[{"id":"741c6acbed17d504","type":"tab","label":"[analytics] Node-RED Community catalogue","disabled":false,"info":"### Description\n\nA basic analysis of the Node-RED Community catalogue, which provides the basis for the packages installable within Node-RED.\n\n![img](https://cdn.openmindmap.org/content/1698262081584_Screen_Shot_2023-10-25_at_21.27.57.png)\n\n![img](https://cdn.openmindmap.org/content/1698262103086_Screen_Shot_2023-10-25_at_21.28.19.png)\n\n![img](https://cdn.openmindmap.org/content/1698262124007_Screen_Shot_2023-10-25_at_21.28.40.png)\n\n","env":[]},{"id":"50d3daf2d40242cd","type":"group","z":"741c6acbed17d504","name":"download numbers - last week","style":{"label":true},"nodes":["f84248691ed06d3d","81183f4703a06f49","8f2128989276a991","67200a1f56d67d09","64f65485e85f9ba7","3e5c72bc75ddc5b7","ab60574324c52a44","d8bf6929c3458b1d","0d5024c37044c70a","56d2378be86a91d3","df18d1223b13f05a","8250415e5f2c89cd","3e34e30ee81ea525","7795563e2648cb7a","200dd7b329a4191e","5a18cef8307f4179","e381d4b2527eb33b","02c2b8d03169a734"],"x":3004.8330078125,"y":359.999727521624,"w":1572.5,"h":433.666748046875},{"id":"9b48b443f84a0653","type":"group","z":"741c6acbed17d504","name":"how many downloads are defined?","style":{"label":true},"nodes":["359d48a6b99d46c9","2d9d68e96c33a00b","e5dee8ee63cc44c3","e927cfffadbcf09a"],"x":3710.3330078125,"y":835.1069194248745,"w":867,"h":82},{"id":"f98a6a1875c36277","type":"group","z":"741c6acbed17d504","name":"retrieve version details","style":{"label":true},"nodes":["0280b91f32c74573","ce3e7eaaf9f9ac2d","f4847a5dba23f723","c0740d5553947cfd","8045064c5212858b","525ff4bef34b3a66","431906ed74e84938","8b993b2ec9fecad0","042c5cb781781ffe","a0af637a6816c6e7","8f7f852a46655a05","ad21b0ba9c731507","3d4e76c8dc54e012","edde60f0b0917325","0f31a57b165af276","b4baba4cbfaebef8","6f70a024e1b52425","81be659567411e30"],"x":3029.8330154418945,"y":958.54736328125,"w":1547.4999923706055,"h":440.8335437774658},{"id":"8ca7d5fd124078bb","type":"group","z":"741c6acbed17d504","name":"how many versions are defined?","style":{"label":true},"nodes":["1e4ca5108278c8bd","ddd4da103f23a14f","8850a08e7b35d028","cd6ca105174a79b8"],"x":3770.3330078125,"y":1440.8213509150914,"w":807,"h":82},{"id":"83e19bdbfde4f783","type":"group","z":"741c6acbed17d504","name":"download numbers - last month","style":{"label":true},"nodes":["f82bed0ba8594cea","01c4e8546909eacb","b505825f2572ee86","8ff36b94c1512a3c","6c76540a2ef329ac","8f0e1ff45bebbf7a","9bf3e530f3f846d4","5b43686e8d5161aa","7b85c12ba013c53d","4ccd999609548e4c","e34f354516d86101","9c05960e1ff6dc3c","447c127e68856e28","152b119440a63bc1","d59e0a07f6f84fdf","4d9b4c52dce3fdf4","0b6fced32cfb7c80","1921a9a32d5a9878"],"x":3004.8330078125,"y":1564.261794771467,"w":1572.5,"h":433.666748046875},{"id":"d54435d4060a54b4","type":"group","z":"741c6acbed17d504","name":"how many downloads are defined?","style":{"label":true},"nodes":["4e60fdf7e8c4797f","08d6c76ad5c973a1","850ab2115c8d4cd0","7cc9dd2e4a07ac16"],"x":3650.3330078125,"y":2039.3689866747177,"w":927,"h":82},{"id":"fa640e80decc9bc5","type":"group","z":"741c6acbed17d504","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["c1e3e3106852730b","decbcd79400f7463","8c201d5953b3ca23","021431979e0d32d2"],"x":2476.999877929687,"y":279.33330372401656,"w":457.00000000000045,"h":160},{"id":"763a9a3a19e3e566","type":"group","z":"741c6acbed17d504","name":"download numbers - last month","style":{"label":true},"nodes":["2230441c8da6753d","6819c8ec63305b67","6cb9d69563fbde69","7e1f12a867a4eebf","2a9d1725f4e61ea9","c2af0e3635fd2d79","01ab63cd6d588d93","b90b8e6feee3063a","67ed67193e9b4bed","78e20e5e110959a9","203760d36862264f","6a75e0693b9b3d5b","fdb0b52bbfaf2d1d","ea0a1d0be603cf50","3930fb99a0e941de","7472483711227f66","d7fa312520baad1e","6fced96b3ef2fa2e"],"x":3004.8330078125,"y":2162.8094305310933,"w":1572.5,"h":433.666748046875},{"id":"9e12e45c53d302e1","type":"group","z":"741c6acbed17d504","name":"how many downloads are defined?","style":{"label":true},"nodes":["2c4902d306776857","2fba82f963fc36b9","b61ba8d10ac5b49a","4f8ba2a5cf54b3d5"],"x":3670.3330078125,"y":2637.9166224343435,"w":907,"h":82},{"id":"206d219714878a64","type":"http request","z":"741c6acbed17d504","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":832.6662292480469,"y":1298.999971662249,"wires":[["f544e75095b4b089","a9e223ba3da5fd6c","d4a8db88a2d62d2b","142f96b4a47de0ec","e51fbfae8f6f88d4","e6d53528d2196e15","fb5a017272acb096","9792fe31e9eb49ec","ca3f486d4be3fb14","2f0167db58f7ce54","27e9cacefbc9e0e0","50b0c642f7829303","25bc3304e70968ae","2a1248ce7e1ac372","060ee3fec1be0dc9"]]},{"id":"db7468f93f6d28c4","type":"inject","z":"741c6acbed17d504","name":"Generate initial data","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":553.1106719970703,"y":1298.999971662249,"wires":[["206d219714878a64"]]},{"id":"f544e75095b4b089","type":"debug","z":"741c6acbed17d504","name":"debug 48","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":777.9995422363281,"y":1413.3332433700562,"wires":[]},{"id":"dec7a25e92772aec","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":4,"width":12,"height":20,"label":"top keywords, used by at least 10 modules","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":722.499971662249,"wires":[[]]},{"id":"a9e223ba3da5fd6c","type":"function","z":"741c6acbed17d504","name":"top keywords","func":"var keywords = {};\nmsg.payload.modules.forEach(function(module) {\n    (module.keywords || []).forEach(function(keyword) {\n        keyword = keyword.toLowerCase()\n        keywords[keyword] ||= 0\n        keywords[keyword] += 1\n    });\n});\n\n\ndelete keywords[\"node-red\"]\ndelete keywords[\"node-red-contrib\"]\ndelete keywords[\"node-red-contrib-contribgen\"]\n// delete keywords[\"iot\"]\ndelete keywords[\"node\"]\ndelete keywords[\"nodered\"]\n\nvar keys = Object.keys(keywords);\nvar kvs = keys.map((k) => { return [k, keywords[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.filter( (v) => { return v[1] > 9 }).map((v) => { return v[0]}),\n    \"data\": kvs.filter((v) => { return v[1] > 9 }).map((v) => { return [v[1]] }),\n    \"labels\": [\"Keywords\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1476.3331413269043,"y":722.499971662249,"wires":[["dec7a25e92772aec"]]},{"id":"d4a8db88a2d62d2b","type":"function","z":"741c6acbed17d504","name":"updates per day","func":"var lastestUpdates = {};\nvar limitToLastXDays = 3000;\n\n[...new Array(limitToLastXDays)].map((i, idx) => {\n    lastestUpdates[moment().startOf(\"day\").subtract(idx, \"days\").format(\"YYYY-MM-DD\")] = 0 \n});\n\nmsg.payload.modules.forEach(function(module) {\n    module.updated_at = module.updated_at.split(\"T\")[0]\n\n    lastestUpdates[module.updated_at] ||= 0\n    lastestUpdates[module.updated_at] += 1\n});\n\nvar keys = Object.keys(lastestUpdates);\nvar kvs = keys.map((k) => { return [k, lastestUpdates[k]]})\n// kvs = kvs.sort( (a,b) => { return Date.parse(a[0]) < Date.parse(b[0]) ? 1 : -1 })\n\nkvs.length = limitToLastXDays\n\nmsg.payload = [{\n    \"series\": [\"Updates\"],\n    \"data\": [kvs.map((v) => { return { x: v[0], y: v[1]} })],\n    \"labels\": [\"Days\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"}],"x":1476.3331413269043,"y":803.499971662249,"wires":[["bdcf58f8b5f0a53f"]]},{"id":"bdcf58f8b5f0a53f","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"d096a52e52c86d2a","order":4,"width":"24","height":"21","label":"updates per day","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":"300","removeOlderPoints":"3000","removeOlderUnit":"604800","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2566.999755859375,"y":803.499971662249,"wires":[[]]},{"id":"142f96b4a47de0ec","type":"function","z":"741c6acbed17d504","name":"top version numbers","func":"var topVersionNunbers = {};\n\nmsg.payload.modules.forEach(function(module) {\n    topVersionNunbers[module.version] ||= 0\n    topVersionNunbers[module.version] += 1\n});\n\nvar keys = Object.keys(topVersionNunbers);\nvar kvs = keys.map((k) => { return [k, topVersionNunbers[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Versions\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1496.3331413269043,"y":902.999971662249,"wires":[["da734d225bc3a03b"]]},{"id":"da734d225bc3a03b","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":5,"width":12,"height":20,"label":"top 100 version numbers","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2596.999755859375,"y":902.999971662249,"wires":[[]]},{"id":"e51fbfae8f6f88d4","type":"function","z":"741c6acbed17d504","name":"last 100 updates","func":"var latestPackageUpdates = [];\n\nmsg.payload.modules.forEach(function(module) {\n    latestPackageUpdates.push([\n        module.id,\n        module.updated_at.split(\"T\")[0],\n        module.description,\n        module.version,\n        module.keywords\n    ])\n});\n\nkvs = latestPackageUpdates.sort( (a,b) => { return Date.parse(a[1]) <= Date.parse(b[1]) ? 1 : -1 })\n\nkvs.length = 100\n\nmsg.payload = kvs.map((v) => {\n    return {\n        \"value\": v[0],\n        \"date\": v[1],\n        \"desc\": v[2],\n        \"version\": v[3],\n        \"tags\": (v[4] || []).map(d => { return { tag: d } })\n    }\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1486.3331413269043,"y":1019.999971662249,"wires":[["d34e2aac0af1c3b4"]]},{"id":"696d4b7a9edc9456","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List of latest updated packages","order":11,"width":12,"height":15,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2616.999755859375,"y":1019.999971662249,"wires":[[]]},{"id":"d34e2aac0af1c3b4","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{date}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br>\n  <i>{{ desc }}</i>\n  </dd>\n{{/payload}}\n</dl>\n","output":"str","x":1872.6663703918457,"y":1019.999971662249,"wires":[["696d4b7a9edc9456"]]},{"id":"476d44ecaa16b0f0","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"TItle","order":10,"width":12,"height":1,"format":"<h2>Last 100 package Updates</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":973.999971662249,"wires":[[]]},{"id":"e6d53528d2196e15","type":"function","z":"741c6acbed17d504","name":"top major version number","func":"var topVersionNunbers = {};\n\nmsg.payload.modules.forEach(function(module) {\n    topVersionNunbers[module.version.split(\".\")[0]] ||= 0\n    topVersionNunbers[module.version.split(\".\")[0]] += 1\n});\n\nvar keys = Object.keys(topVersionNunbers);\nvar kvs = keys.map((k) => { return [k, topVersionNunbers[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Major Version\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1506.3331413269043,"y":1101.499971662249,"wires":[["cd46143e9a042d89"]]},{"id":"cd46143e9a042d89","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":6,"width":12,"height":20,"label":"top major version number (major.minor.patch)","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2666.999755859375,"y":1101.499971662249,"wires":[[]]},{"id":"fb5a017272acb096","type":"function","z":"741c6acbed17d504","name":"highest defined types","func":"var typeCounts = {};\n\nmsg.payload.modules.forEach(function(module) {\n    typeCounts[module.types.length] ||= 0\n    typeCounts[module.types.length] += 1\n});\n\nvar keys = Object.keys(typeCounts);\nvar kvs = keys.map((k) => { return [k, typeCounts[k]]})\nkvs = kvs.sort( (a,b) => { return parseInt(a[0]) > parseInt(b[0]) ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Type counts\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1496.3331413269043,"y":1185.499971662249,"wires":[["fc97bcdb069767a2"]]},{"id":"fc97bcdb069767a2","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":7,"width":12,"height":20,"label":"number of node types defined by a package","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":1185.499971662249,"wires":[[]]},{"id":"9792fe31e9eb49ec","type":"function","z":"741c6acbed17d504","name":"number of types > 20","func":"var topTypeCounts = [];\n\nmsg.payload.modules.forEach(function(module) {\n    topTypeCounts.push([\n        module.id,\n        module.types.length,\n        module.version,\n        module.description,\n        module.keywords\n    ])\n});\n\nvar kvs = topTypeCounts.filter((d) => { \n    return (parseInt(d[1]) > 19 || parseInt(d[1]) == 0 )\n}).sort( (a,b) => { \n    return parseInt(a[1]) <= parseInt(b[1]) ? 1 : -1 \n})\n\nmsg.payload = kvs.map((v) => {\n    return {\n        \"value\": v[0],\n        \"count\": parseInt(v[1]),\n        \"version\": v[2],\n        \"desc\": v[3],\n        \"tags\": (v[4]||[]).map( d => { return { tag: d }})\n    }\n})\n\nreturn [\n    {\n        ...msg,\n        payload: msg.payload.filter( d => { return d.count > 0 })\n    },\n    {\n        ...msg,\n        payload: msg.payload.filter(d => { return d.count == 0 })\n    }\n]","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1496.3331413269043,"y":1298.999971662249,"wires":[["fc1728e12900a63e"],["75ceb26047ef4853"]]},{"id":"26071b19cfe2addb","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List of type counts","order":13,"width":12,"height":15,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2576.999755859375,"y":1291.999971662249,"wires":[[]]},{"id":"fc1728e12900a63e","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":1872.6663703918457,"y":1291.999971662249,"wires":[["26071b19cfe2addb"]]},{"id":"1cbcf2c1fb513439","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"TItle 2","order":12,"width":12,"height":1,"format":"<h2>Packages with the most types defined (above 20)</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":1233.999971662249,"wires":[[]]},{"id":"0de51abc98bd4b1f","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List of packages with no node types defined","order":15,"width":12,"height":15,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2656.999755859375,"y":1405.499971662249,"wires":[[]]},{"id":"75ceb26047ef4853","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":1872.6663703918457,"y":1405.499971662249,"wires":[["0de51abc98bd4b1f"]]},{"id":"d52f1947d0f12e32","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"TItle 3","order":14,"width":12,"height":1,"format":"<h2>Packages with no node types defined</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":1351.999971662249,"wires":[[]]},{"id":"2ba7496fdee9fb94","type":"ui_button","z":"741c6acbed17d504","name":"","group":"0ed53e2825b8c7fb","order":2,"width":"6","height":"6","passthru":false,"label":"Refresh Data","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":397.1108093261719,"y":246.22215175628662,"wires":[["6e28a0aaf183ed8a","7a73184fb136e7db","8849e98ce9b9944f"]]},{"id":"ca3f486d4be3fb14","type":"function","z":"741c6acbed17d504","name":"top package prefixes","func":"var topDevelopers = {};\n\nmsg.payload.modules.forEach(function(module) {\n    var devname = module.id.split(\"/\")\n    if ( devname.length > 1 ) {\n        topDevelopers[devname[0]] ||= 0\n        topDevelopers[devname[0]] += 1\n    }\n});\n\nvar keys = Object.keys(topDevelopers);\nvar kvs = keys.map((k) => { return [k, topDevelopers[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100;\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Prefix\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1496.3331413269043,"y":1466.999971662249,"wires":[["5353fbb10c120179"]]},{"id":"5353fbb10c120179","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":8,"width":12,"height":20,"label":"top 100 package prefixes","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2596.999755859375,"y":1466.999971662249,"wires":[[]]},{"id":"e8c4690585fb2a41","type":"catch","z":"741c6acbed17d504","name":"","scope":null,"uncaught":false,"x":2538.332691192627,"y":480.44450882502974,"wires":[["3fe48b832b51cf6b"]]},{"id":"3fe48b832b51cf6b","type":"debug","z":"741c6acbed17d504","name":"EXCEPTIONS WILL HAPPEN","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2800.443817138672,"y":480.44450882502974,"wires":[]},{"id":"6e28a0aaf183ed8a","type":"change","z":"741c6acbed17d504","name":"reset charts","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2348.3330078125,"y":391.555419921875,"wires":[["dec7a25e92772aec","bdcf58f8b5f0a53f","da734d225bc3a03b","cd46143e9a042d89","fc97bcdb069767a2","696d4b7a9edc9456","26071b19cfe2addb","0de51abc98bd4b1f","5353fbb10c120179","08e9c9ce8d47bd36","c4d0f31a52436e6c","911d68596b80740e","c9f5e8734dc46760","c891cade66e07a2f","d3960b2b800f214f","3fe13dceb4568af8","2c424d5c5477f560","2c5f56500f8481e0","e7f7cc8765d42637","c16e1a149617f22a","16b238d730f2f00b","109f21242d7a0a2e","76d6e701c58d1a9a","c50be1421ee3faa0","4196a221702c7174","2b4002228dca5b61","d31c061fa26fc19a","d5c0b2276b2202a8"]]},{"id":"7a73184fb136e7db","type":"delay","z":"741c6acbed17d504","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":630.4440765380859,"y":743.2221927642822,"wires":[["206d219714878a64"]]},{"id":"2f0167db58f7ce54","type":"function","z":"741c6acbed17d504","name":"top developers","func":"var prefixedPackages = 0;\nvar totalPackages = 0;\n\nmsg.payload.modules.forEach(function(module) {\n    var devname = module.id.split(\"/\")\n\n    totalPackages += 1\n    if ( devname.length > 1 ) {\n        prefixedPackages += 1\n    }\n});\n\nmsg.prefixedPackages = prefixedPackages;\nmsg.totalPackages = totalPackages;\nmsg.nonPrefixedPackages = totalPackages - prefixedPackages;\nmsg.lastUpdated = msg.payload.updated_at;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1476.3331413269043,"y":649.5555746895927,"wires":[["46e5086ca7d0e5d1"]]},{"id":"08e9c9ce8d47bd36","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"Statistics","order":1,"width":12,"height":4,"format":"\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2546.999755859375,"y":649.5555746895927,"wires":[["a8715f06a1e483b2"]]},{"id":"46e5086ca7d0e5d1","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h2>Packages</h2>\n\nTotal: <b>{{ totalPackages }}</b><br>\nPrefixed: <b>{{ prefixedPackages }}</b><br>\nNon-Prefixed: <b>{{ nonPrefixedPackages }}</b><br>\nLast updated at: <b>{{ lastUpdated }}</b><br>\n","output":"str","x":1872.6663703918457,"y":649.5555746895927,"wires":[["08e9c9ce8d47bd36"]]},{"id":"27e9cacefbc9e0e0","type":"function","z":"741c6acbed17d504","name":"last updates by year","func":"var groupByDate = {};\n\nmsg.payload.modules.forEach(function(module) {\n    var day = module.updated_at.split(\"T\")[0];\n\n    var month = day.split(\"-\").slice(0, 2).join(\"-\")\n    var year = day.split(\"-\").slice(0, 1).join(\"-\")\n\n    // groupByDate[month] = (groupByDate[month] || 0) + 1\n    groupByDate[year] = (groupByDate[year] || 0) + 1\n});\n\nvar keys = Object.keys(groupByDate);\nvar kvs = keys.map((k) => { return [k, groupByDate[k]] })\nkvs = kvs.sort((a, b) => { return parseInt(a[0]) < parseInt(b[1]) ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0] }),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Year\"]\n}]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1496.3331413269043,"y":1554.4445689065117,"wires":[["c4d0f31a52436e6c"]]},{"id":"c4d0f31a52436e6c","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":9,"width":12,"height":20,"label":"number of packages updated by year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2636.999755859375,"y":1554.4445689065117,"wires":[[]]},{"id":"50b0c642f7829303","type":"function","z":"741c6acbed17d504","name":"overlapping types","func":"var types = {};\n\nmsg.payload.modules.forEach( (module) => {\n    (module.types || []).forEach( (typ) => {\n        types[typ] = ( types[typ] || [] ).concat( [module.id] )\n    });\n});\n\n// occurs multiple times but seems to be ignored. Some packages\n// define this as a node type several times - some generational \n// error I assume.\ndelete types[\"__errors__\"]; \n\nvar kvs = Object.keys(types).map((k) => { return [k, types[k]]}).filter( (d) => {\n    return d[1].length > 1\n})\nkvs = kvs.sort( (a,b) => { return a[1].length < b[1].length ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1].length] }),\n            \"labels\": [\"Types\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1486.3331413269043,"y":1632.999971662249,"wires":[["911d68596b80740e"],[]]},{"id":"911d68596b80740e","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":3,"width":12,"height":20,"label":"top 100 overlapping package types","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2626.999755859375,"y":1630.999971662249,"wires":[[]]},{"id":"f84248691ed06d3d","type":"function","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"function 10","func":"msg.downloads = msg.downloads || {};\n\nvar module = msg.modules.pop();\n\n/* \n  Url from https://www.edoardoscibona.com/exploring-the-npm-registry-api, possible periods are:\n   - last-year\n   - last-month\n   - last-year\n   - last-day\n*/\nif ( module ) {\n    return [{\n            ...msg,\n            url: \"https://api.npmjs.org/downloads/point/last-week/\" + module.id,\n            module: module,\n            isempty: msg.downloads[module.id] == undefined\n        },\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4298.3330078125,"y":509.749727521624,"wires":[["df18d1223b13f05a"],["7795563e2648cb7a"]]},{"id":"81183f4703a06f49","type":"http request","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3100.8330078125,"y":528.499727521624,"wires":[["3e5c72bc75ddc5b7"]]},{"id":"8f2128989276a991","type":"delay","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4108.499671936035,"y":750.4998381478447,"wires":[["f84248691ed06d3d"]]},{"id":"67200a1f56d67d09","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"debug 49","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":703.687227521624,"wires":[]},{"id":"64f65485e85f9ba7","type":"change","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"get flow.downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4030.3330078125,"y":550.249727521624,"wires":[["f84248691ed06d3d"]]},{"id":"3e5c72bc75ddc5b7","type":"function","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"function 11","func":"msg.downloads = msg.downloads || {}\n\nif (msg.payload.package) {\n    msg.downloads[msg.payload.package] = msg.payload.downloads;\n    \n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3203.3330078125,"y":711.687227521624,"wires":[["ab60574324c52a44"],["e381d4b2527eb33b","8f2128989276a991"]]},{"id":"ab60574324c52a44","type":"change","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","rules":[{"t":"set","p":"downloads","pt":"flow","to":"downloads","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3911.3330078125,"y":703.687227521624,"wires":[["67200a1f56d67d09","8f2128989276a991"]]},{"id":"d8bf6929c3458b1d","type":"inject","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"9600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3423.3330078125,"y":596.249727521624,"wires":[["02c2b8d03169a734"]]},{"id":"0d5024c37044c70a","type":"catch","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","scope":["81183f4703a06f49"],"uncaught":false,"x":3221.3330078125,"y":510.499727521624,"wires":[["56d2378be86a91d3","3e34e30ee81ea525"]]},{"id":"56d2378be86a91d3","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"debug 50","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3405.3330078125,"y":544.499727521624,"wires":[]},{"id":"df18d1223b13f05a","type":"switch","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":3919.3330078125,"y":406.999727521624,"wires":[["8250415e5f2c89cd","f84248691ed06d3d"],["81183f4703a06f49"]]},{"id":"8250415e5f2c89cd","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"debug 51","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":400.999727521624,"wires":[]},{"id":"312691f152807a49","type":"function","z":"741c6acbed17d504","name":"most downloads last week","func":"var kvs = Object.keys(msg.downloads).map((k) => { return [k, msg.downloads[k]]}).filter( (d) => { return d[0] != \"undefined\" })\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Types\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: kvs.map((v) => {\n            var mod = msg.payload.modules.filter((d) => { return d.id == v[0] })[0];\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"version\": mod.version,\n                \"desc\": mod.description,\n                \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n            }\n        })\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1932.6663703918457,"y":2839.9999716622488,"wires":[["c9f5e8734dc46760"],["c407ee428bcd3fb7"],[]]},{"id":"67659a26f732abce","type":"change","z":"741c6acbed17d504","name":"flow.downloads --> downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1526.3331413269043,"y":2839.9999716622488,"wires":[["312691f152807a49"]]},{"id":"c9f5e8734dc46760","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"7278d8bced05b3d5","order":1,"width":"16","height":20,"label":"top 100 downloaded packages - last week","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":2826.9999716622488,"wires":[[]]},{"id":"c407ee428bcd3fb7","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2270.999755859375,"y":2964.9999716622488,"wires":[["c891cade66e07a2f"]]},{"id":"c891cade66e07a2f","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"Top 100 downloaded packages (week)","order":5,"width":"16","height":"16","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2636.999755859375,"y":2965.9999716622488,"wires":[[]]},{"id":"793ef02569caa901","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"TItle 4","order":4,"width":"16","height":1,"format":"<h2>Top 100 downloaded packages - last week numbers</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":2897.9999716622488,"wires":[[]]},{"id":"359d48a6b99d46c9","type":"change","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"flow.downloads --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"downloads","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4060.3330078125,"y":876.1069194248745,"wires":[["e5dee8ee63cc44c3"]]},{"id":"2d9d68e96c33a00b","type":"inject","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3816.3330078125,"y":876.1069194248745,"wires":[["359d48a6b99d46c9"]]},{"id":"e5dee8ee63cc44c3","type":"function","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"function 12","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4301.3330078125,"y":876.1069194248745,"wires":[["e927cfffadbcf09a"]]},{"id":"e927cfffadbcf09a","type":"debug","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"debug 52","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4471.3330078125,"y":876.1069194248745,"wires":[]},{"id":"0280b91f32c74573","type":"function","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"function 13","func":"msg.versions = msg.versions || {};\n\nvar module = msg.modules.pop();\n\nif ( !module ) {\n    return [ \n        undefined,\n        msg\n    ]\n} else {\n    return [\n        {\n            ...msg,\n            url: \"https://registry.npmjs.org/\" + module.id,\n            module: module,\n            isempty: msg.versions[module.id] == undefined,\n        },\n        undefined\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4303.3330078125,"y":1081.29736328125,"wires":[["8f7f852a46655a05"],["3d4e76c8dc54e012"]]},{"id":"ce3e7eaaf9f9ac2d","type":"http request","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3125.8330154418945,"y":1096.1307382583618,"wires":[["525ff4bef34b3a66"]]},{"id":"f4847a5dba23f723","type":"delay","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4134.499572753906,"y":1356.047462463379,"wires":[["0280b91f32c74573"]]},{"id":"c0740d5553947cfd","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"debug 53","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":1290.92236328125,"wires":[]},{"id":"8045064c5212858b","type":"change","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"get flow.versions","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4055.3330078125,"y":1130.0473747253418,"wires":[["0280b91f32c74573"]]},{"id":"525ff4bef34b3a66","type":"function","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"function 14","func":"msg.versions = msg.versions || {}\n\nif (msg.payload._id) {\n    msg.versions[msg.payload._id] = {\n        releases: { ...msg.payload.time },\n        readme: !!msg.payload.readme,\n        readmeFilename: !!msg.payload.readmeFilename,\n        description: msg.payload.description,\n        maintainers: msg.payload.maintainers,\n        contributors: msg.payload.contributors,\n        disttags: { ...msg.payload[\"dist-tags\"] }\n    }\n\n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3283.3330078125,"y":1298.54736328125,"wires":[["431906ed74e84938"],["0f31a57b165af276","f4847a5dba23f723"]]},{"id":"431906ed74e84938","type":"change","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","rules":[{"t":"set","p":"versions","pt":"flow","to":"versions","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3952.3330078125,"y":1290.92236328125,"wires":[["c0740d5553947cfd","f4847a5dba23f723"]]},{"id":"8b993b2ec9fecad0","type":"inject","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"21600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3483.3330078125,"y":1191.54736328125,"wires":[["81be659567411e30"]]},{"id":"042c5cb781781ffe","type":"catch","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","scope":["ce3e7eaaf9f9ac2d"],"uncaught":false,"x":3244.3330078125,"y":1081.04736328125,"wires":[["a0af637a6816c6e7","edde60f0b0917325"]]},{"id":"a0af637a6816c6e7","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"debug 54","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3421.666343688965,"y":1142.0473227500916,"wires":[]},{"id":"8f7f852a46655a05","type":"switch","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":3919.332996368408,"y":999.8807353973389,"wires":[["ad21b0ba9c731507","0280b91f32c74573"],["ce3e7eaaf9f9ac2d"]]},{"id":"ad21b0ba9c731507","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"debug 55","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4469.3330078125,"y":999.54736328125,"wires":[]},{"id":"1e4ca5108278c8bd","type":"change","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"flow.versions --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"versions","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":4072.3330078125,"y":1481.8213509150914,"wires":[["8850a08e7b35d028"]]},{"id":"ddd4da103f23a14f","type":"inject","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3876.3330078125,"y":1481.8213509150914,"wires":[["1e4ca5108278c8bd"]]},{"id":"8850a08e7b35d028","type":"function","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"function 15","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4301.3330078125,"y":1481.8213509150914,"wires":[["cd6ca105174a79b8"]]},{"id":"cd6ca105174a79b8","type":"debug","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"debug 56","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4471.3330078125,"y":1481.8213509150914,"wires":[]},{"id":"25bc3304e70968ae","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1481.3332138061523,"y":1742.6666660308838,"wires":[["cab121243e501204","884cd3f3c28bfe11","fc906ad4a7bc49e6"]]},{"id":"cab121243e501204","type":"function","z":"741c6acbed17d504","name":"top maintainers","func":"var maintainers = {}\nvar yearStarted = {}\n\nmsg.payload.modules.forEach( (mod) => {\n    let packname = mod.id;\n    let version = msg.versions[packname];\n\n    if ( version ) {\n        let year = moment().add(30, 'year').year()\n\n        if (version.releases && version.releases.created) {\n            year = moment(version.releases.created).year()\n        }\n\n        ( (version.maintainers) || []).forEach( (man) => {\n            yearStarted[man.name] = yearStarted[man.name] || []\n            yearStarted[man.name].push(year)\n\n            maintainers[man.name] = (maintainers[man.name] || 0) + 1\n        })\n    }\n})\n\nvar groupByYear = {}\nObject.keys(yearStarted).filter( d => {\n    return jstat.min(yearStarted[d]) <= moment(new Date()).year()\n}).map( d => {\n    return [d, jstat.min(yearStarted[d])]\n}).forEach( d => {\n    groupByYear[d[1]] = (groupByYear[d[1]] || 0) + 1\n})\n\nvar yvs = Object.keys(groupByYear).map((k) => { return [parseInt(k), groupByYear[k]] })\nyvs = yvs.sort((a, b) => { return a[0] < b[0] ? 1 : -1 })\n\nvar kvs = Object.keys(maintainers).map( (k) => { return [k, maintainers[k]]} )\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100;\n\nreturn [{\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Maintainer\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: [{\n            \"series\": yvs.map((v) => { return v[0] }),\n            \"data\": yvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Maintainer total: \" + jstat.sum(yvs.map((v) => { return v[1] }))]\n        }]\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1892.666374206543,"y":1739.333291053772,"wires":[["d3960b2b800f214f"],["b128296d67e6b95e"]]},{"id":"d3960b2b800f214f","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":2,"width":12,"height":20,"label":"overall top 100 package maintainers","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2636.999755859375,"y":1714.3333933694023,"wires":[[]]},{"id":"3e34e30ee81ea525","type":"delay","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3792.3330078125,"y":507.666475568499,"wires":[["f84248691ed06d3d"]]},{"id":"7795563e2648cb7a","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4461.3330078125,"y":577.666475568499,"wires":[]},{"id":"3d4e76c8dc54e012","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4461.3330078125,"y":1150.04736328125,"wires":[]},{"id":"edde60f0b0917325","type":"delay","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3749.3330078125,"y":1076.04736328125,"wires":[["0280b91f32c74573"]]},{"id":"200dd7b329a4191e","type":"inject","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"Reset","props":[{"p":"payload"}],"repeat":"82800","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3269.0830078125,"y":649.666475568499,"wires":[["5a18cef8307f4179"]]},{"id":"5a18cef8307f4179","type":"change","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","rules":[{"t":"set","p":"downloads","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3468.0830078125,"y":649.666475568499,"wires":[["02c2b8d03169a734"]]},{"id":"b4baba4cbfaebef8","type":"inject","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"Reset","props":[{"p":"payload"}],"repeat":"75600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3345.416305541992,"y":1248.04740524292,"wires":[["6f70a024e1b52425"]]},{"id":"6f70a024e1b52425","type":"change","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","rules":[{"t":"set","p":"versions","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3549.416305541992,"y":1248.04740524292,"wires":[["81be659567411e30"]]},{"id":"e381d4b2527eb33b","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"empty download data","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3424.0830078125,"y":752.666475568499,"wires":[]},{"id":"0f31a57b165af276","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"empty version data","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3510.0830307006836,"y":1358.3809070587158,"wires":[]},{"id":"884cd3f3c28bfe11","type":"function","z":"741c6acbed17d504","name":"active maintainers","func":"var maintainers = {}\n\nvar twelveMonthsAgo = moment().subtract(1,'year')\n\nmsg.payload.modules.filter( (module) => {\n    return Date.parse(module.updated_at) > twelveMonthsAgo\n}).forEach( (module) => {\n    var version = msg.versions[module.id]\n    if ( version ) {\n        (version.maintainers || []).forEach( (mt) => {\n            maintainers[mt.name] = maintainers[mt.name] || {}\n            maintainers[mt.name][module.id] = true\n        })\n    }\n})\n\nvar kvs = Object.keys(maintainers).map((k) => { return [k, Object.keys(maintainers[k]).length] })\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar all_kvs = [...kvs]\n\nkvs.length = 100\n\nreturn [ \n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"\"]\n        }]\n    },\n    {\n        ...msg,\n        total: all_kvs.length,\n        payload: all_kvs.map((v) => {\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"modules\": Object.keys(maintainers[v[0]]).map( (d) => { return {name: d}}),\n            }\n        })\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"}],"x":1904.3330001831055,"y":1813.3330478668213,"wires":[["3fe13dceb4568af8"],["66ab8082e928f254"]]},{"id":"3fe13dceb4568af8","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":4,"width":12,"height":20,"label":"top 100 maintainers active last 12 months","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2646.999755859375,"y":1811.9997675759453,"wires":[[]]},{"id":"66ab8082e928f254","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://www.npmjs.com/~{{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd>{{#modules}}{{name}},{{/modules}}</dd>\n{{/payload}}\n</dl>\n","output":"str","x":2270.999755859375,"y":1907.999971662249,"wires":[["2c424d5c5477f560"]]},{"id":"2c424d5c5477f560","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"Top mainters last year","order":6,"width":12,"height":15,"format":"## Total: {{msg.total}}\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2586.999755859375,"y":1904.999971662249,"wires":[[]]},{"id":"0fc3f42a0142747d","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"TItle 5","order":5,"width":12,"height":1,"format":"<h2>Maintainers active in the last 12 months</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":1854.999971662249,"wires":[[]]},{"id":"f82bed0ba8594cea","type":"function","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"function 17","func":"msg.downloads = msg.downloads || {};\n\nvar module = msg.modules.pop();\n\n/* \n  Url from https://www.edoardoscibona.com/exploring-the-npm-registry-api, possible periods are:\n   - last-year\n   - last-month\n   - last-year\n   - last-day\n*/\nif ( module ) {\n    return [{\n            ...msg,\n            url: \"https://api.npmjs.org/downloads/point/last-month/\" + module.id,\n            module: module,\n            isempty: msg.downloads[module.id] == undefined\n        },\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4298.3330078125,"y":1714.011794771467,"wires":[["e34f354516d86101"],["152b119440a63bc1"]]},{"id":"01c4e8546909eacb","type":"http request","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3100.8330078125,"y":1732.761794771467,"wires":[["8f0e1ff45bebbf7a"]]},{"id":"b505825f2572ee86","type":"delay","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4108.499671936035,"y":1954.7619053976878,"wires":[["f82bed0ba8594cea"]]},{"id":"8ff36b94c1512a3c","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"debug 57","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":1907.949294771467,"wires":[]},{"id":"6c76540a2ef329ac","type":"change","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"get flow.downloads_last_month","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_month","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3994.3330078125,"y":1751.511794771467,"wires":[["f82bed0ba8594cea"]]},{"id":"8f0e1ff45bebbf7a","type":"function","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"function 18","func":"msg.downloads = msg.downloads || {}\n\nif (msg.payload.package) {\n    msg.downloads[msg.payload.package] = msg.payload.downloads;\n    \n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3203.3330078125,"y":1915.949294771467,"wires":[["9bf3e530f3f846d4"],["0b6fced32cfb7c80","b505825f2572ee86"]]},{"id":"9bf3e530f3f846d4","type":"change","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","rules":[{"t":"set","p":"downloads_last_month","pt":"flow","to":"downloads","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3951.3330078125,"y":1907.949294771467,"wires":[["8ff36b94c1512a3c","b505825f2572ee86"]]},{"id":"5b43686e8d5161aa","type":"inject","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"12600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3423.3330078125,"y":1800.511794771467,"wires":[["1921a9a32d5a9878"]]},{"id":"7b85c12ba013c53d","type":"catch","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","scope":["01c4e8546909eacb"],"uncaught":false,"x":3221.3330078125,"y":1714.761794771467,"wires":[["4ccd999609548e4c","447c127e68856e28"]]},{"id":"4ccd999609548e4c","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"debug 58","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3405.3330078125,"y":1748.761794771467,"wires":[]},{"id":"e34f354516d86101","type":"switch","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":3919.3330078125,"y":1611.261794771467,"wires":[["9c05960e1ff6dc3c","f82bed0ba8594cea"],["01c4e8546909eacb"]]},{"id":"9c05960e1ff6dc3c","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"debug 59","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":1605.261794771467,"wires":[]},{"id":"447c127e68856e28","type":"delay","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3792.3330078125,"y":1711.928542818342,"wires":[["f82bed0ba8594cea"]]},{"id":"152b119440a63bc1","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4461.3330078125,"y":1781.928542818342,"wires":[]},{"id":"d59e0a07f6f84fdf","type":"inject","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"Reset","props":[{"p":"payload"}],"repeat":"78000","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3269.0830078125,"y":1853.928542818342,"wires":[["4d9b4c52dce3fdf4"]]},{"id":"4d9b4c52dce3fdf4","type":"change","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","rules":[{"t":"set","p":"downloads_last_month","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3487.0830078125,"y":1853.928542818342,"wires":[["1921a9a32d5a9878"]]},{"id":"0b6fced32cfb7c80","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"empty download data","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3424.0830078125,"y":1956.928542818342,"wires":[]},{"id":"4e60fdf7e8c4797f","type":"change","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"flow.downloads_last_month --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"downloads_last_month","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4020.3330078125,"y":2080.3689866747177,"wires":[["850ab2115c8d4cd0"]]},{"id":"08d6c76ad5c973a1","type":"inject","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3756.3330078125,"y":2080.3689866747177,"wires":[["4e60fdf7e8c4797f"]]},{"id":"850ab2115c8d4cd0","type":"function","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"function 19","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4301.3330078125,"y":2080.3689866747177,"wires":[["7cc9dd2e4a07ac16"]]},{"id":"7cc9dd2e4a07ac16","type":"debug","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"debug 60","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4471.3330078125,"y":2080.3689866747177,"wires":[]},{"id":"423676957b2e0deb","type":"function","z":"741c6acbed17d504","name":"most downloads last month","func":"var kvs = Object.keys(msg.downloads).map((k) => { return [k, msg.downloads[k]]}).filter( (d) => { return d[0] != \"undefined\" })\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Types\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: kvs.map((v) => {\n            var mod = msg.payload.modules.filter((d) => { return d.id == v[0] })[0];\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"version\": mod.version,\n                \"desc\": mod.description,\n                \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n            }\n        })\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1932.6663703918457,"y":2634.3332236153738,"wires":[["2c5f56500f8481e0"],["b21394f0fd1529b0"],[]]},{"id":"acb70287893b47e6","type":"change","z":"741c6acbed17d504","name":"flow.downloads_last_month --> downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_month","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1566.3331413269043,"y":2634.3332236153738,"wires":[["423676957b2e0deb"]]},{"id":"2c5f56500f8481e0","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"7278d8bced05b3d5","order":2,"width":"16","height":20,"label":"top 100 downloaded packages - last month","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":2621.3332236153738,"wires":[[]]},{"id":"b21394f0fd1529b0","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2270.999755859375,"y":2759.3332236153738,"wires":[["e7f7cc8765d42637"]]},{"id":"e7f7cc8765d42637","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"Top 100 downloaded packages (month)","order":7,"width":"16","height":"16","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2646.999755859375,"y":2760.3332236153738,"wires":[[]]},{"id":"dc93aa963ca8683b","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"TItle 6","order":6,"width":"16","height":1,"format":"<h2>Top 100 downloaded packages - last month numbers</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":2692.3332236153738,"wires":[[]]},{"id":"a8715f06a1e483b2","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1849.999626159668,"y":461.66663769313277,"wires":[["2ba7496fdee9fb94"]]},{"id":"2d23825607b33059","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":411.66644287109375,"y":126.66662788391113,"wires":[["2ba7496fdee9fb94"]]},{"id":"8849e98ce9b9944f","type":"delay","z":"741c6acbed17d504","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":609.9997482299805,"y":183.33328247070312,"wires":[["2d23825607b33059"]]},{"id":"2a1248ce7e1ac372","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow"},{"t":"set","p":"downloads","pt":"msg","to":"downloads","tot":"flow"},{"t":"set","p":"downloads_last_month","pt":"msg","to":"downloads_last_month","tot":"flow"},{"t":"set","p":"downloads_last_year","pt":"msg","to":"downloads_last_year","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1476.3331413269043,"y":1974.999971662249,"wires":[["b110eaf6482b4c19","e6d146cc9716633a"]]},{"id":"b110eaf6482b4c19","type":"function","z":"741c6acbed17d504","name":"active maintainers, maintainers that dropped out and the rest","func":"var maintainers = {}\n\nvar now = new Date()\nvar monthsAgo = {}\n\nfor ( var y = 0; y < 11; y++ ) {\n    monthsAgo[12 * y] = moment(now).subtract(12 * y, 'month')\n    maintainers[y] = {}\n}\n\nvar allMaintainers = {}\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id]\n    if (version) {\n        (version.maintainers || []).forEach((mt) => {\n            allMaintainers[mt.name] = allMaintainers[mt.name] || {}\n            allMaintainers[mt.name][module.id] = true\n        })\n    }\n});\n\nfor (var y = 0; y < 10; y++) {\n    msg.payload.modules.filter( (module) => {\n        var d = Date.parse(module.updated_at);\n        return ( monthsAgo[y * 12] > d ) && ( d > monthsAgo[(y+1)*12] )\n    }).forEach( (module) => {\n        var version = msg.versions[module.id]\n        if ( version ) {\n            (version.maintainers || []).forEach( (mt) => {\n                maintainers[y][mt.name] = maintainers[y][mt.name] || {}\n                maintainers[y][mt.name][module.id] = true\n            })\n        }\n    })\n}\n\nvar here12 = Object.keys(maintainers[0])\nvar gone24 = Object.keys(maintainers[1])\nvar gone36 = Object.keys(maintainers[2])\nvar gone48 = Object.keys(maintainers[3])\nvar gone60 = Object.keys(maintainers[4])\nvar gone72 = Object.keys(maintainers[5])\nvar gone84 = Object.keys(maintainers[6])\nvar gone96 = Object.keys(maintainers[7])\nvar gone108 = Object.keys(maintainers[8])\n\ngone24 = gone24.filter( (x) => {\n    return here12.indexOf(x) < 0\n});\n\ngone36 = gone36.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0\n});\n\ngone48 = gone48.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0\n});\n\ngone60 = gone60.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0\n});\n\ngone72 = gone72.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0\n});\n\ngone84 = gone84.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0 && gone72.indexOf(x) < 0\n});\n\ngone96 = gone96.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0 && gone72.indexOf(x) < 0 && gone84.indexOf(x) < 0\n});\n\ngone108 = gone108.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0 && gone72.indexOf(x) < 0 && gone84.indexOf(x) < 0 && gone96.indexOf(x) < 0\n});\n\nvar kvs = [\n    [\"12m\", here12],\n    [\"24m\", gone24],\n    [\"36m\", gone36],\n    [\"48m\", gone48],\n    [\"60m\", gone60],\n    [\"72m\", gone72],\n    [\"84m\", gone84],\n    [\"96m\", gone96],\n    [\"108m\", gone108],\n]\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0] }),\n    \"data\": kvs.map((v) => { return [v[1].length] }),\n    \"labels\": [\"Last Active - Total: \" + Object.keys(allMaintainers).length]\n}]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"}],"x":2032.6663703918457,"y":1974.999971662249,"wires":[["c16e1a149617f22a"]]},{"id":"c16e1a149617f22a","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":9,"width":12,"height":20,"label":"when where maintainers last active","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2626.999755859375,"y":1973.999971662249,"wires":[[]]},{"id":"e6d146cc9716633a","type":"function","z":"741c6acbed17d504","name":"average time maintaining code","func":"var now = new Date()\nvar allMaintainers = {}\nvar releaseCounts = {}\nvar firstReleaseEver = moment(now).add(30, 'year');\n\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id]\n\n    if (version) {\n        \n        releaseCounts[module.id] = Object.keys(version.releases|| {}).length - 2; // -2 because there is \"created\" and \"modified\"\n\n        (version.maintainers || []).forEach((mt) => {\n            allMaintainers[mt.name] = allMaintainers[mt.name] || {\n                started: moment(now).add(30,'year'),\n                stopped: -1\n            }\n\n            let latestRelease = version.releases[version.disttags && version.disttags.latest]\n            let firstRelease = Date.parse(version.releases[\"created\"])\n\n            firstReleaseEver = Math.min(firstReleaseEver, firstRelease)\n\n            allMaintainers[mt.name].started = Math.min(allMaintainers[mt.name].started, firstRelease)\n            if ( latestRelease) {\n                allMaintainers[mt.name].stopped = Math.max(allMaintainers[mt.name].stopped, Date.parse(latestRelease))\n            }\n        })\n    }\n});\n\nvar data = Object.values(allMaintainers).filter( d => {\n    return d.started < now && d.stopped > 0 && d.started < d.stopped \n}).map( d => {\n    return moment.duration(d.stopped - d.started, 'milliseconds').asMonths();\n})\n\nvar rCnt = Object.values(releaseCounts).filter( d => {\n    return d > 0\n})\n\nvar relPercentiles = [...new Array(10)].map((i, idx) => {\n    return [(10*idx+1), jstat.percentile(rCnt, (10*idx+1) / 100)]\n});\n\nvar actPercentiles = [...new Array(10)].map((i, idx) => {\n    return [10*idx+1, jstat.percentile(data, (10*idx + 1) / 100)]\n});\n\nvar nodereddetails = {}\nif ( msg.versions[\"node-red\"]) {\n    let nrVersions = msg.versions[\"node-red\"];\n\n    if (nrVersions.releases){\n        nodereddetails[\"releases\"] = Object.keys(nrVersions.releases).length - 2\n        nodereddetails[\"first_release\"] = moment(Date.parse(nrVersions.releases[\"created\"])).format(\"dddd, MMMM Do YYYY, h:mm:ss a\")\n    }\n\n    nodereddetails[\"dwns\"] = {\n        \"lastweek\": msg.downloads[\"node-red\"] || -1,\n        \"lastmonth\": msg.downloads_last_month[\"node-red\"] || -1,\n        \"lastyear\": msg.downloads_last_year[\"node-red\"] || -1\n    }\n}\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": relPercentiles.map((v) => { return v[0] }),\n            \"data\": relPercentiles.map((v) => { return [v[1]] }),\n            \"labels\": [\"Percentile\"]\n        }]\n    },\n\n    {\n        ...msg,\n        payload: [{\n            \"series\": actPercentiles.map((v) => { return v[0] }),\n            \"data\": actPercentiles.map((v) => { return [v[1]] }),\n            \"labels\": [\"Percentile\"]\n        }]\n    },\n    \n    {\n        ...msg,\n        payload: {\n            release_count: {\n                avg: jstat.median(rCnt),\n                mean: jstat.mean(rCnt),\n                max: jstat.max(rCnt),\n                per90: jstat.percentile(rCnt, 0.9)\n            },\n            maintainers_stay: {\n                avg: jstat.median(data),\n                mean: jstat.mean(data),\n                max: jstat.max(data),\n                per90: jstat.percentile(data, 0.9)\n            },\n            totals: {\n                maintainers: Object.keys(allMaintainers).length,\n                packages: msg.payload.modules.length,\n                first_package_released: moment(firstReleaseEver).format(\"dddd, MMMM Do YYYY, h:mm:ss a\")\n            },\n            nodered: nodereddetails\n        }\n    }\n]\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1942.6663703918457,"y":2044.9999716622488,"wires":[["16b238d730f2f00b"],["109f21242d7a0a2e"],["168bf5e7d110f9d2"]]},{"id":"16b238d730f2f00b","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":10,"width":"12","height":"21","label":"releases per package","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":"300","removeOlderPoints":"100","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2586.999755859375,"y":2035.999971662249,"wires":[[]]},{"id":"109f21242d7a0a2e","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":11,"width":"12","height":"21","label":"months developer active","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":"300","removeOlderPoints":"100","removeOlderUnit":"604800","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2596.999755859375,"y":2083.9999716622488,"wires":[[]]},{"id":"168bf5e7d110f9d2","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h3>Releases per package</h3>\n<dl>\n  {{#payload}}\n  {{#release_count}}\n  <dt>Average</dt>\n  <dd>{{ avg }}</dd>\n  <dt>Mean</dt>\n  <dd>{{ mean }}</dd>\n  <dt>90th Percentile</dt>\n  <dd>{{ per90 }}</dd>\n  <dt>Max</dt>\n  <dd>{{ max }}</dd>\n  {{/release_count}}\n  {{/payload}}\n</dl>\n\n<h3>In <b>months</b>: how long are maintainers active?</h3>\n<dl>\n  {{#payload}}\n  {{#maintainers_stay}}\n  <dt>Average</dt>\n  <dd>{{ avg }}</dd>\n  <dt>Mean</dt>\n  <dd>{{ mean }}</dd>\n  <dt>90th Percentile</dt>\n  <dd>{{ per90 }}</dd>\n  <dt>Max</dt>\n  <dd>{{ max }}</dd>\n  {{/maintainers_stay}}\n  {{/payload}}\n</dl>\n\n<h3>Absolutes</h3>\n<dl>\n  {{#payload}}\n  <dt>Total package maintainers</dt>\n  <dd>{{ totals.maintainers }}</dd>\n  <dt>Total packages</dt>\n  <dd>{{ totals.packages }}</dd>\n  <dt>First package released</dt>\n  <dd>{{ totals.first_package_released }}</dd>\n  {{/payload}}\n</dl>\n\n<h3>Node-RED</h3>\n<dl>\n  {{#payload}}\n  {{#nodered}}\n  <dt>Total Releases</dt>\n  <dd>{{ releases }}</dd>\n  <dt>First Release</dt>\n  <dd>{{ first_release }}</dd>\n  {{#dwns}}\n  <dt>Last Week</dt>\n  <dd>{{ lastweek }}</dd>\n  <dt>Last Month</dt>\n  <dd>{{ lastmonth }}</dd>\n  <dt>Last Year</dt>\n  <dd>{{ lastyear }}</dd>\n  {{/dwns}}\n  {{/nodered}}\n  {{/payload}}\n</dl>\n","output":"str","x":2270.999755859375,"y":2186.9999716622488,"wires":[["76d6e701c58d1a9a"]]},{"id":"76d6e701c58d1a9a","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"Release and developer active stats","order":13,"width":12,"height":15,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2626.999755859375,"y":2185.9999716622488,"wires":[[]]},{"id":"ca12352a07269104","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"TItle 7","order":12,"width":"12","height":1,"format":"<h2>Developer active and release counts</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2536.999755859375,"y":2131.9999716622488,"wires":[[]]},{"id":"c1e3e3106852730b","type":"link in","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"package list with node-red","links":[],"x":2517.999877929687,"y":371.3333037240161,"wires":[["decbcd79400f7463"]]},{"id":"decbcd79400f7463","type":"http request","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"GET package catalogue","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":2699.9998779296875,"y":320.33330372401656,"wires":[["8c201d5953b3ca23"]]},{"id":"8c201d5953b3ca23","type":"function","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"add node-red as a module","func":"\nmsg.payload.modules.push({\n    id: \"node-red\",\n    version: \"3.1.0\",\n    description: \"Low-code programming for event-driven applications\",\n    updated_at: new Date(),\n    types: [],\n    keywords: [],\n    url: \"https://nodered.org\"\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2712.9998779296875,"y":398.33330372401656,"wires":[["021431979e0d32d2"]]},{"id":"021431979e0d32d2","type":"link out","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"link out 122","mode":"return","links":[],"x":2892.9998779296875,"y":354.33330372401656,"wires":[]},{"id":"1921a9a32d5a9878","type":"link call","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3775.3330078125,"y":1800.178542818342,"wires":[["6c76540a2ef329ac"]]},{"id":"81be659567411e30","type":"link call","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3827.3330078125,"y":1191.5475578308105,"wires":[["8045064c5212858b"]]},{"id":"02c2b8d03169a734","type":"link call","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3784.3330078125,"y":595.999971662249,"wires":[["64f65485e85f9ba7"]]},{"id":"2230441c8da6753d","type":"function","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"function 20","func":"msg.downloads = msg.downloads || {};\n\nvar module = msg.modules.pop();\n\n/* \n  Url from https://www.edoardoscibona.com/exploring-the-npm-registry-api, possible periods are:\n   - last-year\n   - last-month\n   - last-year\n   - last-day\n*/\nif ( module ) {\n    return [{\n            ...msg,\n            url: \"https://api.npmjs.org/downloads/point/last-year/\" + module.id,\n            module: module,\n            isempty: msg.downloads[module.id] == undefined\n        },\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4298.3330078125,"y":2312.5594305310933,"wires":[["203760d36862264f"],["ea0a1d0be603cf50"]]},{"id":"6819c8ec63305b67","type":"http request","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3100.8330078125,"y":2331.3094305310933,"wires":[["c2af0e3635fd2d79"]]},{"id":"6cb9d69563fbde69","type":"delay","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4108.499671936035,"y":2553.309541157314,"wires":[["2230441c8da6753d"]]},{"id":"7e1f12a867a4eebf","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"debug 61","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":2506.4969305310933,"wires":[]},{"id":"2a9d1725f4e61ea9","type":"change","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"get flow.downloads_last_year","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_year","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3994.3330078125,"y":2350.0594305310933,"wires":[["2230441c8da6753d"]]},{"id":"c2af0e3635fd2d79","type":"function","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"function 21","func":"msg.downloads = msg.downloads || {}\n\nif (msg.payload.package) {\n    msg.downloads[msg.payload.package] = msg.payload.downloads;\n    \n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3203.3330078125,"y":2514.4969305310933,"wires":[["01ab63cd6d588d93"],["d7fa312520baad1e","6cb9d69563fbde69"]]},{"id":"01ab63cd6d588d93","type":"change","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","rules":[{"t":"set","p":"downloads_last_year","pt":"flow","to":"downloads","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3941.3330078125,"y":2506.4969305310933,"wires":[["7e1f12a867a4eebf","6cb9d69563fbde69"]]},{"id":"b90b8e6feee3063a","type":"inject","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"13800","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3423.3330078125,"y":2399.0594305310933,"wires":[["6fced96b3ef2fa2e"]]},{"id":"67ed67193e9b4bed","type":"catch","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","scope":["6819c8ec63305b67"],"uncaught":false,"x":3221.3330078125,"y":2313.3094305310933,"wires":[["78e20e5e110959a9","fdb0b52bbfaf2d1d"]]},{"id":"78e20e5e110959a9","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"debug 62","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3405.3330078125,"y":2347.3094305310933,"wires":[]},{"id":"203760d36862264f","type":"switch","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":3919.3330078125,"y":2209.8094305310933,"wires":[["6a75e0693b9b3d5b","2230441c8da6753d"],["6819c8ec63305b67"]]},{"id":"6a75e0693b9b3d5b","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"debug 63","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4471.3330078125,"y":2203.8094305310933,"wires":[]},{"id":"fdb0b52bbfaf2d1d","type":"delay","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3792.3330078125,"y":2310.4761785779683,"wires":[["2230441c8da6753d"]]},{"id":"ea0a1d0be603cf50","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4461.3330078125,"y":2380.4761785779683,"wires":[]},{"id":"3930fb99a0e941de","type":"inject","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"Reset","props":[{"p":"payload"}],"repeat":"90000","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3269.0830078125,"y":2452.4761785779683,"wires":[["7472483711227f66"]]},{"id":"7472483711227f66","type":"change","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","rules":[{"t":"set","p":"downloads_last_year","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3477.0830078125,"y":2452.4761785779683,"wires":[["6fced96b3ef2fa2e"]]},{"id":"d7fa312520baad1e","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"empty download data","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3424.0830078125,"y":2555.4761785779683,"wires":[]},{"id":"6fced96b3ef2fa2e","type":"link call","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3775.3330078125,"y":2398.7261785779683,"wires":[["2a9d1725f4e61ea9"]]},{"id":"2c4902d306776857","type":"change","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"flow.downloads_last_year --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"downloads_last_year","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4030.3330078125,"y":2678.9166224343435,"wires":[["b61ba8d10ac5b49a"]]},{"id":"2fba82f963fc36b9","type":"inject","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3776.3330078125,"y":2678.9166224343435,"wires":[["2c4902d306776857"]]},{"id":"b61ba8d10ac5b49a","type":"function","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"function 22","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4301.3330078125,"y":2678.9166224343435,"wires":[["4f8ba2a5cf54b3d5"]]},{"id":"4f8ba2a5cf54b3d5","type":"debug","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"debug 64","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4471.3330078125,"y":2678.9166224343435,"wires":[]},{"id":"5583bf246f7f872f","type":"function","z":"741c6acbed17d504","name":"most downloads last year","func":"var kvs = Object.keys(msg.downloads).map((k) => { return [k, msg.downloads[k]]}).filter( (d) => { return d[0] != \"undefined\" })\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Packages\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: kvs.map((v) => {\n            var mod = msg.payload.modules.filter((d) => { return d.id == v[0] })[0];\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"version\": mod.version,\n                \"desc\": mod.description,\n                \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n            }\n        })\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1922.6663703918457,"y":2266.9999716622488,"wires":[["c50be1421ee3faa0"],["d462e7dba3a8ad5b"],["9411eb7feff999a0"]]},{"id":"a62c97296fca9718","type":"change","z":"741c6acbed17d504","name":"flow.downloads_last_year --> downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_year","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1556.3331413269043,"y":2266.9999716622488,"wires":[["5583bf246f7f872f"]]},{"id":"c50be1421ee3faa0","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"7278d8bced05b3d5","order":3,"width":"16","height":20,"label":"top 100 downloaded packages - last year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2647.3331413269043,"y":2253.9999716622488,"wires":[[]]},{"id":"d462e7dba3a8ad5b","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2270.999755859375,"y":2392.9999716622488,"wires":[["4196a221702c7174"]]},{"id":"4196a221702c7174","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"Top 100 downloaded packages (year)","order":9,"width":"16","height":"16","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2637.3331413269043,"y":2391.9999716622488,"wires":[[]]},{"id":"89b5e97ce0622d49","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"TItle 8","order":8,"width":"16","height":1,"format":"<h2>Top 100 downloaded packages - last year</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2537.3331413269043,"y":2324.9999716622488,"wires":[[]]},{"id":"060ee3fec1be0dc9","type":"function","z":"741c6acbed17d504","name":"add node-red as a module","func":"\nmsg.payload.modules.push({\n    id: \"node-red\",\n    version: \"3.1.0\",\n    description: \"Low-code programming for event-driven applications\",\n    updated_at: new Date(),\n    types: [],\n    keywords: [],\n    url: \"https://nodered.org\"\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1177.999755859375,"y":2497.9999716622488,"wires":[["a62c97296fca9718","acb70287893b47e6","67659a26f732abce"]]},{"id":"fc906ad4a7bc49e6","type":"function","z":"741c6acbed17d504","name":"package counts per year","func":"var yearPackage = {}\n\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id];\n    if (version && version.releases && version.releases.created) {\n        var year = moment(version.releases.created).year()\n        yearPackage[year] = yearPackage[year] || 0;\n        yearPackage[year] += 1\n    }\n});\n\nvar kvs = Object.keys(yearPackage).map( (k) => { return [parseInt(k), yearPackage[k]]} )\nkvs = kvs.sort((a, b) => { return a[0] < b[0] ? 1 : -1 })\n\nreturn {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return \"\"+v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Year - Total: \" + jstat.sum(kvs.map((v) => { return v[1] }))]\n        }]\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1929.9999542236328,"y":1674.9998950958252,"wires":[["2b4002228dca5b61"]]},{"id":"2b4002228dca5b61","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":2,"width":12,"height":20,"label":"new packages per year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2603.333251953125,"y":1671.6666259765625,"wires":[[]]},{"id":"b128296d67e6b95e","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":1,"width":12,"height":20,"label":"new maintainers by year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2598.333553314209,"y":1764.9999628067017,"wires":[[]]},{"id":"53fa90a1a439d3aa","type":"function","z":"741c6acbed17d504","name":"maintainers of the top downloaded packages","func":"var maintainers = {}\n\nmsg.payload.length = 100\n\nmsg.payload.forEach( (ary) => {\n    let packname = ary[0];\n    let version = msg.versions[packname];\n\n    if (version) {\n        (version.maintainers || []).forEach((man) => {\n            maintainers[man.name] = (maintainers[man.name] || [])\n            maintainers[man.name].push( packname )\n        })\n    }\n})\n\nvar kvs = Object.keys(maintainers).map((k) => { return [k, maintainers[k].length] })\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Maintainer\"]\n        }]\n    },\n    {\n        ...msg,\n        total: Object.keys(maintainers).length,\n        payload: kvs.map((v) => {\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"modules\": maintainers[v[0]].map((d) => { return { name: d } }),\n            }\n        })\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2160.333251953125,"y":2447.33349609375,"wires":[["d31c061fa26fc19a"],["82c5d63dac18dc3d"]]},{"id":"9411eb7feff999a0","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1983.66650390625,"y":2371.999755859375,"wires":[["53fa90a1a439d3aa"]]},{"id":"d31c061fa26fc19a","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":3,"width":"12","height":20,"label":"maintainers of the top 100 downloaded packages (last year)","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2714,"y":2441,"wires":[[]]},{"id":"e28a1fe864e7e145","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"TItle 9","order":7,"width":"12","height":1,"format":"<h2>Maintainers of top 100 downloaded packages - last year</h2>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2543,"y":2494,"wires":[[]]},{"id":"82c5d63dac18dc3d","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://www.npmjs.com/~{{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd>{{#modules}}{{name}},{{/modules}}</dd>\n{{/payload}}\n</dl>\n","output":"str","x":2277,"y":2553,"wires":[["d5c0b2276b2202a8"]]},{"id":"d5c0b2276b2202a8","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"Maintainers of top downloads = last year","order":8,"width":12,"height":15,"format":"## Total: {{msg.total}}\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2655,"y":2554,"wires":[[]]},{"id":"a003e0267c9beae2","type":"ui_spacer","z":"741c6acbed17d504","name":"spacer","group":"0ed53e2825b8c7fb","order":3,"width":1,"height":1},{"id":"0d446e39f83fbf3c","type":"ui_spacer","z":"741c6acbed17d504","name":"spacer","group":"0ed53e2825b8c7fb","order":1,"width":1,"height":1},{"id":"01cb0c42ba918c34","type":"ui_group","name":"Default","tab":"e2ef93495fbb5da3","order":1,"disp":false,"width":"12","collapse":false,"className":""},{"id":"d096a52e52c86d2a","type":"ui_group","name":"Updates per day","tab":"8ac4502aba0c4e9c","order":1,"disp":false,"width":"24","collapse":false,"className":""},{"id":"0ed53e2825b8c7fb","type":"ui_group","name":"Group 1","tab":"1f12665a90cf544e","order":1,"disp":false,"width":"6","collapse":false,"className":""},{"id":"7278d8bced05b3d5","type":"ui_group","name":"Group 1","tab":"b2ec9c01ed6d42e2","order":1,"disp":false,"width":"16","collapse":false,"className":""},{"id":"fb090f8abca07b18","type":"ui_group","name":"Group 1","tab":"f2115eca5656f45f","order":1,"disp":false,"width":"12","collapse":false,"className":""},{"id":"e2ef93495fbb5da3","type":"ui_tab","name":"Package Analysis","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"8ac4502aba0c4e9c","type":"ui_tab","name":"Updates per day","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"1f12665a90cf544e","type":"ui_tab","name":"Refresh data","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"b2ec9c01ed6d42e2","type":"ui_tab","name":"Downloads","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"f2115eca5656f45f","type":"ui_tab","name":"Maintainers","icon":"dashboard","order":4,"disabled":false,"hidden":false}]