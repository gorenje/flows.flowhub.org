[{"id":"741c6acbed17d504","type":"tab","label":"[analytics] Node-RED Community catalogue","disabled":false,"info":"### Article\n\nProvides the basis for [Node-RED Development: The Numbers](https://blog.openmindmap.org/blog/crunchy-numbers) article.\n\n### Using\n\nKick off the retrieval of <a class=\"ahl-group-only\" data-ids=\"806b8c243393b8e7\">auxillary</a> data (version and download numbers) by hitting the <a class=\"ahl-node-only\" data-ids=\"f06f7069b7e81822\">big red reset button</a>.\n\nThere is a dashboard tab containing all the charts, somewhere under `http://noderedhost:1880/ui` or similar.\n\n![img](https://cdn.openmindmap.org/content/1699464638942_Screen_Shot_2023-11-08_at_18.30.34.png)\n\nThe next step is to find the refresh button that then updates the graphs with data but this will only be complete once auxiliary data has been fully retrieved.\n\nThis can be checked by using the download counter flows: <a class=\"ahl-group-only\" data-ids=\"9b48b443f84a0653\">one</a>, <a class=\"ahl-group-only\" data-ids=\"8ca7d5fd124078bb\">two</a>, <a class=\"ahl-group-only\" data-ids=\"d54435d4060a54b4\">three</a> and <a class=\"ahl-group-only\" data-ids=\"9e12e45c53d302e1\">four</a>. \n\nTheir output should be somewhere around upwards of 4700, i.e., one per module.\n\n### Description\n\nA basic analysis of the Node-RED Community catalogue, which provides the basis for the packages installable within Node-RED.\n\n![img](https://cdn.openmindmap.org/content/1698262081584_Screen_Shot_2023-10-25_at_21.27.57.png)\n\n![img](https://cdn.openmindmap.org/content/1698262103086_Screen_Shot_2023-10-25_at_21.28.19.png)\n\n![img](https://cdn.openmindmap.org/content/1698262124007_Screen_Shot_2023-10-25_at_21.28.40.png)\n\n","env":[]},{"id":"fa640e80decc9bc5","type":"group","z":"741c6acbed17d504","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["c1e3e3106852730b","decbcd79400f7463","8c201d5953b3ca23","021431979e0d32d2"],"x":2542.99983215332,"y":132.6666440963745,"w":457.00000000000045,"h":160},{"id":"50d3daf2d40242cd","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"download numbers - last week","style":{"label":true},"nodes":["f84248691ed06d3d","81183f4703a06f49","8f2128989276a991","67200a1f56d67d09","64f65485e85f9ba7","3e5c72bc75ddc5b7","ab60574324c52a44","d8bf6929c3458b1d","0d5024c37044c70a","56d2378be86a91d3","df18d1223b13f05a","8250415e5f2c89cd","3e34e30ee81ea525","7795563e2648cb7a","200dd7b329a4191e","5a18cef8307f4179","e381d4b2527eb33b","02c2b8d03169a734","eecdeeb1d5aa8833"],"x":3191.499755859375,"y":149.99972752162375,"w":1652.5,"h":433.6667480468752},{"id":"9b48b443f84a0653","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"how many downloads are defined?","style":{"label":true},"nodes":["359d48a6b99d46c9","2d9d68e96c33a00b","e5dee8ee63cc44c3","e927cfffadbcf09a"],"x":3976.999755859375,"y":627.2590245443678,"w":867,"h":82},{"id":"f98a6a1875c36277","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"retrieve version details","style":{"label":true},"nodes":["0280b91f32c74573","ce3e7eaaf9f9ac2d","f4847a5dba23f723","c0740d5553947cfd","8045064c5212858b","525ff4bef34b3a66","431906ed74e84938","8b993b2ec9fecad0","042c5cb781781ffe","a0af637a6816c6e7","8f7f852a46655a05","ad21b0ba9c731507","3d4e76c8dc54e012","edde60f0b0917325","0f31a57b165af276","b4baba4cbfaebef8","6f70a024e1b52425","81be659567411e30","8a7f161573c5e14f"],"x":3216.4997634887695,"y":752.8515735202366,"w":1627.4999923706055,"h":440.8335437774658},{"id":"8ca7d5fd124078bb","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"how many versions are defined?","style":{"label":true},"nodes":["1e4ca5108278c8bd","ddd4da103f23a14f","8850a08e7b35d028","cd6ca105174a79b8"],"x":4036.999755859375,"y":1237.2776662735712,"w":807,"h":82},{"id":"83e19bdbfde4f783","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"download numbers - last month","style":{"label":true},"nodes":["f82bed0ba8594cea","01c4e8546909eacb","b505825f2572ee86","8ff36b94c1512a3c","6c76540a2ef329ac","8f0e1ff45bebbf7a","9bf3e530f3f846d4","5b43686e8d5161aa","7b85c12ba013c53d","4ccd999609548e4c","e34f354516d86101","9c05960e1ff6dc3c","447c127e68856e28","152b119440a63bc1","d59e0a07f6f84fdf","4d9b4c52dce3fdf4","0b6fced32cfb7c80","1921a9a32d5a9878","f05758153fc09e49"],"x":3191.499755859375,"y":1362.87021524944,"w":1652.5,"h":433.666748046875},{"id":"d54435d4060a54b4","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"how many downloads are defined?","style":{"label":true},"nodes":["4e60fdf7e8c4797f","08d6c76ad5c973a1","850ab2115c8d4cd0","7cc9dd2e4a07ac16"],"x":3916.999755859375,"y":1840.1295122721838,"w":927,"h":82},{"id":"763a9a3a19e3e566","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"download numbers - last month","style":{"label":true},"nodes":["2230441c8da6753d","6819c8ec63305b67","6cb9d69563fbde69","7e1f12a867a4eebf","2a9d1725f4e61ea9","c2af0e3635fd2d79","01ab63cd6d588d93","b90b8e6feee3063a","67ed67193e9b4bed","78e20e5e110959a9","203760d36862264f","6a75e0693b9b3d5b","fdb0b52bbfaf2d1d","ea0a1d0be603cf50","3930fb99a0e941de","7472483711227f66","d7fa312520baad1e","6fced96b3ef2fa2e","057c714997aee1c8"],"x":3191.499755859375,"y":1965.7220612480526,"w":1652.5,"h":433.6667480468748},{"id":"9e12e45c53d302e1","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"how many downloads are defined?","style":{"label":true},"nodes":["2c4902d306776857","2fba82f963fc36b9","b61ba8d10ac5b49a","4f8ba2a5cf54b3d5"],"x":3936.999755859375,"y":2442.981358270796,"w":907,"h":82},{"id":"b3a178168673f9fd","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"retrieve dependencies details","style":{"label":true},"nodes":["f8a880616a0678e0","e052666ce8bdb712","1f7e912f0159aa56","70e2dc27fdb91843","6a3720a225ce1a36","c30d3bcfc3ce373b","6bf4bf66e84c4826","2c310f9b66a4979e","f6604fcfb562f29f","f476789b02f5a38e","b0dd219744d43c9d","e6aa69dbf8bd4b13","9a1e6dfa766086fd","759fb127ca4b03a8","812af935be45d037","4a4ca60fb96afb74","8c86ade52feeeb4d","cb923dd83e9a50ba","e4f89a1c09554cc6"],"x":3216.4997634887695,"y":2568.573907246665,"w":1627.4999923706055,"h":440.8335437774658},{"id":"b0acb5b98b9ba507","type":"group","z":"741c6acbed17d504","g":"90b5365c90e405f6","name":"how many dependencies are defined?","style":{"label":true},"nodes":["a31caf7875a80777","8fcad9210f431c25","1c4983f9611b8f79","dbde90ed93e047ef"],"x":4036.999755859375,"y":3053,"w":807,"h":82},{"id":"90b5365c90e405f6","type":"group","z":"741c6acbed17d504","name":"auxiallary data","style":{"label":true,"label-position":"sw"},"nodes":["50d3daf2d40242cd","9b48b443f84a0653","f98a6a1875c36277","8ca7d5fd124078bb","83e19bdbfde4f783","d54435d4060a54b4","763a9a3a19e3e566","9e12e45c53d302e1","b3a178168673f9fd","b0acb5b98b9ba507"],"x":3165.499755859375,"y":123.99972752162375,"w":1704.5,"h":3045.0002724783762},{"id":"f55e0223aabdd29a","type":"group","z":"741c6acbed17d504","name":"query form for type, dependency and keyword","style":{"label":true},"nodes":["c18328ca2f0ccd46","5fe7dc56d2502691","abcb267eaec77ebc","0669bc3867e87fcc","34a2200f5070acc3","68a1431eb00bb19b","d49cd2f917ac2192","2bb7205ee423d9b7","bb050816a770b7d3","9a50e74f8cf5e8a1","175ede85275bae21","197c16b4e9fad9f0","0282ee71b9a0c73f","08ed1433c19505f9","297c0f948a9279b1","eca1ac4d6ab53040","f134de2dde405406","d8a9d58895a71563","1ca6d21dc02767ce","d58f47d19f5130d0","49a3205b07215779","4f3e84deaab66655","fdf46d79aa9ece7d","cdfb6e6ef9992e1e","2211116912795ca9","293c032c95145a70"],"x":3093.66650390625,"y":3252.666748046875,"w":1779,"h":441},{"id":"fdf46d79aa9ece7d","type":"junction","z":"741c6acbed17d504","g":"f55e0223aabdd29a","x":4517.66654753685,"y":3585.0953273773193,"wires":[["5fe7dc56d2502691"]]},{"id":"cdfb6e6ef9992e1e","type":"junction","z":"741c6acbed17d504","g":"f55e0223aabdd29a","x":4705,"y":3473,"wires":[["293c032c95145a70"]]},{"id":"2211116912795ca9","type":"junction","z":"741c6acbed17d504","g":"f55e0223aabdd29a","x":4749,"y":3383,"wires":[["cdfb6e6ef9992e1e"]]},{"id":"293c032c95145a70","type":"junction","z":"741c6acbed17d504","g":"f55e0223aabdd29a","x":4661,"y":3563,"wires":[["197c16b4e9fad9f0"]]},{"id":"223e0d525fd9e3b9","type":"junction","z":"741c6acbed17d504","x":918.4490032196045,"y":2788.7142535448074,"wires":[["3a94fdcdccd7e0f6"]]},{"id":"206d219714878a64","type":"http request","z":"741c6acbed17d504","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":832.6662292480469,"y":1444.7407172520955,"wires":[["060ee3fec1be0dc9","2a1248ce7e1ac372","25bc3304e70968ae","2f0167db58f7ce54","9792fe31e9eb49ec","e51fbfae8f6f88d4","50b0c642f7829303","27e9cacefbc9e0e0","ca3f486d4be3fb14","fb5a017272acb096","e6d53528d2196e15","142f96b4a47de0ec","d4a8db88a2d62d2b","a9e223ba3da5fd6c","223e0d525fd9e3b9"]]},{"id":"db7468f93f6d28c4","type":"inject","z":"741c6acbed17d504","name":"Generate initial data","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":367.1108093261719,"y":1444.7407172520955,"wires":[["206d219714878a64"]]},{"id":"dec7a25e92772aec","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":4,"width":"16","height":20,"label":"top keywords, used by at least 10 modules","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2716.999755859375,"y":722.499971662249,"wires":[[]]},{"id":"a9e223ba3da5fd6c","type":"function","z":"741c6acbed17d504","name":"top keywords","func":"var keywords = {};\nmsg.payload.modules.forEach(function(module) {\n    (module.keywords || []).forEach(function(keyword) {\n        keyword = keyword.toLowerCase()\n        keywords[keyword] ||= 0\n        keywords[keyword] += 1\n    });\n});\n\n\ndelete keywords[\"node-red\"]\ndelete keywords[\"node-red-contrib\"]\ndelete keywords[\"node-red-contrib-contribgen\"]\n// delete keywords[\"iot\"]\ndelete keywords[\"node\"]\ndelete keywords[\"nodered\"]\n\nvar keys = Object.keys(keywords);\nvar kvs = keys.map((k) => { return [k, keywords[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.filter( (v) => { return v[1] > 9 }).map((v) => { return v[0]}),\n    \"data\": kvs.filter((v) => { return v[1] > 9 }).map((v) => { return [v[1]] }),\n    \"labels\": [\"Keywords\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1471.3332138061523,"y":722.499971662249,"wires":[["dec7a25e92772aec"]]},{"id":"d4a8db88a2d62d2b","type":"function","z":"741c6acbed17d504","name":"updates per day","func":"var lastestUpdates = {};\nvar limitToLastXDays = 3000;\n\n[...new Array(limitToLastXDays)].map((i, idx) => {\n    lastestUpdates[moment().startOf(\"day\").subtract(idx, \"days\").format(\"YYYY-MM-DD\")] = 0 \n});\n\nmsg.payload.modules.forEach(function(module) {\n    module.updated_at = module.updated_at.split(\"T\")[0]\n\n    lastestUpdates[module.updated_at] ||= 0\n    lastestUpdates[module.updated_at] += 1\n});\n\nvar keys = Object.keys(lastestUpdates);\nvar kvs = keys.map((k) => { return [k, lastestUpdates[k]]})\n// kvs = kvs.sort( (a,b) => { return Date.parse(a[0]) < Date.parse(b[0]) ? 1 : -1 })\n\nkvs.length = limitToLastXDays\n\nmsg.payload = [{\n    \"series\": [\"Updates\"],\n    \"data\": [kvs.map((v) => { return { x: v[0], y: v[1]} })],\n    \"labels\": [\"Days\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"}],"x":1471.3332138061523,"y":777.499971662249,"wires":[["bdcf58f8b5f0a53f"]]},{"id":"bdcf58f8b5f0a53f","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"d096a52e52c86d2a","order":4,"width":"24","height":"21","label":"updates per day","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":"300","removeOlderPoints":"3000","removeOlderUnit":"604800","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2626.999755859375,"y":777.499971662249,"wires":[[]]},{"id":"142f96b4a47de0ec","type":"function","z":"741c6acbed17d504","name":"top version numbers","func":"var topVersionNunbers = {};\n\nmsg.payload.modules.forEach(function(module) {\n    topVersionNunbers[module.version] ||= 0\n    topVersionNunbers[module.version] += 1\n});\n\nvar keys = Object.keys(topVersionNunbers);\nvar kvs = keys.map((k) => { return [k, topVersionNunbers[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Versions\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1491.3332138061523,"y":830.999971662249,"wires":[["da734d225bc3a03b"]]},{"id":"da734d225bc3a03b","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":5,"width":"16","height":20,"label":"top 100 version numbers","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":830.999971662249,"wires":[[]]},{"id":"e51fbfae8f6f88d4","type":"function","z":"741c6acbed17d504","name":"last 100 updates","func":"var latestPackageUpdates = [];\n\nmsg.payload.modules.forEach(function(module) {\n    latestPackageUpdates.push([\n        module.id,\n        module.updated_at.split(\"T\")[0],\n        module.description,\n        module.version,\n        module.keywords\n    ])\n});\n\nkvs = latestPackageUpdates.sort( (a,b) => { return Date.parse(a[1]) <= Date.parse(b[1]) ? 1 : -1 })\n\nkvs.length = 100\n\nmsg.payload = kvs.map((v) => {\n    return {\n        \"value\": v[0],\n        \"date\": v[1],\n        \"desc\": v[2],\n        \"version\": v[3],\n        \"tags\": (v[4] || []).map(d => { return { tag: d } })\n    }\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1481.3332138061523,"y":879.999971662249,"wires":[["d34e2aac0af1c3b4"]]},{"id":"696d4b7a9edc9456","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List of latest updated packages","order":10,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n<h2>Last 100 package Updates</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2676.999755859375,"y":879.999971662249,"wires":[[]]},{"id":"d34e2aac0af1c3b4","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{date}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br>\n  <i>{{ desc }}</i>\n  </dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":879.999971662249,"wires":[["696d4b7a9edc9456"]]},{"id":"e6d53528d2196e15","type":"function","z":"741c6acbed17d504","name":"top major version number","func":"var topVersionNunbers = {};\n\nmsg.payload.modules.forEach(function(module) {\n    topVersionNunbers[module.version.split(\".\")[0]] ||= 0\n    topVersionNunbers[module.version.split(\".\")[0]] += 1\n});\n\nvar keys = Object.keys(topVersionNunbers);\nvar kvs = keys.map((k) => { return [k, topVersionNunbers[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Major Version\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1501.3332138061523,"y":930.499971662249,"wires":[["cd46143e9a042d89"]]},{"id":"cd46143e9a042d89","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":6,"width":"8","height":"8","label":"top major version number (major.minor.patch)","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2726.999755859375,"y":930.499971662249,"wires":[[]]},{"id":"fb5a017272acb096","type":"function","z":"741c6acbed17d504","name":"highest defined types","func":"var typeCounts = {};\n\nmsg.payload.modules.forEach(function(module) {\n    typeCounts[module.types.length] ||= 0\n    typeCounts[module.types.length] += 1\n});\n\nvar keys = Object.keys(typeCounts);\nvar kvs = keys.map((k) => { return [k, typeCounts[k]]})\nkvs = kvs.sort( (a,b) => { return parseInt(a[0]) > parseInt(b[0]) ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Type counts\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1491.3332138061523,"y":994.499971662249,"wires":[["fc97bcdb069767a2"]]},{"id":"fc97bcdb069767a2","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":7,"width":"16","height":20,"label":"number of node types defined by a package","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2716.999755859375,"y":994.499971662249,"wires":[[]]},{"id":"9792fe31e9eb49ec","type":"function","z":"741c6acbed17d504","name":"number of types > 20","func":"var topTypeCounts = [];\n\nmsg.payload.modules.forEach(function(module) {\n    topTypeCounts.push([\n        module.id,\n        module.types.length,\n        module.version,\n        module.description,\n        module.keywords\n    ])\n});\n\nvar kvs = topTypeCounts.filter((d) => { \n    return (parseInt(d[1]) > 19 || parseInt(d[1]) == 0 )\n}).sort( (a,b) => { \n    return parseInt(a[1]) <= parseInt(b[1]) ? 1 : -1 \n})\n\nmsg.payload = kvs.map((v) => {\n    return {\n        \"value\": v[0],\n        \"count\": parseInt(v[1]),\n        \"version\": v[2],\n        \"desc\": v[3],\n        \"tags\": (v[4]||[]).map( d => { return { tag: d }})\n    }\n})\n\nreturn [\n    {\n        ...msg,\n        payload: msg.payload.filter( d => { return d.count > 0 })\n    },\n    {\n        ...msg,\n        payload: msg.payload.filter(d => { return d.count == 0 })\n    }\n]","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1491.3332138061523,"y":1047.999971662249,"wires":[["fc1728e12900a63e"],["75ceb26047ef4853"]]},{"id":"26071b19cfe2addb","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List of type counts","order":11,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n    <h2>Packages with the most types defined (above 20)</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2636.999755859375,"y":1040.999971662249,"wires":[[]]},{"id":"fc1728e12900a63e","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":1040.999971662249,"wires":[["26071b19cfe2addb"]]},{"id":"0de51abc98bd4b1f","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List of packages with no node types defined","order":12,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n    <h2>Packages with no node types defined</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2716.999755859375,"y":1094.499971662249,"wires":[[]]},{"id":"75ceb26047ef4853","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":1094.499971662249,"wires":[["0de51abc98bd4b1f"]]},{"id":"2ba7496fdee9fb94","type":"ui_button","z":"741c6acbed17d504","name":"","group":"0ed53e2825b8c7fb","order":2,"width":"6","height":"6","passthru":false,"label":"Refresh Data","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":397.1108093261719,"y":251.555419921875,"wires":[["8849e98ce9b9944f","7a73184fb136e7db","6e28a0aaf183ed8a"]]},{"id":"ca3f486d4be3fb14","type":"function","z":"741c6acbed17d504","name":"top package prefixes","func":"var topDevelopers = {};\n\nmsg.payload.modules.forEach(function(module) {\n    var devname = module.id.split(\"/\")\n    if ( devname.length > 1 ) {\n        topDevelopers[devname[0]] ||= 0\n        topDevelopers[devname[0]] += 1\n    }\n});\n\nvar keys = Object.keys(topDevelopers);\nvar kvs = keys.map((k) => { return [k, topDevelopers[k]]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100;\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0]}),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Prefix\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1491.3332138061523,"y":1155.999971662249,"wires":[["5353fbb10c120179"]]},{"id":"5353fbb10c120179","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":8,"width":"16","height":20,"label":"top 100 package prefixes","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":1155.999971662249,"wires":[[]]},{"id":"e8c4690585fb2a41","type":"catch","z":"741c6acbed17d504","name":"","scope":null,"uncaught":false,"x":2606.999755859375,"y":333.7778558731079,"wires":[["3fe48b832b51cf6b"]]},{"id":"3fe48b832b51cf6b","type":"debug","z":"741c6acbed17d504","name":"EXCEPTIONS WILL HAPPEN","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2866.4437713623047,"y":333.7778558731079,"wires":[]},{"id":"7a73184fb136e7db","type":"delay","z":"741c6acbed17d504","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":630.4440765380859,"y":845.481434504191,"wires":[["206d219714878a64"]]},{"id":"2f0167db58f7ce54","type":"function","z":"741c6acbed17d504","name":"top developers","func":"var prefixedPackages = 0;\nvar totalPackages = 0;\n\nmsg.payload.modules.forEach(function(module) {\n    var devname = module.id.split(\"/\")\n\n    totalPackages += 1\n    if ( devname.length > 1 ) {\n        prefixedPackages += 1\n    }\n});\n\nmsg.prefixedPackages = prefixedPackages;\nmsg.totalPackages = totalPackages;\nmsg.nonPrefixedPackages = totalPackages - prefixedPackages;\nmsg.lastUpdated = msg.payload.updated_at;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1471.3332138061523,"y":649.5555746895927,"wires":[["46e5086ca7d0e5d1"]]},{"id":"08e9c9ce8d47bd36","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"Statistics","order":1,"width":"16","height":4,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2606.999755859375,"y":649.5555746895927,"wires":[["a8715f06a1e483b2"]]},{"id":"46e5086ca7d0e5d1","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h2>Packages</h2>\n\nTotal: <b>{{ totalPackages }}</b><br>\nPrefixed: <b>{{ prefixedPackages }}</b><br>\nNon-Prefixed: <b>{{ nonPrefixedPackages }}</b><br>\nLast updated at: <b>{{ lastUpdated }}</b><br>\n","output":"str","x":2382.333251953125,"y":649.5555746895927,"wires":[["08e9c9ce8d47bd36"]]},{"id":"27e9cacefbc9e0e0","type":"function","z":"741c6acbed17d504","name":"last updates by year","func":"var groupByDate = {};\n\nmsg.payload.modules.forEach(function(module) {\n    var day = module.updated_at.split(\"T\")[0];\n\n    var month = day.split(\"-\").slice(0, 2).join(\"-\")\n    var year = day.split(\"-\").slice(0, 1).join(\"-\")\n\n    // groupByDate[month] = (groupByDate[month] || 0) + 1\n    groupByDate[year] = (groupByDate[year] || 0) + 1\n});\n\nvar keys = Object.keys(groupByDate);\nvar kvs = keys.map((k) => { return [k, groupByDate[k]] })\nkvs = kvs.sort((a, b) => { return parseInt(a[0]) < parseInt(b[1]) ? 1 : -1 })\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0] }),\n    \"data\": kvs.map((v) => { return [v[1]] }),\n    \"labels\": [\"Year\"]\n}]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1491.3332138061523,"y":1223.4445689065117,"wires":[["c4d0f31a52436e6c"]]},{"id":"c4d0f31a52436e6c","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":9,"width":"8","height":"8","label":"number of packages updated by year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2696.999755859375,"y":1223.4445689065117,"wires":[[]]},{"id":"50b0c642f7829303","type":"function","z":"741c6acbed17d504","name":"overlapping types","func":"var types = {};\n\nmsg.payload.modules.forEach( (module) => {\n    (module.types || []).forEach( (typ) => {\n        types[typ] = ( types[typ] || [] ).concat( [module.id] )\n    });\n});\n\n// occurs multiple times but seems to be ignored. Some packages\n// define this as a node type several times - some generational \n// error I assume.\ndelete types[\"__errors__\"]; \n\nvar kvs = Object.keys(types).map((k) => { return [k, types[k]]}).filter( (d) => {\n    return d[1].length > 1\n})\nkvs = kvs.sort( (a,b) => { return a[1].length < b[1].length ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1].length] }),\n            \"labels\": [\"Types\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1481.3332138061523,"y":1284.999971662249,"wires":[["911d68596b80740e"],[]]},{"id":"911d68596b80740e","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":3,"width":"16","height":20,"label":"top 100 overlapping package types","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2686.999755859375,"y":1279.999971662249,"wires":[[]]},{"id":"f84248691ed06d3d","type":"function","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"function 10","func":"msg.downloads = msg.downloads || {};\n\nvar module = msg.modules.pop();\n\n/* \n  Url from https://www.edoardoscibona.com/exploring-the-npm-registry-api, possible periods are:\n   - last-year\n   - last-month\n   - last-year\n   - last-day\n*/\nif (module) {\n    return [{\n        ...msg,\n        url: \"https://api.npmjs.org/downloads/point/last-week/\" + module.id,\n        requestTimeout: 2500,\n        module: module,\n        isempty: msg.downloads[module.id] == undefined\n    },\n    undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4484.999755859375,"y":299.74972752162375,"wires":[["df18d1223b13f05a"],["7795563e2648cb7a"]]},{"id":"81183f4703a06f49","type":"http request","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3287.499755859375,"y":318.49972752162375,"wires":[["3e5c72bc75ddc5b7"]]},{"id":"8f2128989276a991","type":"delay","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4295.16641998291,"y":540.4998381478447,"wires":[["f84248691ed06d3d"]]},{"id":"67200a1f56d67d09","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"updated flow context","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4697.999755859375,"y":493.687227521624,"wires":[]},{"id":"64f65485e85f9ba7","type":"change","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"set msg.downloads, set msg.modules","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4205,"y":336.2497253417969,"wires":[["f84248691ed06d3d"]]},{"id":"3e5c72bc75ddc5b7","type":"function","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"function 11","func":"msg.downloads = msg.downloads || {}\n\nif (msg.payload.package) {\n    msg.downloads[msg.payload.package] = msg.payload.downloads;\n    \n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3389.999755859375,"y":501.687227521624,"wires":[["ab60574324c52a44"],["e381d4b2527eb33b","8f2128989276a991"]]},{"id":"ab60574324c52a44","type":"change","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","rules":[{"t":"set","p":"downloads","pt":"flow","to":"downloads","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4097.999755859375,"y":493.687227521624,"wires":[["67200a1f56d67d09","8f2128989276a991"]]},{"id":"d8bf6929c3458b1d","type":"inject","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"9600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3609.999755859375,"y":386.24972752162375,"wires":[["02c2b8d03169a734"]]},{"id":"0d5024c37044c70a","type":"catch","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","scope":["81183f4703a06f49"],"uncaught":false,"x":3407.999755859375,"y":300.49972752162375,"wires":[["56d2378be86a91d3","3e34e30ee81ea525"]]},{"id":"56d2378be86a91d3","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"debug 50","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3591.999755859375,"y":334.49972752162375,"wires":[]},{"id":"df18d1223b13f05a","type":"switch","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":4105.999755859375,"y":196.99972752162375,"wires":[["8250415e5f2c89cd","f84248691ed06d3d"],["81183f4703a06f49"]]},{"id":"8250415e5f2c89cd","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"has been retrieved","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4687.999755859375,"y":190.99972752162375,"wires":[]},{"id":"312691f152807a49","type":"function","z":"741c6acbed17d504","name":"most downloads last week","func":"var kvs = Object.keys(msg.downloads).map((k) => { return [k, msg.downloads[k]]}).filter( (d) => { return d[0] != \"undefined\" })\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Types\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: kvs.map((v) => {\n            var mod = msg.payload.modules.filter((d) => { return d.id == v[0] })[0];\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"version\": mod.version,\n                \"desc\": mod.description,\n                \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n            }\n        })\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1937.6663208007812,"y":2616.9999716622488,"wires":[["c9f5e8734dc46760"],["c407ee428bcd3fb7"],[]]},{"id":"67659a26f732abce","type":"change","z":"741c6acbed17d504","name":"flow.downloads --> downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1521.3332138061523,"y":2616.9999716622488,"wires":[["312691f152807a49"]]},{"id":"c9f5e8734dc46760","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"7278d8bced05b3d5","order":1,"width":"16","height":20,"label":"top 100 downloaded packages - last week","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2716.999755859375,"y":2603.9999716622488,"wires":[[]]},{"id":"c407ee428bcd3fb7","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":2662.9999716622488,"wires":[["c891cade66e07a2f"]]},{"id":"c891cade66e07a2f","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"Top 100 downloaded packages (week)","order":5,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n    <h2>Top 100 downloaded packages - last week numbers</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2696.999755859375,"y":2662.9999716622488,"wires":[[]]},{"id":"359d48a6b99d46c9","type":"change","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"flow.downloads --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"downloads","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4326.999755859375,"y":668.2590245443678,"wires":[["e5dee8ee63cc44c3"]]},{"id":"2d9d68e96c33a00b","type":"inject","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4082.999755859375,"y":668.2590245443678,"wires":[["359d48a6b99d46c9"]]},{"id":"e5dee8ee63cc44c3","type":"function","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"function 12","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4567.999755859375,"y":668.2590245443678,"wires":[["e927cfffadbcf09a"]]},{"id":"e927cfffadbcf09a","type":"debug","z":"741c6acbed17d504","g":"9b48b443f84a0653","name":"debug 52","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4737.999755859375,"y":668.2590245443678,"wires":[]},{"id":"0280b91f32c74573","type":"function","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"function 13","func":"msg.versions = msg.versions || {};\n\nvar module = msg.modules.pop();\n\nif ( !module ) {\n    return [ \n        undefined,\n        msg\n    ]\n} else {\n    return [\n        {\n            ...msg,\n            url: \"https://registry.npmjs.org/\" + module.id,\n            module: module,\n            requestTimeout: 2500,\n            isempty: msg.versions[module.id] == undefined,\n        },\n        undefined\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4489.999755859375,"y":875.6015735202366,"wires":[["8f7f852a46655a05"],["3d4e76c8dc54e012"]]},{"id":"ce3e7eaaf9f9ac2d","type":"http request","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3312.4997634887695,"y":890.4349484973484,"wires":[["525ff4bef34b3a66"]]},{"id":"f4847a5dba23f723","type":"delay","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4321.166320800781,"y":1150.3516727023655,"wires":[["0280b91f32c74573"]]},{"id":"c0740d5553947cfd","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"update flow context","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4697.999755859375,"y":1085.2265735202366,"wires":[]},{"id":"8045064c5212858b","type":"change","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"set msg.versions, set msg.modules","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4215,"y":923.3515735202366,"wires":[["0280b91f32c74573"]]},{"id":"525ff4bef34b3a66","type":"function","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"function 14","func":"msg.versions = msg.versions || {}\n\nif (msg.payload._id) {\n    msg.versions[msg.payload._id] = {\n        releases: { ...msg.payload.time },\n        readme: (msg.payload.readme && msg.payload.readme != \"\"),\n        readmeFilename: (msg.payload.readmeFilename && msg.payload.readmeFilename != \"\"),\n        description: msg.payload.description,\n        maintainers: msg.payload.maintainers,\n        contributors: msg.payload.contributors,\n        disttags: { ...msg.payload[\"dist-tags\"] },\n        unpublished: !!(msg.payload.time || {}).unpublished\n    }\n\n    return [\n        msg,\n        undefined\n    ]\n} else {\n    if ( msg.statusCode == 404) {\n        msg.versions[msg.module.id] = {\n            releases: {},\n            readme: false,\n            readmeFilename: false,\n            description: \"404 Response\",\n            disttags: {},\n            unpublished: true\n        }\n        \n        return [\n            msg,\n            undefined\n        ]\n    } else {\n        return [\n            undefined,\n            msg\n        ]\n    }\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3469.999755859375,"y":1092.8515735202366,"wires":[["431906ed74e84938"],["0f31a57b165af276","f4847a5dba23f723"]]},{"id":"431906ed74e84938","type":"change","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","rules":[{"t":"set","p":"versions","pt":"flow","to":"versions","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4138.999755859375,"y":1085.2265735202366,"wires":[["c0740d5553947cfd","f4847a5dba23f723"]]},{"id":"8b993b2ec9fecad0","type":"inject","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"21600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3669.999755859375,"y":985.8515735202366,"wires":[["81be659567411e30"]]},{"id":"042c5cb781781ffe","type":"catch","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","scope":["ce3e7eaaf9f9ac2d"],"uncaught":false,"x":3430.999755859375,"y":875.3515735202366,"wires":[["a0af637a6816c6e7","edde60f0b0917325"]]},{"id":"a0af637a6816c6e7","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"debug 54","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3608.33309173584,"y":936.3515329890781,"wires":[]},{"id":"8f7f852a46655a05","type":"switch","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":4105.999744415283,"y":794.1849456363254,"wires":[["ad21b0ba9c731507","0280b91f32c74573"],["ce3e7eaaf9f9ac2d"]]},{"id":"ad21b0ba9c731507","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"has been retrieved","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4685.999755859375,"y":793.8515735202366,"wires":[]},{"id":"1e4ca5108278c8bd","type":"change","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"flow.versions --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"versions","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":4338.999755859375,"y":1278.2776662735712,"wires":[["8850a08e7b35d028"]]},{"id":"ddd4da103f23a14f","type":"inject","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4142.999755859375,"y":1278.2776662735712,"wires":[["1e4ca5108278c8bd"]]},{"id":"8850a08e7b35d028","type":"function","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"function 15","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4567.999755859375,"y":1278.2776662735712,"wires":[["cd6ca105174a79b8"]]},{"id":"cd6ca105174a79b8","type":"debug","z":"741c6acbed17d504","g":"8ca7d5fd124078bb","name":"debug 56","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4737.999755859375,"y":1278.2776662735712,"wires":[]},{"id":"25bc3304e70968ae","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1481.3332138061523,"y":1439.9998950958252,"wires":[["fc906ad4a7bc49e6","884cd3f3c28bfe11","cab121243e501204","611bf86b366aefa4","bab9b83903f03aa6","c3671042b2b21a3c"]]},{"id":"cab121243e501204","type":"function","z":"741c6acbed17d504","name":"top maintainers","func":"var maintainers = {}\nvar yearStarted = {}\n\nmsg.payload.modules.forEach( (mod) => {\n    let packname = mod.id;\n    let version = msg.versions[packname];\n\n    if ( version ) {\n        let year = moment().add(30, 'year').year()\n\n        if (version.releases && version.releases.created) {\n            year = moment(version.releases.created).year()\n        }\n\n        ( (version.maintainers) || []).forEach( (man) => {\n            yearStarted[man.name] = yearStarted[man.name] || []\n            yearStarted[man.name].push(year)\n\n            maintainers[man.name] = (maintainers[man.name] || 0) + 1\n        })\n    }\n})\n\nvar groupByYear = {}\nObject.keys(yearStarted).filter( d => {\n    return jstat.min(yearStarted[d]) <= moment(new Date()).year()\n}).map( d => {\n    return [d, jstat.min(yearStarted[d])]\n}).forEach( d => {\n    groupByYear[d[1]] = (groupByYear[d[1]] || 0) + 1\n})\n\nvar yvs = Object.keys(groupByYear).map((k) => { return [parseInt(k), groupByYear[k]] })\nyvs = yvs.sort((a, b) => { return a[0] < b[0] ? 1 : -1 })\n\nvar kvs = Object.keys(maintainers).map( (k) => { return [k, maintainers[k]]} )\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100;\n\nreturn [{\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Maintainer\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: [{\n            \"series\": yvs.map((v) => { return v[0] }),\n            \"data\": yvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Maintainer total: \" + jstat.sum(yvs.map((v) => { return v[1] }))]\n        }]\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1897.6663208007812,"y":1581.3333933694023,"wires":[["d3960b2b800f214f"],["b128296d67e6b95e"]]},{"id":"d3960b2b800f214f","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":5,"width":16,"height":16,"label":"overall top 100 package maintainers","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2696.999755859375,"y":1581.3333933694023,"wires":[[]]},{"id":"3e34e30ee81ea525","type":"delay","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3978.999755859375,"y":297.66647556849875,"wires":[["f84248691ed06d3d"]]},{"id":"7795563e2648cb7a","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4647.999755859375,"y":367.66647556849875,"wires":[]},{"id":"3d4e76c8dc54e012","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4647.999755859375,"y":944.3515735202366,"wires":[]},{"id":"edde60f0b0917325","type":"delay","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3934.999755859375,"y":877.3515735202366,"wires":[["0280b91f32c74573"]]},{"id":"200dd7b329a4191e","type":"inject","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"Reset","props":[{"p":"payload"}],"repeat":"82800","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3424.749755859375,"y":452.66650390625,"wires":[["5a18cef8307f4179"]]},{"id":"5a18cef8307f4179","type":"change","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","rules":[{"t":"set","p":"downloads","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3654.749755859375,"y":439.66647556849875,"wires":[["02c2b8d03169a734"]]},{"id":"b4baba4cbfaebef8","type":"inject","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"Reset","props":[{"p":"payload"}],"repeat":"75600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3507.0830078125,"y":1050.3515735202366,"wires":[["6f70a024e1b52425"]]},{"id":"6f70a024e1b52425","type":"change","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","rules":[{"t":"set","p":"versions","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3736.083053588867,"y":1042.3516154819065,"wires":[["81be659567411e30"]]},{"id":"e381d4b2527eb33b","type":"debug","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"empty download data","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3610.749755859375,"y":542.666475568499,"wires":[]},{"id":"0f31a57b165af276","type":"debug","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"empty version data","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3696.7497787475586,"y":1152.6851172977024,"wires":[]},{"id":"884cd3f3c28bfe11","type":"function","z":"741c6acbed17d504","name":"active maintainers","func":"var maintainers = {}\n\nvar twelveMonthsAgo = moment().subtract(1,'year')\n\nmsg.payload.modules.filter( (module) => {\n    return Date.parse(module.updated_at) > twelveMonthsAgo\n}).forEach( (module) => {\n    var version = msg.versions[module.id]\n    if ( version ) {\n        (version.maintainers || []).forEach( (mt) => {\n            maintainers[mt.name] = maintainers[mt.name] || {}\n            maintainers[mt.name][module.id] = true\n        })\n    }\n})\n\nvar kvs = Object.keys(maintainers).map((k) => { return [k, Object.keys(maintainers[k]).length] })\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar all_kvs = [...kvs]\n\nkvs.length = 100\n\nreturn [ \n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"\"]\n        }]\n    },\n    {\n        ...msg,\n        total: all_kvs.length,\n        payload: all_kvs.map((v) => {\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"modules\": Object.keys(maintainers[v[0]]).map( (d) => { return {name: d}}),\n            }\n        })\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"}],"x":1907.6663208007812,"y":1673.3330478668213,"wires":[["3fe13dceb4568af8"],["66ab8082e928f254"]]},{"id":"3fe13dceb4568af8","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":7,"width":16,"height":20,"label":"top 100 maintainers active last 12 months","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2706.999755859375,"y":1671.9997675759453,"wires":[[]]},{"id":"66ab8082e928f254","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://www.npmjs.com/~{{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd>{{#modules}}<a target=\"_blank\" href=\"https://flows.nodered.org/node/{{{name}}}\">{{name}}</a>, {{/modules}}</dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":1731.999971662249,"wires":[["2c424d5c5477f560"]]},{"id":"2c424d5c5477f560","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"Top mainters last year","order":8,"width":16,"height":16,"format":"<div class=\"fix-header-onscroll\">\n    <h2>Maintainers active in the last 12 months</h2>\n<div>\n<span style=\"font-weight: bold;\">Total</span>: {{msg.total}}\n</div>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2646.999755859375,"y":1731.999971662249,"wires":[[]]},{"id":"f82bed0ba8594cea","type":"function","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"function 17","func":"msg.downloads = msg.downloads || {};\n\nvar module = msg.modules.pop();\n\n/* \n  Url from https://www.edoardoscibona.com/exploring-the-npm-registry-api, possible periods are:\n   - last-year\n   - last-month\n   - last-year\n   - last-day\n*/\nif (module) {\n    return [{\n        ...msg,\n        url: \"https://api.npmjs.org/downloads/point/last-month/\" + module.id,\n        requestTimeout: 2500,\n        module: module,\n        isempty: msg.downloads[module.id] == undefined\n    },\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4484.999755859375,"y":1512.62021524944,"wires":[["e34f354516d86101"],["152b119440a63bc1"]]},{"id":"01c4e8546909eacb","type":"http request","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3287.499755859375,"y":1531.37021524944,"wires":[["8f0e1ff45bebbf7a"]]},{"id":"b505825f2572ee86","type":"delay","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4295.16641998291,"y":1753.3703258756607,"wires":[["f82bed0ba8594cea"]]},{"id":"8ff36b94c1512a3c","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"update flow context","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4697.999755859375,"y":1706.55771524944,"wires":[]},{"id":"6c76540a2ef329ac","type":"change","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"set msg.downloads_last_month, set msg.modules","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_month","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4134.999755859375,"y":1554.1202612982854,"wires":[["f82bed0ba8594cea"]]},{"id":"8f0e1ff45bebbf7a","type":"function","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"function 18","func":"msg.downloads = msg.downloads || {}\n\nif (msg.payload.package) {\n    msg.downloads[msg.payload.package] = msg.payload.downloads;\n    \n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3389.999755859375,"y":1714.55771524944,"wires":[["9bf3e530f3f846d4"],["0b6fced32cfb7c80","b505825f2572ee86"]]},{"id":"9bf3e530f3f846d4","type":"change","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","rules":[{"t":"set","p":"downloads_last_month","pt":"flow","to":"downloads","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4137.999755859375,"y":1706.55771524944,"wires":[["8ff36b94c1512a3c","b505825f2572ee86"]]},{"id":"5b43686e8d5161aa","type":"inject","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"12600","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3609.999755859375,"y":1599.12021524944,"wires":[["1921a9a32d5a9878"]]},{"id":"7b85c12ba013c53d","type":"catch","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","scope":["01c4e8546909eacb"],"uncaught":false,"x":3407.999755859375,"y":1513.37021524944,"wires":[["4ccd999609548e4c","447c127e68856e28"]]},{"id":"4ccd999609548e4c","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"debug 58","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3591.999755859375,"y":1547.37021524944,"wires":[]},{"id":"e34f354516d86101","type":"switch","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":4105.999755859375,"y":1409.87021524944,"wires":[["9c05960e1ff6dc3c","f82bed0ba8594cea"],["01c4e8546909eacb"]]},{"id":"9c05960e1ff6dc3c","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"has been retrieved","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4687.999755859375,"y":1403.87021524944,"wires":[]},{"id":"447c127e68856e28","type":"delay","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3978.999755859375,"y":1510.536963296315,"wires":[["f82bed0ba8594cea"]]},{"id":"152b119440a63bc1","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4647.999755859375,"y":1580.536963296315,"wires":[]},{"id":"d59e0a07f6f84fdf","type":"inject","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"Reset","props":[{"p":"payload"}],"repeat":"78000","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3449.749755859375,"y":1670.536887274848,"wires":[["4d9b4c52dce3fdf4"]]},{"id":"4d9b4c52dce3fdf4","type":"change","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","rules":[{"t":"set","p":"downloads_last_month","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3673.749755859375,"y":1652.536963296315,"wires":[["1921a9a32d5a9878"]]},{"id":"0b6fced32cfb7c80","type":"debug","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"empty download data","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3610.749755859375,"y":1755.536963296315,"wires":[]},{"id":"4e60fdf7e8c4797f","type":"change","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"flow.downloads_last_month --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"downloads_last_month","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4286.999755859375,"y":1881.1295122721838,"wires":[["850ab2115c8d4cd0"]]},{"id":"08d6c76ad5c973a1","type":"inject","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4022.999755859375,"y":1881.1295122721838,"wires":[["4e60fdf7e8c4797f"]]},{"id":"850ab2115c8d4cd0","type":"function","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"function 19","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4567.999755859375,"y":1881.1295122721838,"wires":[["7cc9dd2e4a07ac16"]]},{"id":"7cc9dd2e4a07ac16","type":"debug","z":"741c6acbed17d504","g":"d54435d4060a54b4","name":"debug 60","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4737.999755859375,"y":1881.1295122721838,"wires":[]},{"id":"423676957b2e0deb","type":"function","z":"741c6acbed17d504","name":"most downloads last month","func":"var kvs = Object.keys(msg.downloads).map((k) => { return [k, msg.downloads[k]]}).filter( (d) => { return d[0] != \"undefined\" })\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Types\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: kvs.map((v) => {\n            var mod = msg.payload.modules.filter((d) => { return d.id == v[0] })[0];\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"version\": mod.version,\n                \"desc\": mod.description,\n                \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n            }\n        })\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1937.6663208007812,"y":2491.3332236153738,"wires":[["2c5f56500f8481e0"],["b21394f0fd1529b0"],[]]},{"id":"acb70287893b47e6","type":"change","z":"741c6acbed17d504","name":"flow.downloads_last_month --> downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_month","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1561.3332138061523,"y":2491.3332236153738,"wires":[["423676957b2e0deb"]]},{"id":"2c5f56500f8481e0","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"7278d8bced05b3d5","order":2,"width":"16","height":20,"label":"top 100 downloaded packages - last month","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2716.999755859375,"y":2478.3332236153738,"wires":[[]]},{"id":"b21394f0fd1529b0","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":2536.8332236153738,"wires":[["e7f7cc8765d42637"]]},{"id":"e7f7cc8765d42637","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"Top 100 downloaded packages (month)","order":7,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n<h2>Top 100 downloaded packages - last month numbers</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2706.999755859375,"y":2536.8332236153738,"wires":[[]]},{"id":"a8715f06a1e483b2","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2320.8331298828125,"y":461.5553894042969,"wires":[["2ba7496fdee9fb94"]]},{"id":"2d23825607b33059","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":411.66644287109375,"y":126.66662788391113,"wires":[["2ba7496fdee9fb94"]]},{"id":"8849e98ce9b9944f","type":"delay","z":"741c6acbed17d504","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":609.9997482299805,"y":183.33328247070312,"wires":[["2d23825607b33059"]]},{"id":"2a1248ce7e1ac372","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow"},{"t":"set","p":"downloads","pt":"msg","to":"downloads","tot":"flow"},{"t":"set","p":"downloads_last_month","pt":"msg","to":"downloads_last_month","tot":"flow"},{"t":"set","p":"downloads_last_year","pt":"msg","to":"downloads_last_year","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1471.3332138061523,"y":1931.999971662249,"wires":[["e6d146cc9716633a","b110eaf6482b4c19"]]},{"id":"b110eaf6482b4c19","type":"function","z":"741c6acbed17d504","name":"active maintainers, maintainers that dropped out and the rest","func":"var maintainers = {}\n\nvar now = new Date()\nvar monthsAgo = {}\n\nfor ( var y = 0; y < 11; y++ ) {\n    monthsAgo[12 * y] = moment(now).subtract(12 * y, 'month')\n    maintainers[y] = {}\n}\n\nvar allMaintainers = {}\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id]\n    if (version) {\n        (version.maintainers || []).forEach((mt) => {\n            allMaintainers[mt.name] = allMaintainers[mt.name] || {}\n            allMaintainers[mt.name][module.id] = true\n        })\n    }\n});\n\nfor (var y = 0; y < 10; y++) {\n    msg.payload.modules.filter( (module) => {\n        var d = Date.parse(module.updated_at);\n        return ( monthsAgo[y * 12] > d ) && ( d > monthsAgo[(y+1)*12] )\n    }).forEach( (module) => {\n        var version = msg.versions[module.id]\n        if ( version ) {\n            (version.maintainers || []).forEach( (mt) => {\n                maintainers[y][mt.name] = maintainers[y][mt.name] || {}\n                maintainers[y][mt.name][module.id] = true\n            })\n        }\n    })\n}\n\nvar here12 = Object.keys(maintainers[0])\nvar gone24 = Object.keys(maintainers[1])\nvar gone36 = Object.keys(maintainers[2])\nvar gone48 = Object.keys(maintainers[3])\nvar gone60 = Object.keys(maintainers[4])\nvar gone72 = Object.keys(maintainers[5])\nvar gone84 = Object.keys(maintainers[6])\nvar gone96 = Object.keys(maintainers[7])\nvar gone108 = Object.keys(maintainers[8])\n\ngone24 = gone24.filter( (x) => {\n    return here12.indexOf(x) < 0\n});\n\ngone36 = gone36.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0\n});\n\ngone48 = gone48.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0\n});\n\ngone60 = gone60.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0\n});\n\ngone72 = gone72.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0\n});\n\ngone84 = gone84.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0 && gone72.indexOf(x) < 0\n});\n\ngone96 = gone96.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0 && gone72.indexOf(x) < 0 && gone84.indexOf(x) < 0\n});\n\ngone108 = gone108.filter((x) => {\n    return here12.indexOf(x) < 0 && gone24.indexOf(x) < 0 && gone36.indexOf(x) < 0 && gone48.indexOf(x) < 0 && gone60.indexOf(x) < 0 && gone72.indexOf(x) < 0 && gone84.indexOf(x) < 0 && gone96.indexOf(x) < 0\n});\n\nvar kvs = [\n    [\"12m\", here12],\n    [\"24m\", gone24],\n    [\"36m\", gone36],\n    [\"48m\", gone48],\n    [\"60m\", gone60],\n    [\"72m\", gone72],\n    [\"84m\", gone84],\n    [\"96m\", gone96],\n    [\"108m\", gone108],\n]\n\nmsg.payload = [{\n    \"series\": kvs.map((v) => { return v[0] }),\n    \"data\": kvs.map((v) => { return [v[1].length] }),\n    \"labels\": [\"Last Active - Total: \" + Object.keys(allMaintainers).length]\n}]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"}],"x":2037.6663208007812,"y":1931.999971662249,"wires":[["c16e1a149617f22a"]]},{"id":"c16e1a149617f22a","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":2,"width":8,"height":8,"label":"maintainers activity by year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2666.999755859375,"y":1930.999971662249,"wires":[[]]},{"id":"e6d146cc9716633a","type":"function","z":"741c6acbed17d504","name":"average time maintaining code","func":"var now = new Date()\nvar allMaintainers = {}\nvar releaseCounts = {}\nvar moduleAge = {}\nvar firstReleaseEver = moment(now).add(30, 'year');\n\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id]\n\n    if (version) {\n        \n        releaseCounts[module.id] = Object.keys(version.releases|| {}).length - 2; // -2 because there is \"created\" and \"modified\"\n\n        (version.maintainers || []).forEach((mt) => {\n            allMaintainers[mt.name] = allMaintainers[mt.name] || {\n                started: moment(now).add(30,'year'),\n                stopped: -1\n            }\n\n            let latestRelease = version.releases[version.disttags && version.disttags.latest]\n            let firstRelease = Date.parse(version.releases[\"created\"])\n\n            firstReleaseEver = Math.min(firstReleaseEver, firstRelease)\n\n            allMaintainers[mt.name].started = Math.min(allMaintainers[mt.name].started, firstRelease)\n            if ( latestRelease) {\n                moduleAge[module.id] = Date.parse(latestRelease) - firstRelease\n                allMaintainers[mt.name].stopped = Math.max(allMaintainers[mt.name].stopped, Date.parse(latestRelease))\n            }\n        })\n    }\n});\n\nvar packAge = Object.values(moduleAge).filter( d => {\n    return d > 0\n}).map( d => {\n    return moment.duration(d, 'milliseconds').asMonths();\n})\n\nvar data = Object.values(allMaintainers).filter( d => {\n    return d.started < now && d.stopped > 0 && d.started < d.stopped \n}).map( d => {\n    return moment.duration(d.stopped - d.started, 'milliseconds').asMonths();\n})\n\nvar rCnt = Object.values(releaseCounts).filter( d => {\n    return d > 0\n})\n\nvar relPercentiles = [...new Array(10)].map((i, idx) => {\n    return [(10*idx+1), jstat.percentile(rCnt, (10*idx+1) / 100)]\n});\n\nvar actPercentiles = [...new Array(10)].map((i, idx) => {\n    return [10*idx+1, jstat.percentile(data, (10*idx + 1) / 100)]\n});\n\nvar nodereddetails = {}\nif ( msg.versions[\"node-red\"]) {\n    let nrVersions = msg.versions[\"node-red\"];\n\n    if (nrVersions.releases){\n        nodereddetails[\"releases\"] = Object.keys(nrVersions.releases).length - 2\n        nodereddetails[\"first_release\"] = moment(Date.parse(nrVersions.releases[\"created\"])).format(\"dddd, MMMM Do YYYY, h:mm:ss a\")\n    }\n\n    nodereddetails[\"dwns\"] = {\n        \"lastweek\": msg.downloads[\"node-red\"] || -1,\n        \"lastmonth\": msg.downloads_last_month[\"node-red\"] || -1,\n        \"lastyear\": msg.downloads_last_year[\"node-red\"] || -1\n    }\n}\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": relPercentiles.map((v) => { return v[0] }),\n            \"data\": relPercentiles.map((v) => { return [v[1]] }),\n            \"labels\": [\"Percentile\"]\n        }]\n    },\n\n    {\n        ...msg,\n        payload: [{\n            \"series\": actPercentiles.map((v) => { return v[0] }),\n            \"data\": actPercentiles.map((v) => { return [v[1]] }),\n            \"labels\": [\"Percentile\"]\n        }]\n    },\n    \n    {\n        ...msg,\n        payload: {\n            package_age: {\n                median: jstat.median(packAge),\n                mean: jstat.mean(packAge),\n                max: jstat.max(packAge),\n                per90: jstat.percentile(packAge, 0.9)\n            },\n            release_count: {\n                median: jstat.median(rCnt),\n                mean: jstat.mean(rCnt),\n                max: jstat.max(rCnt),\n                per90: jstat.percentile(rCnt, 0.9)\n            },\n            maintainers_stay: {\n                median: jstat.median(data),\n                mean: jstat.mean(data),\n                max: jstat.max(data),\n                per90: jstat.percentile(data, 0.9)\n            },\n            totals: {\n                maintainers: Object.keys(allMaintainers).length,\n                packages: msg.payload.modules.length,\n                first_package_released: moment(firstReleaseEver).format(\"dddd, MMMM Do YYYY, h:mm:ss a\")\n            },\n            nodered: nodereddetails\n        }\n    }\n]\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1947.6663208007812,"y":2001.9999716622488,"wires":[["16b238d730f2f00b"],["109f21242d7a0a2e"],["168bf5e7d110f9d2"]]},{"id":"16b238d730f2f00b","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":10,"width":8,"height":8,"label":"releases per package","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":"300","removeOlderPoints":"100","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2646.999755859375,"y":1992.999971662249,"wires":[[]]},{"id":"109f21242d7a0a2e","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":11,"width":8,"height":8,"label":"months developer active","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":"300","removeOlderPoints":"100","removeOlderUnit":"604800","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":2040.9999716622488,"wires":[[]]},{"id":"168bf5e7d110f9d2","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h3>Absolutes</h3>\n<dl>\n  {{#payload}}\n  <dt>Total package maintainers</dt>\n  <dd>{{ totals.maintainers }}</dd>\n  <dt>Total packages</dt>\n  <dd>{{ totals.packages }}</dd>\n  <dt>First package released</dt>\n  <dd>{{ totals.first_package_released }}</dd>\n  {{/payload}}\n</dl>\n\n<h3>Node-RED</h3>\n<dl>\n  {{#payload}}\n  {{#nodered}}\n  <dt>Total Releases</dt>\n  <dd>{{ releases }}</dd>\n  <dt>First Release</dt>\n  <dd>{{ first_release }}</dd>\n  {{#dwns}}\n  <dt>Last Week Downloads</dt>\n  <dd>{{ lastweek }}</dd>\n  <dt>Last Month Downloads</dt>\n  <dd>{{ lastmonth }}</dd>\n  <dt>Last Year Downloads</dt>\n  <dd>{{ lastyear }}</dd>\n  {{/dwns}}\n  {{/nodered}}\n  {{/payload}}\n</dl>\n\n<table> \n  <tr>\n    <td>\n<h3>Releases per package</h3>\n<dl>\n  {{#payload}}\n  {{#release_count}}\n  <dt>Median</dt>\n  <dd>{{ median }}</dd>\n  <dt>Mean</dt>\n  <dd>{{ mean }}</dd>\n  <dt>90th Percentile</dt>\n  <dd>{{ per90 }}</dd>\n  <dt>Max</dt>\n  <dd>{{ max }}</dd>\n  {{/release_count}}\n  {{/payload}}\n</dl>\n</td>\n<td>\n<h3>Package age in <b>months</b></h3>\n<dl>\n  {{#payload}}\n  {{#package_age}}\n  <dt>Median</dt>\n  <dd>{{ median }}</dd>\n  <dt>Mean</dt>\n  <dd>{{ mean }}</dd>\n  <dt>90th Percentile</dt>\n  <dd>{{ per90 }}</dd>\n  <dt>Max</dt>\n  <dd>{{ max }}</dd>\n  {{/package_age}}\n  {{/payload}}\n</dl>\n</td>\n</tr>\n</table>\n\n<h3>In <b>months</b>: how long are maintainers active?</h3>\n<dl>\n  {{#payload}}\n  {{#maintainers_stay}}\n  <dt>Median</dt>\n  <dd>{{ median }}</dd>\n  <dt>Mean</dt>\n  <dd>{{ mean }}</dd>\n  <dt>90th Percentile</dt>\n  <dd>{{ per90 }}</dd>\n  <dt>Max</dt>\n  <dd>{{ max }}</dd>\n  {{/maintainers_stay}}\n  {{/payload}}\n</dl>\n\n","output":"str","x":2382.333251953125,"y":2097.4999716622488,"wires":[["76d6e701c58d1a9a"]]},{"id":"76d6e701c58d1a9a","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"Release and developer active stats","order":12,"width":16,"height":16,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2686.999755859375,"y":2097.4999716622488,"wires":[[]]},{"id":"c1e3e3106852730b","type":"link in","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"package list with node-red","links":[],"x":2583.99983215332,"y":224.66664409637406,"wires":[["decbcd79400f7463"]]},{"id":"decbcd79400f7463","type":"http request","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"GET package catalogue","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":2765.9998321533203,"y":173.6666440963745,"wires":[["8c201d5953b3ca23"]]},{"id":"8c201d5953b3ca23","type":"function","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"add node-red as a module","func":"\nmsg.payload.modules.push({\n    id: \"node-red\",\n    version: \"3.1.0\",\n    description: \"Low-code programming for event-driven applications\",\n    updated_at: new Date(),\n    types: [],\n    keywords: [],\n    url: \"https://nodered.org\"\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2778.9998321533203,"y":251.6666440963745,"wires":[["021431979e0d32d2"]]},{"id":"021431979e0d32d2","type":"link out","z":"741c6acbed17d504","g":"fa640e80decc9bc5","name":"link out 122","mode":"return","links":[],"x":2958.9998321533203,"y":207.6666440963745,"wires":[]},{"id":"1921a9a32d5a9878","type":"link call","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3961.999755859375,"y":1598.786963296315,"wires":[["6c76540a2ef329ac"]]},{"id":"81be659567411e30","type":"link call","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":4013.999755859375,"y":985.8517680697971,"wires":[["8045064c5212858b"]]},{"id":"02c2b8d03169a734","type":"link call","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3970.999755859375,"y":385.99997166224875,"wires":[["64f65485e85f9ba7"]]},{"id":"2230441c8da6753d","type":"function","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"function 20","func":"msg.downloads = msg.downloads || {};\n\nvar module = msg.modules.pop();\n\n/* \n  Url from https://www.edoardoscibona.com/exploring-the-npm-registry-api, possible periods are:\n   - last-year\n   - last-month\n   - last-year\n   - last-day\n*/\nif (module) {\n    return [{\n        ...msg,\n        url: \"https://api.npmjs.org/downloads/point/last-year/\" + module.id,\n        module: module,\n        requestTimeout: 2500,\n        isempty: msg.downloads[module.id] == undefined\n    },\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4484.999755859375,"y":2115.4720612480523,"wires":[["203760d36862264f"],["ea0a1d0be603cf50"]]},{"id":"6819c8ec63305b67","type":"http request","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3287.499755859375,"y":2134.2220612480523,"wires":[["c2af0e3635fd2d79"]]},{"id":"6cb9d69563fbde69","type":"delay","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4295.16641998291,"y":2356.222171874273,"wires":[["2230441c8da6753d"]]},{"id":"7e1f12a867a4eebf","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"updated flow context","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4697.999755859375,"y":2309.4095612480523,"wires":[]},{"id":"2a9d1725f4e61ea9","type":"change","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"set msg.downloads_last_year, set msg.modules","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_year","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4158.999755859375,"y":2155.971956888834,"wires":[["2230441c8da6753d"]]},{"id":"c2af0e3635fd2d79","type":"function","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"function 21","func":"msg.downloads = msg.downloads || {}\n\nif (msg.payload.package) {\n    msg.downloads[msg.payload.package] = msg.payload.downloads;\n    \n    return [\n        msg,\n        undefined\n    ]\n} else {\n    return [\n        undefined,\n        msg\n    ]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3389.999755859375,"y":2317.4095612480523,"wires":[["01ab63cd6d588d93"],["d7fa312520baad1e","6cb9d69563fbde69"]]},{"id":"01ab63cd6d588d93","type":"change","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","rules":[{"t":"set","p":"downloads_last_year","pt":"flow","to":"downloads","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4127.999755859375,"y":2309.4095612480523,"wires":[["7e1f12a867a4eebf","6cb9d69563fbde69"]]},{"id":"b90b8e6feee3063a","type":"inject","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"Trigger download number collection","props":[{"p":"payload"}],"repeat":"13800","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3609.999755859375,"y":2201.9720612480523,"wires":[["6fced96b3ef2fa2e"]]},{"id":"67ed67193e9b4bed","type":"catch","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","scope":["6819c8ec63305b67"],"uncaught":false,"x":3407.999755859375,"y":2116.2220612480523,"wires":[["78e20e5e110959a9","fdb0b52bbfaf2d1d"]]},{"id":"78e20e5e110959a9","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"debug 62","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3591.999755859375,"y":2150.2220612480523,"wires":[]},{"id":"203760d36862264f","type":"switch","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":4105.999755859375,"y":2012.7220612480526,"wires":[["6a75e0693b9b3d5b","2230441c8da6753d"],["6819c8ec63305b67"]]},{"id":"6a75e0693b9b3d5b","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"has been retrieved","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4687.999755859375,"y":2006.7220612480526,"wires":[]},{"id":"fdb0b52bbfaf2d1d","type":"delay","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3978.999755859375,"y":2113.3888092949273,"wires":[["2230441c8da6753d"]]},{"id":"ea0a1d0be603cf50","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4647.999755859375,"y":2183.3888092949273,"wires":[]},{"id":"3930fb99a0e941de","type":"inject","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"Reset","props":[{"p":"payload"}],"repeat":"90000","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":3440.749755859375,"y":2271.388704935709,"wires":[["7472483711227f66"]]},{"id":"7472483711227f66","type":"change","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","rules":[{"t":"set","p":"downloads_last_year","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3663.749755859375,"y":2255.3888092949273,"wires":[["6fced96b3ef2fa2e"]]},{"id":"d7fa312520baad1e","type":"debug","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"empty download data","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3610.749755859375,"y":2358.3888092949273,"wires":[]},{"id":"6fced96b3ef2fa2e","type":"link call","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":3961.999755859375,"y":2201.6388092949273,"wires":[["2a9d1725f4e61ea9"]]},{"id":"2c4902d306776857","type":"change","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"flow.downloads_last_year --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"downloads_last_year","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4296.999755859375,"y":2483.981358270796,"wires":[["b61ba8d10ac5b49a"]]},{"id":"2fba82f963fc36b9","type":"inject","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4042.999755859375,"y":2483.981358270796,"wires":[["2c4902d306776857"]]},{"id":"b61ba8d10ac5b49a","type":"function","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"function 22","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4567.999755859375,"y":2483.981358270796,"wires":[["4f8ba2a5cf54b3d5"]]},{"id":"4f8ba2a5cf54b3d5","type":"debug","z":"741c6acbed17d504","g":"9e12e45c53d302e1","name":"debug 64","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4737.999755859375,"y":2483.981358270796,"wires":[]},{"id":"5583bf246f7f872f","type":"function","z":"741c6acbed17d504","name":"most downloads last year","func":"var kvs = Object.keys(msg.downloads).map((k) => { return [k, msg.downloads[k]]}).filter( (d) => { return d[0] != \"undefined\" })\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar orig = [...kvs]\n\nkvs.length = 100;\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Packages\"]\n        }]\n    },\n    {\n        ...msg,\n        payload: kvs.map((v) => {\n            var mod = msg.payload.modules.filter((d) => { return d.id == v[0] })[0];\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"version\": mod.version,\n                \"desc\": mod.description,\n                \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n            }\n        })\n    },\n    {\n        ...msg,\n        payload: orig\n    }\n]","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1927.6663208007812,"y":2183.9999716622488,"wires":[["c50be1421ee3faa0"],["d462e7dba3a8ad5b"],["9411eb7feff999a0"]]},{"id":"a62c97296fca9718","type":"change","z":"741c6acbed17d504","name":"flow.downloads_last_year --> downloads","rules":[{"t":"set","p":"downloads","pt":"msg","to":"downloads_last_year","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1551.3332138061523,"y":2183.9999716622488,"wires":[["5583bf246f7f872f"]]},{"id":"c50be1421ee3faa0","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"7278d8bced05b3d5","order":3,"width":"16","height":20,"label":"top 100 downloaded packages - last year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2706.999755859375,"y":2170.9999716622488,"wires":[[]]},{"id":"d462e7dba3a8ad5b","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":2229.4999716622488,"wires":[["4196a221702c7174"]]},{"id":"4196a221702c7174","type":"ui_template","z":"741c6acbed17d504","group":"7278d8bced05b3d5","name":"Top 100 downloaded packages (year)","order":9,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n<h2>Top 100 downloaded packages - last year</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2696.999755859375,"y":2229.4999716622488,"wires":[[]]},{"id":"060ee3fec1be0dc9","type":"function","z":"741c6acbed17d504","name":"add node-red as a module","func":"\nmsg.payload.modules.push({\n    id: \"node-red\",\n    version: \"3.1.0\",\n    description: \"Low-code programming for event-driven applications\",\n    updated_at: new Date(),\n    types: [],\n    keywords: [],\n    url: \"https://nodered.org\"\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1145.999755859375,"y":2184,"wires":[["67659a26f732abce","acb70287893b47e6","a62c97296fca9718"]]},{"id":"fc906ad4a7bc49e6","type":"function","z":"741c6acbed17d504","name":"package counts per year","func":"var yearPackage = {}\n\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id];\n    if (version && version.releases && version.releases.created) {\n        var year = moment(version.releases.created).year()\n        yearPackage[year] = yearPackage[year] || 0;\n        yearPackage[year] += 1\n    }\n});\n\nvar kvs = Object.keys(yearPackage).map( (k) => { return [parseInt(k), yearPackage[k]]} )\nkvs = kvs.sort((a, b) => { return a[0] < b[0] ? 1 : -1 })\n\nreturn {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return \"\"+v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Year - Total: \" + jstat.sum(kvs.map((v) => { return v[1] }))]\n        }]\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1927.6663208007812,"y":1533.3332605361938,"wires":[["2b4002228dca5b61"]]},{"id":"2b4002228dca5b61","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"01cb0c42ba918c34","order":2,"width":"8","height":"8","label":"new packages per year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":1533.3332605361938,"wires":[[]]},{"id":"b128296d67e6b95e","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":1,"width":8,"height":8,"label":"new maintainers by year","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2656.999755859375,"y":1624.9999628067017,"wires":[[]]},{"id":"53fa90a1a439d3aa","type":"function","z":"741c6acbed17d504","name":"maintainers of the top downloaded packages","func":"var maintainers = {}\n\nmsg.payload.length = 100\n\nmsg.payload.forEach( (ary) => {\n    let packname = ary[0];\n    let version = msg.versions[packname];\n\n    if (version) {\n        (version.maintainers || []).forEach((man) => {\n            maintainers[man.name] = (maintainers[man.name] || [])\n            maintainers[man.name].push( packname )\n        })\n    }\n})\n\nvar kvs = Object.keys(maintainers).map((k) => { return [k, maintainers[k].length] })\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nreturn [\n    {\n        ...msg,\n        payload: [{\n            \"series\": kvs.map((v) => { return v[0] }),\n            \"data\": kvs.map((v) => { return [v[1]] }),\n            \"labels\": [\"Maintainer\"]\n        }]\n    },\n    {\n        ...msg,\n        total: Object.keys(maintainers).length,\n        payload: kvs.map((v) => {\n            return {\n                \"value\": v[0],\n                \"count\": parseInt(v[1]),\n                \"modules\": maintainers[v[0]].map((d) => { return { name: d } }),\n            }\n        })\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1987.6663208007812,"y":2324.33349609375,"wires":[["d31c061fa26fc19a"],["82c5d63dac18dc3d"]]},{"id":"9411eb7feff999a0","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1907.6663208007812,"y":2256.999755859375,"wires":[["53fa90a1a439d3aa"]]},{"id":"d31c061fa26fc19a","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":6,"width":16,"height":20,"label":"maintainers of the top 100 downloaded packages (last year)","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2766.999755859375,"y":2318,"wires":[[]]},{"id":"82c5d63dac18dc3d","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://www.npmjs.com/~{{ value }}\">{{ value}}</a></b> ({{count}})</dt>\n  <dd>{{#modules}}<a target=\"_blank\" href=\"https://flows.nodered.org/node/{{{name}}}\">{{name}}</a>, {{/modules}}</dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":2370.5,"wires":[["d5c0b2276b2202a8"]]},{"id":"d5c0b2276b2202a8","type":"ui_template","z":"741c6acbed17d504","group":"fb090f8abca07b18","name":"Maintainers of top downloads = last year","order":9,"width":16,"height":15,"format":"<div class=\"fix-header-onscroll\">\n<h2>Maintainers of top 100 downloaded packages - last year</h2>\n<div>\n<span style=\"font-weight: bold;\">Total</span>: {{msg.total}}\n</div>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2706.999755859375,"y":2370.5,"wires":[[]]},{"id":"f06f7069b7e81822","type":"inject","z":"741c6acbed17d504","name":"BIG RED RESET BUTTON","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":926,"y":138,"wires":[["3ab90e85ec532f99"]],"icon":"font-awesome/fa-warning"},{"id":"3ab90e85ec532f99","type":"link out","z":"741c6acbed17d504","name":"link out 123","mode":"link","links":["057c714997aee1c8","8a7f161573c5e14f","ec7c42bb832fc3ea","eecdeeb1d5aa8833","f05758153fc09e49","e4f89a1c09554cc6"],"x":1113,"y":112.2777099609375,"wires":[]},{"id":"ec7c42bb832fc3ea","type":"link in","z":"741c6acbed17d504","name":"link in 1","links":["3ab90e85ec532f99"],"x":2266.3330078125,"y":112.2777099609375,"wires":[["6e28a0aaf183ed8a"]]},{"id":"8a7f161573c5e14f","type":"link in","z":"741c6acbed17d504","g":"f98a6a1875c36277","name":"link in 2","links":["c08ce4327a2715c1","3ab90e85ec532f99"],"x":3476.0830078125,"y":1015.3515735202366,"wires":[["6f70a024e1b52425"]]},{"id":"057c714997aee1c8","type":"link in","z":"741c6acbed17d504","g":"763a9a3a19e3e566","name":"link in 3","links":["03cc04158eccb404","3ab90e85ec532f99"],"x":3416.749755859375,"y":2238.388704935709,"wires":[["7472483711227f66"]]},{"id":"f05758153fc09e49","type":"link in","z":"741c6acbed17d504","g":"83e19bdbfde4f783","name":"link in 4","links":["e0e039cb00b4cce4","3ab90e85ec532f99"],"x":3416.749755859375,"y":1633.536887274848,"wires":[["4d9b4c52dce3fdf4"]]},{"id":"eecdeeb1d5aa8833","type":"link in","z":"741c6acbed17d504","g":"50d3daf2d40242cd","name":"link in 5","links":["0e9033b68791ad78","3ab90e85ec532f99"],"x":3418.749755859375,"y":416.66650390625,"wires":[["5a18cef8307f4179"]]},{"id":"73bf88a722f5ed95","type":"function","z":"741c6acbed17d504","name":"packages without readme, modules unpublished","func":"\nvar noreadmes = msg.payload.modules.filter((module) => {\n    if (!msg.versions[module.id] || !!msg.versions[module.id].unpublished) {\n        return false\n    } else {\n        return !msg.versions[module.id].readme\n    }\n}).map( module => {\n    let mod = msg.versions[module.id];\n    let dwn = msg.downloads_last_year[module.id]\n    \n    return {\n        \"value\": module.id,\n        \"count\": dwn || -1,\n        \"version\": mod.version,\n        \"desc\": mod.description,\n        \"tags\": (mod.keywords || []).map(d => { return { tag: d } }),\n        \"str\": JSON.stringify(mod, null, 2)\n    }\n})\n\nvar unpublished = msg.payload.modules.filter((module) => {\n    if (!msg.versions[module.id]) {\n        return false\n    } else {\n        return !!msg.versions[module.id].unpublished\n    }\n}).map( module => {\n    let mod = msg.versions[module.id];\n    let dwn = msg.downloads_last_year[module.id]\n\n    return {\n        \"value\": module.id,\n        \"count\": dwn || -1,\n        \"version\": mod.version,\n        \"desc\": mod.description,\n        \"tags\": (mod.keywords || []).map(d => { return { tag: d } })\n    }\n})\n\nreturn [\n    {\n        ...msg,\n        totalPackages: noreadmes.length,\n        payload: noreadmes\n    },\n    {\n        ...msg,\n        totalPackages: unpublished.length,\n        payload: unpublished\n    }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":2007.6663208007812,"y":1834,"wires":[["1333d1a55a3a984a"],["96db2020dbbb17d1"]]},{"id":"1333d1a55a3a984a","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt>\n    <b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> \n    (DLYr: {{count}})\n    <a target=\"_blank\" href=\"https://registry.npmjs.org/{{ value }}\">reg</a>\n  </dt>\n  <dd>\n    <i>{{ version }}</i> \n    {{#tags}}{{tag}},{{/tags}}<br>\n    <i>{{ desc }}</i><br>\n    <!-- <pre><code>{{str}}</code></pre> -->\n  </dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":1827,"wires":[["11763054934e191d"]]},{"id":"11763054934e191d","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"Packages without readme","order":13,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n<h2>Packages without readme data</h2>\n<span style=\"font-weight: bold;\">Total</span>: {{msg.totalPackages}}\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2656.999755859375,"y":1827,"wires":[[]]},{"id":"611bf86b366aefa4","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"downloads_last_year","pt":"msg","to":"downloads_last_year","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1947.6663208007812,"y":1758.6665897369385,"wires":[["73bf88a722f5ed95"]]},{"id":"af7d9109c58e5503","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"Packages unpublished","order":14,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n<h2>Packages Unpublished</h2>\n<div>\n    <span style=\"font-weight: bold;\">Total</span>: {{msg.totalPackages}}\n</div>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2646.999755859375,"y":1883.066650390625,"wires":[[]]},{"id":"96db2020dbbb17d1","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt>\n    <b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> \n    (DLYr: {{count}})\n    <a target=\"_blank\" href=\"https://registry.npmjs.org/{{ value }}\">reg</a>\n  </dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br><i>{{ desc }}</i></dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":1883.066650390625,"wires":[["af7d9109c58e5503"]]},{"id":"d66deda16cb34afb","type":"ui_template","z":"741c6acbed17d504","group":"0ed53e2825b8c7fb","name":"Custom CSS","order":3,"width":0,"height":0,"format":"<style>\n    .fix-header-onscroll {\n        position: sticky; \n        top: 0; \n        border-top: 1px solid #08f;    \n        background-color: white;\n    }\n</style>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"global","className":"","x":2616.999755859375,"y":461.5553894042969,"wires":[[]]},{"id":"bab9b83903f03aa6","type":"function","z":"741c6acbed17d504","name":"maintainer and contributor counts","func":"var mcCounts = {}\nlet pplCounts = {}\n\nmsg.payload.modules.forEach((module) => {\n    var version = msg.versions[module.id];\n\n    if ( version ) {\n      let key = \"\" + (version.maintainers || []).length + \",\" + ((version.contributors || []).length || 0);\n      mcCounts[key] = (mcCounts[key] || 0) + 1\n\n      key = ((version.maintainers || []).length || 0) + ((version.contributors || []).length || 0);\n      pplCounts[key] = (pplCounts[key] || 0) + 1\n    }\n\n});\n\nvar kvs = Object.keys(mcCounts).map( (k) => { return [k, mcCounts[k]]} )\nkvs = kvs.sort((a, b) => { return a[1] < b[1] ? 1 : -1 })\n\nvar kvs2 = Object.keys(pplCounts).map((k) => { return [k, pplCounts[k]] })\nkvs2 = kvs2.sort((a, b) => { return parseInt(a[0]) > parseInt(b[0]) ? 1 : -1 })\n\nreturn [\n  {\n    ...msg,\n    payload: [{\n        \"series\": kvs.map((v) => { return \"\"+v[0] }),\n        \"data\": kvs.map((v) => { return [v[1]] }),\n        \"labels\": [\"MC Count\"]\n    }]\n  }, \n  {\n    ...msg,\n    payload: [{\n      \"series\": kvs2.map((v) => { return \"\" + v[0] }),\n      \"data\": kvs2.map((v) => { return [v[1]] }),\n      \"labels\": [\"PPl Count\"]\n    }]\n  }\n]\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"moment","module":"moment"},{"var":"jstat","module":"jstat"}],"x":1957.6663208007812,"y":1442.5,"wires":[["ec44ac1beba91c78"],["d0ff8847ab6e66a6"]]},{"id":"ec44ac1beba91c78","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":3,"width":8,"height":8,"label":"number of maintainers, number of contributors","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2726.999755859375,"y":1442.5,"wires":[[]]},{"id":"6e28a0aaf183ed8a","type":"change","z":"741c6acbed17d504","name":"reset charts","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2371.3330078125,"y":251.555419921875,"wires":[["d5c0b2276b2202a8","d31c061fa26fc19a","2b4002228dca5b61","4196a221702c7174","c50be1421ee3faa0","76d6e701c58d1a9a","109f21242d7a0a2e","16b238d730f2f00b","c16e1a149617f22a","e7f7cc8765d42637","2c5f56500f8481e0","2c424d5c5477f560","3fe13dceb4568af8","d3960b2b800f214f","c891cade66e07a2f","c9f5e8734dc46760","911d68596b80740e","c4d0f31a52436e6c","08e9c9ce8d47bd36","5353fbb10c120179","0de51abc98bd4b1f","26071b19cfe2addb","696d4b7a9edc9456","fc97bcdb069767a2","cd46143e9a042d89","da734d225bc3a03b","bdcf58f8b5f0a53f","dec7a25e92772aec","11763054934e191d","af7d9109c58e5503","ec44ac1beba91c78","d0ff8847ab6e66a6","3a6adf3bf423e1ec","8fcf4e9e86e670d0"]]},{"id":"d0ff8847ab6e66a6","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"fb090f8abca07b18","order":4,"width":8,"height":8,"label":"total people involved in pkg dev","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2676.999755859375,"y":1486.333408355713,"wires":[[]]},{"id":"c3671042b2b21a3c","type":"function","z":"741c6acbed17d504","name":"newest 100 packages","func":"let modules = msg.payload.modules.reduce(function (map, obj) {\n    map[obj.id] = obj;\n    return map;\n}, {});\n\nvar latest = Object.keys(msg.versions).map( v => {\n    return [v, msg.versions[v]]\n}).sort( (a,b) => {\n    if (a[1].releases && b[1].releases && a[1].releases.created && b[1].releases.created) {\n        return Date.parse(a[1].releases.created) < Date.parse(b[1].releases.created) ? 1 : -1\n    } else { return -1 }\n}).slice(\n    0,100\n).map( v => {\n    return v.concat( [modules[v[0]]] )\n}).filter( v => {\n    console.log( v )\n    return !!v[2]\n}).map( v => {\n    return [\n        v[2].id,\n        v[1].releases.created.split(\"T\")[0],\n        v[2].description,\n        v[2].version,\n        v[2].keywords\n    ]\n})\n\nmsg.payload = latest.map((v) => {\n    return {\n        \"value\": v[0],\n        \"date\": v[1],\n        \"desc\": v[2],\n        \"version\": v[3],\n        \"tags\": (v[4] || []).map(d => { return { tag: d } })\n    }\n})\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1917.6663208007812,"y":1362,"wires":[["dde2949d37452a6d"]]},{"id":"3a6adf3bf423e1ec","type":"ui_template","z":"741c6acbed17d504","group":"01cb0c42ba918c34","name":"List newest packages","order":10,"width":"16","height":"16","format":"<div class=\"fix-header-onscroll\">\n<h2>Newest 100 package</h2>\n</div>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":2646.999755859375,"y":1362,"wires":[[]]},{"id":"dde2949d37452a6d","type":"template","z":"741c6acbed17d504","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<dl>\n{{#payload}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{date}})</dt>\n  <dd><i>{{ version }}</i> {{#tags}}{{tag}},{{/tags}}<br>\n  <i>{{ desc }}</i>\n  </dd>\n{{/payload}}\n</dl>\n","output":"str","x":2382.333251953125,"y":1362,"wires":[["3a6adf3bf423e1ec"]]},{"id":"f8a880616a0678e0","type":"function","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"function 24","func":"msg.versions = msg.versions || {};\n\nvar module = msg.modules.pop();\n\nif ( !module ) {\n    return [ \n        undefined,\n        msg\n    ]\n} else {\n    return [\n        {\n            ...msg,\n            url: \"https://registry.npmjs.org/\" + module.id,\n            module: module,\n            requestTimeout: 2500,\n            isempty: msg.dependencies[module.id] == undefined,\n        },\n        undefined\n    ]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4489.999755859375,"y":2691.323907246665,"wires":[["b0dd219744d43c9d"],["9a1e6dfa766086fd"]]},{"id":"e052666ce8bdb712","type":"http request","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":true,"headers":[],"x":3312.4997634887695,"y":2706.1572822237767,"wires":[["c30d3bcfc3ce373b"]]},{"id":"1f7e912f0159aa56","type":"delay","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":4321.166320800781,"y":2966.074006428794,"wires":[["f8a880616a0678e0"]]},{"id":"70e2dc27fdb91843","type":"debug","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"update flow context","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4697.999755859375,"y":2900.948907246665,"wires":[]},{"id":"6a3720a225ce1a36","type":"change","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"set msg.dependencies, set msg.modules","rules":[{"t":"set","p":"dependencies","pt":"msg","to":"dependencies","tot":"flow","dc":true},{"t":"set","p":"modules","pt":"msg","to":"payload.modules","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4235,"y":2739.073907246665,"wires":[["f8a880616a0678e0"]]},{"id":"c30d3bcfc3ce373b","type":"function","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"function 25","func":"msg.dependencies = msg.dependencies || {}\n\nif (msg.payload._id) {\n    try {\n        msg.dependencies[msg.payload._id] = msg.payload.versions[msg.payload[\"dist-tags\"][\"latest\"]].dependencies\n    } catch (ex) {\n        msg.dependencies[msg.payload._id] = {}\n    }\n\n    return [\n        msg,\n        undefined\n    ]\n} else {\n    if ( msg.statusCode == 404) {\n        msg.dependencies[msg.module.id] = {\n        }\n        \n        return [\n            msg,\n            undefined\n        ]\n    } else {\n        return [\n            undefined,\n            msg\n        ]\n    }\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3469.999755859375,"y":2908.573907246665,"wires":[["6bf4bf66e84c4826"],["812af935be45d037","1f7e912f0159aa56"]]},{"id":"6bf4bf66e84c4826","type":"change","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","rules":[{"t":"set","p":"dependencies","pt":"flow","to":"dependencies","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4148.999755859375,"y":2900.948907246665,"wires":[["70e2dc27fdb91843","1f7e912f0159aa56"]]},{"id":"2c310f9b66a4979e","type":"inject","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"Trigger download number collection","props":[],"repeat":"21600","crontab":"","once":false,"onceDelay":"1","topic":"","x":3669.999755859375,"y":2801.573907246665,"wires":[["cb923dd83e9a50ba"]]},{"id":"f6604fcfb562f29f","type":"catch","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","scope":["e052666ce8bdb712"],"uncaught":false,"x":3430.999755859375,"y":2691.073907246665,"wires":[["f476789b02f5a38e","759fb127ca4b03a8"]]},{"id":"f476789b02f5a38e","type":"debug","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"debug 78","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3608.33309173584,"y":2752.0738667155065,"wires":[]},{"id":"b0dd219744d43c9d","type":"switch","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","property":"isempty","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":4105.999744415283,"y":2609.907279362754,"wires":[["e6aa69dbf8bd4b13","f8a880616a0678e0"],["e052666ce8bdb712"]]},{"id":"e6aa69dbf8bd4b13","type":"debug","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"has been retrieved","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4685.999755859375,"y":2609.573907246665,"wires":[]},{"id":"9a1e6dfa766086fd","type":"debug","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"done","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":4647.999755859375,"y":2760.073907246665,"wires":[]},{"id":"759fb127ca4b03a8","type":"delay","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3934.999755859375,"y":2693.073907246665,"wires":[["f8a880616a0678e0"]]},{"id":"812af935be45d037","type":"debug","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"empty version data","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3696.7497787475586,"y":2968.4074510241308,"wires":[]},{"id":"4a4ca60fb96afb74","type":"inject","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"Reset","props":[],"repeat":"75600","crontab":"","once":false,"onceDelay":"1","topic":"","x":3507.0830078125,"y":2866.073907246665,"wires":[["8c86ade52feeeb4d"]]},{"id":"8c86ade52feeeb4d","type":"change","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","rules":[{"t":"set","p":"dependencies","pt":"flow","to":"{}","tot":"json","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3746.083053588867,"y":2858.073949208335,"wires":[["cb923dd83e9a50ba"]]},{"id":"cb923dd83e9a50ba","type":"link call","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"","links":["c1e3e3106852730b"],"linkType":"static","timeout":"30","x":4013.999755859375,"y":2801.5741017962255,"wires":[["6a3720a225ce1a36"]]},{"id":"e4f89a1c09554cc6","type":"link in","z":"741c6acbed17d504","g":"b3a178168673f9fd","name":"link in 6","links":["c08ce4327a2715c1","3ab90e85ec532f99"],"x":3476.0830078125,"y":2831.073907246665,"wires":[["8c86ade52feeeb4d"]]},{"id":"a31caf7875a80777","type":"change","z":"741c6acbed17d504","g":"b0acb5b98b9ba507","name":"flow.dependencies --> payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"dependencies","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":4358.999755859375,"y":3094,"wires":[["1c4983f9611b8f79"]]},{"id":"8fcad9210f431c25","type":"inject","z":"741c6acbed17d504","g":"b0acb5b98b9ba507","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4142.999755859375,"y":3094,"wires":[["a31caf7875a80777"]]},{"id":"1c4983f9611b8f79","type":"function","z":"741c6acbed17d504","g":"b0acb5b98b9ba507","name":"function 29","func":"msg.payload = Object.keys(msg.payload).length\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4567.999755859375,"y":3094,"wires":[["dbde90ed93e047ef"]]},{"id":"dbde90ed93e047ef","type":"debug","z":"741c6acbed17d504","g":"b0acb5b98b9ba507","name":"debug 80","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4737.999755859375,"y":3094,"wires":[]},{"id":"c18328ca2f0ccd46","type":"ui_form","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","label":"","group":"e148222ee54863b8","order":1,"width":0,"height":0,"options":[{"label":"Type","value":"type","type":"text","required":false,"rows":null},{"label":"Keyword","value":"keyword","type":"text","required":false,"rows":null},{"label":"Dependencies","value":"dependencies","type":"text","required":false,"rows":null}],"formValue":{"type":"","keyword":"","dependencies":""},"payload":"","submit":"submit","cancel":"cancel","topic":"topic","topicType":"msg","splitLayout":"","className":"","x":3169.66650390625,"y":3434.666748046875,"wires":[["49a3205b07215779"]]},{"id":"5fe7dc56d2502691","type":"ui_template","z":"741c6acbed17d504","g":"f55e0223aabdd29a","group":"e148222ee54863b8","name":"","order":2,"width":"12","height":"8","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":4732.66650390625,"y":3293.666748046875,"wires":[["2211116912795ca9"]]},{"id":"abcb267eaec77ebc","type":"switch","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"dependencies","property":"payload.dependencies","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":3403.66650390625,"y":3300.666748046875,"wires":[["68a1431eb00bb19b"],["0669bc3867e87fcc"]]},{"id":"0669bc3867e87fcc","type":"switch","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"keyword","property":"payload.keyword","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":3557.66650390625,"y":3422.666748046875,"wires":[["0282ee71b9a0c73f"],["34a2200f5070acc3"]]},{"id":"34a2200f5070acc3","type":"switch","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"type","property":"payload.type","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":3691.66650390625,"y":3541.666748046875,"wires":[["eca1ac4d6ab53040"],["bb050816a770b7d3"]]},{"id":"68a1431eb00bb19b","type":"change","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","rules":[{"t":"set","p":"dependencies","pt":"msg","to":"dependencies","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":3715.66650390625,"y":3293.666748046875,"wires":[["2bb7205ee423d9b7"]]},{"id":"d49cd2f917ac2192","type":"template","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h1>{{ payload.searchterm }}</h1>\n<dl>\n{{#packages}}\n  <dt><b><a target=\"_blank\" href=\"https://flows.nodered.org/search?term={{ value }}\">{{ value}}</a></b> ({{version}})</dt>\n  <dd><i>{{ description }}</i></dd>\n{{/packages}}\n</dl>\n","output":"str","x":4536.66650390625,"y":3293.666748046875,"wires":[["5fe7dc56d2502691"]]},{"id":"2bb7205ee423d9b7","type":"function","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"function 26","func":"msg.packages = []\n\nObject.keys( msg.dependencies ).forEach( pkgname => {\n    if (Object.keys(msg.dependencies[pkgname] || {}).indexOf(msg.payload.dependencies) > -1 ) {\n        msg.packages.push({\n            value: pkgname,\n            description: (msg.versions[pkgname] || {}).description,\n            version: ((msg.versions[pkgname] || {})[\"disttags\"] || {})[\"latest\"]\n        })\n    }\n})\n\nmsg.payload = {\n    searchterm: \"Dependency: \" + msg.payload.dependencies + \" (\" + msg.packages.length + \")\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3959.66650390625,"y":3293.666748046875,"wires":[["d49cd2f917ac2192"]]},{"id":"bb050816a770b7d3","type":"template","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Nothing found","output":"str","x":3878.66650390625,"y":3585.666748046875,"wires":[["fdf46d79aa9ece7d"]]},{"id":"9a50e74f8cf5e8a1","type":"http request","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":4041.66650390625,"y":3415.666748046875,"wires":[["08ed1433c19505f9"]]},{"id":"175ede85275bae21","type":"change","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":3464.66650390625,"y":3652.666748046875,"wires":[["1ca6d21dc02767ce"]]},{"id":"197c16b4e9fad9f0","type":"change","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":4706.66650390625,"y":3652.666748046875,"wires":[["4f3e84deaab66655"]]},{"id":"0282ee71b9a0c73f","type":"change","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","rules":[{"t":"set","p":"orig_payload","pt":"msg","to":"payload","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3820.66650390625,"y":3415.666748046875,"wires":[["9a50e74f8cf5e8a1"]]},{"id":"08ed1433c19505f9","type":"function","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"function 27","func":"msg.packages = []\n\nmsg.payload.modules.forEach( module => {\n    if ( (module.keywords || []).indexOf(msg.orig_payload.keyword) > -1 ) {\n        msg.packages.push({\n            value: module.id,\n            description: (msg.versions[module.id] || {}).description,\n            version: ((msg.versions[module.id] || {})[\"disttags\"] || {})[\"latest\"]\n        })\n    }\n})\n\nmsg.payload = {\n    searchterm: \"Keyword: \" + msg.orig_payload.keyword + \" (\" + msg.packages.length + \")\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4222.66650390625,"y":3415.666748046875,"wires":[["d49cd2f917ac2192"]]},{"id":"297c0f948a9279b1","type":"inject","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"enable form","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":4367.66650390625,"y":3652.666748046875,"wires":[["197c16b4e9fad9f0"]]},{"id":"eca1ac4d6ab53040","type":"change","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","rules":[{"t":"set","p":"orig_payload","pt":"msg","to":"payload","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3923.66650390625,"y":3534.666748046875,"wires":[["f134de2dde405406"]]},{"id":"f134de2dde405406","type":"http request","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":4125.66650390625,"y":3534.666748046875,"wires":[["d8a9d58895a71563"]]},{"id":"d8a9d58895a71563","type":"function","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"function 28","func":"msg.packages = []\n\nmsg.payload.modules.forEach( module => {\n    if ( (module.types || []).indexOf(msg.orig_payload.type) > -1 ) {\n        msg.packages.push({\n            value: module.id,\n            description: (msg.versions[module.id] || {}).description,\n            version: ((msg.versions[module.id] || {})[\"disttags\"] || {})[\"latest\"]\n        })\n    }\n})\n\nmsg.payload = {\n    searchterm: \"Type: \" + msg.orig_payload.type + \" (\" + msg.packages.length + \")\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4345.66650390625,"y":3534.666748046875,"wires":[["d49cd2f917ac2192"]]},{"id":"1ca6d21dc02767ce","type":"link out","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"link out 125","mode":"link","links":["d58f47d19f5130d0"],"x":3720.66650390625,"y":3652.666748046875,"wires":[]},{"id":"d58f47d19f5130d0","type":"link in","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"link in 7","links":["1ca6d21dc02767ce","4f3e84deaab66655"],"x":3141.66650390625,"y":3514.666748046875,"wires":[["c18328ca2f0ccd46"]]},{"id":"49a3205b07215779","type":"change","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"","rules":[{"t":"set","p":"versions","pt":"msg","to":"versions","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":3258,"y":3370,"wires":[["abcb267eaec77ebc","175ede85275bae21"]]},{"id":"4f3e84deaab66655","type":"link out","z":"741c6acbed17d504","g":"f55e0223aabdd29a","name":"link out 127","mode":"link","links":["970eb071368b9a86","d58f47d19f5130d0"],"x":4831.66650390625,"y":3652.666748046875,"wires":[]},{"id":"3a94fdcdccd7e0f6","type":"change","z":"741c6acbed17d504","name":"","rules":[{"t":"set","p":"dependencies","pt":"msg","to":"dependencies","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1429,"y":2794,"wires":[["5ab4fce857ae64b5"]]},{"id":"5ab4fce857ae64b5","type":"function","z":"741c6acbed17d504","name":"top package dependency","func":"var packDep = {};\n\nObject.keys(msg.dependencies).forEach( (pkgname) => {\n    Object.keys(msg.dependencies[pkgname] || {}).forEach( dep => {\n        (packDep[dep] = packDep[dep] || []).push( pkgname)\n    })\n})\n\nvar keys = Object.keys(packDep);\nvar kvs = keys.map((k) => { return [k, packDep[k].length]})\nkvs = kvs.sort( (a,b) => { return a[1] < b[1] ? 1 : -1 })\n\nkvs.length = 100\n\nmsg.payload = [{\n    \"series\": kvs.filter( (v) => { return v[1] > 0 }).map((v) => { return v[0]}),\n    \"data\": kvs.filter((v) => { return v[1] > 0 }).map((v) => { return [v[1]] }),\n    \"labels\": [\"Dependency\"]\n}]\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1804,"y":2793,"wires":[["8fcf4e9e86e670d0"]]},{"id":"8fcf4e9e86e670d0","type":"ui_chart","z":"741c6acbed17d504","name":"","group":"bfa17d125c0fc223","order":2,"width":"16","height":"20","label":"top 100 package dependency","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"hello","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#5cb47c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2678,"y":2784,"wires":[[]]},{"id":"a003e0267c9beae2","type":"ui_spacer","z":"741c6acbed17d504","name":"spacer","group":"0ed53e2825b8c7fb","order":3,"width":1,"height":1},{"id":"0d446e39f83fbf3c","type":"ui_spacer","z":"741c6acbed17d504","name":"spacer","group":"0ed53e2825b8c7fb","order":1,"width":1,"height":1},{"id":"01cb0c42ba918c34","type":"ui_group","name":"Default","tab":"e2ef93495fbb5da3","order":1,"disp":false,"width":"16","collapse":false,"className":""},{"id":"d096a52e52c86d2a","type":"ui_group","name":"Updates per day","tab":"8ac4502aba0c4e9c","order":1,"disp":false,"width":"24","collapse":false,"className":""},{"id":"0ed53e2825b8c7fb","type":"ui_group","name":"Group 1","tab":"1f12665a90cf544e","order":1,"disp":false,"width":"6","collapse":false,"className":""},{"id":"7278d8bced05b3d5","type":"ui_group","name":"Group 1","tab":"b2ec9c01ed6d42e2","order":1,"disp":false,"width":"16","collapse":false,"className":""},{"id":"fb090f8abca07b18","type":"ui_group","name":"Group 1","tab":"f2115eca5656f45f","order":1,"disp":false,"width":"16","collapse":false,"className":""},{"id":"e148222ee54863b8","type":"ui_group","name":"Query","tab":"3b5f19cb0e238eac","order":1,"disp":true,"width":"12","collapse":false,"className":""},{"id":"bfa17d125c0fc223","type":"ui_group","name":"Dependencies","tab":"1f618769e9a06a30","order":1,"disp":true,"width":"16","collapse":false,"className":""},{"id":"e2ef93495fbb5da3","type":"ui_tab","name":"Package Analysis","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"8ac4502aba0c4e9c","type":"ui_tab","name":"Updates per day","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"1f12665a90cf544e","type":"ui_tab","name":"Refresh data","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"b2ec9c01ed6d42e2","type":"ui_tab","name":"Downloads","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"f2115eca5656f45f","type":"ui_tab","name":"Maintainers","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"3b5f19cb0e238eac","type":"ui_tab","name":"Query","icon":"dashboard","disabled":false,"hidden":false},{"id":"1f618769e9a06a30","type":"ui_tab","name":"Dependencies","icon":"dashboard","disabled":false,"hidden":false}]