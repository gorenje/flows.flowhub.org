[{"id":"553ca20c0b35e191","type":"tab","label":"[MQTT] Inhouse broker using aedes","disabled":false,"info":"::: aim\n\nCreate a MQTT broker in Node-RED for communicating between Node-RED instances.\n\n:::\n\n::: requirements\n\n- [node-red-contrib-aedes](https://flows.nodered.org/node/node-red-contrib-aedes)\n\n:::\n\n### Description\n\nInstead of installing something like [mosquitto](https://mosquitto.org/) as MQTT broker, do everything within Node-RED.\n\nThis will start a MQTT broker on ```localhost:3883``` and connect four MQTT clients: one to publish, the other three to subscribe.\n\nOf course, this does nothing more useful than to duplicate a single message three times by having three listeners. \n\nIt's application is far more useful as an educuational demonstration of the typical message bus architecture: <a class=\"ahl-group-only\" data-ids=\"2b415aa9a5896b1e\">broker</a>, <a class=\"ahl-group-only\" data-ids=\"17e56d23824624d4\">listeners</a> and <a class=\"ahl-group-only\" data-ids=\"ae2634d0e4a0fa24\">publishers</a>.\n\n","env":[]},{"id":"17e56d23824624d4","type":"group","z":"553ca20c0b35e191","name":"listeners","style":{"label":true},"nodes":["4db5a0fc66cd7e8b","11d766b54d6e3996","5b43c4c8a7f2d5c1","c37c707de79f3024","d2751e67a6510f35","e5c37b131a78451e"],"x":753,"y":693,"w":650,"h":345},{"id":"ae2634d0e4a0fa24","type":"group","z":"553ca20c0b35e191","name":"publisher","style":{"label":true},"nodes":["60be392ff110eada","0fc3408f0f46c935"],"x":386,"y":300.5,"w":533,"h":82},{"id":"2b415aa9a5896b1e","type":"group","z":"553ca20c0b35e191","name":"broker","style":{"label":true},"nodes":["33956e2978d8cdda","f331dff0968910d9","4d762547774060f5"],"x":704,"y":450,"w":508,"h":147},{"id":"33956e2978d8cdda","type":"aedes broker","z":"553ca20c0b35e191","g":"2b415aa9a5896b1e","name":"","mqtt_port":"3883","mqtt_ws_bind":"port","mqtt_ws_port":"","mqtt_ws_path":"","cert":"","key":"","certname":"","keyname":"","persistence_bind":"memory","dburl":"","usetls":false,"x":820,"y":520,"wires":[["f331dff0968910d9"],["4d762547774060f5"]]},{"id":"4db5a0fc66cd7e8b","type":"mqtt in","z":"553ca20c0b35e191","g":"17e56d23824624d4","name":"","topic":"topictopic","qos":"2","datatype":"auto-detect","broker":"3e00b775e3f4a3f4","nl":false,"rap":true,"rh":0,"inputs":0,"x":839,"y":734,"wires":[["11d766b54d6e3996"]]},{"id":"60be392ff110eada","type":"mqtt out","z":"553ca20c0b35e191","g":"ae2634d0e4a0fa24","name":"","topic":"topictopic","qos":"2","retain":"false","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"3e00b775e3f4a3f4","x":833,"y":341.5,"wires":[]},{"id":"11d766b54d6e3996","type":"debug","z":"553ca20c0b35e191","g":"17e56d23824624d4","name":"a message came along","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1247,"y":819,"wires":[]},{"id":"0fc3408f0f46c935","type":"inject","z":"553ca20c0b35e191","g":"ae2634d0e4a0fa24","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"hello world","payloadType":"str","x":492,"y":341.5,"wires":[["60be392ff110eada"]]},{"id":"f331dff0968910d9","type":"debug","z":"553ca20c0b35e191","g":"2b415aa9a5896b1e","name":"non-publish traffic","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1076,"y":491,"wires":[]},{"id":"4d762547774060f5","type":"debug","z":"553ca20c0b35e191","g":"2b415aa9a5896b1e","name":"publish traffic","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1058,"y":556,"wires":[]},{"id":"5b43c4c8a7f2d5c1","type":"mqtt in","z":"553ca20c0b35e191","g":"17e56d23824624d4","name":"","topic":"topictopic","qos":"2","datatype":"auto-detect","broker":"3e00b775e3f4a3f4","nl":false,"rap":true,"rh":0,"inputs":0,"x":839,"y":875,"wires":[["d2751e67a6510f35"]]},{"id":"c37c707de79f3024","type":"mqtt in","z":"553ca20c0b35e191","g":"17e56d23824624d4","name":"","topic":"topictopic","qos":"2","datatype":"auto-detect","broker":"3e00b775e3f4a3f4","nl":false,"rap":true,"rh":0,"inputs":0,"x":839,"y":997,"wires":[["e5c37b131a78451e"]]},{"id":"d2751e67a6510f35","type":"debug","z":"553ca20c0b35e191","g":"17e56d23824624d4","name":"a message came along","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1247,"y":873,"wires":[]},{"id":"e5c37b131a78451e","type":"debug","z":"553ca20c0b35e191","g":"17e56d23824624d4","name":"a message came along","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1247,"y":927,"wires":[]},{"id":"3e00b775e3f4a3f4","type":"mqtt-broker","name":"","broker":"localhost","port":"3883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""}]