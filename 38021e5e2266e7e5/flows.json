[{"id":"38021e5e2266e7e5","type":"tab","label":"OSC to I2C bridge","disabled":false,"info":"::: aim\n\nConstruct a bridge between Open Sound Control (OSC) protocol and the I2C protocol.\n\n:::\n\n::: prereq\n\n- [Open Sound Control (OSC)](https://www.npmjs.com/package/node-red-contrib-osc)\n\n:::\n\n### Related flows\n\n- [I2C interface to Scoll pHAT](https://flowhub.org/f/be2109bba90b6c5a)\n\n","env":[]},{"id":"4ba9ba6e3ac414e2","type":"group","z":"38021e5e2266e7e5","name":"Required to connect to Scroll pHAT LED display","style":{"label":true},"nodes":["72a17d57e00c033d"],"x":205,"y":249,"w":307,"h":82},{"id":"72a17d57e00c033d","type":"FlowHubPull","z":"38021e5e2266e7e5","g":"4ba9ba6e3ac414e2","name":"","notab":false,"flowid":"be2109bba90b6c5a","flowname":"[I2C] Scroll pHAT","flowrevision":"","x":321,"y":290,"wires":[[]]},{"id":"38a22678.b804ca","type":"udp in","z":"38021e5e2266e7e5","name":"","iface":"","port":"12345","ipv":"udp6","multicast":"false","group":"","datatype":"buffer","x":647,"y":881,"wires":[["aa5581d1.cabc"]]},{"id":"aa5581d1.cabc","type":"osc","z":"38021e5e2266e7e5","name":"","path":"","metadata":true,"x":833,"y":836,"wires":[["cb9ab6044e098095","ba4253ee0c429245"]]},{"id":"253a731f0f754f5f","type":"link out","z":"38021e5e2266e7e5","name":"link to I2C [scrollphat] set single pixel on or off","mode":"link","links":["377893b3eb85798d"],"x":2210,"y":232,"wires":[]},{"id":"f9bdc02cc3d0f121","type":"change","z":"38021e5e2266e7e5","name":"col = 1","rules":[{"t":"set","p":"col","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":468,"wires":[["b15ded91d247ea80"]]},{"id":"afc773facd1e0eb4","type":"change","z":"38021e5e2266e7e5","name":"col = 2","rules":[{"t":"set","p":"col","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":519.0666666666666,"wires":[["b15ded91d247ea80"]]},{"id":"841ade1d3e6e809f","type":"change","z":"38021e5e2266e7e5","name":"col = 3","rules":[{"t":"set","p":"col","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":570.1333333333333,"wires":[["b15ded91d247ea80"]]},{"id":"0187b3643fc9827a","type":"change","z":"38021e5e2266e7e5","name":"col = 4","rules":[{"t":"set","p":"col","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":621.2,"wires":[["b15ded91d247ea80"]]},{"id":"b15ded91d247ea80","type":"change","z":"38021e5e2266e7e5","name":"row = 1","rules":[{"t":"set","p":"row","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1603.5,"y":542,"wires":[["f40e1f34948bc305"]]},{"id":"f40e1f34948bc305","type":"function","z":"38021e5e2266e7e5","name":"function 31","func":"// handle rate value\nlet p = msg.payload[3].value > 0.5\n\nnode.send({\n    ...msg,\n    payload: p\n})\n\n// handle frequency\np = msg.payload[5].value > 0.5\n\nnode.send({\n    ...msg,\n    col: msg.col + 5,\n    payload: p\n})\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1889,"y":849,"wires":[["253a731f0f754f5f"]]},{"id":"2deada9669881f66","type":"change","z":"38021e5e2266e7e5","name":"row = 2","rules":[{"t":"set","p":"row","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1603.5,"y":749.6666666666666,"wires":[["f40e1f34948bc305"]]},{"id":"5641d6746e122087","type":"change","z":"38021e5e2266e7e5","name":"col = 5","rules":[{"t":"set","p":"col","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":643,"y":945,"wires":[[]]},{"id":"1d2e411f0fc1a95a","type":"change","z":"38021e5e2266e7e5","name":"col = 6","rules":[{"t":"set","p":"col","pt":"msg","to":"6","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":648,"y":996,"wires":[[]]},{"id":"13e83f4fc86e4aee","type":"change","z":"38021e5e2266e7e5","name":"col = 7","rules":[{"t":"set","p":"col","pt":"msg","to":"7","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":642,"y":1042,"wires":[[]]},{"id":"25c198cb60f8ddbb","type":"change","z":"38021e5e2266e7e5","name":"col = 8","rules":[{"t":"set","p":"col","pt":"msg","to":"8","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":645,"y":1098,"wires":[[]]},{"id":"c2cc566b1fcce68b","type":"change","z":"38021e5e2266e7e5","name":"col = 1","rules":[{"t":"set","p":"col","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":672.2666666666668,"wires":[["2deada9669881f66"]]},{"id":"5b67c6cb04d7db87","type":"change","z":"38021e5e2266e7e5","name":"col = 2","rules":[{"t":"set","p":"col","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":723.3333333333335,"wires":[["2deada9669881f66"]]},{"id":"040863e1de95075a","type":"change","z":"38021e5e2266e7e5","name":"col = 3","rules":[{"t":"set","p":"col","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":774.4000000000002,"wires":[["2deada9669881f66"]]},{"id":"eb482e69b9f16774","type":"change","z":"38021e5e2266e7e5","name":"col = 4","rules":[{"t":"set","p":"col","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":825.4666666666669,"wires":[["2deada9669881f66"]]},{"id":"31a6427462e7c9e2","type":"change","z":"38021e5e2266e7e5","name":"col = 1","rules":[{"t":"set","p":"col","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":876.5333333333336,"wires":[["4894120ca27d04aa"]]},{"id":"c2229bb2b73bce20","type":"change","z":"38021e5e2266e7e5","name":"col = 2","rules":[{"t":"set","p":"col","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":927.6000000000004,"wires":[["4894120ca27d04aa"]]},{"id":"37b783adca5296b4","type":"change","z":"38021e5e2266e7e5","name":"col = 3","rules":[{"t":"set","p":"col","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":978.6666666666671,"wires":[["4894120ca27d04aa"]]},{"id":"f36888e0337ebac1","type":"change","z":"38021e5e2266e7e5","name":"col = 4","rules":[{"t":"set","p":"col","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":1029.7333333333338,"wires":[["4894120ca27d04aa"]]},{"id":"2976908af5519e30","type":"change","z":"38021e5e2266e7e5","name":"col = 1","rules":[{"t":"set","p":"col","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":1080.8000000000004,"wires":[["aea72740f8212f2b"]]},{"id":"5c268149b1f57072","type":"change","z":"38021e5e2266e7e5","name":"col = 2","rules":[{"t":"set","p":"col","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":1131.866666666667,"wires":[["aea72740f8212f2b"]]},{"id":"3f184da60643a821","type":"change","z":"38021e5e2266e7e5","name":"col = 3","rules":[{"t":"set","p":"col","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":1182.9333333333336,"wires":[["aea72740f8212f2b"]]},{"id":"5f4c2ffc882e530b","type":"change","z":"38021e5e2266e7e5","name":"col = 4","rules":[{"t":"set","p":"col","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1394,"y":1234,"wires":[["aea72740f8212f2b"]]},{"id":"4894120ca27d04aa","type":"change","z":"38021e5e2266e7e5","name":"row = 3","rules":[{"t":"set","p":"row","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1603.5,"y":957.3333333333333,"wires":[["f40e1f34948bc305"]]},{"id":"aea72740f8212f2b","type":"change","z":"38021e5e2266e7e5","name":"row = 4","rules":[{"t":"set","p":"row","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1603.5,"y":1165,"wires":[["f40e1f34948bc305"]]},{"id":"39aaaf7014faa3be","type":"function","z":"38021e5e2266e7e5","name":"function 32","func":"let pads = msg.payload.filter( d => {\n    return d[0].value > 0\n})\n\nif ( pads.length > 0 ) {\n    let b = 0;\n    \n    pads.forEach(function(element) {\n        b += element[1].value\n    });\n\n    b = Math.ceil((b / pads.length) * 127)\n    if ( msg.curr_b ) {\n        if (b > msg.curr_b) b = msg.curr_b + 1\n        if (b < msg.curr_b) b = msg.curr_b - 1\n    }\n    \n    return {\n        ...msg,\n        payload: b\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1672,"y":1422,"wires":[["13662aede2f3b914"]]},{"id":"68077b735b750d9a","type":"join","z":"38021e5e2266e7e5","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"1","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1249,"y":1342,"wires":[["adb7926ec9bbbba9"]]},{"id":"cb9ab6044e098095","type":"switch","z":"38021e5e2266e7e5","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"/pad","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1108,"y":1254,"wires":[["68077b735b750d9a"]]},{"id":"8b08210b834ce6b6","type":"link out","z":"38021e5e2266e7e5","name":"link to I2C - set brightness","mode":"link","links":["f5d674b8bf337831"],"x":2210,"y":1424,"wires":[]},{"id":"adb7926ec9bbbba9","type":"change","z":"38021e5e2266e7e5","name":"","rules":[{"t":"set","p":"curr_b","pt":"msg","to":"brightness","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1433,"y":1390,"wires":[["39aaaf7014faa3be"]]},{"id":"13662aede2f3b914","type":"change","z":"38021e5e2266e7e5","name":"","rules":[{"t":"set","p":"brightness","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1961,"y":1425,"wires":[["8b08210b834ce6b6"]]},{"id":"ba4253ee0c429245","type":"switch","z":"38021e5e2266e7e5","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"/pad0","vt":"str"},{"t":"cont","v":"/pad1","vt":"str"},{"t":"cont","v":"/pad2","vt":"str"},{"t":"cont","v":"/pad3","vt":"str"},{"t":"cont","v":"/pad4","vt":"str"},{"t":"cont","v":"/pad5","vt":"str"},{"t":"cont","v":"/pad6","vt":"str"},{"t":"cont","v":"/pad7","vt":"str"},{"t":"cont","v":"/pad8","vt":"str"},{"t":"cont","v":"/pad9","vt":"str"},{"t":"cont","v":"/pad10","vt":"str"},{"t":"cont","v":"/pad11","vt":"str"},{"t":"cont","v":"/pad12","vt":"str"},{"t":"cont","v":"/pad13","vt":"str"},{"t":"cont","v":"/pad14","vt":"str"},{"t":"cont","v":"/pad15","vt":"str"}],"checkall":"true","repair":false,"outputs":16,"x":1125,"y":833,"wires":[["f9bdc02cc3d0f121"],["afc773facd1e0eb4"],["841ade1d3e6e809f"],["0187b3643fc9827a"],["c2cc566b1fcce68b"],["5b67c6cb04d7db87"],["040863e1de95075a"],["eb482e69b9f16774"],["31a6427462e7c9e2"],["c2229bb2b73bce20"],["37b783adca5296b4"],["f36888e0337ebac1"],["2976908af5519e30"],["5c268149b1f57072"],["3f184da60643a821"],["5f4c2ffc882e530b"]]}]