[{"id":"dd3cb2217a01efae","type":"tab","label":"[GitHub Actions] Convert actions yaml to collection of change nodes","disabled":false,"info":"### Description\n\nFunctionality for converting [GitHub actions](https://docs.github.com/en/actions) YAMLs to a flow of change nodes.\n\nThe <a class=\"ahl-node-only\" data-ids=\"356cad31136bd2bb\">function node</a> generates a flow description that is imported by the <a class=\"ahl-node-only\" data-ids=\"58482fba18d94669\">client code node</a>.\n\nThe intention is to find a visual method of modifying and maintaining the YAMLs required for GitHub actions.\n\nThe <a class='ahl-group-only' data-ids=\"9ad2a872d1bc67d5,0e61baef025de7fe,a295b1018fc0fbbf,ad6d69d2f9a25b95,acd63cc5a2f4f35b,fd9dafd09c273f3a\">generated nodes</a>, when <a class=\"ahl-node-only\" data-ids=\"59bc62b633233084,cb668a8413f53c5e,49c596a623c39fb8,7814a8d7fa6f20a8,c73a4ee8a205d27e,629fbb2da80f70df\">triggered</a> generate a YAML representation that is the same as the <a class=\"ahl-node-only\" data-ids=\"bf83e0b1a8583629,9194f31f4c6ec8d7,6a40f2f935e829fe,e12b6cf5ac5c8d8b,a98d9ebc42d62eec,e949067515c6a52f\">original YAMLs</a>.\n\n\n### Requirements\n\n- [introspection nodes](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection)\n\n","env":[]},{"id":"92b2acb8859596ad","type":"group","z":"dd3cb2217a01efae","name":"Example 1: Generating nodes from YAML","style":{"label":true},"nodes":["bf83e0b1a8583629","fd9dafd09c273f3a"],"x":299,"y":844,"w":544,"h":636},{"id":"942a2d153feccae7","type":"group","z":"dd3cb2217a01efae","name":"Generate Change Nodes","style":{"label":true},"nodes":["d031695a129e095a","356cad31136bd2bb","6477c53d82e6fbaf","58482fba18d94669","0d6ddb294a9be57e","38bc0b91bc93b258","f62dba1845a5413b"],"x":1939.333251953125,"y":311.33331298828125,"w":890,"h":217},{"id":"fd9dafd09c273f3a","type":"group","z":"dd3cb2217a01efae","g":"92b2acb8859596ad","name":"Nodes Generated from YAML","style":{"label":true},"nodes":["937e64169ce0ef8e","909874ae77782571","da5699b1257e34f0","dcc081f631a2eb21","e414ae1770d1d1a5","9df5df9630951d5f","d981a1e909d5f907","85c6d3e420526ac2","ad367d2c26100484","ef8e6aa170e9efa8"],"x":325,"y":922,"w":492,"h":532},{"id":"acd63cc5a2f4f35b","type":"group","z":"dd3cb2217a01efae","g":"5cb7812512e00b29","name":"Generated Nodes","style":{"label":true},"nodes":["7bf314afcf570c84","4309af5c9c9adb83","51f0d1028c41de41","a21b16a30ffa9596","5b7ddf3ec55f9736","e1246a264c8f53ac","f8167a5d8ea2c419"],"x":1146,"y":1006,"w":402,"h":382},{"id":"5cb7812512e00b29","type":"group","z":"dd3cb2217a01efae","name":"Example 2","style":{"label":true},"nodes":["9194f31f4c6ec8d7","acd63cc5a2f4f35b"],"x":1120,"y":844,"w":454,"h":570},{"id":"ad6d69d2f9a25b95","type":"group","z":"dd3cb2217a01efae","g":"4f30383b302770d9","name":"generated nodes","style":{"label":true},"nodes":["861b940c73de8d41","2c9ecfa1f5777cac","0e982e239f6d2230","b50d485fdb8150bd","f9a9e85916125818","12fb51e71f2fcca3","f8c4f957ec04a53e","16a082c3c1d34931"],"x":1877,"y":952,"w":562,"h":432},{"id":"4f30383b302770d9","type":"group","z":"dd3cb2217a01efae","name":"Example 3","style":{"label":true},"nodes":["6a40f2f935e829fe","ad6d69d2f9a25b95"],"x":1851,"y":844,"w":614,"h":566},{"id":"a295b1018fc0fbbf","type":"group","z":"dd3cb2217a01efae","g":"2d80f77fc90b8faf","name":"generated nodes","style":{"label":true},"nodes":["85f342dd3d1c8b1e","87b1dac64a3eee4a","bfb90a34394e7ec9"],"x":2768,"y":1002,"w":352,"h":182},{"id":"2d80f77fc90b8faf","type":"group","z":"dd3cb2217a01efae","name":"Example 4","style":{"label":true},"nodes":["e12b6cf5ac5c8d8b","a295b1018fc0fbbf"],"x":2742,"y":844,"w":404,"h":366},{"id":"0e61baef025de7fe","type":"group","z":"dd3cb2217a01efae","g":"bf467bf835118d90","name":"generated nodes","style":{"label":true},"nodes":["f9cdfbab777ed66a","69b626cc543975bf","e2ef60793a7ed1f2"],"x":3449,"y":977.5,"w":332,"h":182},{"id":"bf467bf835118d90","type":"group","z":"dd3cb2217a01efae","name":"Example 5","style":{"label":true},"nodes":["a98d9ebc42d62eec","0e61baef025de7fe"],"x":3423,"y":838.5,"w":384,"h":347},{"id":"9ad2a872d1bc67d5","type":"group","z":"dd3cb2217a01efae","g":"d89467b659e375fe","name":"generated nodes","style":{"label":true},"nodes":["797020c68534b80a","fa904c18e76703da","f2aa34fe4459cc6c","3142ffe8692bca07","696d604423ce03bb","317a8f0b7100865a","08def01d2eb1512b","6aa48feb6543a643","9c37c041e7a3939a","c825efd60c1595dc"],"x":4081,"y":1006,"w":302,"h":532},{"id":"d89467b659e375fe","type":"group","z":"dd3cb2217a01efae","name":"Example 6","style":{"label":true},"nodes":["e949067515c6a52f","9ad2a872d1bc67d5"],"x":4055,"y":838.5,"w":354,"h":725.5},{"id":"5ef6bad9db706e0e","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":127.33327102661133,"y":886.0000038146973,"wires":[["bf83e0b1a8583629"]]},{"id":"bf83e0b1a8583629","type":"template","z":"dd3cb2217a01efae","g":"92b2acb8859596ad","name":"GitHub Actions YAML","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Publish Release\nenv:\n  ACTIONS_ALLOW_UNSECURE_COMMANDS: true\non:\n  release:\n    types: [published]\n\npermissions:\n  contents: read\n\njobs:\n  generate:\n    name: 'Update node-red-docker image'\n    runs-on: ubuntu-latest\n    steps:\n      - name: Check out node-red repository\n        uses: actions/checkout@v4\n        with:\n            path: 'node-red'\n      - name: Check out node-red-docker repository\n        uses: actions/checkout@v4\n        with:\n            repository: 'node-red/node-red-docker'\n            path: 'node-red-docker'\n      - name: Check out node-red.github.io repository\n        uses: actions/checkout@v4\n        with:\n            repository: 'node-red/node-red.github.io'\n            path: 'node-red.github.io'\n      - uses: actions/setup-node@v4\n        with:\n            node-version: '16'\n      - run: node ./node-red/.github/scripts/update-node-red-docker.js\n      - name: Create Docker Pull Request\n        uses: peter-evans/create-pull-request@v5\n        with:\n          token: ${{ secrets.NR_REPO_TOKEN }}\n          committer: GitHub <noreply@github.com>\n          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\n          path: 'node-red-docker'\n          commit-message: 'Bump to ${{ env.newVersion }}'\n          title: 'ðŸš€ Update to Node-RED ${{ env.newVersion }} release'\n          body: |\n            Updates the Node-RED Docker repo for the ${{ env.newVersion }} release.\n\n            Once this is merged, you will need to create a new release with the tag `v${{ env.newVersion }}`.\n\n            This PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary\n      - run: node ./node-red/.github/scripts/update-node-red-website.js\n      - name: Create Website Pull Request\n        uses: peter-evans/create-pull-request@v5\n        with:\n          token: ${{ secrets.NR_REPO_TOKEN }}\n          committer: GitHub <noreply@github.com>\n          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\n          path: 'node-red.github.io'\n          commit-message: 'Bump to ${{ env.newVersion }}'\n          title: 'ðŸš€ Update to Node-RED ${{ env.newVersion }} release'\n          body: |\n            Updates the Node-RED Website repo for the ${{ env.newVersion }} release.\n\n            This PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary","output":"str","x":550,"y":885,"wires":[["3cbbe7bfd4b74601"]]},{"id":"d031695a129e095a","type":"yaml","z":"dd3cb2217a01efae","g":"942a2d153feccae7","property":"payload","name":"","x":2065.333251953125,"y":485.33331298828125,"wires":[["356cad31136bd2bb","38bc0b91bc93b258"]]},{"id":"356cad31136bd2bb","type":"function","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"convert github action yaml file to collection of change nodes","func":"/*\n * Functionality\n */\nlet ruleJson = (nameStr, data) => {\n    return {\n        \"t\": \"set\",\n        \"p\": nameStr,\n        \"pt\": \"msg\",\n        \"to\": JSON.stringify(data, null, 2),\n        \"tot\": \"json\"\n    }\n}\n\nlet ruleString = (nameStr, data) => {\n    return {\n        \"t\": \"set\",\n        \"p\": nameStr,\n        \"pt\": \"msg\",\n        \"to\": data,\n        \"tot\": \"str\"\n    }\n}\n\nlet hashKey = (keyStr) => {\n    if (keyStr.indexOf(\"-\") > -1) {\n        return `[\"${keyStr}\"]`\n    } else {\n        return `.${keyStr}`\n    }\n}\n\n/*\n * Templates\n */\nlet chgTemplate = {\n    \"type\": \"change\",\n    \"name\": \"\",\n    \"action\": \"\",\n    \"property\": \"\",\n    \"from\": \"\",\n    \"to\": \"\",\n    \"reg\": false,\n    \"x\": 0,\n    \"y\": 0,\n}\n\nlet startHere = {\n    ...chgTemplate,\n    \"id\": RED.util.generateId(),\n    \"name\": \"Start Here\",\n    \"rules\": [ruleJson(\"payload\", {})],\n    \"wires\": [\n        []\n    ]\n}\n\nlet lstNde = startHere;\nlet height = 0;\nlet nodeCollection = [ startHere ];\n\n/*\n * Computation starts here.\n */\nif ( msg.payload.name ) {\n    startHere.name = msg.payload.name\n    startHere.rules.push(ruleString(\"payload.name\", msg.payload.name))\n    delete msg.payload.name;\n}\n\nif ( msg.payload.env ) {\n    startHere.rules.push(ruleJson(\"payload.env\",{}))\n\n    let envKeys = Object.keys(msg.payload.env)\n    for (var kdx = 0; kdx < envKeys.length; kdx++) {\n        startHere.rules.push(ruleJson(\"payload.env\" + hashKey(envKeys[kdx]), msg.payload.env[envKeys[kdx]]))\n    }\n    \n    delete msg.payload.env;\n}\n\n['on','permissions'].forEach( k => {\n    if (Object.keys(msg.payload).indexOf(k) > -1) {\n        startHere.rules.push(ruleJson(\"payload\" + hashKey(k), msg.payload[k]))\n        delete msg.payload[k];\n    }\n})\n\nif (msg.payload.jobs) {\n    startHere.rules.push(ruleJson(\"payload.jobs\",{}))\n\n    let jobKeys = Object.keys(msg.payload.jobs);\n\n    for (var idx = 0; idx < jobKeys.length ; idx++) {\n        let ndeId = RED.util.generateId()\n        let jobObj = msg.payload.jobs[jobKeys[idx]]\n\n        height += 50\n\n        let jobChg = {\n            ...chgTemplate,\n            id: ndeId,\n            name: \"Job: \" + jobKeys[idx],\n            rules: [ruleJson(\"payload.jobs\" + hashKey(jobKeys[idx]), {})],\n            x: 40,\n            y: height,\n            wires: [[]]\n        };\n        \n        if (Object.keys(jobObj).indexOf(\"name\") > -1) {\n            jobChg.rules.push(ruleString(\"payload.jobs\" + hashKey(jobKeys[idx]) + \".name\", jobObj.name));\n            delete jobObj.name;\n        }\n\n        ['id', 'permissions', 'runs-on'].forEach(k => {\n            if (Object.keys(jobObj).indexOf(k) > -1) {\n                jobChg.rules.push(ruleJson(\"payload.jobs\" + hashKey(jobKeys[idx]) + hashKey(k), jobObj[k]))\n                delete jobObj[k];\n            }\n        })\n\n        nodeCollection.push(jobChg)\n        lstNde.wires[0].push(ndeId)\n        lstNde = jobChg;\n\n        if (jobObj.steps) {\n            jobChg.rules.push(ruleJson(\"payload.jobs\" + hashKey(jobKeys[idx]) + \".steps\",[]))\n\n            for (var jdx = 0; jdx < jobObj.steps.length; jdx++) {\n                ndeId = RED.util.generateId()\n                let stpObj = jobObj.steps[jdx];\n                height += 50\n\n                let stpName = (stpObj.name || (stpObj.run && \"Run Only\") || (stpObj.uses && \"Uses only\") || \"No Name\")\n\n                let stepChg = {\n                    ...chgTemplate,\n                    id: ndeId,\n                    name: \"Step: \" + stpName,\n                    rules: [ruleJson(\"step\", {})],\n                    x: 80,\n                    y: height,\n                    \"wires\": [[]]\n                };\n\n                if (Object.keys(stpObj).indexOf(\"name\") > -1) {\n                    stepChg.rules.push(ruleString(\"step.name\", stpObj.name))\n                    delete stpObj.name\n                }\n                \n                [\"id\", \"if\", \"uses\",\"run\"].forEach( k => {\n                    if (Object.keys(stpObj).indexOf(k) > -1 ) {\n                        stepChg.rules.push(ruleJson(\"step\" + hashKey(k), stpObj[k]))\n                        delete stpObj[k]\n                    }\n                })\n                \n                if ( stpObj[\"with\"] ) {\n                    stepChg.rules.push(ruleJson(\"step.with\", {}))\n\n                    let withKeys = Object.keys(stpObj[\"with\"])\n                    for ( var kdx = 0 ; kdx < withKeys.length ; kdx++ ) {\n                        stepChg.rules.push(ruleJson(\"step.with\" + hashKey(withKeys[kdx]), stpObj[\"with\"][withKeys[kdx]]))\n                    }\n\n                    delete stpObj[\"with\"]\n                }\n\n                Object.keys(stpObj).forEach(k => {\n                    stepChg.rules.push(ruleJson(\"step\" + hashKey(k), stpObj[k]))\n                    delete stpObj[k]\n                })        \n                \n                /*\n                 * Add step obj to steps array and clean up msg object.\n                 */\n                stepChg.rules.push({\n                    \"t\": \"set\",\n                    \"p\": \"payload.jobs\" + hashKey(jobKeys[idx]) + \".steps\",\n                    \"pt\": \"msg\",\n                    \"to\": \"$append( $$.payload.jobs.\\\"\" + jobKeys[idx] + \"\\\".steps, [$$.step])\",\n                    \"tot\": \"jsonata\"\n                })\n\n                stepChg.rules.push({\n                    \"t\": \"delete\",\n                    \"p\": \"step\",\n                    \"pt\": \"msg\"\n                })\n\n                nodeCollection.push(stepChg)\n                lstNde.wires[0].push(ndeId)\n                lstNde = stepChg;\n            }\n            delete jobObj.steps\n        }\n\n        Object.keys(jobObj).forEach( k => {\n            jobChg.rules.push(ruleJson(\"payload.jobs\" + hashKey(jobKeys[idx]) + hashKey(k), jobObj[k]))\n            delete jobObj[k];\n        })        \n    }\n    delete msg.payload.jobs;\n}\n\nObject.keys(msg.payload).forEach( k => {\n    startHere.rules.push(ruleJson( \"payload\" + hashKey(k), msg.payload[k]))\n    delete msg.payload[k];\n})\n\nmsg.payload = nodeCollection\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2237.333251953125,"y":352.33331298828125,"wires":[["6477c53d82e6fbaf","0d6ddb294a9be57e"]]},{"id":"6477c53d82e6fbaf","type":"json","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"","property":"payload","action":"str","pretty":true,"x":2555.6187744140625,"y":423.33331298828125,"wires":[["58482fba18d94669"]]},{"id":"58482fba18d94669","type":"ClientCode","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"open import dialog","clientcode":"setTimeout(() => {\n            RED.clipboard.import();\n        \n            setTimeout(() => {\n                $('#red-ui-clipboard-dialog-import-text').val(\n                   data.payload\n                ).trigger(\"paste\");\n            }, 300);\n        },400)","format":"javascript","x":2713.333251953125,"y":487.33331298828125,"wires":[[]]},{"id":"3b6cb8d41c17ee45","type":"yaml","z":"dd3cb2217a01efae","property":"payload","name":"","x":2349.3333053588867,"y":2073.333169937134,"wires":[["208e3f642ad5c227"]]},{"id":"208e3f642ad5c227","type":"debug","z":"dd3cb2217a01efae","name":"debug 94","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2581.3333053588867,"y":2073.333169937134,"wires":[]},{"id":"59bc62b633233084","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":126.33327102661133,"y":964.0000038146973,"wires":[["937e64169ce0ef8e"]]},{"id":"0d6ddb294a9be57e","type":"debug","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"debug 89","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2655.333251953125,"y":352.33331298828125,"wires":[]},{"id":"38bc0b91bc93b258","type":"debug","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"debug 93","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2379.333251953125,"y":485.33331298828125,"wires":[]},{"id":"937e64169ce0ef8e","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Publish Release","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Publish Release","tot":"str"},{"t":"set","p":"payload.env","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.env.ACTIONS_ALLOW_UNSECURE_COMMANDS","pt":"msg","to":"true","tot":"json"},{"t":"set","p":"payload.on","pt":"msg","to":"{  \"release\": {    \"types\": [      \"published\"    ]  }}","tot":"json"},{"t":"set","p":"payload.permissions","pt":"msg","to":"{  \"contents\": \"read\"}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":431,"y":963,"wires":[["909874ae77782571"]]},{"id":"909874ae77782571","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Job: generate","rules":[{"t":"set","p":"payload.jobs.generate","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs.generate.name","pt":"msg","to":"Update node-red-docker image","tot":"str"},{"t":"set","p":"payload.jobs.generate['runs-on']","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":471,"y":1013,"wires":[["da5699b1257e34f0"]]},{"id":"da5699b1257e34f0","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Check out node-red repository","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check out node-red repository","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":581,"y":1063,"wires":[["dcc081f631a2eb21"]]},{"id":"dcc081f631a2eb21","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Check out node-red-docker repository","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check out node-red-docker repository","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.repository","pt":"msg","to":"\"node-red/node-red-docker\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red-docker\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":601,"y":1113,"wires":[["e414ae1770d1d1a5"]]},{"id":"e414ae1770d1d1a5","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Check out node-red.github.io repository","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check out node-red.github.io repository","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.repository","pt":"msg","to":"\"node-red/node-red.github.io\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red.github.io\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":611,"y":1163,"wires":[["9df5df9630951d5f"]]},{"id":"9df5df9630951d5f","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/setup-node@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with['node-version']","pt":"msg","to":"\"16\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":511,"y":1213,"wires":[["d981a1e909d5f907"]]},{"id":"d981a1e909d5f907","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"node ./node-red/.github/scripts/update-node-red-docker.js\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":511,"y":1263,"wires":[["85c6d3e420526ac2"]]},{"id":"85c6d3e420526ac2","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Create Docker Pull Request","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Create Docker Pull Request","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"peter-evans/create-pull-request@v5\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.token","pt":"msg","to":"\"${{ secrets.NR_REPO_TOKEN }}\"","tot":"json"},{"t":"set","p":"step.with.committer","pt":"msg","to":"\"GitHub <noreply@github.com>\"","tot":"json"},{"t":"set","p":"step.with.author","pt":"msg","to":"\"${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red-docker\"","tot":"json"},{"t":"set","p":"step.with['commit-message']","pt":"msg","to":"\"Bump to ${{ env.newVersion }}\"","tot":"json"},{"t":"set","p":"step.with.title","pt":"msg","to":"\"ðŸš€ Update to Node-RED ${{ env.newVersion }} release\"","tot":"json"},{"t":"set","p":"step.with.body","pt":"msg","to":"\"Updates the Node-RED Docker repo for the ${{ env.newVersion }} release.\\n\\nOnce this is merged, you will need to create a new release with the tag `v${{ env.newVersion }}`.\\n\\nThis PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary\\n\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":571,"y":1313,"wires":[["ad367d2c26100484"]]},{"id":"ad367d2c26100484","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"node ./node-red/.github/scripts/update-node-red-website.js\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":511,"y":1363,"wires":[["ef8e6aa170e9efa8"]]},{"id":"ef8e6aa170e9efa8","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Create Website Pull Request","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Create Website Pull Request","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"peter-evans/create-pull-request@v5\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.token","pt":"msg","to":"\"${{ secrets.NR_REPO_TOKEN }}\"","tot":"json"},{"t":"set","p":"step.with.committer","pt":"msg","to":"\"GitHub <noreply@github.com>\"","tot":"json"},{"t":"set","p":"step.with.author","pt":"msg","to":"\"${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red.github.io\"","tot":"json"},{"t":"set","p":"step.with['commit-message']","pt":"msg","to":"\"Bump to ${{ env.newVersion }}\"","tot":"json"},{"t":"set","p":"step.with.title","pt":"msg","to":"\"ðŸš€ Update to Node-RED ${{ env.newVersion }} release\"","tot":"json"},{"t":"set","p":"step.with.body","pt":"msg","to":"\"Updates the Node-RED Website repo for the ${{ env.newVersion }} release.\\n\\nThis PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary\\n\"","tot":"json"},{"t":"set","p":"payload.jobs.generate.steps","pt":"msg","to":"$append( $$.payload.jobs.generate.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":571,"y":1413,"wires":[["8900bd0aef26f5a8"]]},{"id":"3cbbe7bfd4b74601","type":"link out","z":"dd3cb2217a01efae","name":"link out 1","mode":"link","links":["f62dba1845a5413b"],"x":774.0000514984131,"y":719,"wires":[]},{"id":"f62dba1845a5413b","type":"link in","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"link in 1","links":["3cbbe7bfd4b74601","3d369886a648cdee","937afdcfcec46b66","7df0d51e0e847014","0e91c3d74cd92cfa","0b852f0a873c72ab"],"x":1980.333251953125,"y":485.33331298828125,"wires":[["d031695a129e095a"]]},{"id":"8900bd0aef26f5a8","type":"link out","z":"dd3cb2217a01efae","name":"link out 2","mode":"link","links":["4931220e1f9c6ba4"],"x":735.3331718444824,"y":1645.333339691162,"wires":[]},{"id":"4931220e1f9c6ba4","type":"link in","z":"dd3cb2217a01efae","name":"link in 2","links":["8900bd0aef26f5a8","19b1aec8a7ee5fb4","b12e1e7a744dc4a7","9a25891944e269a6","1677c8b63ba183c6","fa03a8cd7efa9752","af28db519a82c872","9d39cbb32f6671f0"],"x":2264.3333053588867,"y":2073.333169937134,"wires":[["3b6cb8d41c17ee45"]]},{"id":"6a40f2f935e829fe","type":"template","z":"dd3cb2217a01efae","g":"4f30383b302770d9","name":"multiline run","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Sync workflows for GHES\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  sync:\n    permissions:\n      contents: write\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    - run: |\n        git fetch --no-tags --prune --depth=1 origin +refs/heads/*:refs/remotes/origin/*\n        git config user.email \"cschleiden@github.com\"\n        git config user.name \"GitHub Actions\"\n    - uses: actions/setup-node@v3\n      with:\n        node-version: '16'\n        cache: 'npm'\n        cache-dependency-path: script/sync-ghes/package-lock.json\n    - name: Check starter workflows for GHES compat\n      run: |\n        npm ci\n        npx ts-node-script ./index.ts\n      working-directory: ./script/sync-ghes\n    - run: |\n        git add -A\n        if [ -z \"$(git status --porcelain)\" ]; then\n          echo \"No changes to commit\"\n        else\n          git commit -m \"Updating GHES workflows\"\n        fi\n    - run: git push","output":"str","x":1996,"y":885,"wires":[["937afdcfcec46b66"]]},{"id":"e12b6cf5ac5c8d8b","type":"template","z":"dd3cb2217a01efae","g":"2d80f77fc90b8faf","name":"schedule","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Mark stale issues and pull requests\n\non:\n  schedule:\n  - cron: \"21 4 * * *\"\n\njobs:\n  stale:\n\n    permissions:\n      issues: write\n      pull-requests: write\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/stale@v8\n      with:\n        stale-issue-message: 'This issue has become stale and will be closed automatically within a period of time. Sorry about that.'\n        stale-pr-message: 'This pull request has become stale and will be closed automatically within a period of time. Sorry about that.'\n        stale-issue-label: 'no-issue-activity'\n        stale-pr-label: 'no-pr-activity'\n        days-before-stale: 90 ","output":"str","x":2949,"y":885,"wires":[["7df0d51e0e847014"]]},{"id":"a98d9ebc42d62eec","type":"template","z":"dd3cb2217a01efae","g":"bf467bf835118d90","name":"if & multiline with value","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Close as a support issue\non:\n  issues:\n    types: [labeled]\n\njobs:\n  build:\n    permissions:\n      issues: write\n    runs-on: ubuntu-latest\n    steps:\n    - name: Close Issue\n      uses: peter-evans/close-issue@v3\n      if: contains(github.event.issue.labels.*.name, 'support')\n      with:\n        comment: |\n          Sorry, but we'd like to keep issues related to code in this repository. Thank you ðŸ™‡ \n          \n          If you have questions about writing workflows or action files, then please [visit the GitHub Community Forum's Actions Board](https://github.community/t5/GitHub-Actions/bd-p/actions)\n          \n          If you are having an issue or question about GitHub Actions then please [contact customer support](https://help.github.com/en/articles/about-github-actions#contacting-support)","output":"str","x":3606,"y":879.5,"wires":[["0e91c3d74cd92cfa"]]},{"id":"da76552686465c13","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":992,"y":884.6666564941406,"wires":[["9194f31f4c6ec8d7"]]},{"id":"cb668a8413f53c5e","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":992,"y":1046.6666259765625,"wires":[["7bf314afcf570c84"]]},{"id":"f30a31cf47ef44aa","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1731.6667213439941,"y":884.3333168029785,"wires":[["6a40f2f935e829fe"]]},{"id":"49c596a623c39fb8","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1731.6667213439941,"y":993.3333168029785,"wires":[["861b940c73de8d41"]]},{"id":"791d381da759b6e9","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2633.6667404174805,"y":883.999963760376,"wires":[["e12b6cf5ac5c8d8b"]]},{"id":"7814a8d7fa6f20a8","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2633.6667404174805,"y":1042.999963760376,"wires":[["85f342dd3d1c8b1e"]]},{"id":"f1af67b3b1e435f7","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3328.066255569458,"y":884.6665878295898,"wires":[["a98d9ebc42d62eec"]]},{"id":"c73a4ee8a205d27e","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3328.066255569458,"y":1023.6666297912598,"wires":[["f9cdfbab777ed66a"]]},{"id":"937afdcfcec46b66","type":"link out","z":"dd3cb2217a01efae","name":"link out 4","mode":"link","links":["f62dba1845a5413b"],"x":2266.500039100647,"y":719,"wires":[]},{"id":"7df0d51e0e847014","type":"link out","z":"dd3cb2217a01efae","name":"link out 5","mode":"link","links":["f62dba1845a5413b"],"x":3012.750032901764,"y":719,"wires":[]},{"id":"0e91c3d74cd92cfa","type":"link out","z":"dd3cb2217a01efae","name":"link out 6","mode":"link","links":["f62dba1845a5413b"],"x":3759.000026702881,"y":719,"wires":[]},{"id":"19b1aec8a7ee5fb4","type":"link out","z":"dd3cb2217a01efae","name":"link out 7","mode":"link","links":["4931220e1f9c6ba4"],"x":1501.9998302459717,"y":1645.333339691162,"wires":[]},{"id":"b12e1e7a744dc4a7","type":"link out","z":"dd3cb2217a01efae","name":"link out 8","mode":"link","links":["4931220e1f9c6ba4"],"x":2268.666488647461,"y":1645.333339691162,"wires":[]},{"id":"9a25891944e269a6","type":"link out","z":"dd3cb2217a01efae","name":"link out 9","mode":"link","links":["4931220e1f9c6ba4"],"x":3801.9998054504395,"y":1645.333339691162,"wires":[]},{"id":"1677c8b63ba183c6","type":"link out","z":"dd3cb2217a01efae","name":"link out 10","mode":"link","links":["4931220e1f9c6ba4"],"x":3035.33314704895,"y":1645.333339691162,"wires":[]},{"id":"9194f31f4c6ec8d7","type":"template","z":"dd3cb2217a01efae","g":"5cb7812512e00b29","name":"basis","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Push-Release-2022-01-To-Dockerhub\n\non:\n  push:\n    branches: [ release-2022-01 ]\n\n  workflow_dispatch:\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      -\n        name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v1\n      -\n        name: Login to DockerHub\n        uses: docker/login-action@v1\n        with:\n          username: ${{ secrets.DOCKERHUB_USER }}\n          password: ${{ secrets.DOCKERHUB_TOKEN }}\n      -\n        name: Build and push\n        id: docker_build\n        uses: docker/build-push-action@v2\n        with:\n          context: .\n          file: Dockerfile.hub\n          push: true\n          tags: gorenje/sysmlv2-jupyter:2022-01\n      -\n        name: Image digest\n        run: echo ${{ steps.docker_build.outputs.digest }}","output":"str","x":1327,"y":885,"wires":[["3d369886a648cdee"]]},{"id":"3d369886a648cdee","type":"link out","z":"dd3cb2217a01efae","name":"link out 3","mode":"link","links":["f62dba1845a5413b"],"x":1520.25004529953,"y":719,"wires":[]},{"id":"7bf314afcf570c84","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Push-Release-2022-01-To-Dockerhub","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Push-Release-2022-01-To-Dockerhub","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"push\": {\n    \"branches\": [\n      \"release-2022-01\"\n    ]\n  },\n  \"workflow_dispatch\": null\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1322,"y":1047,"wires":[["4309af5c9c9adb83"]]},{"id":"4309af5c9c9adb83","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Job: build","rules":[{"t":"set","p":"payload.jobs.build","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs.build['runs-on']","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1282,"y":1097,"wires":[["51f0d1028c41de41"]]},{"id":"51f0d1028c41de41","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v2\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"$append( $$.payload.jobs.build.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1362,"y":1147,"wires":[["a21b16a30ffa9596"]]},{"id":"a21b16a30ffa9596","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Set up Docker Buildx","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Set up Docker Buildx","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"docker/setup-buildx-action@v1\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"$append( $$.payload.jobs.build.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1402,"y":1197,"wires":[["5b7ddf3ec55f9736"]]},{"id":"5b7ddf3ec55f9736","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Login to DockerHub","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Login to DockerHub","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"docker/login-action@v1\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.username","pt":"msg","to":"\"${{ secrets.DOCKERHUB_USER }}\"","tot":"json"},{"t":"set","p":"step.with.password","pt":"msg","to":"\"${{ secrets.DOCKERHUB_TOKEN }}\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"$append( $$.payload.jobs.build.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1392,"y":1247,"wires":[["e1246a264c8f53ac"]]},{"id":"e1246a264c8f53ac","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Build and push","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Build and push","tot":"str"},{"t":"set","p":"step.id","pt":"msg","to":"\"docker_build\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"docker/build-push-action@v2\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.context","pt":"msg","to":"\".\"","tot":"json"},{"t":"set","p":"step.with.file","pt":"msg","to":"\"Dockerfile.hub\"","tot":"json"},{"t":"set","p":"step.with.push","pt":"msg","to":"true","tot":"json"},{"t":"set","p":"step.with.tags","pt":"msg","to":"\"gorenje/sysmlv2-jupyter:2022-01\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"$append( $$.payload.jobs.build.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1382,"y":1297,"wires":[["f8167a5d8ea2c419"]]},{"id":"f8167a5d8ea2c419","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Image digest","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Image digest","tot":"str"},{"t":"set","p":"step.run","pt":"msg","to":"\"echo ${{ steps.docker_build.outputs.digest }}\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"$append( $$.payload.jobs.build.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1372,"y":1347,"wires":[["19b1aec8a7ee5fb4"]]},{"id":"861b940c73de8d41","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Sync workflows for GHES","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Sync workflows for GHES","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"push\": {\n    \"branches\": [\n      \"main\"\n    ]\n  }\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2013,"y":993,"wires":[["2c9ecfa1f5777cac"]]},{"id":"2c9ecfa1f5777cac","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Job: sync","rules":[{"t":"set","p":"payload.jobs.sync","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs.sync.permissions","pt":"msg","to":"{\n  \"contents\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs.sync['runs-on']","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2053,"y":1043,"wires":[["0e982e239f6d2230"]]},{"id":"0e982e239f6d2230","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v3\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"$append( $$.payload.jobs.sync.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2133,"y":1093,"wires":[["b50d485fdb8150bd"]]},{"id":"b50d485fdb8150bd","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"git fetch --no-tags --prune --depth=1 origin +refs/heads/*:refs/remotes/origin/*\\ngit config user.email \\\"cschleiden@github.com\\\"\\ngit config user.name \\\"GitHub Actions\\\"\\n\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"$append( $$.payload.jobs.sync.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2133,"y":1143,"wires":[["f9a9e85916125818"]]},{"id":"f9a9e85916125818","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/setup-node@v3\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with['node-version']","pt":"msg","to":"\"16\"","tot":"json"},{"t":"set","p":"step.with.cache","pt":"msg","to":"\"npm\"","tot":"json"},{"t":"set","p":"step.with['cache-dependency-path']","pt":"msg","to":"\"script/sync-ghes/package-lock.json\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"$append( $$.payload.jobs.sync.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2133,"y":1193,"wires":[["12fb51e71f2fcca3"]]},{"id":"12fb51e71f2fcca3","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Check starter workflows for GHES compat","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check starter workflows for GHES compat","tot":"str"},{"t":"set","p":"step.run","pt":"msg","to":"\"npm ci\\nnpx ts-node-script ./index.ts\\n\"","tot":"json"},{"t":"set","p":"step['working-directory']","pt":"msg","to":"\"./script/sync-ghes\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"$append( $$.payload.jobs.sync.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2233,"y":1243,"wires":[["f8c4f957ec04a53e"]]},{"id":"f8c4f957ec04a53e","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"git add -A\\nif [ -z \\\"$(git status --porcelain)\\\" ]; then\\n  echo \\\"No changes to commit\\\"\\nelse\\n  git commit -m \\\"Updating GHES workflows\\\"\\nfi\\n\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"$append( $$.payload.jobs.sync.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2133,"y":1293,"wires":[["16a082c3c1d34931"]]},{"id":"16a082c3c1d34931","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"git push\"","tot":"json"},{"t":"set","p":"payload.jobs.sync.steps","pt":"msg","to":"$append( $$.payload.jobs.sync.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2133,"y":1343,"wires":[["b12e1e7a744dc4a7"]]},{"id":"85f342dd3d1c8b1e","type":"change","z":"dd3cb2217a01efae","g":"a295b1018fc0fbbf","name":"Mark stale issues and pull requests","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Mark stale issues and pull requests","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"schedule\": [\n    {\n      \"cron\": \"21 4 * * *\"\n    }\n  ]\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2934,"y":1043,"wires":[["87b1dac64a3eee4a"]]},{"id":"87b1dac64a3eee4a","type":"change","z":"dd3cb2217a01efae","g":"a295b1018fc0fbbf","name":"Job: stale","rules":[{"t":"set","p":"payload.jobs.stale","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs.stale.permissions","pt":"msg","to":"{\n  \"issues\": \"write\",\n  \"pull-requests\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs.stale['runs-on']","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs.stale.steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2934,"y":1093,"wires":[["bfb90a34394e7ec9"]]},{"id":"bfb90a34394e7ec9","type":"change","z":"dd3cb2217a01efae","g":"a295b1018fc0fbbf","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/stale@v8\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with['stale-issue-message']","pt":"msg","to":"\"This issue has become stale and will be closed automatically within a period of time. Sorry about that.\"","tot":"json"},{"t":"set","p":"step.with['stale-pr-message']","pt":"msg","to":"\"This pull request has become stale and will be closed automatically within a period of time. Sorry about that.\"","tot":"json"},{"t":"set","p":"step.with['stale-issue-label']","pt":"msg","to":"\"no-issue-activity\"","tot":"json"},{"t":"set","p":"step.with['stale-pr-label']","pt":"msg","to":"\"no-pr-activity\"","tot":"json"},{"t":"set","p":"step.with['days-before-stale']","pt":"msg","to":"90","tot":"json"},{"t":"set","p":"payload.jobs.stale.steps","pt":"msg","to":"$append( $$.payload.jobs.stale.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3014,"y":1143,"wires":[["1677c8b63ba183c6"]]},{"id":"f9cdfbab777ed66a","type":"change","z":"dd3cb2217a01efae","g":"0e61baef025de7fe","name":"Close as a support issue","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Close as a support issue","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"issues\": {\n    \"types\": [\n      \"labeled\"\n    ]\n  }\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3585,"y":1018.5,"wires":[["69b626cc543975bf"]]},{"id":"69b626cc543975bf","type":"change","z":"dd3cb2217a01efae","g":"0e61baef025de7fe","name":"Job: build","rules":[{"t":"set","p":"payload.jobs.build","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs.build.permissions","pt":"msg","to":"{\n  \"issues\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs.build['runs-on']","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3585,"y":1068.5,"wires":[["e2ef60793a7ed1f2"]]},{"id":"e2ef60793a7ed1f2","type":"change","z":"dd3cb2217a01efae","g":"0e61baef025de7fe","name":"Step: Close Issue","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Close Issue","tot":"str"},{"t":"set","p":"step.if","pt":"msg","to":"\"contains(github.event.issue.labels.*.name, 'support')\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"peter-evans/close-issue@v3\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.comment","pt":"msg","to":"\"Sorry, but we'd like to keep issues related to code in this repository. Thank you ðŸ™‡ \\n\\nIf you have questions about writing workflows or action files, then please [visit the GitHub Community Forum's Actions Board](https://github.community/t5/GitHub-Actions/bd-p/actions)\\n\\nIf you are having an issue or question about GitHub Actions then please [contact customer support](https://help.github.com/en/articles/about-github-actions#contacting-support)\\n\"","tot":"json"},{"t":"set","p":"payload.jobs.build.steps","pt":"msg","to":"$append( $$.payload.jobs.build.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3665,"y":1118.5,"wires":[["9a25891944e269a6"]]},{"id":"e949067515c6a52f","type":"template","z":"dd3cb2217a01efae","g":"d89467b659e375fe","name":"two jobs with steps","field":"payload","fieldType":"msg","format":"handlebars","syntax":"plain","template":"name: test-setup-melange\n\non:\n  pull_request:\n\njobs:\n  test-setup-melange:\n    runs-on: ubuntu-latest\n    permissions: {}\n    steps:\n    - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n\n    - id: changed-melange\n      uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d # v40.1.1\n      with:\n        files: |\n          ./setup-melange/**\n          ./melange-build/**\n          ./melange-build-pkg/**\n          ./melange-keygen/**\n          .github/workflows/test-setup-melange.yaml\n\n    - uses: ./setup-melange\n      if: steps.changed-melange.outputs.any_changed == 'true'\n\n    - if: steps.changed-melange.outputs.any_changed == 'true'\n      run: |\n        melange build setup-melange/example/melange.yaml --arch=x86_64\n        ls -R packages/\n\n  # This should do the same thing.\n  test-melange-build:\n    runs-on: ubuntu-latest\n    permissions: {}\n    steps:\n      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n\n      - id: changed-melange\n        uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d # v40.1.1\n        with:\n          files: |\n            ./setup-melange/**\n            .github/workflows/test-setup-melange.yaml\n\n      - uses: ./melange-build\n        if: steps.changed-melange.outputs.any_changed == 'true'\n        with:\n          config: setup-melange/example/melange.yaml\n          archs: x86_64\n          sign-with-temporary-key: true","output":"str","x":4248,"y":879.5,"wires":[["0b852f0a873c72ab"]]},{"id":"0b852f0a873c72ab","type":"link out","z":"dd3cb2217a01efae","name":"link out 11","mode":"link","links":["f62dba1845a5413b"],"x":4515,"y":719,"wires":[]},{"id":"71c6908890e8794f","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3975.999786376953,"y":876.8332586288452,"wires":[["e949067515c6a52f"]]},{"id":"629fbb2da80f70df","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3968.6666946411133,"y":1050.1664543151855,"wires":[["797020c68534b80a"]]},{"id":"fa03a8cd7efa9752","type":"link out","z":"dd3cb2217a01efae","name":"link out 12","mode":"link","links":["4931220e1f9c6ba4"],"x":4488.666463851929,"y":1645.333339691162,"wires":[]},{"id":"797020c68534b80a","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"test-setup-melange","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"test-setup-melange","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"pull_request\": null\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4197,"y":1047,"wires":[["fa904c18e76703da"]]},{"id":"fa904c18e76703da","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Job: test-setup-melange","rules":[{"t":"set","p":"payload.jobs[\"test-setup-melange\"]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"].permissions","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"].steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4237,"y":1097,"wires":[["f2aa34fe4459cc6c"]]},{"id":"f2aa34fe4459cc6c","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-setup-melange\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1147,"wires":[["3142ffe8692bca07"]]},{"id":"3142ffe8692bca07","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.id","pt":"msg","to":"\"changed-melange\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.files","pt":"msg","to":"\"./setup-melange/**\\n./melange-build/**\\n./melange-build-pkg/**\\n./melange-keygen/**\\n.github/workflows/test-setup-melange.yaml\\n\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-setup-melange\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1197,"wires":[["696d604423ce03bb"]]},{"id":"696d604423ce03bb","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.if","pt":"msg","to":"\"steps.changed-melange.outputs.any_changed == 'true'\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"./setup-melange\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-setup-melange\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1247,"wires":[["317a8f0b7100865a"]]},{"id":"317a8f0b7100865a","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.if","pt":"msg","to":"\"steps.changed-melange.outputs.any_changed == 'true'\"","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"melange build setup-melange/example/melange.yaml --arch=x86_64\\nls -R packages/\\n\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-setup-melange\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-setup-melange\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1297,"wires":[["08def01d2eb1512b"]]},{"id":"08def01d2eb1512b","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Job: test-melange-build","rules":[{"t":"set","p":"payload.jobs[\"test-melange-build\"]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[\"test-melange-build\"].permissions","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[\"test-melange-build\"][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-melange-build\"].steps","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4237,"y":1347,"wires":[["6aa48feb6543a643"]]},{"id":"6aa48feb6543a643","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-melange-build\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-melange-build\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1397,"wires":[["9c37c041e7a3939a"]]},{"id":"9c37c041e7a3939a","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.id","pt":"msg","to":"\"changed-melange\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.files","pt":"msg","to":"\"./setup-melange/**\\n.github/workflows/test-setup-melange.yaml\\n\"","tot":"json"},{"t":"set","p":"payload.jobs[\"test-melange-build\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-melange-build\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1447,"wires":[["c825efd60c1595dc"]]},{"id":"c825efd60c1595dc","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.if","pt":"msg","to":"\"steps.changed-melange.outputs.any_changed == 'true'\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"./melange-build\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.config","pt":"msg","to":"\"setup-melange/example/melange.yaml\"","tot":"json"},{"t":"set","p":"step.with.archs","pt":"msg","to":"\"x86_64\"","tot":"json"},{"t":"set","p":"step.with[\"sign-with-temporary-key\"]","pt":"msg","to":"true","tot":"json"},{"t":"set","p":"payload.jobs[\"test-melange-build\"].steps","pt":"msg","to":"$append( $$.payload.jobs.\"test-melange-build\".steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4277,"y":1497,"wires":[["fa03a8cd7efa9752"]]}]