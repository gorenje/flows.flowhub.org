[{"id":"dd3cb2217a01efae","type":"tab","label":"[GitHub Actions] Visualising GitHub actions as Node-RED flow","disabled":false,"info":"### Description\n\nFunctionality for converting [GitHub actions](https://docs.github.com/en/actions) YAMLs to a flow of change nodes. GitHub actions are a workflow description of steps that are performed with specific actions occur. These actions are represented in YAML files and can become very long. \n\nThis is an attempt to represent the workflow defined in the YAML files as a flow within Node-RED. The flow consists solely of change nodes.\n\nThe <a class=\"ahl-node-only\" data-ids=\"356cad31136bd2bb\">function node</a> generates a flow description that is imported by the <a class=\"ahl-node-only\" data-ids=\"58482fba18d94669\">client code node</a>.\n\nThe intention is to find a visual method of modifying and maintaining the YAMLs required for GitHub actions.\n\nThe <a class='ahl-group-only' data-ids=\"9ad2a872d1bc67d5,0e61baef025de7fe,a295b1018fc0fbbf,ad6d69d2f9a25b95,acd63cc5a2f4f35b,fd9dafd09c273f3a\">generated nodes</a>, when <a class=\"ahl-node-only\" data-ids=\"59bc62b633233084,cb668a8413f53c5e,49c596a623c39fb8,7814a8d7fa6f20a8,c73a4ee8a205d27e,629fbb2da80f70df\">triggered</a> generate a YAML representation that is the same as the <a class=\"ahl-node-only\" data-ids=\"bf83e0b1a8583629,9194f31f4c6ec8d7,6a40f2f935e829fe,e12b6cf5ac5c8d8b,a98d9ebc42d62eec,e949067515c6a52f\">original YAMLs</a>.\n\n### Example YAML\n\nThe following YAML generates the <a class='ahl-group-only' data-ids='9ad2a872d1bc67d5'>these change nodes</a>.\n\n```yaml\nname: test-setup-melange\n\non:\n  pull_request:\n\njobs:\n  test-setup-melange:\n    runs-on: ubuntu-latest\n    permissions: {}\n    steps:\n    - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n\n    - id: changed-melange\n      uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d # v40.1.1\n      with:\n        files: |\n          ./setup-melange/**\n          ./melange-build/**\n          ./melange-build-pkg/**\n          ./melange-keygen/**\n          .github/workflows/test-setup-melange.yaml\n\n    - uses: ./setup-melange\n      if: steps.changed-melange.outputs.any_changed == 'true'\n\n    - if: steps.changed-melange.outputs.any_changed == 'true'\n      run: |\n        melange build setup-melange/example/melange.yaml --arch=x86_64\n        ls -R packages/\n\n  # This should do the same thing.\n  test-melange-build:\n    runs-on: ubuntu-latest\n    permissions: {}\n    steps:\n      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n\n      - id: changed-melange\n        uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d # v40.1.1\n        with:\n          files: |\n            ./setup-melange/**\n            .github/workflows/test-setup-melange.yaml\n\n      - uses: ./melange-build\n        if: steps.changed-melange.outputs.any_changed == 'true'\n        with:\n          config: setup-melange/example/melange.yaml\n          archs: x86_64\n          sign-with-temporary-key: true\n```\n\nWhen the nodes are <a class='ahl-node-only' data-ids='629fbb2da80f70df'>triggered</a>, they produce this output: \n\n```yaml\nname: test-setup-melange\n'on':\n  pull_request: null\njobs:\n  test-setup-melange:\n    permissions: {}\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11\n      - id: changed-melange\n        uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d\n        with:\n          files: |\n            ./setup-melange/**\n            ./melange-build/**\n            ./melange-build-pkg/**\n            ./melange-keygen/**\n            .github/workflows/test-setup-melange.yaml\n      - if: steps.changed-melange.outputs.any_changed == 'true'\n        uses: ./setup-melange\n      - if: steps.changed-melange.outputs.any_changed == 'true'\n        run: |\n          melange build setup-melange/example/melange.yaml --arch=x86_64\n          ls -R packages/\n  test-melange-build:\n    permissions: {}\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11\n      - id: changed-melange\n        uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d\n        with:\n          files: |\n            ./setup-melange/**\n            .github/workflows/test-setup-melange.yaml\n      - if: steps.changed-melange.outputs.any_changed == 'true'\n        uses: ./melange-build\n        with:\n          config: setup-melange/example/melange.yaml\n          archs: x86_64\n          sign-with-temporary-key: true\n```\n\nAll the data in the YAMLs has been transferred to the change nodes, there that data can be updated and a new YAML can be generated.\n\nOf course, the generated YAML can also be automatically committed to the GitHub repository to which it belongs using the [GitHub flow](https://flowhub.org/f/31ea3193ec1a2117). \n\n**Pitfall**: the GITHUB_TOKEN that is used to update the workflow for a repository needs to have the `workflow` permission else updates of GitHub will not work.\n\nThe intention is to have a Node-RED flow that defines the actions YAML for a repository and have that flow also commit any changes to the generated YAML - all-in-one GitHub actions updater flow.\n\nThis idea is demonstrated by the <a class='ahl-group-only' data-ids='10d37b5abae15a75'>import, modify and export</a> example. The nodes were generated by this flow and then are committed to GitHub.\n\n### Why?\n\nThe initial idea was that GitHub actions are workflows and Node-RED is a visual workflow designer tool - amongst other things. So why not have a visual representation of GitHub action workflows?\n\nThe generation of Node-RED flows using a <a class=\"ahl-node-only\" data-ids=\"356cad31136bd2bb\">function node</a> *within* Node-RED gives this a meta-programming aspect which should not be overlooked when using Node-RED. There is nothing wrong with using Node-RED to generate Node-RED flows within Node-RED. \n\nGenerated flows solely use the in-built change node: a job, a step and the workflow are all represented as change nodes. This demonstrates the flexibility of the change node and Node-RED in general. \n\nFlows are created so that steps and jobs can be moved, copied and deleted without any interdependency between the nodes. This allows for existing workflows to be imported, modified as flows and then exported as YAML.\n\n### Requirements\n\n- [introspection nodes](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection)\n- [FlowHub nodes](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-flowhub) are optional but required to import this flow to Node-RED.\n\n","env":[]},{"id":"92b2acb8859596ad","type":"group","z":"dd3cb2217a01efae","name":"Example 1: Generating nodes from YAML","style":{"label":true},"nodes":["bf83e0b1a8583629","fd9dafd09c273f3a"],"x":284,"y":844,"w":548,"h":630.166748046875},{"id":"942a2d153feccae7","type":"group","z":"dd3cb2217a01efae","name":"Generate Change Nodes","style":{"label":true},"nodes":["d031695a129e095a","356cad31136bd2bb","6477c53d82e6fbaf","58482fba18d94669","0d6ddb294a9be57e","38bc0b91bc93b258","f62dba1845a5413b"],"x":1939.333251953125,"y":311.33331298828125,"w":890,"h":217},{"id":"5cb7812512e00b29","type":"group","z":"dd3cb2217a01efae","name":"Example 2","style":{"label":true},"nodes":["9194f31f4c6ec8d7","acd63cc5a2f4f35b"],"x":1126,"y":844,"w":407,"h":544.6998901367188},{"id":"4f30383b302770d9","type":"group","z":"dd3cb2217a01efae","name":"Example 3","style":{"label":true},"nodes":["6a40f2f935e829fe","ad6d69d2f9a25b95"],"x":1900,"y":844,"w":554,"h":551.6998901367188},{"id":"2d80f77fc90b8faf","type":"group","z":"dd3cb2217a01efae","name":"Example 4","style":{"label":true},"nodes":["e12b6cf5ac5c8d8b","a295b1018fc0fbbf"],"x":2729,"y":844,"w":384,"h":367.69989013671875},{"id":"bf467bf835118d90","type":"group","z":"dd3cb2217a01efae","name":"Example 5","style":{"label":true},"nodes":["a98d9ebc42d62eec","0e61baef025de7fe"],"x":3423,"y":843.5,"w":362,"h":347.19989013671875},{"id":"d89467b659e375fe","type":"group","z":"dd3cb2217a01efae","name":"Example 6","style":{"label":true},"nodes":["e949067515c6a52f","9ad2a872d1bc67d5"],"x":4040,"y":836.5,"w":410,"h":727.199951171875},{"id":"8c75517fade9020d","type":"group","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"import existing action from GitHub","style":{"label":true},"nodes":["59e71e95c97037a1","11dcd558d0fa1eec","f2ac359448a147a5"],"x":1544.6192220052083,"y":2696.825222439236,"w":451.4445501963298,"h":253.1109214358862},{"id":"ad6d69d2f9a25b95","type":"group","z":"dd3cb2217a01efae","g":"4f30383b302770d9","name":"generated nodes","style":{"label":true},"nodes":["59cbf9b2a5a363d8","ac22622d29b6256b","b8be98a26531273b","012b42983946ac82","ce68f35f8ac1ded2","36243d805526a0d9","7cf971aea02d571e","d24fc201ce3f7aea"],"x":1931,"y":952.699951171875,"w":497,"h":416.99993896484375},{"id":"a295b1018fc0fbbf","type":"group","z":"dd3cb2217a01efae","g":"2d80f77fc90b8faf","name":"generated nodes","style":{"label":true},"nodes":["5c137719f2d54a5f","f48110aa55f316b5","ecbcd74504621fc5"],"x":2755,"y":1001.6998901367188,"w":332,"h":184},{"id":"0e61baef025de7fe","type":"group","z":"dd3cb2217a01efae","g":"bf467bf835118d90","name":"generated nodes","style":{"label":true},"nodes":["52b1d34c2e3ba582","6e84a0f364ce6645","2bd2f37835657e93"],"x":3449,"y":982.699951171875,"w":310,"h":181.99993896484375},{"id":"9ad2a872d1bc67d5","type":"group","z":"dd3cb2217a01efae","g":"d89467b659e375fe","name":"generated nodes","style":{"label":true},"nodes":["ad1b7d091692ab12","493ef5952f6f7b3f","053405fdb6726a41","abc569157eb7b9a2","a015ca0367d5a815","2f9c29a0dd6718c7","1ed70f9cc4678db1","78721ce601bb0f8a","7aad32d4cfb9fe68","9aea71abc4b5751a"],"x":4066,"y":990.6998901367188,"w":358,"h":547.0000610351562},{"id":"fd9dafd09c273f3a","type":"group","z":"dd3cb2217a01efae","g":"92b2acb8859596ad","name":"Nodes Generated from YAML","style":{"label":true},"nodes":["d83f6dc78fba87a2","224353b86811f3af","d56e5f124c57d131","0e2c08826ec93d2d","15510c40dee3fab6","91cdc9b3c0808e9b","e4c7fdbc611096ad","1cdd6978bc9a1813","7a8e4a46ac03c9d7","1b13e8698b1539f4"],"x":317,"y":920.166748046875,"w":489,"h":528},{"id":"acd63cc5a2f4f35b","type":"group","z":"dd3cb2217a01efae","g":"5cb7812512e00b29","name":"Generated Nodes","style":{"label":true},"nodes":["20031350ec8b64ad","2c2862273c7bee7e","60455d61ffbf42ad","9543d8ce2b4991ac","1a605680c1eb622f","c82a0f16f236e4f2","44564467ca5ed4cd"],"x":1152,"y":984.699951171875,"w":355,"h":377.99993896484375},{"id":"10d37b5abae15a75","type":"group","z":"dd3cb2217a01efae","name":"Import, modify and export use-case","style":{"label":true},"nodes":["9d25b80dc1c06a91","27e8d7539969d23a","a11d72a71841545b","4711a6a05e7d7d91","d9c2f96746a08193","255c4b3b4de2969f","7456d21afae97b8d","30e2a2476e6428a3","05d238461a15a7e7","b0cc639589b7f053","5f536d475427f84f","a70f2698627249f7","8c75517fade9020d","3521d8d9a9555a79","9bc6d29f39f2c888"],"x":1518.6192220052083,"y":2574.714262008667,"w":2083.888834635417,"h":421.9999408721924},{"id":"3521d8d9a9555a79","type":"group","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Requried depended flow","style":{"label":true},"nodes":["9146a0bb592d8731"],"x":1547.0634078979492,"y":2604.1432914733887,"w":292,"h":82},{"id":"5ef6bad9db706e0e","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":127.33327102661133,"y":886.0000038146973,"wires":[["bf83e0b1a8583629"]]},{"id":"bf83e0b1a8583629","type":"template","z":"dd3cb2217a01efae","g":"92b2acb8859596ad","name":"Node-RED publish actions","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Publish Release\nenv:\n  ACTIONS_ALLOW_UNSECURE_COMMANDS: true\non:\n  release:\n    types: [published]\n\npermissions:\n  contents: read\n\njobs:\n  generate:\n    name: 'Update node-red-docker image'\n    runs-on: ubuntu-latest\n    steps:\n      - name: Check out node-red repository\n        uses: actions/checkout@v4\n        with:\n            path: 'node-red'\n      - name: Check out node-red-docker repository\n        uses: actions/checkout@v4\n        with:\n            repository: 'node-red/node-red-docker'\n            path: 'node-red-docker'\n      - name: Check out node-red.github.io repository\n        uses: actions/checkout@v4\n        with:\n            repository: 'node-red/node-red.github.io'\n            path: 'node-red.github.io'\n      - uses: actions/setup-node@v4\n        with:\n            node-version: '16'\n      - run: node ./node-red/.github/scripts/update-node-red-docker.js\n      - name: Create Docker Pull Request\n        uses: peter-evans/create-pull-request@v5\n        with:\n          token: ${{ secrets.NR_REPO_TOKEN }}\n          committer: GitHub <noreply@github.com>\n          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\n          path: 'node-red-docker'\n          commit-message: 'Bump to ${{ env.newVersion }}'\n          title: 'ðŸš€ Update to Node-RED ${{ env.newVersion }} release'\n          body: |\n            Updates the Node-RED Docker repo for the ${{ env.newVersion }} release.\n\n            Once this is merged, you will need to create a new release with the tag `v${{ env.newVersion }}`.\n\n            This PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary\n      - run: node ./node-red/.github/scripts/update-node-red-website.js\n      - name: Create Website Pull Request\n        uses: peter-evans/create-pull-request@v5\n        with:\n          token: ${{ secrets.NR_REPO_TOKEN }}\n          committer: GitHub <noreply@github.com>\n          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\n          path: 'node-red.github.io'\n          commit-message: 'Bump to ${{ env.newVersion }}'\n          title: 'ðŸš€ Update to Node-RED ${{ env.newVersion }} release'\n          body: |\n            Updates the Node-RED Website repo for the ${{ env.newVersion }} release.\n\n            This PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary","output":"str","x":430,"y":885,"wires":[["3cbbe7bfd4b74601"]]},{"id":"d031695a129e095a","type":"yaml","z":"dd3cb2217a01efae","g":"942a2d153feccae7","property":"payload","name":"","x":2065.333251953125,"y":485.33331298828125,"wires":[["356cad31136bd2bb","38bc0b91bc93b258"]]},{"id":"356cad31136bd2bb","type":"function","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"convert github action yaml file to collection of change nodes","func":"/*\n * Functionality\n */\nlet ruleJson = (nameStr, data) => {\n    return {\n        \"t\": \"set\",\n        \"p\": nameStr,\n        \"pt\": \"msg\",\n        \"to\": JSON.stringify(data, null, 2),\n        \"tot\": \"json\"\n    }\n}\n\nlet ruleString = (nameStr, data) => {\n    return {\n        \"t\": \"set\",\n        \"p\": nameStr,\n        \"pt\": \"msg\",\n        \"to\": data,\n        \"tot\": \"str\"\n    }\n}\n\nlet hashKey = (keyStr) => {\n    if (keyStr.indexOf(\"-\") > -1) {\n        return `[\"${keyStr}\"]`\n    } else {\n        return `.${keyStr}`\n    }\n}\n\n/*\n * Templates\n */\nlet chgTemplate = {\n    \"type\": \"change\",\n    \"name\": \"\",\n    \"action\": \"\",\n    \"property\": \"\",\n    \"from\": \"\",\n    \"to\": \"\",\n    \"reg\": false,\n    \"x\": 0,\n    \"y\": 0,\n}\n\nlet startHere = {\n    ...chgTemplate,\n    \"id\": RED.util.generateId(),\n    \"name\": \"Start Here\",\n    \"rules\": [ruleJson(\"payload\", {})],\n    \"wires\": [\n        []\n    ]\n}\n\nlet lstNde = startHere;\nlet height = 0;\nlet nodeCollection = [startHere];\n\n/*\n * Computation starts here.\n */\nif (msg.payload.name) {\n    startHere.name = msg.payload.name\n    startHere.rules.push(ruleString(\"payload.name\", msg.payload.name))\n    delete msg.payload.name;\n}\n\nif (msg.payload.env) {\n    startHere.rules.push(ruleJson(\"payload.env\", {}))\n\n    let envKeys = Object.keys(msg.payload.env)\n    for (var kdx = 0; kdx < envKeys.length; kdx++) {\n        startHere.rules.push(ruleJson(\"payload.env\" + hashKey(envKeys[kdx]), msg.payload.env[envKeys[kdx]]))\n    }\n\n    delete msg.payload.env;\n}\n\n['on', 'permissions'].forEach(k => {\n    if (Object.keys(msg.payload).indexOf(k) > -1) {\n        startHere.rules.push(ruleJson(\"payload\" + hashKey(k), msg.payload[k]))\n        delete msg.payload[k];\n    }\n})\n\nif (msg.payload.jobs) {\n    startHere.rules.push(ruleJson(\"payload.jobs\", {}))\n\n    let jobKeys = Object.keys(msg.payload.jobs);\n\n    for (var idx = 0; idx < jobKeys.length; idx++) {\n        let ndeId = RED.util.generateId()\n        let jobObj = msg.payload.jobs[jobKeys[idx]]\n\n        height += 50\n\n        let jobChg = {\n            ...chgTemplate,\n            id: ndeId,\n            name: \"Job: \" + jobKeys[idx],\n            rules: [\n                /*\n                 * the jobkey value allows jobs to be copied and reused just by altering this\n                 * value, a new job is created in the final YAML.\n                 */\n                ruleString(\"jobkey\", jobKeys[idx]),\n                ruleJson(\"payload.jobs[msg.jobkey]\", {})\n            ],\n            x: 40,\n            y: height,\n            wires: [[]]\n        };\n\n        if (Object.keys(jobObj).indexOf(\"name\") > -1) {\n            jobChg.rules.push(ruleString(\"payload.jobs[msg.jobkey].name\", jobObj.name));\n            delete jobObj.name;\n        }\n\n        ['id', 'permissions', 'runs-on'].forEach(k => {\n            if (Object.keys(jobObj).indexOf(k) > -1) {\n                jobChg.rules.push(ruleJson(\"payload.jobs[msg.jobkey]\" + hashKey(k), jobObj[k]))\n                delete jobObj[k];\n            }\n        })\n\n        nodeCollection.push(jobChg)\n        lstNde.wires[0].push(ndeId)\n        lstNde = jobChg;\n\n        /*\n         * Handle the steps defined on the job. Each step uses a _reference_ to the job,\n         * this allows steps to be moved and copied around within the flow _without_ \n         * having to alter the step or job.\n         */\n        if (jobObj.steps) {\n            jobChg.rules.push(ruleJson(\"payload.jobs[msg.jobkey].steps\", []))\n            /* this becomes the reference that a step uses to reference the job it belongs to */\n            jobChg.rules.push({\n                \"t\": \"set\",\n                \"p\": \"job\",\n                \"pt\": \"msg\",\n                \"to\": \"payload.jobs[msg.jobkey]\",\n                \"tot\": \"msg\",\n            })\n\n            for (var jdx = 0; jdx < jobObj.steps.length; jdx++) {\n                ndeId = RED.util.generateId()\n                let stpObj = jobObj.steps[jdx];\n                height += 50\n\n                let stpName = (stpObj.name || stpObj.id || (stpObj.run && \"Run Only\") || (stpObj.uses && \"Uses Only\") || \"No Name\")\n\n                let stepChg = {\n                    ...chgTemplate,\n                    id: ndeId,\n                    name: \"Step: \" + stpName,\n                    rules: [ruleJson(\"step\", {})],\n                    x: 80,\n                    y: height,\n                    \"wires\": [[]]\n                };\n\n                if (Object.keys(stpObj).indexOf(\"name\") > -1) {\n                    stepChg.rules.push(ruleString(\"step.name\", stpObj.name))\n                    delete stpObj.name\n                }\n\n                [\"id\", \"if\", \"uses\", \"run\"].forEach(k => {\n                    if (Object.keys(stpObj).indexOf(k) > -1) {\n                        stepChg.rules.push(ruleJson(\"step\" + hashKey(k), stpObj[k]))\n                        delete stpObj[k]\n                    }\n                })\n\n                if (stpObj[\"with\"]) {\n                    stepChg.rules.push(ruleJson(\"step.with\", {}))\n\n                    let withKeys = Object.keys(stpObj[\"with\"])\n                    for (var kdx = 0; kdx < withKeys.length; kdx++) {\n                        stepChg.rules.push(ruleJson(\"step.with\" + hashKey(withKeys[kdx]), stpObj[\"with\"][withKeys[kdx]]))\n                    }\n\n                    delete stpObj[\"with\"]\n                }\n\n                Object.keys(stpObj).forEach(k => {\n                    stepChg.rules.push(ruleJson(\"step\" + hashKey(k), stpObj[k]))\n                    delete stpObj[k]\n                })\n\n                /*\n                 * Add step obj to steps array and clean up msg object.\n                 */\n                stepChg.rules.push({\n                    \"t\": \"set\",\n                    \"p\": \"job.steps\",\n                    \"pt\": \"msg\",\n                    \"to\": \"$append( $$.job.steps, [$$.step])\",\n                    \"tot\": \"jsonata\"\n                })\n\n                stepChg.rules.push({\n                    \"t\": \"delete\",\n                    \"p\": \"step\",\n                    \"pt\": \"msg\"\n                })\n\n                nodeCollection.push(stepChg)\n                lstNde.wires[0].push(ndeId)\n                lstNde = stepChg;\n            }\n            delete jobObj.steps\n        }\n\n        Object.keys(jobObj).forEach(k => {\n            jobChg.rules.push(ruleJson(\"payload.jobs[msg.jobkey]\" + hashKey(k), jobObj[k]))\n            delete jobObj[k];\n        })\n\n        jobChg.rules.push({\n            \"t\": \"delete\",\n            \"p\": \"jobkey\",\n            \"pt\": \"msg\"\n        })\n    }\n    delete msg.payload.jobs;\n}\n\nObject.keys(msg.payload).forEach(k => {\n    startHere.rules.push(ruleJson(\"payload\" + hashKey(k), msg.payload[k]))\n    delete msg.payload[k];\n})\n\nmsg.payload = nodeCollection\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2237.333251953125,"y":352.33331298828125,"wires":[["6477c53d82e6fbaf","0d6ddb294a9be57e"]]},{"id":"6477c53d82e6fbaf","type":"json","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"","property":"payload","action":"str","pretty":true,"x":2555.6187744140625,"y":423.33331298828125,"wires":[["58482fba18d94669"]]},{"id":"58482fba18d94669","type":"ClientCode","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"open import dialog","clientcode":"setTimeout(() => {\n            RED.clipboard.import();\n        \n            setTimeout(() => {\n                $('#red-ui-clipboard-dialog-import-text').val(\n                   data.payload\n                ).trigger(\"paste\");\n            }, 300);\n        },400)","format":"javascript","x":2713.333251953125,"y":487.33331298828125,"wires":[[]]},{"id":"3b6cb8d41c17ee45","type":"yaml","z":"dd3cb2217a01efae","property":"payload","name":"","x":2469.3331451416016,"y":2024.761850118637,"wires":[["208e3f642ad5c227"]]},{"id":"208e3f642ad5c227","type":"debug","z":"dd3cb2217a01efae","name":"debug 94","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2701.3331451416016,"y":2024.761850118637,"wires":[]},{"id":"59bc62b633233084","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":126.33327102661133,"y":962.0000038146973,"wires":[["d83f6dc78fba87a2"]]},{"id":"0d6ddb294a9be57e","type":"debug","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"debug 89","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2655.333251953125,"y":352.33331298828125,"wires":[]},{"id":"38bc0b91bc93b258","type":"debug","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"debug 93","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2379.333251953125,"y":485.33331298828125,"wires":[]},{"id":"3cbbe7bfd4b74601","type":"link out","z":"dd3cb2217a01efae","name":"link out 1","mode":"link","links":["f62dba1845a5413b"],"x":774.0000514984131,"y":719,"wires":[]},{"id":"f62dba1845a5413b","type":"link in","z":"dd3cb2217a01efae","g":"942a2d153feccae7","name":"generate flow","links":["0b852f0a873c72ab","0e91c3d74cd92cfa","3cbbe7bfd4b74601","3d369886a648cdee","7df0d51e0e847014","937afdcfcec46b66","f2ac359448a147a5"],"x":1980.333251953125,"y":485.33331298828125,"wires":[["d031695a129e095a"]]},{"id":"8900bd0aef26f5a8","type":"link out","z":"dd3cb2217a01efae","name":"link out 2","mode":"link","links":["4931220e1f9c6ba4"],"x":735.3331718444824,"y":1645.333339691162,"wires":[]},{"id":"4931220e1f9c6ba4","type":"link in","z":"dd3cb2217a01efae","name":"generate YAML","links":["1677c8b63ba183c6","19b1aec8a7ee5fb4","8900bd0aef26f5a8","9a25891944e269a6","b12e1e7a744dc4a7","fa03a8cd7efa9752"],"x":2384.3331451416016,"y":2024.761850118637,"wires":[["3b6cb8d41c17ee45"]]},{"id":"6a40f2f935e829fe","type":"template","z":"dd3cb2217a01efae","g":"4f30383b302770d9","name":"multiline run","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Sync workflows for GHES\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  sync:\n    permissions:\n      contents: write\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    - run: |\n        git fetch --no-tags --prune --depth=1 origin +refs/heads/*:refs/remotes/origin/*\n        git config user.email \"cschleiden@github.com\"\n        git config user.name \"GitHub Actions\"\n    - uses: actions/setup-node@v3\n      with:\n        node-version: '16'\n        cache: 'npm'\n        cache-dependency-path: script/sync-ghes/package-lock.json\n    - name: Check starter workflows for GHES compat\n      run: |\n        npm ci\n        npx ts-node-script ./index.ts\n      working-directory: ./script/sync-ghes\n    - run: |\n        git add -A\n        if [ -z \"$(git status --porcelain)\" ]; then\n          echo \"No changes to commit\"\n        else\n          git commit -m \"Updating GHES workflows\"\n        fi\n    - run: git push","output":"str","x":1996,"y":885,"wires":[["937afdcfcec46b66"]]},{"id":"e12b6cf5ac5c8d8b","type":"template","z":"dd3cb2217a01efae","g":"2d80f77fc90b8faf","name":"close tickets on schedule","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Mark stale issues and pull requests\n\non:\n  schedule:\n  - cron: \"21 4 * * *\"\n\njobs:\n  stale:\n\n    permissions:\n      issues: write\n      pull-requests: write\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/stale@v8\n      with:\n        stale-issue-message: 'This issue has become stale and will be closed automatically within a period of time. Sorry about that.'\n        stale-pr-message: 'This pull request has become stale and will be closed automatically within a period of time. Sorry about that.'\n        stale-issue-label: 'no-issue-activity'\n        stale-pr-label: 'no-pr-activity'\n        days-before-stale: 90 ","output":"str","x":2879,"y":885,"wires":[["7df0d51e0e847014"]]},{"id":"a98d9ebc42d62eec","type":"template","z":"dd3cb2217a01efae","g":"bf467bf835118d90","name":"if & multiline with value","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Close as a support issue\non:\n  issues:\n    types: [labeled]\n\njobs:\n  build:\n    permissions:\n      issues: write\n    runs-on: ubuntu-latest\n    steps:\n    - name: Close Issue\n      uses: peter-evans/close-issue@v3\n      if: contains(github.event.issue.labels.*.name, 'support')\n      with:\n        comment: |\n          Sorry, but we'd like to keep issues related to code in this repository. Thank you ðŸ™‡ \n          \n          If you have questions about writing workflows or action files, then please [visit the GitHub Community Forum's Actions Board](https://github.community/t5/GitHub-Actions/bd-p/actions)\n          \n          If you are having an issue or question about GitHub Actions then please [contact customer support](https://help.github.com/en/articles/about-github-actions#contacting-support)","output":"str","x":3556,"y":884.5,"wires":[["0e91c3d74cd92cfa"]]},{"id":"da76552686465c13","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":992,"y":884.6666564941406,"wires":[["9194f31f4c6ec8d7"]]},{"id":"cb668a8413f53c5e","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":994,"y":1025.6665649414062,"wires":[["20031350ec8b64ad"]]},{"id":"f30a31cf47ef44aa","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1731.6667213439941,"y":884.3333168029785,"wires":[["6a40f2f935e829fe"]]},{"id":"49c596a623c39fb8","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1731.6667213439941,"y":993.3333168029785,"wires":[["59cbf9b2a5a363d8"]]},{"id":"791d381da759b6e9","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2633.6667404174805,"y":883.999963760376,"wires":[["e12b6cf5ac5c8d8b"]]},{"id":"7814a8d7fa6f20a8","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2633.6667404174805,"y":1042.999963760376,"wires":[["5c137719f2d54a5f"]]},{"id":"f1af67b3b1e435f7","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3328.066255569458,"y":884.6665878295898,"wires":[["a98d9ebc42d62eec"]]},{"id":"c73a4ee8a205d27e","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3328.066255569458,"y":1023.6666297912598,"wires":[["52b1d34c2e3ba582"]]},{"id":"937afdcfcec46b66","type":"link out","z":"dd3cb2217a01efae","name":"link out 4","mode":"link","links":["f62dba1845a5413b"],"x":2266.500039100647,"y":719,"wires":[]},{"id":"7df0d51e0e847014","type":"link out","z":"dd3cb2217a01efae","name":"link out 5","mode":"link","links":["f62dba1845a5413b"],"x":3012.750032901764,"y":719,"wires":[]},{"id":"0e91c3d74cd92cfa","type":"link out","z":"dd3cb2217a01efae","name":"link out 6","mode":"link","links":["f62dba1845a5413b"],"x":3759.000026702881,"y":719,"wires":[]},{"id":"19b1aec8a7ee5fb4","type":"link out","z":"dd3cb2217a01efae","name":"link out 7","mode":"link","links":["4931220e1f9c6ba4"],"x":1501.9998302459717,"y":1645.333339691162,"wires":[]},{"id":"b12e1e7a744dc4a7","type":"link out","z":"dd3cb2217a01efae","name":"link out 8","mode":"link","links":["4931220e1f9c6ba4"],"x":2268.666488647461,"y":1645.333339691162,"wires":[]},{"id":"9a25891944e269a6","type":"link out","z":"dd3cb2217a01efae","name":"link out 9","mode":"link","links":["4931220e1f9c6ba4"],"x":3801.9998054504395,"y":1645.333339691162,"wires":[]},{"id":"1677c8b63ba183c6","type":"link out","z":"dd3cb2217a01efae","name":"link out 10","mode":"link","links":["4931220e1f9c6ba4"],"x":3035.33314704895,"y":1645.333339691162,"wires":[]},{"id":"9194f31f4c6ec8d7","type":"template","z":"dd3cb2217a01efae","g":"5cb7812512e00b29","name":"basic docker deploy","field":"payload","fieldType":"msg","format":"yaml","syntax":"plain","template":"name: Push-Release-2022-01-To-Dockerhub\n\non:\n  push:\n    branches: [ release-2022-01 ]\n\n  workflow_dispatch:\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      -\n        name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v1\n      -\n        name: Login to DockerHub\n        uses: docker/login-action@v1\n        with:\n          username: ${{ secrets.DOCKERHUB_USER }}\n          password: ${{ secrets.DOCKERHUB_TOKEN }}\n      -\n        name: Build and push\n        id: docker_build\n        uses: docker/build-push-action@v2\n        with:\n          context: .\n          file: Dockerfile.hub\n          push: true\n          tags: gorenje/sysmlv2-jupyter:2022-01\n      -\n        name: Image digest\n        run: echo ${{ steps.docker_build.outputs.digest }}","output":"str","x":1257,"y":885,"wires":[["3d369886a648cdee"]]},{"id":"3d369886a648cdee","type":"link out","z":"dd3cb2217a01efae","name":"link out 3","mode":"link","links":["f62dba1845a5413b"],"x":1520.25004529953,"y":719,"wires":[]},{"id":"e949067515c6a52f","type":"template","z":"dd3cb2217a01efae","g":"d89467b659e375fe","name":"two jobs with steps","field":"payload","fieldType":"msg","format":"handlebars","syntax":"plain","template":"name: test-setup-melange\n\non:\n  pull_request:\n\njobs:\n  test-setup-melange:\n    runs-on: ubuntu-latest\n    permissions: {}\n    steps:\n    - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n\n    - id: changed-melange\n      uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d # v40.1.1\n      with:\n        files: |\n          ./setup-melange/**\n          ./melange-build/**\n          ./melange-build-pkg/**\n          ./melange-keygen/**\n          .github/workflows/test-setup-melange.yaml\n\n    - uses: ./setup-melange\n      if: steps.changed-melange.outputs.any_changed == 'true'\n\n    - if: steps.changed-melange.outputs.any_changed == 'true'\n      run: |\n        melange build setup-melange/example/melange.yaml --arch=x86_64\n        ls -R packages/\n\n  # This should do the same thing.\n  test-melange-build:\n    runs-on: ubuntu-latest\n    permissions: {}\n    steps:\n      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n\n      - id: changed-melange\n        uses: tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d # v40.1.1\n        with:\n          files: |\n            ./setup-melange/**\n            .github/workflows/test-setup-melange.yaml\n\n      - uses: ./melange-build\n        if: steps.changed-melange.outputs.any_changed == 'true'\n        with:\n          config: setup-melange/example/melange.yaml\n          archs: x86_64\n          sign-with-temporary-key: true","output":"str","x":4184,"y":877.5,"wires":[["0b852f0a873c72ab"]]},{"id":"0b852f0a873c72ab","type":"link out","z":"dd3cb2217a01efae","name":"link out 11","mode":"link","links":["f62dba1845a5413b"],"x":4515,"y":719,"wires":[]},{"id":"71c6908890e8794f","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3975.999786376953,"y":876.8332586288452,"wires":[["e949067515c6a52f"]]},{"id":"629fbb2da80f70df","type":"inject","z":"dd3cb2217a01efae","name":"trigger","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3968.666748046875,"y":1031.1664428710938,"wires":[["ad1b7d091692ab12"]]},{"id":"fa03a8cd7efa9752","type":"link out","z":"dd3cb2217a01efae","name":"link out 12","mode":"link","links":["4931220e1f9c6ba4"],"x":4488.666463851929,"y":1645.333339691162,"wires":[]},{"id":"d83f6dc78fba87a2","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Publish Release","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Publish Release","tot":"str"},{"t":"set","p":"payload.env","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.env.ACTIONS_ALLOW_UNSECURE_COMMANDS","pt":"msg","to":"true","tot":"json"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"release\": {\n    \"types\": [\n      \"published\"\n    ]\n  }\n}","tot":"json"},{"t":"set","p":"payload.permissions","pt":"msg","to":"{\n  \"contents\": \"read\"\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":423,"y":961.166748046875,"wires":[["224353b86811f3af"]]},{"id":"224353b86811f3af","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Job: generate","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"generate","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].name","pt":"msg","to":"Update node-red-docker image","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":453,"y":1009.166748046875,"wires":[["d56e5f124c57d131"]]},{"id":"d56e5f124c57d131","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Check out node-red repository","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check out node-red repository","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":1061.1666870117188,"wires":[["0e2c08826ec93d2d"]]},{"id":"0e2c08826ec93d2d","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Check out node-red-docker repository","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check out node-red-docker repository","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.repository","pt":"msg","to":"\"node-red/node-red-docker\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red-docker\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1110.5952671595983,"wires":[["15510c40dee3fab6"]]},{"id":"15510c40dee3fab6","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Check out node-red.github.io repository","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check out node-red.github.io repository","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.repository","pt":"msg","to":"\"node-red/node-red.github.io\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red.github.io\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1160.0238473074778,"wires":[["91cdc9b3c0808e9b"]]},{"id":"91cdc9b3c0808e9b","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/setup-node@v4\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with[\"node-version\"]","pt":"msg","to":"\"16\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1209.4524274553573,"wires":[["e4c7fdbc611096ad"]]},{"id":"e4c7fdbc611096ad","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"node ./node-red/.github/scripts/update-node-red-docker.js\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1258.8810076032369,"wires":[["1cdd6978bc9a1813"]]},{"id":"1cdd6978bc9a1813","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Create Docker Pull Request","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Create Docker Pull Request","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"peter-evans/create-pull-request@v5\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.token","pt":"msg","to":"\"${{ secrets.NR_REPO_TOKEN }}\"","tot":"json"},{"t":"set","p":"step.with.committer","pt":"msg","to":"\"GitHub <noreply@github.com>\"","tot":"json"},{"t":"set","p":"step.with.author","pt":"msg","to":"\"${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red-docker\"","tot":"json"},{"t":"set","p":"step.with[\"commit-message\"]","pt":"msg","to":"\"Bump to ${{ env.newVersion }}\"","tot":"json"},{"t":"set","p":"step.with.title","pt":"msg","to":"\"ðŸš€ Update to Node-RED ${{ env.newVersion }} release\"","tot":"json"},{"t":"set","p":"step.with.body","pt":"msg","to":"\"Updates the Node-RED Docker repo for the ${{ env.newVersion }} release.\\n\\nOnce this is merged, you will need to create a new release with the tag `v${{ env.newVersion }}`.\\n\\nThis PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1308.3095877511164,"wires":[["7a8e4a46ac03c9d7"]]},{"id":"7a8e4a46ac03c9d7","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"node ./node-red/.github/scripts/update-node-red-website.js\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1357.738167898996,"wires":[["1b13e8698b1539f4"]]},{"id":"1b13e8698b1539f4","type":"change","z":"dd3cb2217a01efae","g":"fd9dafd09c273f3a","name":"Step: Create Website Pull Request","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Create Website Pull Request","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"peter-evans/create-pull-request@v5\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.token","pt":"msg","to":"\"${{ secrets.NR_REPO_TOKEN }}\"","tot":"json"},{"t":"set","p":"step.with.committer","pt":"msg","to":"\"GitHub <noreply@github.com>\"","tot":"json"},{"t":"set","p":"step.with.author","pt":"msg","to":"\"${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>\"","tot":"json"},{"t":"set","p":"step.with.path","pt":"msg","to":"\"node-red.github.io\"","tot":"json"},{"t":"set","p":"step.with[\"commit-message\"]","pt":"msg","to":"\"Bump to ${{ env.newVersion }}\"","tot":"json"},{"t":"set","p":"step.with.title","pt":"msg","to":"\"ðŸš€ Update to Node-RED ${{ env.newVersion }} release\"","tot":"json"},{"t":"set","p":"step.with.body","pt":"msg","to":"\"Updates the Node-RED Website repo for the ${{ env.newVersion }} release.\\n\\nThis PR was auto-generated by a GitHub Action. Any questions, speak to @knolleary\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1407.166748046875,"wires":[["8900bd0aef26f5a8"]]},{"id":"20031350ec8b64ad","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Push-Release-2022-01-To-Dockerhub","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Push-Release-2022-01-To-Dockerhub","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"push\": {\n    \"branches\": [\n      \"release-2022-01\"\n    ]\n  },\n  \"workflow_dispatch\": null\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1328,"y":1025.699951171875,"wires":[["2c2862273c7bee7e"]]},{"id":"2c2862273c7bee7e","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Job: build","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"build","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1277,"y":1079.6998901367188,"wires":[["60455d61ffbf42ad"]]},{"id":"60455d61ffbf42ad","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v2\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1321,"y":1128.6998901367188,"wires":[["9543d8ce2b4991ac"]]},{"id":"9543d8ce2b4991ac","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Set up Docker Buildx","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Set up Docker Buildx","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"docker/setup-buildx-action@v1\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1361,"y":1176.9498901367188,"wires":[["1a605680c1eb622f"]]},{"id":"1a605680c1eb622f","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Login to DockerHub","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Login to DockerHub","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"docker/login-action@v1\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.username","pt":"msg","to":"\"${{ secrets.DOCKERHUB_USER }}\"","tot":"json"},{"t":"set","p":"step.with.password","pt":"msg","to":"\"${{ secrets.DOCKERHUB_TOKEN }}\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1351,"y":1225.1998901367188,"wires":[["c82a0f16f236e4f2"]]},{"id":"c82a0f16f236e4f2","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Build and push","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Build and push","tot":"str"},{"t":"set","p":"step.id","pt":"msg","to":"\"docker_build\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"docker/build-push-action@v2\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.context","pt":"msg","to":"\".\"","tot":"json"},{"t":"set","p":"step.with.file","pt":"msg","to":"\"Dockerfile.hub\"","tot":"json"},{"t":"set","p":"step.with.push","pt":"msg","to":"true","tot":"json"},{"t":"set","p":"step.with.tags","pt":"msg","to":"\"gorenje/sysmlv2-jupyter:2022-01\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1341,"y":1273.4498901367188,"wires":[["44564467ca5ed4cd"]]},{"id":"44564467ca5ed4cd","type":"change","z":"dd3cb2217a01efae","g":"acd63cc5a2f4f35b","name":"Step: Image digest","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Image digest","tot":"str"},{"t":"set","p":"step.run","pt":"msg","to":"\"echo ${{ steps.docker_build.outputs.digest }}\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1331,"y":1321.6998901367188,"wires":[["19b1aec8a7ee5fb4"]]},{"id":"59cbf9b2a5a363d8","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Sync workflows for GHES","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Sync workflows for GHES","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"push\": {\n    \"branches\": [\n      \"main\"\n    ]\n  }\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2067,"y":993.699951171875,"wires":[["ac22622d29b6256b"]]},{"id":"ac22622d29b6256b","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Job: sync","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"sync","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].permissions","pt":"msg","to":"{\n  \"contents\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2064,"y":1041.6998901367188,"wires":[["b8be98a26531273b"]]},{"id":"b8be98a26531273b","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v3\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2122,"y":1089.6998901367188,"wires":[["012b42983946ac82"]]},{"id":"012b42983946ac82","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"git fetch --no-tags --prune --depth=1 origin +refs/heads/*:refs/remotes/origin/*\\ngit config user.email \\\"cschleiden@github.com\\\"\\ngit config user.name \\\"GitHub Actions\\\"\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2122,"y":1137.4998901367187,"wires":[["ce68f35f8ac1ded2"]]},{"id":"ce68f35f8ac1ded2","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/setup-node@v3\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with[\"node-version\"]","pt":"msg","to":"\"16\"","tot":"json"},{"t":"set","p":"step.with.cache","pt":"msg","to":"\"npm\"","tot":"json"},{"t":"set","p":"step.with[\"cache-dependency-path\"]","pt":"msg","to":"\"script/sync-ghes/package-lock.json\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2122,"y":1185.2998901367187,"wires":[["36243d805526a0d9"]]},{"id":"36243d805526a0d9","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Check starter workflows for GHES compat","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Check starter workflows for GHES compat","tot":"str"},{"t":"set","p":"step.run","pt":"msg","to":"\"npm ci\\nnpx ts-node-script ./index.ts\\n\"","tot":"json"},{"t":"set","p":"step[\"working-directory\"]","pt":"msg","to":"\"./script/sync-ghes\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2222,"y":1233.0998901367186,"wires":[["7cf971aea02d571e"]]},{"id":"7cf971aea02d571e","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"git add -A\\nif [ -z \\\"$(git status --porcelain)\\\" ]; then\\n  echo \\\"No changes to commit\\\"\\nelse\\n  git commit -m \\\"Updating GHES workflows\\\"\\nfi\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2122,"y":1280.8998901367186,"wires":[["d24fc201ce3f7aea"]]},{"id":"d24fc201ce3f7aea","type":"change","z":"dd3cb2217a01efae","g":"ad6d69d2f9a25b95","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"git push\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2122,"y":1328.6998901367188,"wires":[["b12e1e7a744dc4a7"]]},{"id":"5c137719f2d54a5f","type":"change","z":"dd3cb2217a01efae","g":"a295b1018fc0fbbf","name":"Mark stale issues and pull requests","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Mark stale issues and pull requests","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"schedule\": [\n    {\n      \"cron\": \"21 4 * * *\"\n    }\n  ]\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2921,"y":1042.6998901367188,"wires":[["f48110aa55f316b5"]]},{"id":"f48110aa55f316b5","type":"change","z":"dd3cb2217a01efae","g":"a295b1018fc0fbbf","name":"Job: stale","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"stale","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].permissions","pt":"msg","to":"{\n  \"issues\": \"write\",\n  \"pull-requests\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2877,"y":1089.6998901367188,"wires":[["ecbcd74504621fc5"]]},{"id":"ecbcd74504621fc5","type":"change","z":"dd3cb2217a01efae","g":"a295b1018fc0fbbf","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/stale@v8\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with[\"stale-issue-message\"]","pt":"msg","to":"\"This issue has become stale and will be closed automatically within a period of time. Sorry about that.\"","tot":"json"},{"t":"set","p":"step.with[\"stale-pr-message\"]","pt":"msg","to":"\"This pull request has become stale and will be closed automatically within a period of time. Sorry about that.\"","tot":"json"},{"t":"set","p":"step.with[\"stale-issue-label\"]","pt":"msg","to":"\"no-issue-activity\"","tot":"json"},{"t":"set","p":"step.with[\"stale-pr-label\"]","pt":"msg","to":"\"no-pr-activity\"","tot":"json"},{"t":"set","p":"step.with[\"days-before-stale\"]","pt":"msg","to":"90","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2961,"y":1144.6998901367188,"wires":[["1677c8b63ba183c6"]]},{"id":"52b1d34c2e3ba582","type":"change","z":"dd3cb2217a01efae","g":"0e61baef025de7fe","name":"Close as a support issue","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Close as a support issue","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"issues\": {\n    \"types\": [\n      \"labeled\"\n    ]\n  }\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3585,"y":1023.699951171875,"wires":[["6e84a0f364ce6645"]]},{"id":"6e84a0f364ce6645","type":"change","z":"dd3cb2217a01efae","g":"0e61baef025de7fe","name":"Job: build","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"build","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].permissions","pt":"msg","to":"{\n  \"issues\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3582,"y":1074.6998901367188,"wires":[["2bd2f37835657e93"]]},{"id":"2bd2f37835657e93","type":"change","z":"dd3cb2217a01efae","g":"0e61baef025de7fe","name":"Step: Close Issue","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Close Issue","tot":"str"},{"t":"set","p":"step.if","pt":"msg","to":"\"contains(github.event.issue.labels.*.name, 'support')\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"peter-evans/close-issue@v3\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.comment","pt":"msg","to":"\"Sorry, but we'd like to keep issues related to code in this repository. Thank you ðŸ™‡ \\n\\nIf you have questions about writing workflows or action files, then please [visit the GitHub Community Forum's Actions Board](https://github.community/t5/GitHub-Actions/bd-p/actions)\\n\\nIf you are having an issue or question about GitHub Actions then please [contact customer support](https://help.github.com/en/articles/about-github-actions#contacting-support)\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3643,"y":1123.6998901367188,"wires":[["9a25891944e269a6"]]},{"id":"ad1b7d091692ab12","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"test-setup-melange","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"test-setup-melange","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"pull_request\": null\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4182,"y":1031.6998901367188,"wires":[["493ef5952f6f7b3f"]]},{"id":"493ef5952f6f7b3f","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Job: test-setup-melange","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"test-setup-melange","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].permissions","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4248,"y":1082.6998901367188,"wires":[["053405fdb6726a41"]]},{"id":"053405fdb6726a41","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4258,"y":1131.6998901367188,"wires":[["abc569157eb7b9a2"]]},{"id":"abc569157eb7b9a2","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: changed-melange","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.id","pt":"msg","to":"\"changed-melange\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.files","pt":"msg","to":"\"./setup-melange/**\\n./melange-build/**\\n./melange-build-pkg/**\\n./melange-keygen/**\\n.github/workflows/test-setup-melange.yaml\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4288,"y":1183.3665771484375,"wires":[["a015ca0367d5a815"]]},{"id":"a015ca0367d5a815","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.if","pt":"msg","to":"\"steps.changed-melange.outputs.any_changed == 'true'\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"./setup-melange\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4258,"y":1235.0332641601562,"wires":[["2f9c29a0dd6718c7"]]},{"id":"2f9c29a0dd6718c7","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Run Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.if","pt":"msg","to":"\"steps.changed-melange.outputs.any_changed == 'true'\"","tot":"json"},{"t":"set","p":"step.run","pt":"msg","to":"\"melange build setup-melange/example/melange.yaml --arch=x86_64\\nls -R packages/\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4258,"y":1286.699951171875,"wires":[["1ed70f9cc4678db1"]]},{"id":"1ed70f9cc4678db1","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Job: test-melange-build","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"test-melange-build","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].permissions","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4238,"y":1336.699951171875,"wires":[["78721ce601bb0f8a"]]},{"id":"78721ce601bb0f8a","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4256,"y":1388.6998901367188,"wires":[["7aad32d4cfb9fe68"]]},{"id":"7aad32d4cfb9fe68","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: changed-melange","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.id","pt":"msg","to":"\"changed-melange\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"tj-actions/changed-files@25ef3926d147cd02fc7e931c1ef50772bbb0d25d\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.files","pt":"msg","to":"\"./setup-melange/**\\n.github/workflows/test-setup-melange.yaml\\n\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4286,"y":1442.6999206542969,"wires":[["9aea71abc4b5751a"]]},{"id":"9aea71abc4b5751a","type":"change","z":"dd3cb2217a01efae","g":"9ad2a872d1bc67d5","name":"Step: Uses Only","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.if","pt":"msg","to":"\"steps.changed-melange.outputs.any_changed == 'true'\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"./melange-build\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.config","pt":"msg","to":"\"setup-melange/example/melange.yaml\"","tot":"json"},{"t":"set","p":"step.with.archs","pt":"msg","to":"\"x86_64\"","tot":"json"},{"t":"set","p":"step.with[\"sign-with-temporary-key\"]","pt":"msg","to":"true","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4256,"y":1496.699951171875,"wires":[["fa03a8cd7efa9752"]]},{"id":"59e71e95c97037a1","type":"http request","z":"dd3cb2217a01efae","g":"8c75517fade9020d","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://raw.githubusercontent.com/gorenje/flows.flowhub.org/main/.github/workflows/jekyll-gh-pages.yml","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1816.174633026123,"y":2816.7138500213623,"wires":[["f2ac359448a147a5"]]},{"id":"11dcd558d0fa1eec","type":"inject","z":"dd3cb2217a01efae","g":"8c75517fade9020d","name":"import existing actions","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1690.6192220052083,"y":2737.825222439236,"wires":[["59e71e95c97037a1"]]},{"id":"f2ac359448a147a5","type":"link out","z":"dd3cb2217a01efae","g":"8c75517fade9020d","name":"link out 13","mode":"link","links":["f62dba1845a5413b"],"x":1955.063772201538,"y":2908.936143875122,"wires":[]},{"id":"9d25b80dc1c06a91","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Deploy Jekyll with GitHub Pages dependencies preinstalled","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.name","pt":"msg","to":"Deploy Jekyll with GitHub Pages dependencies preinstalled","tot":"str"},{"t":"set","p":"payload.on","pt":"msg","to":"{\n  \"push\": {\n    \"paths\": [\n      \"README.md\",\n      \"sitemap.xml\",\n      \"feed.xml\"\n    ]\n  },\n  \"workflow_dispatch\": null\n}","tot":"json"},{"t":"set","p":"payload.permissions","pt":"msg","to":"{\n  \"contents\": \"read\",\n  \"pages\": \"write\",\n  \"id-token\": \"write\"\n}","tot":"json"},{"t":"set","p":"payload.jobs","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.concurrency","pt":"msg","to":"{\n  \"group\": \"pages\",\n  \"cancel-in-progress\": false\n}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2669.841564178467,"y":2615.714262008667,"wires":[["27e8d7539969d23a"]]},{"id":"27e8d7539969d23a","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Job: build","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"build","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2645.3970108032227,"y":2665.7142391204834,"wires":[["a11d72a71841545b"]]},{"id":"a11d72a71841545b","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Step: Checkout","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Checkout","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/checkout@v3\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2755.3969802856445,"y":2706.825263977051,"wires":[["4711a6a05e7d7d91"]]},{"id":"4711a6a05e7d7d91","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Step: Setup Pages","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Setup Pages","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/configure-pages@v3\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2765.3969802856445,"y":2759.7882455190024,"wires":[["d9c2f96746a08193"]]},{"id":"d9c2f96746a08193","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Step: Build with Jekyll","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Build with Jekyll","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/jekyll-build-pages@v1\"","tot":"json"},{"t":"set","p":"step.with","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.with.source","pt":"msg","to":"\"./\"","tot":"json"},{"t":"set","p":"step.with.destination","pt":"msg","to":"\"./_site\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2775.3969802856445,"y":2812.751227060954,"wires":[["255c4b3b4de2969f"]]},{"id":"255c4b3b4de2969f","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Step: Upload artifact","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Upload artifact","tot":"str"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/upload-pages-artifact@v2\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2775.3969802856445,"y":2865.7142086029053,"wires":[["7456d21afae97b8d"]]},{"id":"7456d21afae97b8d","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Job: deploy","rules":[{"t":"set","p":"jobkey","pt":"msg","to":"deploy","tot":"str"},{"t":"set","p":"payload.jobs[msg.jobkey]","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey][\"runs-on\"]","pt":"msg","to":"\"ubuntu-latest\"","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].steps","pt":"msg","to":"[]","tot":"json"},{"t":"set","p":"job","pt":"msg","to":"payload.jobs[msg.jobkey]","tot":"msg"},{"t":"set","p":"payload.jobs[msg.jobkey].environment","pt":"msg","to":"{\n  \"name\": \"github-pages\",\n  \"url\": \"${{ steps.deployment.outputs.page_url }}\"\n}","tot":"json"},{"t":"set","p":"payload.jobs[msg.jobkey].needs","pt":"msg","to":"\"build\"","tot":"json"},{"t":"delete","p":"jobkey","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2657.619094848633,"y":2906.8252906799316,"wires":[["30e2a2476e6428a3"]]},{"id":"30e2a2476e6428a3","type":"change","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Step: Deploy to GitHub Pages","rules":[{"t":"set","p":"step","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"step.name","pt":"msg","to":"Deploy to GitHub Pages","tot":"str"},{"t":"set","p":"step.id","pt":"msg","to":"\"deployment\"","tot":"json"},{"t":"set","p":"step.uses","pt":"msg","to":"\"actions/deploy-pages@v2\"","tot":"json"},{"t":"set","p":"job.steps","pt":"msg","to":"$append( $$.job.steps, [$$.step])","tot":"jsonata"},{"t":"delete","p":"step","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2792.063705444336,"y":2955.7142028808594,"wires":[["b0cc639589b7f053"]]},{"id":"9146a0bb592d8731","type":"FlowHubPull","z":"dd3cb2217a01efae","g":"3521d8d9a9555a79","name":"","notab":false,"flowid":"31ea3193ec1a2117","flowname":"[GitHub] commit single file","flowrevision":"","x":1693.0634078979492,"y":2645.1432914733887,"wires":[[]]},{"id":"05d238461a15a7e7","type":"inject","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"Commit to GitHub","props":[{"p":"github","v":"{\"repo\":\"flows.flowhub.org\",\"branch\":\"main\",\"owner\":\"gorenje\",\"author\":{\"name\":\"Gerrit Riessen\",\"email\":\"gerrit@openmindmap.org\"},\"message\":\"update workflow file\",\"filename\":\".github/workflows/jekyll-gh-pages.yml\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2285.841552734375,"y":2790.714111328125,"wires":[["9d25b80dc1c06a91"]]},{"id":"b0cc639589b7f053","type":"yaml","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","property":"payload","name":"","x":3045.952392578125,"y":2907.047119140625,"wires":[["a70f2698627249f7"]]},{"id":"5f536d475427f84f","type":"debug","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"debug 99","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3496.508056640625,"y":2681.9365234375,"wires":[]},{"id":"a70f2698627249f7","type":"link call","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"","links":["46ab795f34a06748"],"linkType":"static","timeout":"30","x":3275.28564453125,"y":2801.8251953125,"wires":[["5f536d475427f84f"]]},{"id":"9bc6d29f39f2c888","type":"comment","z":"dd3cb2217a01efae","g":"10d37b5abae15a75","name":"GITHUB_TOKEN must have workflow permission","info":"For this to work, the GITHUB_TOKEN requires `workflow` permission.","x":3324.285690307617,"y":2944.2857780456543,"wires":[]}]