[{"id":"a8d90fc15ab6990b","type":"tab","label":"[HN] Readers Personal Blogs","disabled":false,"info":"::: aim\n\nCreate an [OPML](https://en.wikipedia.org/wiki/OPML) feed with all Hacker News readers that post their blog sites on a post page.\n\n:::\n\n::: palette\n\n- [node-red-contrib-cron-plus](https://flows.nodered.org/node/node-red-contrib-cron-plus)\n\n:::\n\n\n### Inspiration\n\nTransform the [\"Show HN: your personal blog\"](https://news.ycombinator.com/item?id=36575081) story into an OPML/RSS feed.\n\n\nInspiration: https://github.com/outcoldman/hackernews-personal-blogs --> [Original Post](https://news.ycombinator.com/item?id=36627112)\n\n\nXML Feed *no longer* available here --> https://blog.openmindmap.org/example/hacker-news-personal-blog-feed.xml\n\n### Rules\n\nThe addition of peoples blogs to this feed is restricted by a number of rules:\n\n- their website needs to respond within 5 seconds\n- their must have an RSS feed defined in their website\n- they must have a HN karma point score above 100 \n\nThese rules are partly encapsulated in this <a class=\"ahl-node-only\" data-ids=\"3aa825d8713d5b93\">function node</a>.\n\n### Discussion\n\nThis flow creates a cache using the `flow` context to store the cache. In creating the cache, a number of difficults were encountered. \n\nThese related to the <a class=\"ahl-node-only\" data-ids=\"875eec8d79909bc9,ec6fb2840f3ff8e2,062194be0b38cb72\">join nodes</a> having a timeout which meant that the cache would be overwritten as these returned new data. Hence an <a class=\"ahl-node-only\" data-ids=\"68b6e26bfac26acc\">extra gateway</a> was installed before the cache was written.\n\nAlso since the cache was updated or created upon the first request (or any request there after), care had to be taken that during the retrieval (creation) of the cache, no second process was kicked in that would do the same. So a <a class=\"ahl-node-only\" data-ids=\"54c28a499aeec29f\">gateway</a> was created for that.\n\nThe <a class=\"ahl-group-only\" data-ids=\"a62858d06bca713d\">third gateway</a> was built for checking whether the refilling of the cache might have failed. If so, the refilling had to be restarted.\n\nAll-in-all, this flow was more challenging than at first site, especially since much external data is being requested. Initially each external request did not have a timeout .. this soon lead to pain. Instead each HTTP request is given a timeout of 5 seconds, this is set in the <a class=\"ahl-node-only\" data-ids=\"105c6e4c8d39240e,961c2f640d6045ab,ca6474139d68b206,d0f5a890cf420104,3aa825d8713d5b93,d034be7e79e0cc6f\">function nodes</a> which prepare the requests.","env":[]},{"id":"886031a58d3a6d21","type":"group","z":"a8d90fc15ab6990b","name":"opml styling for nicer viewing in the browser - Code taken from https://github.com/dpobel/opml-utils ","style":{"label":true},"nodes":["b85fd2ee56d68932","3d24094904df7b06","c03e12c46faac9dd","2e1bda7bc5f79cbf","569712238952db5c"],"x":1509.25,"y":48.5,"w":780,"h":171,"info":"Code taken from https://github.com/dpobel/opml-utils \n\n"},{"id":"20b5eb42e3123703","type":"group","z":"a8d90fc15ab6990b","name":"request comes in for opml feed","style":{"label":true},"nodes":["fdbfaffd15ce80b4","9b61d5da7ecb7cb5","e0ccf685f70bf27b","2a72348bfc25487e","847f74e1fe49f6a5","a51ef4f928f53df1"],"x":297,"y":70,"w":1195,"h":149},{"id":"196577ea25fa51c6","type":"group","z":"a8d90fc15ab6990b","name":"hard lifting - get the content","style":{"label":true},"nodes":["2cb49db8bdc82ef3","105c6e4c8d39240e","c5d6edf245737643","ca6474139d68b206","875eec8d79909bc9","961c2f640d6045ab","44258c02bf96281a","d0f5a890cf420104","ec6fb2840f3ff8e2","3aa825d8713d5b93","c7bb3e218e6e39f7","13af21259f0efa3f","d034be7e79e0cc6f","062194be0b38cb72","3879381e369d0d3d","0af1c7ea67b17d0b","4058ca62bce8af23","6ee8287123ec3be5"],"x":1732.75,"y":753,"w":426,"h":1139},{"id":"4d5db783070e3d7a","type":"group","z":"a8d90fc15ab6990b","name":"create the content","style":{"label":true},"nodes":["b56339980d8e1163","8d4673edf73ad005","947cc2496f556a55"],"x":2619,"y":1811.5,"w":615.5,"h":165.75},{"id":"80a36485df7f7b0e","type":"group","z":"a8d90fc15ab6990b","name":"update cache with new stuff","style":{"label":true},"nodes":["e941b45ca9c66e4b","edb7cbbbbe8e77c6","54c28a499aeec29f","fa763d5f6130b9ca","a62858d06bca713d"],"x":349,"y":379,"w":1186,"h":482},{"id":"a62858d06bca713d","type":"group","z":"a8d90fc15ab6990b","g":"80a36485df7f7b0e","name":"has rendered for longer than ... mins?","style":{"label":true},"nodes":["a0558217726aa24d","50e92d0ce89b38e1","e410de8f0db803f9"],"x":1081,"y":405,"w":242,"h":197},{"id":"6945ee232a1633c2","type":"group","z":"a8d90fc15ab6990b","name":"Start Here","style":{"label":true},"nodes":["c7038f9df491a2f8"],"x":66,"y":131,"w":82,"h":82},{"id":"2cb49db8bdc82ef3","type":"http request","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"retrieve original post data","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://hacker-news.firebaseio.com/v0/item/36575081.json","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1921.75,"y":820,"wires":[["105c6e4c8d39240e"]]},{"id":"e941b45ca9c66e4b","type":"inject","z":"a8d90fc15ab6990b","g":"80a36485df7f7b0e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":455,"y":452,"wires":[["54c28a499aeec29f"]]},{"id":"105c6e4c8d39240e","type":"function","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"split `kids` into separate messages","func":"var totalItems = msg.payload.kids.length;\n\nvar grpId = RED.util.generateId();\n\nfor (var idx = 0; idx < totalItems; idx++ ) {\n    var commentId = msg.payload.kids[idx];\n\n    node.send({\n        parts: {\n            id:    grpId,\n            count: totalItems,\n            index: idx,\n            key:   commentId,\n            type:  \"array\"\n        },\n        url: \"https://hacker-news.firebaseio.com/v0/item/\"+commentId+\".json\",\n        requestTimeout: 5000,\n        commentId: commentId,\n        payload: {}\n    });    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1936.75,"y":894,"wires":[["c5d6edf245737643"]]},{"id":"c5d6edf245737643","type":"http request","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"retrieve individual comments","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1932.75,"y":967,"wires":[["961c2f640d6045ab"]]},{"id":"ca6474139d68b206","type":"function","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"prefilter for comments looking for links","func":"msg.payload = msg.payload.map( function(cmt){\n    cmt.origText = cheerio.load(cmt.text || \"\").html()\n    delete cmt.text;\n    return cmt;\n}).map(function(cmt){\n    cmt.blogUrl = (( \n        cmt.origText.match(/href='([^ ']+)'/) || cmt.origText.match(/href=\"([^ \"]+)\"/)\n    ) || [])[1];\n    delete cmt.origText;\n    return cmt\n}).filter( function(c) { return !!c.blogUrl });\n\nvar totalItems = msg.payload.length;\nvar grpId = RED.util.generateId();\n\nfor (var idx = 0; idx < totalItems; idx++) {\n    var userCmt = msg.payload[idx];\n\n    node.send({\n        parts: {\n            id: grpId,\n            count: totalItems,\n            index: idx,\n            key: userCmt.commentId,\n            type: \"array\"\n        },\n        url: \"https://hacker-news.firebaseio.com/v0/user/\"+userCmt.by+\".json\",\n        requestTimeout: 5000,\n        userComment: userCmt,\n        payload: {}\n    });\n}\n\n//return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"cheerio","module":"cheerio"}],"x":1930.75,"y":1205,"wires":[["44258c02bf96281a"]]},{"id":"875eec8d79909bc9","type":"join","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"20","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1920.75,"y":1136,"wires":[["ca6474139d68b206"]]},{"id":"961c2f640d6045ab","type":"function","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"add commentId to the payload","func":"msg.payload = {\n    ...msg.payload || {},\n    commentId: msg.commentId\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1930.75,"y":1051,"wires":[["875eec8d79909bc9"]]},{"id":"44258c02bf96281a","type":"http request","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"retrieve user karma points","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1928.75,"y":1275,"wires":[["d0f5a890cf420104"]]},{"id":"d0f5a890cf420104","type":"function","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"combine karma with userComment","func":"msg.payload = {\n    ...msg.userComment,\n    karma: (msg.payload && msg.payload.karma) || 0,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1934.75,"y":1354,"wires":[["ec6fb2840f3ff8e2"]]},{"id":"ec6fb2840f3ff8e2","type":"join","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"30","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1922.75,"y":1427,"wires":[["3aa825d8713d5b93"]]},{"id":"3aa825d8713d5b93","type":"function","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"filter by karma < 100 & requestTimeout > 5000","func":"msg.payload = msg.payload.filter(function (cmt) {\n    return cmt.karma > 100\n});\n\nvar totalItems = msg.payload.length;\nvar grpId = RED.util.generateId();\n\nfor (var idx = 0; idx < totalItems; idx++) {\n    var userCmt = msg.payload[idx];\n\n    node.send({\n        parts: {\n            id: grpId,\n            count: totalItems,\n            index: idx,\n            key: userCmt.commentId,\n            type: \"array\"\n        },\n        userComment: { ...userCmt },\n        payload: {},\n        url: userCmt.blogUrl,\n        requestTimeout: 5000,\n    });\n}\n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1946.75,"y":1534,"wires":[["c7bb3e218e6e39f7"]]},{"id":"c7bb3e218e6e39f7","type":"http request","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"retrieve rss+atom alternate from the blog page","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1938.75,"y":1626,"wires":[["13af21259f0efa3f"]]},{"id":"13af21259f0efa3f","type":"html","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"parse html and get all \"link\" tags","property":"payload","outproperty":"payload","tag":"link","ret":"attr","as":"single","x":1925.75,"y":1707,"wires":[["d034be7e79e0cc6f"]]},{"id":"d034be7e79e0cc6f","type":"function","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"combine links with userComment","func":"msg.payload = {\n    ...msg.userComment,\n    links: msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1932.75,"y":1778,"wires":[["062194be0b38cb72"]]},{"id":"062194be0b38cb72","type":"join","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"30","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1929.75,"y":1851,"wires":[["68b6e26bfac26acc"]]},{"id":"b56339980d8e1163","type":"function","z":"a8d90fc15ab6990b","g":"4d5db783070e3d7a","name":"retrieve rss/atom feed url from head, drop blogs w/ no rss feed","func":"\nmsg.payload = msg.payload.map(function (cmt) {\n    var links =  (cmt.links || []).map( function(lnk) {\n        if ( !lnk) { return undefined };\n\n        var mth = (lnk.type || \"\").match(/^application\\/((rss)|(atom))/);\n        if ( mth) {\n            return { \n                href: lnk.href, \n                type: mth[1], \n                elem: lnk\n            }\n        } else {\n            return undefined\n        }\n    }).filter( function(c) { return c });\n\n    cmt.rssLinks = links;\n    return cmt;\n}).filter( function (cmt) {\n    return cmt.rssLinks.length > 0;\n}).map( function(cmt){\n    var lnk = cmt.rssLinks[0];\n\n    if ( !lnk) {\n        return cmt;\n    }\n\n    if ( lnk.href.match(/^https?:/) ) {\n        cmt.rssUrl = lnk.href;\n        cmt.rssDetails = lnk;\n    } else {\n        cmt.rssUrl = cmt.blogUrl.replace(/\\/$/, '') + \"/\" + lnk.href.replace(/^\\//,'');\n        cmt.rssDetails = lnk;\n    }\n\n    return cmt;\n}).filter(function (cmt) {\n    return !!cmt.rssUrl;\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2877.5,"y":1852.5,"wires":[["8d4673edf73ad005"]]},{"id":"3879381e369d0d3d","type":"catch","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","scope":["c7bb3e218e6e39f7"],"uncaught":false,"x":2082.75,"y":1602,"wires":[["13af21259f0efa3f"]]},{"id":"8d4673edf73ad005","type":"template","z":"a8d90fc15ab6990b","g":"4d5db783070e3d7a","name":"opml content","field":"payload","fieldType":"msg","format":"text","syntax":"mustache","template":"{{#payload}}\n<outline type=\"rss\" title=\"{{ by }}\" text=\"{{ by }}\" xmlUrl=\"{{{ rssUrl }}}\" htmlUrl=\"{{{ blogUrl }}}\"/>\n{{/payload}}\n","output":"str","x":2715,"y":1936.25,"wires":[["947cc2496f556a55"]]},{"id":"947cc2496f556a55","type":"change","z":"a8d90fc15ab6990b","g":"4d5db783070e3d7a","name":"Cache Results","rules":[{"t":"set","p":"opmldata","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"isBeingRendered","pt":"flow","to":"false","tot":"bool"},{"t":"set","p":"lastUpdate","pt":"flow","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":3128.5,"y":1936.25,"wires":[[]]},{"id":"fdbfaffd15ce80b4","type":"change","z":"a8d90fc15ab6990b","g":"20b5eb42e3123703","name":"status 242: be patient, content being recreated","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"242","tot":"num"},{"t":"set","p":"payload","pt":"msg","to":"Content being rendered, please be patient.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":924,"y":178,"wires":[["847f74e1fe49f6a5"]]},{"id":"9b61d5da7ecb7cb5","type":"http response","z":"a8d90fc15ab6990b","g":"20b5eb42e3123703","name":"","statusCode":"","headers":{"content-type":"application/xml"},"x":1416,"y":111,"wires":[]},{"id":"e0ccf685f70bf27b","type":"switch","z":"a8d90fc15ab6990b","g":"20b5eb42e3123703","name":"do we have filled cache?","property":"opmldata","propertyType":"flow","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":433,"y":172,"wires":[["2a72348bfc25487e"],["fdbfaffd15ce80b4","54c28a499aeec29f"]]},{"id":"2a72348bfc25487e","type":"change","z":"a8d90fc15ab6990b","g":"20b5eb42e3123703","name":"status 200: here ya go!","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"200","tot":"num"},{"t":"set","p":"payload","pt":"msg","to":"opmldata","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":683,"y":112,"wires":[["a51ef4f928f53df1"]]},{"id":"edb7cbbbbe8e77c6","type":"change","z":"a8d90fc15ab6990b","g":"80a36485df7f7b0e","name":"","rules":[{"t":"set","p":"isBeingRendered","pt":"flow","to":"true","tot":"bool"},{"t":"set","p":"requestTimeout","pt":"msg","to":"5000","tot":"num"},{"t":"set","p":"renderStartedAt","pt":"flow","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":1429,"y":820,"wires":[["2cb49db8bdc82ef3"]]},{"id":"54c28a499aeec29f","type":"switch","z":"a8d90fc15ab6990b","g":"80a36485df7f7b0e","name":"isAlreadyBeingRendered?","property":"isBeingRendered","propertyType":"flow","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":766,"y":452,"wires":[["50e92d0ce89b38e1"],["edb7cbbbbe8e77c6"]]},{"id":"0af1c7ea67b17d0b","type":"catch","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","scope":["2cb49db8bdc82ef3"],"uncaught":false,"x":2015.75,"y":794,"wires":[["45e243d1c297c3e0"]]},{"id":"45e243d1c297c3e0","type":"change","z":"a8d90fc15ab6990b","name":"Exit stage left","rules":[{"t":"set","p":"isBeingRendered","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2499.75,"y":794,"wires":[[]]},{"id":"4058ca62bce8af23","type":"catch","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","scope":["c5d6edf245737643"],"uncaught":false,"x":2080.75,"y":947,"wires":[["961c2f640d6045ab"]]},{"id":"6ee8287123ec3be5","type":"catch","z":"a8d90fc15ab6990b","g":"196577ea25fa51c6","name":"","scope":["44258c02bf96281a"],"uncaught":false,"x":2061.75,"y":1259,"wires":[["d0f5a890cf420104"]]},{"id":"b85fd2ee56d68932","type":"http in","z":"a8d90fc15ab6990b","g":"886031a58d3a6d21","name":"","url":"/f/opml/style.xsl","method":"get","upload":false,"swaggerDoc":"","x":1635.25,"y":89.5,"wires":[["3d24094904df7b06"]]},{"id":"3d24094904df7b06","type":"template","z":"a8d90fc15ab6990b","g":"886031a58d3a6d21","name":"style.xsl","field":"payload","fieldType":"msg","format":"html","syntax":"plain","template":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n     <xsl:import href=\"import/html.xsl\" />\n     <xsl:output method = \"html\" version = \"4.0\" encoding=\"ISO-8859-1\" indent = \"no\" />\n     <xsl:template match=\"title\">\n         <title><xsl:value-of select=\".\" /></title>\n     </xsl:template>\n\n     <xsl:template match=\"body\">\n         <body>\n             <xsl:apply-templates select=\"outline\">\n                 <xsl:sort select=\"@title\" />\n             </xsl:apply-templates>\n         </body>\n     </xsl:template>\n\n     <xsl:template match=\"opml\">\n         <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\">\n             <head>\n                 <meta charset=\"utf-8\" />\n                 <xsl:apply-templates select=\"head/title\" />\n             </head>\n             <xsl:apply-templates select=\"body\" />\n        </html>\n     </xsl:template>\n\n </xsl:stylesheet>","output":"str","x":1939.25,"y":127.5,"wires":[["c03e12c46faac9dd"]]},{"id":"c03e12c46faac9dd","type":"http response","z":"a8d90fc15ab6990b","g":"886031a58d3a6d21","name":"xml","statusCode":"200","headers":{"content-type":"application/xml"},"x":2213.25,"y":93.5,"wires":[]},{"id":"2e1bda7bc5f79cbf","type":"http in","z":"a8d90fc15ab6990b","g":"886031a58d3a6d21","name":"","url":"/f/opml/import/html.xsl","method":"get","upload":false,"swaggerDoc":"","x":1655.25,"y":178.5,"wires":[["569712238952db5c"]]},{"id":"569712238952db5c","type":"template","z":"a8d90fc15ab6990b","g":"886031a58d3a6d21","name":"home.xsl","field":"payload","fieldType":"msg","format":"handlebars","syntax":"plain","template":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n     <xsl:template match=\"outline[not(@type='rss')]\">\n         <section>\n             <h2><xsl:value-of select=\"@title\" /></h2>\n             <p>\n                 <a href=\"{@htmlUrl}\">Add blog to HN Post</a>\n                 <br/>\n                 <xsl:value-of select=\"@text\" />\n             </p>\n             <ul>\n                 <xsl:apply-templates select=\"outline[@type='rss']\">\n                     <xsl:sort select=\"@title\" />\n                 </xsl:apply-templates>\n             </ul>\n             <xsl:apply-templates select=\"outline[not(@type='rss')]\">\n                 <xsl:sort select=\"@title\" />\n             </xsl:apply-templates>\n         </section>\n     </xsl:template>\n\n     <xsl:template match=\"outline[@type='rss']\">\n         <li>\n             <a href=\"{@htmlUrl}\"><xsl:value-of select=\"@title\" /></a>\n             (<a href=\"{@xmlUrl}\">RSS</a>)\n         </li>\n     </xsl:template>\n </xsl:stylesheet>","output":"str","x":1940.25,"y":178.5,"wires":[["c03e12c46faac9dd"]]},{"id":"847f74e1fe49f6a5","type":"template","z":"a8d90fc15ab6990b","g":"20b5eb42e3123703","name":"opml content","field":"payload","fieldType":"msg","format":"text","syntax":"mustache","template":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet href=\"/f/opml/style.xsl\" type=\"text/xsl\"?>\n<opml version=\"2.0\">\n<head>\n<title>Hacker News Personal Blogs - No Content Yet</title>\n</head>\n<body>\n<outline title=\"HN Personal Blogs - Apologies a free service is broken\" text=\"Sorry, content is currently being rendered, come back later.\"/>\n</body>\n</opml>\n","output":"str","x":1254,"y":178,"wires":[["9b61d5da7ecb7cb5"]]},{"id":"a51ef4f928f53df1","type":"template","z":"a8d90fc15ab6990b","g":"20b5eb42e3123703","name":"opml content template","field":"payload","fieldType":"msg","format":"text","syntax":"mustache","template":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet href=\"/f/opml/style.xsl\" type=\"text/xsl\"?>\n<opml version=\"2.0\">\n<head>\n<title>Hacker News Personal Blogs</title>\n</head>\n<body>\n<outline title=\"HN Personal Blogs\" htmlUrl=\"https://news.ycombinator.com/item?id=36575081\" text=\"To be added, add blog to HN post, have karma poinst &gt; 100 and a blog that responds within 5000ms. Finally include an link rel='alternate' type='rss' tag in your website header - that becomes the rss link.\">\n\n{{{ payload }}}\n\n</outline>\n</body>\n</opml>\n","output":"str","x":1047,"y":112,"wires":[["9b61d5da7ecb7cb5"]]},{"id":"a0558217726aa24d","type":"switch","z":"a8d90fc15ab6990b","g":"a62858d06bca713d","name":"if tsDiff > 2mins","property":"timestampDiff","propertyType":"msg","rules":[{"t":"gt","v":"5000 * 12 * 2","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":1190,"y":499,"wires":[["e410de8f0db803f9"]]},{"id":"50e92d0ce89b38e1","type":"change","z":"a8d90fc15ab6990b","g":"a62858d06bca713d","name":"","rules":[{"t":"set","p":"currentTimestamp","pt":"msg","to":"","tot":"date"},{"t":"set","p":"renderStartedAt","pt":"msg","to":"renderStartedAt","tot":"flow"},{"t":"set","p":"timestampDiff","pt":"msg","to":"currentTimestamp - renderStartedAt","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1187,"y":446,"wires":[["a0558217726aa24d"]]},{"id":"e410de8f0db803f9","type":"change","z":"a8d90fc15ab6990b","g":"a62858d06bca713d","name":"","rules":[{"t":"set","p":"isBeingRendered","pt":"flow","to":"false","tot":"bool"},{"t":"delete","p":"renderStartedAt","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1191,"y":561,"wires":[["edb7cbbbbe8e77c6"]]},{"id":"2dda7ab3e3f11a0c","type":"catch","z":"a8d90fc15ab6990b","name":"","scope":null,"uncaught":true,"x":1823,"y":2046,"wires":[["ac57ed4ff93c764f"]]},{"id":"ac57ed4ff93c764f","type":"debug","z":"a8d90fc15ab6990b","name":"debug 21","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2080,"y":2046,"wires":[]},{"id":"68b6e26bfac26acc","type":"switch","z":"a8d90fc15ab6990b","name":"ignore results if no longer rendering","property":"isBeingRendered","propertyType":"flow","rules":[{"t":"true"}],"checkall":"false","repair":false,"outputs":1,"x":2355,"y":1852,"wires":[["b56339980d8e1163"]]},{"id":"c7038f9df491a2f8","type":"link in","z":"a8d90fc15ab6990b","g":"6945ee232a1633c2","name":"HTTP request In","links":[],"x":107,"y":172,"wires":[["e0ccf685f70bf27b"]]},{"id":"fa763d5f6130b9ca","type":"cronplus","z":"a8d90fc15ab6990b","name":"every six hour refresh cache","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0 3 */6 * * * *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":475,"y":518,"wires":[["54c28a499aeec29f"]]}]