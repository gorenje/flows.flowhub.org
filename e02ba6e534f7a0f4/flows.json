[{"id":"e02ba6e534f7a0f4","type":"tab","label":"[Introspection] ClientCode: Convert RSS to Nodes","disabled":false,"info":"::: aim\n\nProvide an example of the TriggerImport node that can be used to import dynamically generated flows.\n\nDemonstrate by converting an RSS feed to a Node-RED flow tab.\n\n:::\n\n::: requirements\n\nThis requirements the following Node-RED nodes:\n\n- [introspection](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection), version >= 0.4.0\n\n:::\n\n::: explanation\n\nThe flow retrieves an RSS feed and for each entry, it generates a comment node.\n\nThe <a class=\"ahl-node-only\" data-ids=\"\">ClientCode node</a> is triggered once the flow contents have been created and it executes Javascript code in the client to open the Flow Import dialog. It the pastes the flow contents into the dialog.\n\nThe nodes generated in the <a class=\"ahl-node-only\" data-ids=\"77a3c9b5811260e2\">function node</a> have the format:\n\n```javascript\nmsg.payload = {\n    \"id\": msg.payload.id[0].match(/.{16}$/)[0],\n    \"type\": \"comment\",\n    \"name\": msg.payload.title[0][\"_\"],\n    \"info\": msg.payload.id[0],\n    \"x\": 801 * Math.random(),\n    \"y\": 699 * Math.random(),\n    \"wires\": [\n    ]\n}\n```\n\nThe `id` (in this case) assumes that the orignal RSS id contains a 16 digit hexdecimal. This is an assumption that **only** works with this RSS feed.\n\n:::\n","env":[]},{"id":"f3bdcd54a0aa8585","type":"inject","z":"e02ba6e534f7a0f4","name":"set RSS url","props":[{"p":"url","v":"https://flows.flowhub.org/feed.xml","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":250,"y":279,"wires":[["c2d4ce3e6e7c2e31"]]},{"id":"c2d4ce3e6e7c2e31","type":"http request","z":"e02ba6e534f7a0f4","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":405,"y":362,"wires":[["f210b63040eeb212"]]},{"id":"f210b63040eeb212","type":"xml","z":"e02ba6e534f7a0f4","name":"parse feed.xml","property":"payload","attr":"","chr":"","x":573,"y":437,"wires":[["3d604af7f2cb8912"]]},{"id":"e7289b9433d25283","type":"split","z":"e02ba6e534f7a0f4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1082,"y":546,"wires":[["77a3c9b5811260e2"]]},{"id":"3d604af7f2cb8912","type":"change","z":"e02ba6e534f7a0f4","name":"set payload and define fake tab Z id","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.feed.entry","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":497,"wires":[["e7289b9433d25283"]]},{"id":"77a3c9b5811260e2","type":"function","z":"e02ba6e534f7a0f4","name":"convert xml object to flow object","func":"msg.payload = {\n    \"id\": msg.payload.id[0].match(/.{16}$/)[0],\n    \"type\": \"comment\",\n    \"name\": msg.payload.title[0][\"_\"],\n    \"info\": msg.payload.id[0],\n    \"x\": 801 * Math.random(),\n    \"y\": 699 * Math.random(),\n    \"wires\": [\n    ]\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1109,"y":633,"wires":[["9de0d672c6fbccb8"]]},{"id":"9de0d672c6fbccb8","type":"join","z":"e02ba6e534f7a0f4","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1106,"y":719,"wires":[["875ef0b0799bb044"]]},{"id":"875ef0b0799bb044","type":"function","z":"e02ba6e534f7a0f4","name":"prepend the subflow to the nodes array","func":"msg.payload = {\n    flowContent: msg.payload,\n    removeduplicates: true,\n    autoimport: false\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1373,"y":719,"wires":[["5bf2de0885c59307"]]},{"id":"5bf2de0885c59307","type":"ClientCode","z":"e02ba6e534f7a0f4","name":"Open import dialog","clientcode":"function doIt() {\n  var content = payload.flowContent;\n\n  if (payload.removeduplicates) {\n    content = content.filter((elem) => {\n      return RED.nodes.node(elem.id) == undefined\n    });\n  }\n\n  if (content.length == 0) {\n    RED.notify(\"No new content\", {\n      type: \"ok\",\n      id: \"TriggerImport\",\n      timeout: 2000\n    });\n    return;\n  }\n  RED.clipboard.import();\n\n  setTimeout(() => {\n    $('#red-ui-clipboard-dialog-import-text').val(\n      JSON.stringify(content)\n    ).trigger(\"paste\");\n\n    if (payload.autoimport) {\n      setTimeout(() => {\n        $('#red-ui-clipboard-dialog-ok').trigger('click');\n      }, 435);\n    }\n  }, 300);\n};\n\ndoIt();\n","format":"javascript","x":1635.75,"y":588.20849609375,"wires":[[]]}]