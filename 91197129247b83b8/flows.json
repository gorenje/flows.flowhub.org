[{"id":"91197129247b83b8","type":"tab","label":"[Txt2Visual] Password Generator","disabled":false,"info":"::: aim\n\nConvert a piece of textual code to visual code, in this case some Python code.\n\n:::\n\n::: background\n\nThe idea for this came from a [Hacker News](https://news.ycombinator.com/item?id=37297759) comment. \n\n> It does not replace those thousand words. I challenge you to share one picture which replaces a 10-word bash script.\n\nSo I thought I might try. Admittedly I picked something that had nothing to do with file systems, which my bash scripts all seemed to be about. The code I picked was some Python code for generating a random password using an external site:\n\n```python\nimport time, subprocess, types, math, sys, re, optparse, os\nimport socket, json, base64, threading, uuid, requests, urllib\nimport types, math, sys, re\n\nfrom bs4 import BeautifulSoup\n\nPageUrl = \"https://www.gaijin.at/de/tools/password-generator-extended\"\n\ndef main(opts):\n    # create an instance of the class\n    forms = BeautifulSoup(requests.get( PageUrl ).content,features=\"html.parser\" ).find_all( \"form\" )\n\n    if len(forms) != 1:\n        print( \"Too many forms found: {} != 1\".format(len(forms)))\n        exit(1)\n\n    form = forms[0]\n    if form.attrs[\"method\"] != \"post\":\n        print(\"Form no longer post: {}\".format(form.attr[\"method\"]))\n        exit(1)\n\n    data = dict([ [e.attrs[\"name\"], e.attrs[\"value\"]]\n                  for e in form.findAll(\"input\")])\n\n    data[\"p_pre_method\"] = \"PWMGR2\"\n    data[\"p_usr_len\"] = str(opts.max_length)\n    data[\"p_usr_count\"] = str(opts.count)\n    data[\"p_pre_count\"] = '8'\n    data[\"tab\"] = 'U'\n\n    if not opts.symbols:\n        data.pop(\"p_usr_fspc\", None)\n        data.pop(\"p_usr_lspc\", None)\n        data.pop(\"p_usr_spc\", None)\n\n    if opts.downcase:\n        data.pop(\"p_usr_fupper\", None)\n        data.pop(\"p_usr_lupper\", None)\n        data.pop(\"p_usr_upper\", None)\n\n    if opts.no_numbers:\n        data.pop(\"p_usr_num\", None)\n        data.pop(\"p_usr_lnum\", None)\n        data.pop(\"p_usr_fnum\", None)\n        data.pop(\"p_usr_nul\", None)\n        data.pop(\"p_usr_lnul\", None)\n        data.pop(\"p_usr_fnul\", None)\n\n    pr = urllib.parse.urlparse(PageUrl)\n    resp = requests.post( pr.scheme + \"://\" + pr.netloc + form.attrs[\"action\"],\n                   data=data )\n    tx = BeautifulSoup( resp.content,\n                        features=\"html.parser\" ).find_all( \"textarea\" )\n\n    print(tx[0].contents[0])\n\nif __name__ == '__main__':\n    parser = optparse.OptionParser()\n    parser.add_option(\n        '-c', '--count',\n        help=\"number of passwords\",\n        type=\"int\", default=16)\n    parser.add_option(\n        '-l', '--max-length',\n        help=\"max length of the passwords\",\n        type='int', default=32)\n    parser.add_option(\n        '-s', '--symbols',\n        help=\"request special characters (i.e. unicode) in passwords\",\n        action=\"store_true\", default=False)\n    parser.add_option(\n        '-d', '--downcase',\n        help=\"request password to be downcase only\",\n        action=\"store_true\", default=False)\n\n    parser.add_option(\n        '-n', '--no-numbers',\n        help=\"request password to contain no numbers\",\n        action=\"store_true\", default=False)\n\n    opts, args = parser.parse_args()\n\n    main(opts)\n```\n\nThe input options to the script:\n\n```\nUsage: get-password.py [options]\n\nOptions:\n  -h, --help            show this help message and exit\n  -c COUNT, --count=COUNT\n                        number of passwords\n  -l MAX_LENGTH, --max-length=MAX_LENGTH\n                        max length of the passwords\n  -s, --symbols         request special characters (i.e. unicode) in passwords\n  -d, --downcase        request password to be downcase only\n  -n, --no-numbers      request password to contain no numbers\n```\n\nIgnoring the question of how best to generate a random password - doing a http request might not figure in the top-ten, the question is how well/easily can textual code be converted into a visual representation?\n\n:::\n\n::: explanation\n\nThe flow begins with <a class=\"ahl-group-only\" data-ids=\"c689299aa31b8b2f\">setting the options</a> for the password generation. All the same options as above are supported. By pressing the button on the <a class=\"ahl-node-only\" data-ids=\"b939ec3a32f8ec87\">inject node</a>, the passwords are generated.\n\nThe difficulty is to obtain the url for the form to post the options to. For this, an <a class=\"ahl-node-only\" data-ids=\"6830c04383494ff3\">initial get request</a> is made to get the required form data and form location. The HTML <a class=\"ahl-group-only\" data-ids=\"c3d8aef2675d937f\">response is parsed</a> twice in parallel to:\n\n- <a class=\"ahl-link-node\" data-ids=\"6830c04383494ff3,9b9925da67c8618b,4bd022809eb21cf5,3f6ad8acdd210647,9b91a0b1d132954a\">obtain the action and method of the form</a>\n\n- <a class=\"ahl-link-node\" data-ids=\"6830c04383494ff3,56cb5e695f77808d,c3e97495143d5d1a,fcec60190dd5e0df,9b91a0b1d132954a\">obtain all `input` elements in the form</a>\n\nSecond half of the <a class=\"ahl-group-only\" data-ids=\"707772b034e40e91\">flow</a> is about recreating the data for the form post. Most of the heavy lifting is done in the <a class=\"ahl-node-only\" data-ids=\"863a9b9613c790b8\">function node</a> to setup the request data.\n\nFinally the <a class=\"ahl-group-only\" data-ids=\"8a21a78f12286b80\">output is dumped</a> to the debug pane.\n:::\n\n\n### Sequence diagram\n\n```mermaid\nsequenceDiagram\n    user->>flow: set options\n    flow->>flow: prepare get request\n    flow->>WWW: [GET] form details\n    WWW->>flow: form data\n    par parse HTML\n        flow->>flow: get action and method\n    and\n        flow->>flow: get all input elements\n    end\n    flow->>flow: create form with options\n    flow->>WWW: [POST] form data\n    WWW->>flow: passwords\n    flow->>user: display passwords\n```\n\n::: discussion\n\nArguably none of the three representations presented are the simplest to understand or understandable for everyone. The advantage the Node-RED representation has is that the visuals are the code. \n\nThe sequence diagram does a good job explaining what happens but a computer can't understand it. The Python code is great for the computer and the programmer to understand, but the stakeholder is lost. \n\nThe Node-RED code is an attempt to find the middle ground between computer, programmer and stakeholder. Whether it does that well is another question.\n\n:::\n\n","env":[]},{"id":"c3d8aef2675d937f","type":"group","z":"91197129247b83b8","name":"Parse form data to obtain all inputs and POST endpoint","style":{"label":true},"nodes":["4bd022809eb21cf5","eeba010f7b62c4f7","c4b110693a7303ca","3f6ad8acdd210647","a21fc2f1f2628c96","20130d6510cec834","9b9925da67c8618b","56cb5e695f77808d","fcec60190dd5e0df","c3e97495143d5d1a"],"x":644,"y":627,"w":1123,"h":296},{"id":"707772b034e40e91","type":"group","z":"91197129247b83b8","name":"Setup post request with all required inputs","style":{"label":true},"nodes":["863a9b9613c790b8","9af0851af8116864","e57abf0e4a6a3517","6541db96eaa38aa4","773fba9ce53f0740"],"x":1953,"y":708,"w":736,"h":215},{"id":"c689299aa31b8b2f","type":"group","z":"91197129247b83b8","name":"Start Here, set options","style":{"label":true},"nodes":["b939ec3a32f8ec87"],"x":72,"y":627,"w":252,"h":82},{"id":"8a21a78f12286b80","type":"group","z":"91197129247b83b8","name":"display output","style":{"label":true},"nodes":["38008ad7ab77e6ef","e5a2f63937a7694e"],"x":2756,"y":708,"w":554,"h":215},{"id":"b939ec3a32f8ec87","type":"inject","z":"91197129247b83b8","g":"c689299aa31b8b2f","name":"password settings","props":[{"p":"pword_length","v":"32","vt":"num"},{"p":"pword_symbols","v":"true","vt":"bool"},{"p":"pword_count","v":"32","vt":"num"},{"p":"pword_numbers","v":"true","vt":"bool"},{"p":"pword_downcase","v":"false","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":208,"y":668,"wires":[["26a66059e7a5838a"]]},{"id":"6830c04383494ff3","type":"http request","z":"91197129247b83b8","name":"get form details","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":486,"y":833,"wires":[["9b9925da67c8618b","56cb5e695f77808d"]]},{"id":"26a66059e7a5838a","type":"function","z":"91197129247b83b8","name":"set request url and headers","func":"msg.base_url = \"https://www.gaijin.at\";\n\nmsg.url = msg.base_url + \"/de/tools/password-generator-extended\";\n\nmsg.headers = {\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_7; en-us) AppleWebKit/525.28.3 (KHTML, like Gecko) Version/3.2.3 Safari/525.28.3\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":343,"y":755,"wires":[["6830c04383494ff3"]]},{"id":"4bd022809eb21cf5","type":"switch","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"ensure there is only 1 form","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1053,"y":675,"wires":[["3f6ad8acdd210647"],["c4b110693a7303ca"]]},{"id":"eeba010f7b62c4f7","type":"debug","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"ERROR","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error","targetType":"msg","statusVal":"","statusType":"auto","x":1622,"y":811,"wires":[]},{"id":"c4b110693a7303ca","type":"change","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"","rules":[{"t":"set","p":"error","pt":"msg","to":"{\t    \"message\": \"Form count not 1 was \" & $count(msg.payload)\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1285,"y":747,"wires":[["20130d6510cec834"]]},{"id":"3f6ad8acdd210647","type":"switch","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"ensure form method is post","property":"payload[0].method","propertyType":"msg","rules":[{"t":"eq","v":"post","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1453,"y":668,"wires":[["9b91a0b1d132954a"],["a21fc2f1f2628c96"]]},{"id":"a21fc2f1f2628c96","type":"change","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"","rules":[{"t":"set","p":"error","pt":"msg","to":"{\t    \"message\": \"Form method assumed to be post, was: \" & msg.payload[0].method\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1603,"y":763,"wires":[["eeba010f7b62c4f7"]]},{"id":"20130d6510cec834","type":"debug","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"ERROR","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error","targetType":"msg","statusVal":"","statusType":"auto","x":1312,"y":801,"wires":[]},{"id":"863a9b9613c790b8","type":"function","z":"91197129247b83b8","g":"707772b034e40e91","name":"setup form post request","func":"msg.url = msg.base_url + msg.payload[0][0].action;\n\nvar formContent = {}\n\nfor (var idx = 0; idx < msg.payload[1].length; idx++ ) {\n    formContent[msg.payload[1][idx].name] = msg.payload[1][idx].value\n}\n\nformContent[\"p_pre_method\"] = \"PWMGR2\"\nformContent[\"p_usr_len\"] = msg.pword_length\nformContent[\"p_usr_count\"] = msg.pword_count\nformContent[\"p_pre_count\"] = '8'\nformContent[\"tab\"] = 'U'\n\nmsg.payload = formContent;\n\nif (!msg.pword_symbols) {\n    msg.payload = {\n        ...msg.payload,\n        \"p_usr_fspc\": 0,\n        \"p_usr_lspc\": 0,\n        \"p_usr_spc\": 0,\n    }\n}\n\nif ( !msg.pword_numbers ) {\n    msg.payload = {\n        ...msg.payload,\n        \"p_usr_num\": 0,\n        \"p_usr_lnum\": 0,\n        \"p_usr_fnum\": 0,\n        \"p_usr_nul\": 0,\n        \"p_usr_lnul\": 0,\n        \"p_usr_fnul\": 0,\n    }\n}\n\nif ( msg.pword_downcase ) {\n    msg.payload = {\n        ...msg.payload,\n        \"p_usr_fupper\": 0,\n        \"p_usr_lupper\": 0,\n        \"p_usr_upper\":0,\n    }\n}\n\nmsg.headers = {\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_7; en-us) AppleWebKit/525.28.3 (KHTML, like Gecko) Version/3.2.3 Safari/525.28.3\",\n    \"content-type\": \"application/x-www-form-urlencoded\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2544,"y":882,"wires":[["9af0851af8116864"]]},{"id":"9af0851af8116864","type":"http request","z":"91197129247b83b8","g":"707772b034e40e91","name":"http POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":2573,"y":749,"wires":[["38008ad7ab77e6ef"]]},{"id":"9b9925da67c8618b","type":"html","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"obtain form element","property":"payload","outproperty":"payload","tag":"form","ret":"attr","as":"single","x":770,"y":733,"wires":[["4bd022809eb21cf5"]]},{"id":"56cb5e695f77808d","type":"html","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"obtain all input elements in the form","property":"payload","outproperty":"payload","tag":"form","ret":"html","as":"single","x":863,"y":882,"wires":[["c3e97495143d5d1a"]]},{"id":"fcec60190dd5e0df","type":"html","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"all input elements in form","property":"payload","outproperty":"payload","tag":"input","ret":"attr","as":"single","x":1631,"y":881,"wires":[["9b91a0b1d132954a"]]},{"id":"c3e97495143d5d1a","type":"change","z":"91197129247b83b8","g":"c3d8aef2675d937f","name":"payload should be string not array","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1197,"y":882,"wires":[["fcec60190dd5e0df"]]},{"id":"9b91a0b1d132954a","type":"join","z":"91197129247b83b8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"1","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1888,"y":662,"wires":[["6541db96eaa38aa4"]]},{"id":"e57abf0e4a6a3517","type":"switch","z":"91197129247b83b8","g":"707772b034e40e91","name":"ensure ordering of payload: form element first","property":"payload[0].length","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":2163,"y":817,"wires":[["863a9b9613c790b8"],["773fba9ce53f0740"]]},{"id":"6541db96eaa38aa4","type":"switch","z":"91197129247b83b8","g":"707772b034e40e91","name":"ensure there was no error, need to have 2 payloads","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2171,"y":759,"wires":[["e57abf0e4a6a3517"]]},{"id":"773fba9ce53f0740","type":"change","z":"91197129247b83b8","g":"707772b034e40e91","name":"swap payload contents","rules":[{"t":"set","p":"p1","pt":"msg","to":"payload[0]","tot":"msg","dc":true},{"t":"set","p":"p2","pt":"msg","to":"payload[1]","tot":"msg","dc":true},{"t":"set","p":"payload","pt":"msg","to":"[ [$$.p2], [$$.p1] ]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2089,"y":882,"wires":[["863a9b9613c790b8"]]},{"id":"38008ad7ab77e6ef","type":"html","z":"91197129247b83b8","g":"8a21a78f12286b80","name":"find the passwords in response","property":"payload","outproperty":"payload","tag":"textarea","ret":"text","as":"single","x":2912,"y":749,"wires":[["e5a2f63937a7694e"]]},{"id":"e5a2f63937a7694e","type":"debug","z":"91197129247b83b8","g":"8a21a78f12286b80","name":"Dump passwords to debug pane","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload[0]","targetType":"msg","statusVal":"","statusType":"auto","x":3124,"y":882,"wires":[]}]