[{"id":"36f1ec196998b047","type":"tab","label":"Node-RED Learnings - Clone and Fork Node","disabled":false,"info":"::: aim\n\nA fork node does not exist in Node-RED!\n\n:::\n\n::: discussion\n\nI was porting some UML diagrams to Node-RED when I came across [the fork node in UML](https://flowhub.org/f/4059b930d1c0f643), I immediately thought why does Node-RED not have a fork node? I even [posed this question](https://discourse.nodered.org/t/fork-node-or-clone-node/81389) in the Node-RED forum.\n\nThe answer is embarassingly simple, especially since I take advantage of it everyday: message cloning (i.e. fork) occurs for each output wire, forking is automatic in Node-RED.\n\nThe [blog post](https://nodered.org/blog/2019/09/13/cloning-messages) clarifies the situation a little more: all messages are cloned except the first one.\n\n:::\n\n::: explanation\n\nThe <a class=\"ahl-group-only\" data-ids=\"a7d253348a4b6ba3\">top group</a> shows how a fork works in Node-RED. In fact, that flow can be simplified to <a class=\"ahl-group-only\" data-ids=\"5c32e7403e3ce5ec\">this group</a> by removing the do something node that actually does nothing! Since each node can have as many output wires as needed, each node does cloning of messages.\n\nThe <a class=\"ahl-group-only\" data-ids=\"7ab26e075e5c528d\">bottom group</a> shows how UML describes forking, using a separate node to duplicate and parallels the message. The <a class=\"ahl-node-only\" data-ids=\"d4e4e2ed3b91e871\">function node</a> does the cloning by doing this:\n\n```javascript\nreturn [\n    { ...msg },\n    { ...msg },\n    { ...msg },\n    { ...msg },\n]\n```\n\nAs pointed on in the [Node-RED forum](https://discourse.nodered.org/t/fork-node-or-clone-node/81389/7), doing `{...msg}` is a shallow copy, to do this properly, the `RED.util.cloneMessage(..)` method should be used:\n\n```javascript\nreturn [\n    RED.util.cloneMessage(msg),\n    RED.util.cloneMessage(msg),\n    RED.util.cloneMessage(msg),\n    RED.util.cloneMessage(msg),\n]\n```\n\nMore on [deep copy](https://developer.mozilla.org/en-US/docs/Glossary/Deep_copy).\n\n:::\n","env":[]},{"id":"7ab26e075e5c528d","type":"group","z":"36f1ec196998b047","name":"Blindly following UML diagrams","style":{"label":true},"nodes":["d4e4e2ed3b91e871","0c3b75a8c8664689","d33df597200b2515","734c5c909a0a858f","f6489ae4c4985f05","d8da954078b89f31"],"x":333,"y":688.3333333333333,"w":732,"h":321.66666666666674},{"id":"a7d253348a4b6ba3","type":"group","z":"36f1ec196998b047","name":"The Node-RED way - fork included for free","style":{"label":true},"nodes":["d6a50f7a04550c8d","a2130b56a6fc9a53","87dac363e3abc9bc","2e4d34de129672cb","69f11863e59c7263","7634d828f47e4c57"],"x":333,"y":208,"w":733,"h":335},{"id":"5c32e7403e3ce5ec","type":"group","z":"36f1ec196998b047","name":"The correct Node-RED way - any node does cloning","style":{"label":true},"nodes":["af0ffa83e13ebcf9","34b08075520545ed","e9b9ca3e5259f375","fb639d07287839e7","3ca65f5164acb1b4"],"x":1128,"y":208,"w":733,"h":335},{"id":"d6a50f7a04550c8d","type":"inject","z":"36f1ec196998b047","g":"a7d253348a4b6ba3","name":"Start","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":429,"y":373,"wires":[["a2130b56a6fc9a53"]]},{"id":"a2130b56a6fc9a53","type":"function","z":"36f1ec196998b047","g":"a7d253348a4b6ba3","name":"do something","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":699,"y":373,"wires":[["87dac363e3abc9bc","2e4d34de129672cb","69f11863e59c7263","7634d828f47e4c57"]]},{"id":"87dac363e3abc9bc","type":"function","z":"36f1ec196998b047","g":"a7d253348a4b6ba3","name":"original msg","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":249,"wires":[[]]},{"id":"2e4d34de129672cb","type":"function","z":"36f1ec196998b047","g":"a7d253348a4b6ba3","name":"msg clone 1","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":333.3333333333333,"wires":[[]]},{"id":"69f11863e59c7263","type":"function","z":"36f1ec196998b047","g":"a7d253348a4b6ba3","name":"msg clone 2","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":417.66666666666663,"wires":[[]]},{"id":"7634d828f47e4c57","type":"function","z":"36f1ec196998b047","g":"a7d253348a4b6ba3","name":"msg clone 3","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":502,"wires":[[]]},{"id":"d4e4e2ed3b91e871","type":"function","z":"36f1ec196998b047","g":"7ab26e075e5c528d","name":"UML Fork Node","func":"return [\n    RED.util.cloneMessage(msg),\n    RED.util.cloneMessage(msg),\n    RED.util.cloneMessage(msg),\n    RED.util.cloneMessage(msg),\n]","outputs":4,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":693,"y":843,"wires":[["d33df597200b2515"],["734c5c909a0a858f"],["f6489ae4c4985f05"],["0c3b75a8c8664689"]]},{"id":"0c3b75a8c8664689","type":"function","z":"36f1ec196998b047","g":"7ab26e075e5c528d","name":"msg clone 4","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":969,"y":969,"wires":[[]]},{"id":"d33df597200b2515","type":"function","z":"36f1ec196998b047","g":"7ab26e075e5c528d","name":"msg clone 1","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":969,"y":729.3333333333333,"wires":[[]]},{"id":"734c5c909a0a858f","type":"function","z":"36f1ec196998b047","g":"7ab26e075e5c528d","name":"msg clone 2","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":969,"y":809.2222222222222,"wires":[[]]},{"id":"f6489ae4c4985f05","type":"function","z":"36f1ec196998b047","g":"7ab26e075e5c528d","name":"msg clone 3","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":969,"y":889.1111111111111,"wires":[[]]},{"id":"d8da954078b89f31","type":"inject","z":"36f1ec196998b047","g":"7ab26e075e5c528d","name":"Start","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":429,"y":843,"wires":[["d4e4e2ed3b91e871"]]},{"id":"af0ffa83e13ebcf9","type":"inject","z":"36f1ec196998b047","g":"5c32e7403e3ce5ec","name":"Start","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1224,"y":373,"wires":[["34b08075520545ed","e9b9ca3e5259f375","fb639d07287839e7","3ca65f5164acb1b4"]]},{"id":"34b08075520545ed","type":"function","z":"36f1ec196998b047","g":"5c32e7403e3ce5ec","name":"original msg","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1765,"y":249,"wires":[[]]},{"id":"e9b9ca3e5259f375","type":"function","z":"36f1ec196998b047","g":"5c32e7403e3ce5ec","name":"msg clone 1","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1765,"y":333.3333333333333,"wires":[[]]},{"id":"fb639d07287839e7","type":"function","z":"36f1ec196998b047","g":"5c32e7403e3ce5ec","name":"msg clone 2","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1765,"y":417.66666666666663,"wires":[[]]},{"id":"3ca65f5164acb1b4","type":"function","z":"36f1ec196998b047","g":"5c32e7403e3ce5ec","name":"msg clone 3","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1765,"y":502,"wires":[[]]}]