[{"id":"60871bf5eadd6d7f","type":"tab","label":"Node-RED Learnings - HTTP requestTimeout","disabled":false,"info":"::: aim\n\nDemonstrate the usage of `requestTimeout` option of the HTTP request node.\n\nTL;DR:\n\n*IMO always set the requestTimeout if you're using the http request node.*\n\n:::\n\n::: warning\n\nThis flow contains Http-In endpoinst definitions that could interrupt existing endpoints and services or open your Node-RED installation to malicious attacks.\n\n:::\n\n### Background\n\nUsing the http request node for obtaining external resources is quite normal. What is not normal is that those external resources fail or take too long to respond, freezing the http request node.\n\nFor this reason, the http request node has an option that can be set via the message sent to it. The `requestTimeout` is the timeout for the *entire* lifecycle of the HTTP request and must be set on the `msg` object not the `payload` attribute.\n\nThe value is in milliseconds and it overrides the global value `httpRequestTimeout`.\n\nThe timeout meant is for the entire lifecycle: connect to server, request data, wait on response and close connection. If that process takes longer than `requestTimeout`, the http request node will fail.\n\n::: explanation\n\nEach of the <a class=\"ahl-group-only\" data-ids=\"084aeb46391f616d,65cfc5b8692aaaee,fc0d80cb9c15b39b\">three requests</a> are triggered by the button (not shown here but in Node-RED) on the respective <a class=\"ahl-node-only\" data-ids=\"7a175ea9f4069917,90fa5db9307703ee,c3e84f7f353e9736\">inject node</a>.\n\nThe URL for the request is also set by the inject node. The URL can be set in the <a class=\"ahl-node-only\" data-ids=\"2f96fd9bab61a567,b2fffb2c8672dd94,11a5b3caba5581e9\">http request node</a>, but I prefer to set everything in the `msg` object - less confusion when debugging.\n\nThe <a class=\"ahl-group-only\" data-ids=\"dcaea1b0ce7e9348\">simulated server</a> has a inbuilt <a class=\"ahl-node-only\" data-ids=\"1cb8b549ec1f3ec1\">five second delay</a> in responding. This simulates a long-taking request to some external resource in some far-off server bunker.\n\nThe <a class=\"ahl-group-only\" data-ids=\"084aeb46391f616d\">first request</a> has no specific timeout and will complete after waiting 5 seconds for the server to respond, provided the `httpRequestTimeout` is set to longer than 5 seconds.\n\nThe <a class=\"ahl-group-only\" data-ids=\"65cfc5b8692aaaee\">second request</a> has a timeout of 1500ms and after that, it generates an error which is <a class=\"ahl-link-node\" data-ids=\"ed16ae6930d75276,d974150fe06c97e2\">logged to the debug panel via the exception node</a>. In addition it returns an error message which is also logged to the <a class=\"ahl-link-node\" data-ids=\"b2fffb2c8672dd94,63e23e8caef8ce2c\">debug panel</a>. The point here is that there are two messages which need handling.\n\nThe <a class=\"ahl-group-only\" data-ids=\"fc0d80cb9c15b39b\">third request</a> has no exception handling and will only generate one message but it will also generate and exception error that is logged to the debug panel. So the second flow is handling the exception while this flow simply lets the exception bubble up to the debug panel. To avoid the exception from appearing in the debug panel, an disconnected exception with silently drop the message.\n\n:::\n\n::: discussion\n\nThe global timeout `httpRequestTimeout` setting might be fine for most use cases, I prefer to be explicit about such things.\n\nI don't even know what the value of the setting is! Also for some requests I don't mind how long they take, for others it becomes important. So instead of reflecting on this, I simply always set the `requestTimeout` and know exactly why something happened to fail on that particular day.\n\n:::\n","env":[]},{"id":"dcaea1b0ce7e9348","type":"group","z":"60871bf5eadd6d7f","name":"Define endpoint for testing - assumed to be connected to localhost:1800","style":{"label":true},"nodes":["bd895427d04e9631","1cb8713008356f0c","1cb8b549ec1f3ec1"],"x":1209,"y":90.5,"w":778,"h":82},{"id":"65cfc5b8692aaaee","type":"group","z":"60871bf5eadd6d7f","name":"request timeout of 1500ms and exception handling","style":{"label":true},"nodes":["b2fffb2c8672dd94","90fa5db9307703ee","63e23e8caef8ce2c","ed16ae6930d75276","d974150fe06c97e2"],"x":282,"y":402.25,"w":1072,"h":122.5},{"id":"fc0d80cb9c15b39b","type":"group","z":"60871bf5eadd6d7f","name":"request timeout of 1500ms without exception handling","style":{"label":true},"nodes":["11a5b3caba5581e9","c3e84f7f353e9736","8601a30233108560"],"x":282,"y":582,"w":837,"h":82},{"id":"084aeb46391f616d","type":"group","z":"60871bf5eadd6d7f","name":"no request timeout","style":{"label":true},"nodes":["2f96fd9bab61a567","7a175ea9f4069917","78fedde0d1956bf6"],"x":282,"y":263,"w":718,"h":82},{"id":"2f96fd9bab61a567","type":"http request","z":"60871bf5eadd6d7f","g":"084aeb46391f616d","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":599,"y":304,"wires":[["78fedde0d1956bf6"]]},{"id":"bd895427d04e9631","type":"http in","z":"60871bf5eadd6d7f","g":"dcaea1b0ce7e9348","name":"","url":"/end/point","method":"get","upload":false,"swaggerDoc":"","x":1315,"y":131.5,"wires":[["1cb8b549ec1f3ec1"]]},{"id":"1cb8713008356f0c","type":"http response","z":"60871bf5eadd6d7f","g":"dcaea1b0ce7e9348","name":"http response","statusCode":"","headers":{},"x":1881,"y":131.5,"wires":[]},{"id":"1cb8b549ec1f3ec1","type":"delay","z":"60871bf5eadd6d7f","g":"dcaea1b0ce7e9348","name":"delay 5s","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1500","randomLast":"4000","randomUnits":"milliseconds","drop":false,"allowrate":false,"outputs":1,"x":1589,"y":131.5,"wires":[["1cb8713008356f0c"]]},{"id":"7a175ea9f4069917","type":"inject","z":"60871bf5eadd6d7f","g":"084aeb46391f616d","name":"set url","props":[{"p":"url","v":"http://localhost:1880/end/point","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":378,"y":304,"wires":[["2f96fd9bab61a567"]]},{"id":"78fedde0d1956bf6","type":"debug","z":"60871bf5eadd6d7f","g":"084aeb46391f616d","name":"http request output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":864,"y":304,"wires":[]},{"id":"b2fffb2c8672dd94","type":"http request","z":"60871bf5eadd6d7f","g":"65cfc5b8692aaaee","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":718,"y":483.75,"wires":[["63e23e8caef8ce2c"]]},{"id":"90fa5db9307703ee","type":"inject","z":"60871bf5eadd6d7f","g":"65cfc5b8692aaaee","name":"set url & requestTimeout","props":[{"p":"url","v":"http://localhost:1880/end/point","vt":"str"},{"p":"requestTimeout","v":"1500","vt":"num"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":438,"y":483.75,"wires":[["b2fffb2c8672dd94"]]},{"id":"63e23e8caef8ce2c","type":"debug","z":"60871bf5eadd6d7f","g":"65cfc5b8692aaaee","name":"http request output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":983,"y":483.75,"wires":[]},{"id":"ed16ae6930d75276","type":"catch","z":"60871bf5eadd6d7f","g":"65cfc5b8692aaaee","name":"","scope":["b2fffb2c8672dd94"],"uncaught":false,"x":741,"y":443.25,"wires":[["d974150fe06c97e2"]]},{"id":"d974150fe06c97e2","type":"debug","z":"60871bf5eadd6d7f","g":"65cfc5b8692aaaee","name":"handle timeout exception","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1198,"y":443.25,"wires":[]},{"id":"11a5b3caba5581e9","type":"http request","z":"60871bf5eadd6d7f","g":"fc0d80cb9c15b39b","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":718,"y":623,"wires":[["8601a30233108560"]]},{"id":"c3e84f7f353e9736","type":"inject","z":"60871bf5eadd6d7f","g":"fc0d80cb9c15b39b","name":"set url & requestTimeout","props":[{"p":"url","v":"http://localhost:1880/end/point","vt":"str"},{"p":"requestTimeout","v":"1500","vt":"num"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":438,"y":623,"wires":[["11a5b3caba5581e9"]]},{"id":"8601a30233108560","type":"debug","z":"60871bf5eadd6d7f","g":"fc0d80cb9c15b39b","name":"http request output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":983,"y":623,"wires":[]}]