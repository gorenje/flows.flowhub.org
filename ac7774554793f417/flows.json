[{"id":"ac7774554793f417","type":"tab","label":"Visual Flow Based Programming","disabled":false,"info":"### Aim\n\nDescribe what is Visual Flow Based Programming, visually in one flow or less.\n\n### Description\n\n[Flow Based Programming](https://jpaulm.github.io/fbp/index.html) (FBP) goes back to the 1960s and is a complete paradigm shift placing the focus on data *flow* and not *algorithmic manipulation* of data.\n\nTo begin with, some terminology:\n\n- a *flow* is the program, a flow describes the manipulation of data that *flows* through it,\n- flows consist of *nodes*, these are the computational units that do the work. In Node-RED, nodes are represented by rectangles,\n- wires connect the nodes and describe the path that the data takes through a flow, i.e., the program. Wires are represented by the lines connecting the rectangles.\n\nVisually one can think of:\n\n- a rectangle represents computational work, manipulation of data,\n- a line represents the flow of data, the pathway of the data through the flow diagram\n\nData flows from left to right, data enters a computational unit (i.e. a rectangle) on the left side and exits, having been modified by the computational unit (i.e., rectangle), on the right side.\n\nAs the data moves through the flow, it is molded into shape - imagine a factory assembly line, perhaps a car assembly line. As the car passes along the assembly line, it gradually takes on shape until at the end, the car is complete and driven off to the carpark.\n\nI sometimes call wires *pipes* since for me stuff *flows* through pipes while wires conduct electricity - the term *pipes* makes for me more sense. Additionally, Unix *pipes* are the exact same FBP paradigm only textually.\n\n### Example 1: Node types\n\nWith that basis, looking at the <a class=\"ahl-group-only\" data-ids=\"da7936d50a5b762c\">first flow</a>, one sees three computational units connected by two pipes: three nodes and two wires in Node-RED terminology.\n\nLooking closer, the flow has an <a class=\"ahl-node-only\" data-ids=\"e67429070592ba53\">inject node</a> connected to a <a class=\"ahl-node-only\" data-ids=\"c0c373c795859694\">function node</a> which in turn is connected to a <a class=\"ahl-node-only\" data-ids=\"8d61f790f5ea511d\">debug node</a>. We are confronted by node *types* - each computational unit (i.e., node) has a different purpose and that purpose is described by its *type*.\n\nThe types used in this flow are:\n\n- an *inject* node is responsible for *injecting* data into a flow, it is a data generator node,\n- a *function* node is computation defined by Javascript code, it applies its *functionality* to the data passing through,\n- a *debug* node is responsible for providing insights into the data and its current state, a *debug* node displays the data it receives in a panel within Node-RED.\n\nThis flow represents the central concept of flow based programming: somewhere data is generated, somewhere that data is manipulated and somewhere the manipulated data is outputted. Every program, every algorithm and every flow when *focussed on the data*, has three core actions: obtain, manipulate, return.\n\nPutting this together, I can say that the <a class=\"ahl-node-only\" data-ids=\"e67429070592ba53\">inject node</a> obtains the data, the <a class=\"ahl-node-only\" data-ids=\"c0c373c795859694\">function node</a> manipulates the data and the <a class=\"ahl-node-only\" data-ids=\"8d61f790f5ea511d\">debug node</a> returns the data. Above I wrote the rectangles *manipulate* the data but inject and debug do not *manipulate*, i.e., change the data. Manipulation includes generation (in the case of inject) and passing on the data (in the case of debug), so I would argue *all* nodes *manipulate* the data.\n\n### Example 2: Data duplication\n\nThe <a class=\"ahl-group-only\" data-ids=\"4ad9d6b654e58ee6\">second flow</a> is an example of another core feature of FBP: data duplication. Data can be duplicated for *zero cost*. Here zero means there is nothing the developer has to do to duplicate the data, it just happens by adding a wire, i.e., a connection between computational units.\n\nThe <a class=\"ahl-link-node first-to-all\" data-ids=\"71c86253a96eaf59,dd8bb0320f2a2c94,01c7e1178e5571c1\">function node</a> now has two output connections, along which pipe does the output data flow? Both. The output from the <a class=\"ahl-node-only\" data-ids=\"71c86253a96eaf59\">first function</a> is *duplicated* and passed to both the <a class=\"ahl-node-only\" data-ids=\"dd8bb0320f2a2c94\">second function</a> and to the <a class=\"ahl-node-only\" data-ids=\"01c7e1178e5571c1\">debug</a> node.\n\nThe data is *not* the same data object, it is a *clone* (i.e., copy) of the data generated by the node. This allows data to be manipulate *independently* by many computational units, (i.e., nodes). Any node with an output connection can have multiple wires connected to multiple other nodes, Node-RED takes care of duplicating the data.\n\n### Example 3: Data decision\n\nThe <a class=\"ahl-group-only\" data-ids=\"eecb8f927c5b21f3\">third flow</a> demonstrates a fork in the river: data can be directed to flow along specific wires. The <a class=\"ahl-node-only\" data-ids=\"f3cb6bbcc32d8dc5\">switch node</a> represents *indirect* data manipulation: the switch does not alter the data itself rather, based on the data contents, it determines which alterations *should* be made downstream.\n\nAgain the data is duplicate automagically and can flow out of multiple output connections. Data could flow out of all three connections or none at all and everything in-between.\n\nHere I must introduce some more terminology:\n\n- *ports* are the smaller grey squares attached to the rectangles and represent \"docking ports\" onto which wires are connected. \n\nThe The <a class=\"ahl-node-only\" data-ids=\"f3cb6bbcc32d8dc5\">switch node</a> has three *output* ports and one *input* port. The <a class=\"ahl-node-only\" data-ids=\"e67429070592ba53,a8b53e9c746f7e3e,77aa26522a923ab5\">inject nodes</a> only have one *output* port and zero *input* ports.\n\nThe <a class=\"ahl-node-only\" data-ids=\"4a8999f6d751601e,01c7e1178e5571c1,8d61f790f5ea511d\">debug nodes</a> have zero *output* ports and one *input* port and the <a class=\"ahl-node-only\" data-ids=\"c0c373c795859694,71c86253a96eaf59,dd8bb0320f2a2c94,e1ace6a88d568e89,d17f862d03f9c963\">function nodes</a> have one each input and output port.\n\nBecause of the nature of Node-RED, nodes can only ever have one or zero input ports, but as many output ports as required. Each port can have as many connection wires as required.\n\n### Real life\n\nThe <a class=\"ahl-group-only\" data-ids=\"1c986409de594d1f\">final flow</a> is a real life flow take from one of my projects. This is taken one-to-one from that project and generates a random login code for an email. The use-case is that I do not use passwords rather the system sends the user a login code each time a user wants to log on. The email has been verified before hand (not show here).\n\nOne clarification to make is that the <a class=\"ahl-node-only\" data-ids=\"c4039cc0fdeb4c6b\">link-in node</a> represents the data generator for this flow. In this case the data comes from a web request flow. \n\nLink in and link out nodes can be thought of as portals between flows, they allow flows to be *linked* together. They can be thought of as long-distance pipes for data to flow through. They do not manipulate the data and a link-in node can be connected to one or more link-out nodes.\n\nThe data in this case is a web request from a user who wishes to login. Upon reaching a <a class=\"ahl-node-only\" data-ids=\"a0824d820916a811,9b99a5306fd8841b\">http response node</a>, the user is sent a response.\n\nI will not explain the flow in more detail, rather I hope the reader understands the basics of the flow and therefore the business logic behind this flow. The point I wish to make is that, given a basic understanding of symbolic, visual flow based programs can be grasp faster than the equivalent textual based programs. \n\nThe details of what each function node does is beyond the scope of this writeup and it is not vital to *understanding* the basics of the business logic that happens here. This is the basic premise I am trying to make.\n\n### Conclusion\n\nHaving grasp the basics of Flow Base Programming and having been introduced to the Node-RED terminology, non-developers can quickly grasp the basics of visual code. Rarely does this happen with textual programs. \n\nTextual programming languages place too much focus on algorithms so that for a novice, programs can get very confusing, very quickly. Flow Based Programs and in particular visual FBP focuses on data and data flows. This provides a visual overview of the system and allows one to gradually obtain the algorithmic details, step by step.\n\nWhat I hope to have done is to provide an insight of how visual FBP paradigm is both empowering and makes for better collaboration between various roles.\n\n### Try this at home\n\nIf the reader would be so kind as to send this to their favourite non-developer and ask them whether they can understand Flow Based Programming from this description, the <a href=\"mailto:author@flowhub.org\">author</a> would be very pleased with constructive feedback!\n\nThank you for reading!\n\n### 3D Preview\n\n![img](https://cdn.openmindmap.org/content/1700404963785_Screen_Shot_2023-11-19_at_15.42.12.png)\n","env":[]},{"id":"da7936d50a5b762c","type":"group","z":"ac7774554793f417","name":"Node types","style":{"label":true},"nodes":["c0c373c795859694","e67429070592ba53","8d61f790f5ea511d"],"x":233,"y":203,"w":610,"h":82},{"id":"4ad9d6b654e58ee6","type":"group","z":"ac7774554793f417","name":"Data duplication","style":{"label":true},"nodes":["a8b53e9c746f7e3e","71c86253a96eaf59","dd8bb0320f2a2c94","01c7e1178e5571c1"],"x":233,"y":361.25,"w":588.5,"h":153},{"id":"eecb8f927c5b21f3","type":"group","z":"ac7774554793f417","name":"Data decision","style":{"label":true},"nodes":["f3cb6bbcc32d8dc5","77aa26522a923ab5","e1ace6a88d568e89","4a8999f6d751601e","d17f862d03f9c963"],"x":233,"y":590.5,"w":528.5,"h":224},{"id":"1c986409de594d1f","type":"group","z":"ac7774554793f417","name":"Generate Login Code","style":{"label":true},"nodes":["a0824d820916a811","b815cc7c27599772","77488d4da9048f04","3001e4f9476dfe59","6ff6983264a7be31","ccdaf05bac5f2843","f03c740479e08f4c","80221c50d8593d0e","bf3287703be98ca7","8a1de7bee4ed1b16","9c43081fa4364cd5","77e9059270a3a155","c4039cc0fdeb4c6b","9b99a5306fd8841b","b8cba5bc5185c98b","e98e8998d3b8551a","cb2b161953d1ca1c","f49531b58413d9e4","d772af8ab90b4c90"],"x":233,"y":890.75,"w":2738.0624465942383,"h":273.74998474121094},{"id":"c0c373c795859694","type":"function","z":"ac7774554793f417","g":"da7936d50a5b762c","name":"function","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":538,"y":244,"wires":[["8d61f790f5ea511d"]]},{"id":"e67429070592ba53","type":"inject","z":"ac7774554793f417","g":"da7936d50a5b762c","name":"inject","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":329,"y":244,"wires":[["c0c373c795859694"]]},{"id":"8d61f790f5ea511d","type":"debug","z":"ac7774554793f417","g":"da7936d50a5b762c","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":747,"y":244,"wires":[]},{"id":"a8b53e9c746f7e3e","type":"inject","z":"ac7774554793f417","g":"4ad9d6b654e58ee6","name":"inject","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":329,"y":437.75,"wires":[["71c86253a96eaf59"]]},{"id":"71c86253a96eaf59","type":"function","z":"ac7774554793f417","g":"4ad9d6b654e58ee6","name":"function","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":532,"y":437.75,"wires":[["dd8bb0320f2a2c94","01c7e1178e5571c1"]]},{"id":"dd8bb0320f2a2c94","type":"function","z":"ac7774554793f417","g":"4ad9d6b654e58ee6","name":"function","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":735.5,"y":402.25,"wires":[[]]},{"id":"01c7e1178e5571c1","type":"debug","z":"ac7774554793f417","g":"4ad9d6b654e58ee6","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":725.5,"y":473.25,"wires":[]},{"id":"f3cb6bbcc32d8dc5","type":"switch","z":"ac7774554793f417","g":"eecb8f927c5b21f3","name":"switch","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"},{"t":"eq","v":"","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":502,"y":702.5,"wires":[["e1ace6a88d568e89"],["4a8999f6d751601e"],["d17f862d03f9c963"]]},{"id":"77aa26522a923ab5","type":"inject","z":"ac7774554793f417","g":"eecb8f927c5b21f3","name":"inject","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":329,"y":702.5,"wires":[["f3cb6bbcc32d8dc5"]]},{"id":"e1ace6a88d568e89","type":"function","z":"ac7774554793f417","g":"eecb8f927c5b21f3","name":"function","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":675.5,"y":631.5,"wires":[[]]},{"id":"4a8999f6d751601e","type":"debug","z":"ac7774554793f417","g":"eecb8f927c5b21f3","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":665.5,"y":702.5,"wires":[]},{"id":"d17f862d03f9c963","type":"function","z":"ac7774554793f417","g":"eecb8f927c5b21f3","name":"function","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":675.5,"y":773.5,"wires":[[]]},{"id":"a0824d820916a811","type":"http response","z":"ac7774554793f417","g":"1c986409de594d1f","name":"","statusCode":"","headers":{},"x":2895.0624465942383,"y":1057,"wires":[]},{"id":"b815cc7c27599772","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"check parameters","func":"var payload = msg.payload;\n\nif ( payload.email ) {\n    msg.status = \"db_check\";\n} else {\n    msg.status = \"missing_data\";\n    msg.payload = JSON.stringify({\n            status: \"error\",\n            msg: \"something missing\"\n        });\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":522.5625,"y":948.0000915527344,"wires":[["d772af8ab90b4c90"]]},{"id":"3001e4f9476dfe59","type":"switch","z":"ac7774554793f417","g":"1c986409de594d1f","name":"rowCount","property":"pgsql.rowCount","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"},{"t":"gt","v":"1","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":1080.5624465942383,"y":1053,"wires":[["ccdaf05bac5f2843"],["9c43081fa4364cd5"],["6ff6983264a7be31"]]},{"id":"6ff6983264a7be31","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"email invalid","func":"msg.payload = {\n    status: \"email_invalid\",\n    msg: \"email '\" + msg.origpayload.email + \"' is invalid\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1523.5624694824219,"y":1123.499984741211,"wires":[["9b99a5306fd8841b"]]},{"id":"ccdaf05bac5f2843","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"is email banned or deleted","func":"var usr = msg.payload[0];\n\nif ( !usr.is_banned && usr.is_verified && !usr.is_deleted ) {\n    msg[\"status\"] = \"email_is_good\";\n    msg[\"userdata\"] = usr;\n} else {\n    var payload = {\n        status: \"email_banned\",\n        msg: \"email is no longer valid\",\n        email: usr.email\n    };\n\n    if (!usr.is_banned && !usr.is_verified && !usr.is_deleted) {\n        payload[\"status\"] = \"email_not_verified\";\n        payload[\"msg\"] = \"email not yet verified\";\n    };\n\n    if (!usr.is_banned && !usr.is_verified && !usr.is_deleted && usr.was_created_by_auction) {\n        payload[\"status\"] = \"email_not_signed_up\";\n        payload[\"msg\"] = \"email not yet signed up\";\n    };\n\n    msg = {\n        res: msg.res,\n        status: \"failed\",\n        payload: JSON.stringify(payload)\n    };\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1299.5624465942383,"y":971.5,"wires":[["f03c740479e08f4c"]]},{"id":"f03c740479e08f4c","type":"switch","z":"ac7774554793f417","g":"1c986409de594d1f","name":"","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"email_is_good","vt":"str"},{"t":"neq","v":"email_is_good","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1523.5624694824219,"y":971.4999847412109,"wires":[["80221c50d8593d0e"],["9b99a5306fd8841b"]]},{"id":"bf3287703be98ca7","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"combine old and new payload","func":"msg.payload = {\n    ...msg.payload[0], \n    ...msg.origpayload, \n    status: \"ok\",\n    firstname: msg.userdata.firstname,\n    lastname: msg.userdata.surname\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2650.5624465942383,"y":959.7499847412109,"wires":[["a0824d820916a811"]]},{"id":"8a1de7bee4ed1b16","type":"switch","z":"ac7774554793f417","g":"1c986409de594d1f","name":"rowCount","property":"pgsql.rowCount","propertyType":"msg","rules":[{"t":"gte","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1989.5624694824219,"y":965.6249923706055,"wires":[["bf3287703be98ca7","b8cba5bc5185c98b"],["e98e8998d3b8551a"]]},{"id":"9c43081fa4364cd5","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"email does not exist","func":"msg.payload = JSON.stringify({\n    status: \"does_not_exist\",\n    msg: \"email does not exist in database\"\n});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1523.5624694824219,"y":1054.499984741211,"wires":[["9b99a5306fd8841b"]]},{"id":"77e9059270a3a155","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"error","func":"msg.payload = {\n    status: \"error\",\n    msg: \"something went wrong\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2609.5624465942383,"y":1055.25,"wires":[["a0824d820916a811"]]},{"id":"c4039cc0fdeb4c6b","type":"link in","z":"ac7774554793f417","g":"1c986409de594d1f","name":"[api] login with email","links":["acbc887acc9963d3"],"x":274,"y":948.8925170898438,"wires":[["b815cc7c27599772"]]},{"id":"9b99a5306fd8841b","type":"http response","z":"ac7774554793f417","g":"1c986409de594d1f","name":"","statusCode":"","headers":{},"x":1776.5624694824219,"y":1054.249984741211,"wires":[]},{"id":"b8cba5bc5185c98b","type":"link out","z":"ac7774554793f417","g":"1c986409de594d1f","name":"link out 121","mode":"link","links":["737b6cbde56f6f01","7e2c24a96b97805b"],"x":2226.5624465942383,"y":931.75,"wires":[]},{"id":"cb2b161953d1ca1c","type":"switch","z":"ac7774554793f417","g":"1c986409de594d1f","name":"rowCount","property":"pgsql.rowCount","propertyType":"msg","rules":[{"t":"gte","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":2404.5624465942383,"y":1049.25,"wires":[["bf3287703be98ca7"],["77e9059270a3a155"]]},{"id":"77488d4da9048f04","type":"postgresql","z":"ac7774554793f417","g":"1c986409de594d1f","name":"get user by email","query":"SELECT * \nFROM users\nwhere email = lower('{{ msg.payload.email }}')\n;","postgreSQLConfig":"85672f28419095b4","split":false,"rowsPerMsg":1,"outputs":1,"x":835.5624465942383,"y":1053,"wires":[["3001e4f9476dfe59"]]},{"id":"80221c50d8593d0e","type":"postgresql","z":"ac7774554793f417","g":"1c986409de594d1f","name":"create login code","query":"INSERT into user_login_codes(\n    user_uuid\n) values (\n   '{{#msg.payload}}{{ uuid }}{{/msg.payload}}'\n) \non conflict(user_uuid) do nothing\nRETURNING user_uuid,code as verification_code\n;","postgreSQLConfig":"85672f28419095b4","split":false,"rowsPerMsg":1,"outputs":1,"x":1774.5624465942383,"y":965.6249923706055,"wires":[["8a1de7bee4ed1b16"]]},{"id":"e98e8998d3b8551a","type":"postgresql","z":"ac7774554793f417","g":"1c986409de594d1f","name":"select login code","query":"select\n  user_uuid,\n  code as verification_code\nfrom \n  user_login_codes\nwhere \n  user_uuid = '{{ msg.userdata.uuid }}'\n;\n","postgreSQLConfig":"85672f28419095b4","split":false,"rowsPerMsg":1,"outputs":1,"x":2191.5624465942383,"y":1049.25,"wires":[["cb2b161953d1ca1c"]]},{"id":"f49531b58413d9e4","type":"switch","z":"ac7774554793f417","g":"1c986409de594d1f","name":"Email valid?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":647,"y":1116,"wires":[["77488d4da9048f04"],["6ff6983264a7be31"]],"outputLabels":["Yes","No"],"icon":"node-red/envelope.svg"},{"id":"d772af8ab90b4c90","type":"function","z":"ac7774554793f417","g":"1c986409de594d1f","name":"GATEWAY: payload ok?","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":583,"y":1022,"wires":[["f49531b58413d9e4"]],"icon":"font-awesome/fa-map-signs"},{"id":"85672f28419095b4","type":"postgreSQLConfig","name":"bnbc","host":"PGHOST","hostFieldType":"env","port":"5432","portFieldType":"num","database":"PGDBNAME","databaseFieldType":"env","ssl":"PGSSLMODE","sslFieldType":"env","applicationName":"","applicationNameType":"str","max":"10","maxFieldType":"num","idle":"1000","idleFieldType":"num","connectionTimeout":"10000","connectionTimeoutFieldType":"num","user":"PGUSERNAME","userFieldType":"env","password":"PGPASSWORD","passwordFieldType":"env"}]