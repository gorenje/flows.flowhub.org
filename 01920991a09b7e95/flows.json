[{"id":"01920991a09b7e95","type":"tab","label":"[nodedev] install random package and its source code","disabled":false,"info":"::: aim\n\nSelect a random Node-RED node package, install it and create nodes containing the source code.\n\n:::\n\n::: requirements\n\n- [NodeDev package](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-nodedev)\n- [Introspection package](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection)\n\n:::\n\n### Preview\n\n![img](https://cdn.openmindmap.org/content/1699349662335_randompackage2.gif)\n\n### Description\n\nLearning by doing - learn from other developers working with Node-RED. This flow will install a package and its source code *all* into Node-RED.\n\nIf there is a spare Node-RED instance, then this flow is perfect for getting to know package development in Node-RED.\n\n### Explanation\n\nThe flow retrieves the [catalogue data](https://catalogue.nodered.org/catalogue.json) from nodered.org, it then selects a <a class=\"ahl-node-only\" data-ids=\"52c9212780f97b12\">random package</a>. After generating a notification within Node-RED using the <a class=\"ahl-node-only\" data-ids=\"c47e5318cfe067e9\">ClientCode</a> node, the package `.tgz` url is retrieved.\n\nThe package.tgz is then passed to the <a class=\"ahl-node-only\" data-ids=\"267bfedc40a05e54\">Node-Red Install</a> node and the <a class=\"ahl-node-only\" data-ids=\"c033a54245e93838\">NodeDev NodeFactory</a> node that generates nodes from the source code.\n\nThe NodeFactory node then opens the import dialog with the nodes it has generated. It generates PkgFile nodes that can be used to work on the package and install it into Node-RED in modified form.\n\n","env":[]},{"id":"9cf2508109257245","type":"http request","z":"01920991a09b7e95","name":"GET package catalogue","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://catalogue.nodered.org/catalogue.json?_={{ payload }}","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":984.1429443359375,"y":287.8571472167969,"wires":[["52c9212780f97b12"]]},{"id":"a5748c3e6e5be4a1","type":"inject","z":"01920991a09b7e95","name":"trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":777.5714111328125,"y":143.85711669921875,"wires":[["9cf2508109257245"]]},{"id":"52c9212780f97b12","type":"function","z":"01920991a09b7e95","name":"select random package","func":"msg.payload = msg.payload.modules[Math.floor(Math.random() * msg.payload.modules.length)];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1011.4285888671875,"y":402.14288330078125,"wires":[["c47e5318cfe067e9"]]},{"id":"c47e5318cfe067e9","type":"ClientCode","z":"01920991a09b7e95","name":"","clientcode":"node.send(msg)\n\nRED.notify(\"Installing <a style='color: blue;' href='\" + msg.payload.url + \"' target=_blank>\" + msg.payload.id + \"<i class='fa fa-external-link'></i></a>\" + \": \" + msg.payload.description, {\n    type: \"success\",\n    id: node.id,\n    timeout: 5000\n});\n\nnode.status({\n    fill: 'green',\n    shape: 'dot',\n    text: msg.payload.url\n})\n\nsetTimeout( ()=> {\n    node.status({});\n},2000)","format":"javascript","x":1251,"y":359,"wires":[["ee9f709efd58ce1f"]]},{"id":"ee9f709efd58ce1f","type":"function","z":"01920991a09b7e95","name":"retrieve package.tgz URL for package","func":"pacote.manifest(\n    msg.payload.id.trim() + \"@\" + msg.payload.version.trim()\n).then(manifest => {\n    msg.payload = manifest._resolved\n    msg.url = manifest._resolved\n    node.send(msg)\n}).catch( err => {\n    msg.error = err\n    node.error(\"failed to get url\", msg)\n})\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"pacote","module":"pacote"}],"x":1528,"y":285,"wires":[["8216ba8a5bde5ca2"]]},{"id":"8216ba8a5bde5ca2","type":"http request","z":"01920991a09b7e95","name":"","method":"GET","ret":"bin","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1348,"y":701,"wires":[["c033a54245e93838","267bfedc40a05e54"]]},{"id":"c033a54245e93838","type":"NodeFactory","z":"01920991a09b7e95","name":"","nodename":"WillBeIgnored","color":"#e5e4ef","hasbutton":false,"hasinput":true,"outputcount":1,"category":"","summary":"WillBeIgnored","description":"WillBeIgnored","icon":"font-awesome/fa-industry","frt2bakcomm":false,"bak2frtcomm":false,"createmanifest":false,"isplugin":false,"x":1660,"y":833,"wires":[[]]},{"id":"267bfedc40a05e54","type":"NodeRedInstall","z":"01920991a09b7e95","name":"","x":1669,"y":584,"wires":[[]]}]