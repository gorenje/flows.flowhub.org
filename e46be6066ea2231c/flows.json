[{"id":"e46be6066ea2231c","type":"tab","label":"[Web] Benchmarking requests","disabled":false,"info":"::: aim\n\nTo build a simple [ab](https://httpd.apache.org/docs/2.4/programs/ab.html) tool for simulating website traffic.\n\n:::\n\n::: warning\n\nThis flow contains Http-In endpoinst definitions that could interrupt existing endpoints and services or open your Node-RED installation to malicious attacks.\n\n:::\n\n","env":[]},{"id":"4f370f0a01427fa2","type":"group","z":"e46be6066ea2231c","name":"Define endpoint for testing - assumed to be connected to localhost:1800","style":{"label":true},"nodes":["68b5f5cc96af4dfc","d4f4d119f907475a","b3176bfe3e920a9a","f569c0f5674297ed"],"x":65,"y":958,"w":934,"h":166},{"id":"6bf9baeaba1ea6df","type":"group","z":"e46be6066ea2231c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["4de89aba64f6a744"],"x":65,"y":146,"w":232,"h":82},{"id":"5ea92899c308965f","type":"group","z":"e46be6066ea2231c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["c5071dcbcf7ced38","382756287b464d90"],"x":474,"y":147,"w":332,"h":178},{"id":"6364ee74e6e9a443","type":"group","z":"e46be6066ea2231c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["5c72a477a083347e","c746c66762c1d0aa","b1f2655753a1d22d","a8bc553f7771b98a"],"x":2029,"y":96,"w":326,"h":261},{"id":"0f0c46ada8e678c0","type":"group","z":"e46be6066ea2231c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["ebfe60187962ec1d","1de2adbf5b60cbba","3eb18afccbc7b415"],"x":1917,"y":496,"w":438,"h":226},{"id":"fecc65337eeaedb0","type":"group","z":"e46be6066ea2231c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["bfb961534391079d","b17afc78fb472d40","e6be7a5009f301b6","5f78cbafd3481358","df6c6a244431f5a9","9c39e4c08eb3d981","175c314a82388d54"],"x":851,"y":96,"w":1022,"h":217},{"id":"3d6702761d95ed47","type":"group","z":"e46be6066ea2231c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["0ce9aa4abb433919","3ab21275fe27a799","fdac928f5002b118","ea436141fe6f8a22","17dee616c2ff7322","da30c45c53fe81f8"],"x":65,"y":494,"w":409,"h":254.5},{"id":"4de89aba64f6a744","type":"inject","z":"e46be6066ea2231c","g":"6bf9baeaba1ea6df","name":"set url and count","props":[{"p":"url","v":"http://localhost:1880/end/point","vt":"str"},{"p":"req_count","v":"300","vt":"num"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":191,"y":187,"wires":[["382756287b464d90"]]},{"id":"c5071dcbcf7ced38","type":"function","z":"e46be6066ea2231c","g":"5ea92899c308965f","name":"create count number of messages \\n with requestTimeout","func":"msg.payload = [];\n\nfor ( var idx = 0 ; idx < msg.req_count; idx++ ) {\n    msg.payload.push({\n        ...msg\n    })\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":272,"wires":[["bfb961534391079d"]]},{"id":"bfb961534391079d","type":"split","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":927,"y":272,"wires":[["9c39e4c08eb3d981"]]},{"id":"b17afc78fb472d40","type":"http request","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1473,"y":271,"wires":[["5f78cbafd3481358"]]},{"id":"e6be7a5009f301b6","type":"catch","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"","scope":["b17afc78fb472d40"],"uncaught":false,"x":1500,"y":241,"wires":[[]]},{"id":"5f78cbafd3481358","type":"join","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1797,"y":272,"wires":[["5c72a477a083347e"]]},{"id":"68b5f5cc96af4dfc","type":"http in","z":"e46be6066ea2231c","g":"4f370f0a01427fa2","name":"","url":"/end/point","method":"get","upload":false,"swaggerDoc":"","x":171,"y":1083,"wires":[["b3176bfe3e920a9a"]]},{"id":"d4f4d119f907475a","type":"http response","z":"e46be6066ea2231c","g":"4f370f0a01427fa2","name":"","statusCode":"","headers":{},"x":923,"y":999,"wires":[]},{"id":"ebfe60187962ec1d","type":"function","z":"e46be6066ea2231c","g":"0f0c46ada8e678c0","name":"group by statusCode","func":"var newpload = {};\n\nfor ( var idx = 0; idx < msg.payload.length; idx++ ) {\n    (newpload[msg.payload[idx].statusCode] ||= []).push(msg.payload[idx])\n}\n\nvar labels = [];\nvar data = [];\n\nvar keys = Object.keys(newpload);\n\nfor ( var idx = 0 ; idx < keys.length; idx++ ) {\n    labels.push( keys[idx]);\n    data.push( newpload[ keys[ idx ] ].length );\n}\nmsg.payload = [{\n    \"series\": [\"x\"],\n    \"data\": [ data ],\n    \"labels\": labels\n}];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2043,"y":591,"wires":[["1de2adbf5b60cbba","3eb18afccbc7b415"]]},{"id":"b3176bfe3e920a9a","type":"delay","z":"e46be6066ea2231c","g":"4f370f0a01427fa2","name":"Random delay between 1.5 and 4 seconds","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1500","randomLast":"4000","randomUnits":"milliseconds","drop":false,"allowrate":false,"outputs":1,"x":555,"y":1083,"wires":[["f569c0f5674297ed"]]},{"id":"df6c6a244431f5a9","type":"delay","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"","pauseType":"delay","timeout":"3000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1354,"y":137,"wires":[["175c314a82388d54"]]},{"id":"9c39e4c08eb3d981","type":"function","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"ready, set, go","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1144,"y":272,"wires":[["b17afc78fb472d40","df6c6a244431f5a9"]]},{"id":"175c314a82388d54","type":"change","z":"e46be6066ea2231c","g":"fecc65337eeaedb0","name":"","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"RESP_TIMEDOUT","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1588,"y":137,"wires":[["5f78cbafd3481358"]]},{"id":"f569c0f5674297ed","type":"change","z":"e46be6066ea2231c","g":"4f370f0a01427fa2","name":"Set random status code either 200 or 404 or 500","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"$random() > 0.6 ? 404 : ($random() > 0.3 ? 500 : 200)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":576,"y":999,"wires":[["d4f4d119f907475a"]]},{"id":"5c72a477a083347e","type":"join","z":"e46be6066ea2231c","g":"6364ee74e6e9a443","name":"wait for 2 messages","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"0.5","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2155,"y":137,"wires":[["a8bc553f7771b98a"]]},{"id":"c746c66762c1d0aa","type":"change","z":"e46be6066ea2231c","g":"6364ee74e6e9a443","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0].payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2249,"y":316,"wires":[["ebfe60187962ec1d"]]},{"id":"1de2adbf5b60cbba","type":"debug","z":"e46be6066ea2231c","g":"0f0c46ada8e678c0","name":"results of first resultset","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2171,"y":681,"wires":[]},{"id":"382756287b464d90","type":"change","z":"e46be6066ea2231c","g":"5ea92899c308965f","name":"","rules":[{"t":"set","p":"packetcount","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":633,"y":188,"wires":[["c5071dcbcf7ced38"]]},{"id":"b1f2655753a1d22d","type":"switch","z":"e46be6066ea2231c","g":"6364ee74e6e9a443","name":"","property":"packetcount","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2199,"y":256,"wires":[["c746c66762c1d0aa"]]},{"id":"a8bc553f7771b98a","type":"function","z":"e46be6066ea2231c","g":"6364ee74e6e9a443","name":"function 11","func":"flow.set(\"packetcount\", parseInt(flow.get(\"packetcount\")) + 1 );\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2183,"y":200,"wires":[["b1f2655753a1d22d"]]},{"id":"3eb18afccbc7b415","type":"ui_chart","z":"e46be6066ea2231c","g":"0f0c46ada8e678c0","name":"","group":"26cb9ede1b16da67","order":0,"width":0,"height":0,"label":"chart","chartType":"pie","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":2279,"y":537,"wires":[[]]},{"id":"0ce9aa4abb433919","type":"ui_button","z":"e46be6066ea2231c","g":"3d6702761d95ed47","name":"","group":"26cb9ede1b16da67","order":3,"width":0,"height":0,"passthru":false,"label":"Go!","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":141,"y":535,"wires":[["da30c45c53fe81f8"]]},{"id":"3ab21275fe27a799","type":"ui_numeric","z":"e46be6066ea2231c","g":"3d6702761d95ed47","name":"","label":"count","tooltip":"","group":"26cb9ede1b16da67","order":2,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"count","topicType":"msg","format":"{{value}}","min":0,"max":"10000","step":1,"className":"","x":141,"y":621.25,"wires":[["17dee616c2ff7322"]]},{"id":"fdac928f5002b118","type":"ui_text_input","z":"e46be6066ea2231c","g":"3d6702761d95ed47","name":"","label":"","tooltip":"URL","group":"26cb9ede1b16da67","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"url","sendOnBlur":true,"className":"","topicType":"msg","x":151,"y":707.5,"wires":[["ea436141fe6f8a22"]]},{"id":"ea436141fe6f8a22","type":"change","z":"e46be6066ea2231c","g":"3d6702761d95ed47","name":"","rules":[{"t":"set","p":"url","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":358,"y":707.5,"wires":[[]]},{"id":"17dee616c2ff7322","type":"change","z":"e46be6066ea2231c","g":"3d6702761d95ed47","name":"","rules":[{"t":"set","p":"count","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":368,"y":621.25,"wires":[[]]},{"id":"da30c45c53fe81f8","type":"change","z":"e46be6066ea2231c","g":"3d6702761d95ed47","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"url","tot":"flow"},{"t":"set","p":"req_count","pt":"msg","to":"count","tot":"flow"},{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":368,"y":535,"wires":[["382756287b464d90","0d53d825d5888fa8","3eb18afccbc7b415"]]},{"id":"0d53d825d5888fa8","type":"debug","z":"e46be6066ea2231c","name":"debug 42","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":714,"y":576,"wires":[]},{"id":"26cb9ede1b16da67","type":"ui_group","name":"Graph","tab":"eed79fd69cef6849","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"eed79fd69cef6849","type":"ui_tab","name":"Benchmark","icon":"dashboard","disabled":false,"hidden":false}]