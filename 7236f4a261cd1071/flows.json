[{"id":"7236f4a261cd1071","type":"tab","label":"[Util] Generate self-encapsulated iframe for embedding flows","disabled":false,"info":"::: aim\n\nThis uses the `srcdoc` attribute on iframes to create a self-encapsulated iframe snippet that incorporates the current flow.\n\n:::\n\n### Examples\n\n<iframe width=\"90%\" height=\"100%\" src=\"https://flowhub.org/s/7236f4a261cd1071\" allow=\"clipboard-read; clipboard-write\" style=\"border: none; min-height: 480px;\"></iframe>\n\n\n\n<iframe width=\"100%\" height=\"100%\" srcdoc=\"&amp;lt;!DOCTYPE html&amp;gt;\n&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;\n&amp;lt;head&amp;gt;\n\t&amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset=utf-8&amp;quot; /&amp;gt;\n\t&amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width, initial-scale=1.0&amp;quot;&amp;gt;\n\t&amp;lt;link rel=&amp;quot;icon&amp;quot; type=&amp;quot;image/x-icon&amp;quot; href=&amp;quot;/favicon.ico&amp;quot;/&amp;gt;\n\t&amp;lt;title&amp;gt;FlowHub - Flow Sharing&amp;lt;/title&amp;gt;\n\n    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;https://cdn.openmindmap.org/embed/flowviewer.css&amp;quot;/&amp;gt;\n    &amp;lt;script src=&amp;quot;https://cdn.openmindmap.org/embed/jquery-3.7.0.min.js&amp;quot; crossorigin=&amp;quot;anonymous&amp;quot; referrerpolicy=&amp;quot;no-referrer&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;\n    \n    &amp;lt;style&amp;gt;\n        .flowviewer svg {\n            min-height: 450px;\n        }\n    &amp;lt;/style&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body class=&amp;quot;flowviewer-share&amp;quot;&amp;gt;\n&amp;lt;style&amp;gt;\n.flowviewer {\n    position: relative;\n}\n.flowviewer svg {\n    --red-ui-view-grid-color: #eee;\n    --red-ui-view-border: 1px solid #bbbbbb;\n    --red-ui-node-border: #999;\n    --red-ui-node-background-default: #eee;\n    --red-ui-node-icon-background-color-fill: black;\n    --red-ui-node-icon-background-color-opacity: 0.1;\n    --red-ui-node-label-color: #333;\n    --red-ui-node-port-background: #d9d9d9;\n    --red-ui-link-color: #999;\n    background-color: white;\n    min-height: 450px;\n    border: var(--red-ui-view-border);\n    border-radius: 3px;\n    position: relative;\n}\n\n.flowviewer svg {\n    width: 100%;\n    height: 100%;\n    min-height: 450px;\n    margin: auto;\n    display: block;\n    border-radius: 2px;\n}\n\n.flowviewer svg {\n    cursor: move;\n    cursor: grab;\n}\n\n.flowviewer .dragging {\n    cursor: grabbing;\n}\n\n.flowviewer-tabs {\n    display: flex;\n}\n.flowviewer-tab {\n    padding: 6px 12px;\n    box-sizing: border-box;\n    display: inline-block;\n    border: 1px solid #bbbbbb;\n    border-right: none;\n    background-color: #f0f0f0;\n    max-width: 200px;\n    width: 14%;\n    overflow: hidden;\n    white-space: nowrap;\n    position: relative;\n    margin-top: -1px;\n    transition: 0.2s background-color;\n}\n.flowviewer-tab.active {\n    background-color: white;\n    border-top-color: white;\n}\n.flowviewer-tab:hover {\n    cursor: pointer;\n    background-color: white;\n}\n.flowviewer-tab:last-child {\n    border-right: 1px solid #bbbbbb;\n}\n\n.flowviewer-note {\n    margin-top: 12px;\n    font-size: 0.875rem;\n    font-style: italic;\n}\n\nbody.flowviewer-share {\n    background-color: inherit;\n}\n\n\n.group-text-label {\n    font-family: Helvetica Neue, Arial, Helvetica, sans-serif;\n\tfont-size: 14px;\n}\n\n.node-text-label {\n\tfont-family: Helvetica Neue, Arial, Helvetica, sans-serif;\n\tfont-size: 14px;\n\tdominant-baseline: middle;\n}\n\n.subflow-node-text-label {\n    color: rgb(85, 85, 85);\n    dominant-baseline: middle;\n    font-family: Helvetica Neue, Arial, Helvetica, sans - serif;\n    font-size: 10px;\n    line-height: 20px;\n    pointer-events: none;\n    text-anchor: middle;\n    user-select: none\n}\n\n.subflow-node-text-label-number {\n    color: rgb(85, 85, 85);\n    dominant-baseline: middle;\n    font-family: Helvetica Neue, Arial, Helvetica, sans-serif;\n    font-size: 16px;\n    line-height: 20px;\n    pointer-events: none;\n    text-anchor: middle;\n    user-select: none\n}\n\n.flow-download-link {\n    font-size: 70%;\n}\n\n.flow-copy-to-clipboard-link {\n    font-size: 70%;\n}\n\n.node {\n    fill-opacity: 1;\n    stroke-width: 1px;\n}\n\n.link {\n    stroke: #999;\n    stroke-width: 3;\n    fill: none;\n}\n\n.link-highlight, .node-highlight {\n    stroke: rgb(255, 127, 14);\n}\n.node-highlight {\n    stroke-width: 3px;\n}\n\n.node-disabled {\n\tstroke-dasharray: 8,3;\n\tfill-opacity: 0.5;\n}\n\n.group-highlight {\n    stroke: rgb(255, 127, 14);\n    stroke-width: 4px;\n    fill: rgb(255, 127, 14);\n    fill-opacity: 0.2;\n}\n\n.link-disabled {\n\tstroke-dasharray: 10,8 !important;\n\tstroke-width: 2 !important;\n\tstroke: rgb(204, 204, 204);\n}\n\n.grid-line {\n    shape-rendering: crispedges;\n    stroke: rgb(238, 238, 238);\n    stroke-width: 1px;\n    fill: none;\n}\n.output-deco {\n    stroke-width: 2px;\n    stroke-miterlimit: 4;\n}\n\n.input-deco {\n    stroke-width: 2px;\n    stroke-miterlimit: 4;\n}\n\n.flow-render-error {\n    background-color: rgb(54, 52, 52);\n    color: rgb(196, 59, 59);\n    width: 100%;\n}\n.flowviewer-share-details {\n    padding: 5px;\n    border: 1px solid #aa6767;\n    background: white;\n    border-bottom-right-radius: 3px;\n    border-top-left-radius: 3px;\n    font-size: 0.8em;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n}\n&amp;lt;/style&amp;gt;\n\n&amp;lt;div&amp;gt;\n    &amp;lt;div class=&amp;quot;flowviewer&amp;quot;&amp;gt;\n        &amp;lt;div style=&amp;quot;position: relative&amp;quot;&amp;gt;\n            &amp;lt;svg&amp;gt;\n                &amp;lt;g class=&amp;quot;flowGridlines&amp;quot;&amp;gt;&amp;lt;/g&amp;gt;\n                &amp;lt;g class=&amp;quot;containerGroup&amp;quot;&amp;gt;\n                    &amp;lt;g class=&amp;quot;flowGroups&amp;quot;&amp;gt;&amp;lt;/g&amp;gt;\n                    &amp;lt;g class=&amp;quot;flowWires&amp;quot;&amp;gt;&amp;lt;/g&amp;gt;\n                    &amp;lt;g class=&amp;quot;flowNodes&amp;quot;&amp;gt;&amp;lt;/g&amp;gt;\n                &amp;lt;/g&amp;gt;\n            &amp;lt;/svg&amp;gt;\n            &amp;lt;button id=&amp;quot;copy-flow&amp;quot; class=&amp;quot;copy-button&amp;quot; style=&amp;quot;display: none;&amp;quot;&amp;gt;Copy JSON&amp;lt;/button&amp;gt;\n        &amp;lt;/div&amp;gt;\n        &amp;lt;div style=&amp;quot;display: none;&amp;quot; class=&amp;quot;flowviewer-tabs&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;\n    &amp;lt;/div&amp;gt;\n&amp;lt;/div&amp;gt;\n\n\n&amp;lt;script src=&amp;quot;https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js&amp;quot; integrity=&amp;quot;sha512-M7nHCiNUOwFt6Us3r8alutZLm9qMt4s9951uo8jqO4UwJ1hziseL6O3ndFyigx6+LREfZqnhHxYjKRJ8ZQ69DQ==&amp;quot; crossorigin=&amp;quot;anonymous&amp;quot; referrerpolicy=&amp;quot;no-referrer&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;\n\n&amp;lt;head&amp;gt;\n    &amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;https://cdn.openmindmap.org/embed/flowviewer.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;\n    (function () {\n\n        var atobUtf8 = (content) =&amp;gt; {\n            function base64ToBytes(base64) {\n              const binString = atob(base64);\n              return Uint8Array.from(binString, (m) =&amp;gt; m.codePointAt(0));\n            }\n            return new TextDecoder().decode(base64ToBytes(content));\n        };\n\n        // pull Flow into JS\n        const flow = ( window.frameElement &amp;amp;&amp;amp; window.frameElement.getAttribute(&amp;#039;data-flow&amp;#039;) &amp;amp;&amp;amp; JSON.parse(atobUtf8(window.frameElement.getAttribute(&amp;#039;data-flow&amp;#039;))) ) || [{&amp;quot;id&amp;quot;:&amp;quot;ec554278a5afbd2f&amp;quot;,&amp;quot;type&amp;quot;:&amp;quot;comment&amp;quot;,&amp;quot;z&amp;quot;:&amp;quot;b8a44ab3f9a85b8b&amp;quot;,&amp;quot;name&amp;quot;:&amp;quot;No flow data found, ensure `data-flow` is set on the containing iframe&amp;quot;,&amp;quot;info&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;x&amp;quot;:785,&amp;quot;y&amp;quot;:294,&amp;quot;wires&amp;quot;:[]}];\n\n        /**\n         * Parse the flow.json to get the details on the tabs/subflows present\n         */\n        const processFlow = function (flow) {\n            const tabids = []\n            const tabs = []\n            flow.forEach((d) =&amp;gt; {\n                if (d.type === &amp;#039;subflow&amp;#039;) {\n                    tabids.push(d.id)\n                    tabs.push({\n                        id: d.id,\n                        label: d.name,\n                        type: &amp;#039;subslow&amp;#039;\n                    })\n                } else if (d.z) {\n                    if (tabids.indexOf(d.z) === -1) {\n                        tabids.push(d.z)\n                        tabs.push({\n                            id: d.z,\n                            label: d.z,\n                            type: &amp;#039;tab&amp;#039;,\n                        })\n                    }\n                }\n            })\n            return tabs\n        }\n\n        function addPanZoom () {\n            var svgs = d3.selectAll(&amp;#039;.flowviewer svg&amp;#039;);\n\n            var svg = $(&amp;quot;.flowviewer svg&amp;quot;);\n\n            svg.attr(&amp;#039;width&amp;#039;,&amp;#039;&amp;#039;);\n            svg.attr(&amp;#039;height&amp;#039;,&amp;#039;&amp;#039;);\n            svg.css(&amp;#039;width&amp;#039;, $(&amp;#039;.flowviewer&amp;#039;).width() + &amp;quot;px&amp;quot;);\n            svg.css(&amp;#039;height&amp;#039;, $(&amp;#039;.flowviewer&amp;#039;).height() + &amp;quot;px&amp;quot;);\n            var bbx = $(&amp;quot;.flowviewer svg .containerGroup&amp;quot;)[0].getBBox();\n            svg.attr(&amp;#039;viewBox&amp;#039;, bbx.x + &amp;quot; &amp;quot; + bbx.y + &amp;quot; &amp;quot; + (bbx.width * 1.1) + &amp;quot; &amp;quot; + (bbx.height * 1.1) )\n\n            svgs.each(function() {\n                var svg = d3.select(this);\n\n                svg.html(&amp;#039;&amp;lt;g&amp;gt;&amp;#039; + svg.html() + &amp;#039;&amp;lt;/g&amp;gt;&amp;#039;);\n                var inner = svg.select(&amp;#039;g&amp;#039;);\n                var zoom = d3.zoom()\n                    .scaleExtent([0.3, 100])\n                    .on(&amp;quot;start&amp;quot;, function () {\n                        svg.classed(&amp;quot;dragging&amp;quot;, true);\n                    })\n                    .on(&amp;#039;zoom&amp;#039;, function(event) {\n                        inner.attr(&amp;#039;transform&amp;#039;, event.transform);\n                    })\n                    .on(&amp;quot;end&amp;quot;, function () {\n                        svg.classed(&amp;quot;dragging&amp;quot;, false);\n                    });\n                svg.call(zoom);\n            });\n        }\n\n        const clearFlow = function () {\n            $(&amp;#039;.flowviewer svg .flowGridlines&amp;#039;).empty()\n            $(&amp;#039;.flowviewer svg .flowGroups&amp;#039;).empty()\n            $(&amp;#039;.flowviewer svg .flowWires&amp;#039;).empty()\n            $(&amp;#039;.flowviewer svg .flowNodes&amp;#039;).empty()\n        }\n        // get the tabs/subflows for our provided flow\n        const tabs = processFlow(flow)\n        // sort them such that tabs render first\n        tabs.sort((a, b) =&amp;gt; {\n            return a.type &amp;gt; b.type ? -1 : (a.type &amp;lt; b.type) ? 1 : 0\n        })\n\n        function openTab (id) {\n            // clear any existing flow\n            clearFlow()\n            // draw the new flow - uses function from `public/js/flowviewer.js`\n            renderFlow(id, flow, $(&amp;#039;.flowviewer svg&amp;#039;), {\n               &amp;quot;arrows&amp;quot;: false,\n               &amp;quot;gridlines&amp;quot;: false,\n               &amp;quot;zoom&amp;quot;: false,\n               &amp;quot;images&amp;quot;: true,\n               &amp;quot;linklines&amp;quot;: false,\n               &amp;quot;dllink&amp;quot;: false,\n               &amp;quot;labels&amp;quot;: true,\n            });\n            addPanZoom()\n        }\n\n        function addTab (tab, index) {\n            const classes = &amp;#039;flowviewer-tab flowviewer-&amp;#039; + tab.type\n            const name = tab.type === &amp;#039;tab&amp;#039; ? &amp;#039;Flow &amp;#039; + (index + 1) : tab.label\n            const tabDOM = $(&amp;#039;.flowviewer-tabs&amp;#039;)\n                .append(`&amp;lt;div id=&amp;quot;flowviewer-tab-${index}&amp;quot; class=&amp;quot;${classes}&amp;quot;&amp;gt;${name}&amp;lt;/div&amp;gt;`)\n                .on(&amp;#039;click&amp;#039;, `#flowviewer-tab-${index}`, function () {\n                    // add on click to each new tab\n                    $(&amp;#039;.flowviewer-tab&amp;#039;).removeClass(&amp;#039;active&amp;#039;)\n                    $(this).addClass(&amp;#039;active&amp;#039;)\n                    openTab(tab.id)\n                })\n        }\n\n        tabs.forEach((tab, index) =&amp;gt; {\n            addTab(tab, index)\n        })\n\n        clearFlow();\n        renderFlow(tabs[0].id, flow, $(&amp;#039;.flowviewer svg&amp;#039;), {\n            &amp;quot;arrows&amp;quot;: false,\n            &amp;quot;gridlines&amp;quot;: false,\n            &amp;quot;zoom&amp;quot;: false,\n            &amp;quot;images&amp;quot;: true,\n            &amp;quot;linklines&amp;quot;: true,\n            &amp;quot;dllink&amp;quot;: false,\n            &amp;quot;labels&amp;quot;: true,\n        });\n        \n        addPanZoom();\n        $(&amp;#039;#flowviewer-tab-0&amp;#039;).addClass(&amp;#039;active&amp;#039;)\n        $(&amp;#039;#copy-flow&amp;#039;).on(&amp;#039;click&amp;#039;, function() {\n            navigator.clipboard.writeText(JSON.stringify(flow));\n        })\n    })()\n&amp;lt;/script&amp;gt;&amp;lt;/body&amp;gt;\n\" allow=\"clipboard-read; clipboard-write\" style=\"border: none; min-height: 480px;\" data-flow=\"W3siaWQiOiI3MjM2ZjRhMjYxY2QxMDcxIiwidHlwZSI6InRhYiIsImxhYmVsIjoiW1V0aWxdIEdlbmVyYXRlIHNlbGYtZW5jYXBzdWxhdGVkIGlmcmFtZSBmb3IgZW1iZWRkaW5nIGZsb3dzIiwiZGlzYWJsZWQiOmZhbHNlLCJpbmZvIjoiOjo6IGFpbVxuXG5UaGlzIHVzZXMgdGhlIGBzcmNkb2NgIGF0dHJpYnV0ZSBvbiBpZnJhbWVzIHRvIGNyZWF0ZSBhIHNlbGYtZW5jYXBzdWxhdGVkIGlmcmFtZSBzbmlwcGV0IHRoYXQgaW5jb3Jwb3JhdGVzIHRoZSBjdXJyZW50IGZsb3cuXG5cbjo6OlxuXG4jIyMgRXhhbXBsZXNcblxuPGlmcmFtZSB3aWR0aD1cIjkwJVwiIGhlaWdodD1cIjEwMCVcIiBzcmM9XCJodHRwczovL2Zsb3dodWIub3JnL3MvNzIzNmY0YTI2MWNkMTA3MVwiIGFsbG93PVwiY2xpcGJvYXJkLXJlYWQ7IGNsaXBib2FyZC13cml0ZVwiIHN0eWxlPVwiYm9yZGVyOiBub25lOyBtaW4taGVpZ2h0OiA0ODBweDtcIj48L2lmcmFtZT5cblxuXG5cbjxpZnJhbWUgd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiMTAwJVwiIHNyY2RvYz1cIiZsdDshRE9DVFlQRSBodG1sJmd0O1xuJmx0O2h0bWwgbGFuZz0mcXVvdDtlbiZxdW90OyZndDtcbiZsdDtoZWFkJmd0O1xuXHQmbHQ7bWV0YSBodHRwLWVxdWl2PSZxdW90O0NvbnRlbnQtVHlwZSZxdW90OyBjb250ZW50PSZxdW90O3RleHQvaHRtbDsgY2hhcnNldD11dGYtOCZxdW90OyAvJmd0O1xuXHQmbHQ7bWV0YSBuYW1lPSZxdW90O3ZpZXdwb3J0JnF1b3Q7IGNvbnRlbnQ9JnF1b3Q7d2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCZxdW90OyZndDtcblx0Jmx0O2xpbmsgcmVsPSZxdW90O2ljb24mcXVvdDsgdHlwZT0mcXVvdDtpbWFnZS94LWljb24mcXVvdDsgaHJlZj0mcXVvdDsvZmF2aWNvbi5pY28mcXVvdDsvJmd0O1xuXHQmbHQ7dGl0bGUmZ3Q7Rmxvd0h1YiAtIEZsb3cgU2hhcmluZyZsdDsvdGl0bGUmZ3Q7XG5cbiAgICAmbHQ7bGluayByZWw9JnF1b3Q7c3R5bGVzaGVldCZxdW90OyBocmVmPSZxdW90O2h0dHBzOi8vY2RuLm9wZW5taW5kbWFwLm9yZy9lbWJlZC9mbG93dmlld2VyLmNzcyZxdW90Oy8mZ3Q7XG4gICAgJmx0O3NjcmlwdCBzcmM9JnF1b3Q7aHR0cHM6Ly9jZG4ub3Blbm1pbmRtYXAub3JnL2VtYmVkL2pxdWVyeS0zLjcuMC5taW4uanMmcXVvdDsgY3Jvc3NvcmlnaW49JnF1b3Q7YW5vbnltb3VzJnF1b3Q7IHJlZmVycmVycG9saWN5PSZxdW90O25vLXJlZmVycmVyJnF1b3Q7Jmd0OyZsdDsvc2NyaXB0Jmd0O1xuICAgIFxuICAgICZsdDtzdHlsZSZndDtcbiAgICAgICAgLmZsb3d2aWV3ZXIgc3ZnIHtcbiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDQ1MHB4O1xuICAgICAgICB9XG4gICAgJmx0Oy9zdHlsZSZndDtcbiZsdDsvaGVhZCZndDtcbiZsdDtib2R5IGNsYXNzPSZxdW90O2Zsb3d2aWV3ZXItc2hhcmUmcXVvdDsmZ3Q7XG4mbHQ7c3R5bGUmZ3Q7XG4uZmxvd3ZpZXdlciB7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xufVxuLmZsb3d2aWV3ZXIgc3ZnIHtcbiAgICAtLXJlZC11aS12aWV3LWdyaWQtY29sb3I6ICNlZWU7XG4gICAgLS1yZWQtdWktdmlldy1ib3JkZXI6IDFweCBzb2xpZCAjYmJiYmJiO1xuICAgIC0tcmVkLXVpLW5vZGUtYm9yZGVyOiAjOTk5O1xuICAgIC0tcmVkLXVpLW5vZGUtYmFja2dyb3VuZC1kZWZhdWx0OiAjZWVlO1xuICAgIC0tcmVkLXVpLW5vZGUtaWNvbi1iYWNrZ3JvdW5kLWNvbG9yLWZpbGw6IGJsYWNrO1xuICAgIC0tcmVkLXVpLW5vZGUtaWNvbi1iYWNrZ3JvdW5kLWNvbG9yLW9wYWNpdHk6IDAuMTtcbiAgICAtLXJlZC11aS1ub2RlLWxhYmVsLWNvbG9yOiAjMzMzO1xuICAgIC0tcmVkLXVpLW5vZGUtcG9ydC1iYWNrZ3JvdW5kOiAjZDlkOWQ5O1xuICAgIC0tcmVkLXVpLWxpbmstY29sb3I6ICM5OTk7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgbWluLWhlaWdodDogNDUwcHg7XG4gICAgYm9yZGVyOiB2YXIoLS1yZWQtdWktdmlldy1ib3JkZXIpO1xuICAgIGJvcmRlci1yYWRpdXM6IDNweDtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG59XG5cbi5mbG93dmlld2VyIHN2ZyB7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgaGVpZ2h0OiAxMDAlO1xuICAgIG1pbi1oZWlnaHQ6IDQ1MHB4O1xuICAgIG1hcmdpbjogYXV0bztcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgICBib3JkZXItcmFkaXVzOiAycHg7XG59XG5cbi5mbG93dmlld2VyIHN2ZyB7XG4gICAgY3Vyc29yOiBtb3ZlO1xuICAgIGN1cnNvcjogZ3JhYjtcbn1cblxuLmZsb3d2aWV3ZXIgLmRyYWdnaW5nIHtcbiAgICBjdXJzb3I6IGdyYWJiaW5nO1xufVxuXG4uZmxvd3ZpZXdlci10YWJzIHtcbiAgICBkaXNwbGF5OiBmbGV4O1xufVxuLmZsb3d2aWV3ZXItdGFiIHtcbiAgICBwYWRkaW5nOiA2cHggMTJweDtcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICBib3JkZXI6IDFweCBzb2xpZCAjYmJiYmJiO1xuICAgIGJvcmRlci1yaWdodDogbm9uZTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmMGYwO1xuICAgIG1heC13aWR0aDogMjAwcHg7XG4gICAgd2lkdGg6IDE0JTtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIG1hcmdpbi10b3A6IC0xcHg7XG4gICAgdHJhbnNpdGlvbjogMC4ycyBiYWNrZ3JvdW5kLWNvbG9yO1xufVxuLmZsb3d2aWV3ZXItdGFiLmFjdGl2ZSB7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgYm9yZGVyLXRvcC1jb2xvcjogd2hpdGU7XG59XG4uZmxvd3ZpZXdlci10YWI6aG92ZXIge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcbn1cbi5mbG93dmlld2VyLXRhYjpsYXN0LWNoaWxkIHtcbiAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjYmJiYmJiO1xufVxuXG4uZmxvd3ZpZXdlci1ub3RlIHtcbiAgICBtYXJnaW4tdG9wOiAxMnB4O1xuICAgIGZvbnQtc2l6ZTogMC44NzVyZW07XG4gICAgZm9udC1zdHlsZTogaXRhbGljO1xufVxuXG5ib2R5LmZsb3d2aWV3ZXItc2hhcmUge1xuICAgIGJhY2tncm91bmQtY29sb3I6IGluaGVyaXQ7XG59XG5cblxuLmdyb3VwLXRleHQtbGFiZWwge1xuICAgIGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2EgTmV1ZSwgQXJpYWwsIEhlbHZldGljYSwgc2Fucy1zZXJpZjtcblx0Zm9udC1zaXplOiAxNHB4O1xufVxuXG4ubm9kZS10ZXh0LWxhYmVsIHtcblx0Zm9udC1mYW1pbHk6IEhlbHZldGljYSBOZXVlLCBBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmO1xuXHRmb250LXNpemU6IDE0cHg7XG5cdGRvbWluYW50LWJhc2VsaW5lOiBtaWRkbGU7XG59XG5cbi5zdWJmbG93LW5vZGUtdGV4dC1sYWJlbCB7XG4gICAgY29sb3I6IHJnYig4NSwgODUsIDg1KTtcbiAgICBkb21pbmFudC1iYXNlbGluZTogbWlkZGxlO1xuICAgIGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2EgTmV1ZSwgQXJpYWwsIEhlbHZldGljYSwgc2FucyAtIHNlcmlmO1xuICAgIGZvbnQtc2l6ZTogMTBweDtcbiAgICBsaW5lLWhlaWdodDogMjBweDtcbiAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICB0ZXh0LWFuY2hvcjogbWlkZGxlO1xuICAgIHVzZXItc2VsZWN0OiBub25lXG59XG5cbi5zdWJmbG93LW5vZGUtdGV4dC1sYWJlbC1udW1iZXIge1xuICAgIGNvbG9yOiByZ2IoODUsIDg1LCA4NSk7XG4gICAgZG9taW5hbnQtYmFzZWxpbmU6IG1pZGRsZTtcbiAgICBmb250LWZhbWlseTogSGVsdmV0aWNhIE5ldWUsIEFyaWFsLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7XG4gICAgZm9udC1zaXplOiAxNnB4O1xuICAgIGxpbmUtaGVpZ2h0OiAyMHB4O1xuICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICAgIHRleHQtYW5jaG9yOiBtaWRkbGU7XG4gICAgdXNlci1zZWxlY3Q6IG5vbmVcbn1cblxuLmZsb3ctZG93bmxvYWQtbGluayB7XG4gICAgZm9udC1zaXplOiA3MCU7XG59XG5cbi5mbG93LWNvcHktdG8tY2xpcGJvYXJkLWxpbmsge1xuICAgIGZvbnQtc2l6ZTogNzAlO1xufVxuXG4ubm9kZSB7XG4gICAgZmlsbC1vcGFjaXR5OiAxO1xuICAgIHN0cm9rZS13aWR0aDogMXB4O1xufVxuXG4ubGluayB7XG4gICAgc3Ryb2tlOiAjOTk5O1xuICAgIHN0cm9rZS13aWR0aDogMztcbiAgICBmaWxsOiBub25lO1xufVxuXG4ubGluay1oaWdobGlnaHQsIC5ub2RlLWhpZ2hsaWdodCB7XG4gICAgc3Ryb2tlOiByZ2IoMjU1LCAxMjcsIDE0KTtcbn1cbi5ub2RlLWhpZ2hsaWdodCB7XG4gICAgc3Ryb2tlLXdpZHRoOiAzcHg7XG59XG5cbi5ub2RlLWRpc2FibGVkIHtcblx0c3Ryb2tlLWRhc2hhcnJheTogOCwzO1xuXHRmaWxsLW9wYWNpdHk6IDAuNTtcbn1cblxuLmdyb3VwLWhpZ2hsaWdodCB7XG4gICAgc3Ryb2tlOiByZ2IoMjU1LCAxMjcsIDE0KTtcbiAgICBzdHJva2Utd2lkdGg6IDRweDtcbiAgICBmaWxsOiByZ2IoMjU1LCAxMjcsIDE0KTtcbiAgICBmaWxsLW9wYWNpdHk6IDAuMjtcbn1cblxuLmxpbmstZGlzYWJsZWQge1xuXHRzdHJva2UtZGFzaGFycmF5OiAxMCw4ICFpbXBvcnRhbnQ7XG5cdHN0cm9rZS13aWR0aDogMiAhaW1wb3J0YW50O1xuXHRzdHJva2U6IHJnYigyMDQsIDIwNCwgMjA0KTtcbn1cblxuLmdyaWQtbGluZSB7XG4gICAgc2hhcGUtcmVuZGVyaW5nOiBjcmlzcGVkZ2VzO1xuICAgIHN0cm9rZTogcmdiKDIzOCwgMjM4LCAyMzgpO1xuICAgIHN0cm9rZS13aWR0aDogMXB4O1xuICAgIGZpbGw6IG5vbmU7XG59XG4ub3V0cHV0LWRlY28ge1xuICAgIHN0cm9rZS13aWR0aDogMnB4O1xuICAgIHN0cm9rZS1taXRlcmxpbWl0OiA0O1xufVxuXG4uaW5wdXQtZGVjbyB7XG4gICAgc3Ryb2tlLXdpZHRoOiAycHg7XG4gICAgc3Ryb2tlLW1pdGVybGltaXQ6IDQ7XG59XG5cbi5mbG93LXJlbmRlci1lcnJvciB7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDU0LCA1MiwgNTIpO1xuICAgIGNvbG9yOiByZ2IoMTk2LCA1OSwgNTkpO1xuICAgIHdpZHRoOiAxMDAlO1xufVxuLmZsb3d2aWV3ZXItc2hhcmUtZGV0YWlscyB7XG4gICAgcGFkZGluZzogNXB4O1xuICAgIGJvcmRlcjogMXB4IHNvbGlkICNhYTY3Njc7XG4gICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDNweDtcbiAgICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAzcHg7XG4gICAgZm9udC1zaXplOiAwLjhlbTtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgYm90dG9tOiAwO1xuICAgIHJpZ2h0OiAwO1xufVxuJmx0Oy9zdHlsZSZndDtcblxuJmx0O2RpdiZndDtcbiAgICAmbHQ7ZGl2IGNsYXNzPSZxdW90O2Zsb3d2aWV3ZXImcXVvdDsmZ3Q7XG4gICAgICAgICZsdDtkaXYgc3R5bGU9JnF1b3Q7cG9zaXRpb246IHJlbGF0aXZlJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgJmx0O3N2ZyZndDtcbiAgICAgICAgICAgICAgICAmbHQ7ZyBjbGFzcz0mcXVvdDtmbG93R3JpZGxpbmVzJnF1b3Q7Jmd0OyZsdDsvZyZndDtcbiAgICAgICAgICAgICAgICAmbHQ7ZyBjbGFzcz0mcXVvdDtjb250YWluZXJHcm91cCZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2cgY2xhc3M9JnF1b3Q7Zmxvd0dyb3VwcyZxdW90OyZndDsmbHQ7L2cmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtnIGNsYXNzPSZxdW90O2Zsb3dXaXJlcyZxdW90OyZndDsmbHQ7L2cmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtnIGNsYXNzPSZxdW90O2Zsb3dOb2RlcyZxdW90OyZndDsmbHQ7L2cmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0Oy9nJmd0O1xuICAgICAgICAgICAgJmx0Oy9zdmcmZ3Q7XG4gICAgICAgICAgICAmbHQ7YnV0dG9uIGlkPSZxdW90O2NvcHktZmxvdyZxdW90OyBjbGFzcz0mcXVvdDtjb3B5LWJ1dHRvbiZxdW90OyBzdHlsZT0mcXVvdDtkaXNwbGF5OiBub25lOyZxdW90OyZndDtDb3B5IEpTT04mbHQ7L2J1dHRvbiZndDtcbiAgICAgICAgJmx0Oy9kaXYmZ3Q7XG4gICAgICAgICZsdDtkaXYgc3R5bGU9JnF1b3Q7ZGlzcGxheTogbm9uZTsmcXVvdDsgY2xhc3M9JnF1b3Q7Zmxvd3ZpZXdlci10YWJzJnF1b3Q7Jmd0OyZsdDsvZGl2Jmd0O1xuICAgICZsdDsvZGl2Jmd0O1xuJmx0Oy9kaXYmZ3Q7XG5cblxuJmx0O3NjcmlwdCBzcmM9JnF1b3Q7aHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZDMvNy44LjUvZDMubWluLmpzJnF1b3Q7IGludGVncml0eT0mcXVvdDtzaGE1MTItTTduSENpTlVPd0Z0NlVzM3I4YWx1dFpMbTlxTXQ0czk5NTF1bzhqcU80VXdKMWh6aXNlTDZPM25kRnlpZ3g2K0xSRWZacW5oSHhZaktSSjhaUTY5RFE9PSZxdW90OyBjcm9zc29yaWdpbj0mcXVvdDthbm9ueW1vdXMmcXVvdDsgcmVmZXJyZXJwb2xpY3k9JnF1b3Q7bm8tcmVmZXJyZXImcXVvdDsmZ3Q7Jmx0Oy9zY3JpcHQmZ3Q7XG5cbiZsdDtoZWFkJmd0O1xuICAgICZsdDtzY3JpcHQgdHlwZT0mcXVvdDt0ZXh0L2phdmFzY3JpcHQmcXVvdDsgc3JjPSZxdW90O2h0dHBzOi8vY2RuLm9wZW5taW5kbWFwLm9yZy9lbWJlZC9mbG93dmlld2VyLmpzJnF1b3Q7Jmd0OyZsdDsvc2NyaXB0Jmd0O1xuJmx0Oy9oZWFkJmd0O1xuJmx0O3NjcmlwdCB0eXBlPSZxdW90O3RleHQvamF2YXNjcmlwdCZxdW90OyZndDtcbiAgICAoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHZhciBhdG9iVXRmOCA9IChjb250ZW50KSA9Jmd0OyB7XG4gICAgICAgICAgICBmdW5jdGlvbiBiYXNlNjRUb0J5dGVzKGJhc2U2NCkge1xuICAgICAgICAgICAgICBjb25zdCBiaW5TdHJpbmcgPSBhdG9iKGJhc2U2NCk7XG4gICAgICAgICAgICAgIHJldHVybiBVaW50OEFycmF5LmZyb20oYmluU3RyaW5nLCAobSkgPSZndDsgbS5jb2RlUG9pbnRBdCgwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGJhc2U2NFRvQnl0ZXMoY29udGVudCkpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1bGwgRmxvdyBpbnRvIEpTXG4gICAgICAgIGNvbnN0IGZsb3cgPSAoIHdpbmRvdy5mcmFtZUVsZW1lbnQgJmFtcDsmYW1wOyB3aW5kb3cuZnJhbWVFbGVtZW50LmdldEF0dHJpYnV0ZSgmIzAzOTtkYXRhLWZsb3cmIzAzOTspICZhbXA7JmFtcDsgSlNPTi5wYXJzZShhdG9iVXRmOCh3aW5kb3cuZnJhbWVFbGVtZW50LmdldEF0dHJpYnV0ZSgmIzAzOTtkYXRhLWZsb3cmIzAzOTspKSkgKSB8fCBbeyZxdW90O2lkJnF1b3Q7OiZxdW90O2VjNTU0Mjc4YTVhZmJkMmYmcXVvdDssJnF1b3Q7dHlwZSZxdW90OzomcXVvdDtjb21tZW50JnF1b3Q7LCZxdW90O3omcXVvdDs6JnF1b3Q7YjhhNDRhYjNmOWE4NWI4YiZxdW90OywmcXVvdDtuYW1lJnF1b3Q7OiZxdW90O05vIGZsb3cgZGF0YSBmb3VuZCwgZW5zdXJlIGBkYXRhLWZsb3dgIGlzIHNldCBvbiB0aGUgY29udGFpbmluZyBpZnJhbWUmcXVvdDssJnF1b3Q7aW5mbyZxdW90OzomcXVvdDsmcXVvdDssJnF1b3Q7eCZxdW90Ozo3ODUsJnF1b3Q7eSZxdW90OzoyOTQsJnF1b3Q7d2lyZXMmcXVvdDs6W119XTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGFyc2UgdGhlIGZsb3cuanNvbiB0byBnZXQgdGhlIGRldGFpbHMgb24gdGhlIHRhYnMvc3ViZmxvd3MgcHJlc2VudFxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgcHJvY2Vzc0Zsb3cgPSBmdW5jdGlvbiAoZmxvdykge1xuICAgICAgICAgICAgY29uc3QgdGFiaWRzID0gW11cbiAgICAgICAgICAgIGNvbnN0IHRhYnMgPSBbXVxuICAgICAgICAgICAgZmxvdy5mb3JFYWNoKChkKSA9Jmd0OyB7XG4gICAgICAgICAgICAgICAgaWYgKGQudHlwZSA9PT0gJiMwMzk7c3ViZmxvdyYjMDM5Oykge1xuICAgICAgICAgICAgICAgICAgICB0YWJpZHMucHVzaChkLmlkKVxuICAgICAgICAgICAgICAgICAgICB0YWJzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJiMwMzk7c3Vic2xvdyYjMDM5O1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZC56KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWJpZHMuaW5kZXhPZihkLnopID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFiaWRzLnB1c2goZC56KVxuICAgICAgICAgICAgICAgICAgICAgICAgdGFicy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZC56LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBkLnosXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJiMwMzk7dGFiJiMwMzk7LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm4gdGFic1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkUGFuWm9vbSAoKSB7XG4gICAgICAgICAgICB2YXIgc3ZncyA9IGQzLnNlbGVjdEFsbCgmIzAzOTsuZmxvd3ZpZXdlciBzdmcmIzAzOTspO1xuXG4gICAgICAgICAgICB2YXIgc3ZnID0gJCgmcXVvdDsuZmxvd3ZpZXdlciBzdmcmcXVvdDspO1xuXG4gICAgICAgICAgICBzdmcuYXR0cigmIzAzOTt3aWR0aCYjMDM5OywmIzAzOTsmIzAzOTspO1xuICAgICAgICAgICAgc3ZnLmF0dHIoJiMwMzk7aGVpZ2h0JiMwMzk7LCYjMDM5OyYjMDM5Oyk7XG4gICAgICAgICAgICBzdmcuY3NzKCYjMDM5O3dpZHRoJiMwMzk7LCAkKCYjMDM5Oy5mbG93dmlld2VyJiMwMzk7KS53aWR0aCgpICsgJnF1b3Q7cHgmcXVvdDspO1xuICAgICAgICAgICAgc3ZnLmNzcygmIzAzOTtoZWlnaHQmIzAzOTssICQoJiMwMzk7LmZsb3d2aWV3ZXImIzAzOTspLmhlaWdodCgpICsgJnF1b3Q7cHgmcXVvdDspO1xuICAgICAgICAgICAgdmFyIGJieCA9ICQoJnF1b3Q7LmZsb3d2aWV3ZXIgc3ZnIC5jb250YWluZXJHcm91cCZxdW90OylbMF0uZ2V0QkJveCgpO1xuICAgICAgICAgICAgc3ZnLmF0dHIoJiMwMzk7dmlld0JveCYjMDM5OywgYmJ4LnggKyAmcXVvdDsgJnF1b3Q7ICsgYmJ4LnkgKyAmcXVvdDsgJnF1b3Q7ICsgKGJieC53aWR0aCAqIDEuMSkgKyAmcXVvdDsgJnF1b3Q7ICsgKGJieC5oZWlnaHQgKiAxLjEpIClcblxuICAgICAgICAgICAgc3Zncy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBzdmcuaHRtbCgmIzAzOTsmbHQ7ZyZndDsmIzAzOTsgKyBzdmcuaHRtbCgpICsgJiMwMzk7Jmx0Oy9nJmd0OyYjMDM5Oyk7XG4gICAgICAgICAgICAgICAgdmFyIGlubmVyID0gc3ZnLnNlbGVjdCgmIzAzOTtnJiMwMzk7KTtcbiAgICAgICAgICAgICAgICB2YXIgem9vbSA9IGQzLnpvb20oKVxuICAgICAgICAgICAgICAgICAgICAuc2NhbGVFeHRlbnQoWzAuMywgMTAwXSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKCZxdW90O3N0YXJ0JnF1b3Q7LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdmcuY2xhc3NlZCgmcXVvdDtkcmFnZ2luZyZxdW90OywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbigmIzAzOTt6b29tJiMwMzk7LCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXIuYXR0cigmIzAzOTt0cmFuc2Zvcm0mIzAzOTssIGV2ZW50LnRyYW5zZm9ybSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbigmcXVvdDtlbmQmcXVvdDssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN2Zy5jbGFzc2VkKCZxdW90O2RyYWdnaW5nJnF1b3Q7LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN2Zy5jYWxsKHpvb20pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjbGVhckZsb3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCYjMDM5Oy5mbG93dmlld2VyIHN2ZyAuZmxvd0dyaWRsaW5lcyYjMDM5OykuZW1wdHkoKVxuICAgICAgICAgICAgJCgmIzAzOTsuZmxvd3ZpZXdlciBzdmcgLmZsb3dHcm91cHMmIzAzOTspLmVtcHR5KClcbiAgICAgICAgICAgICQoJiMwMzk7LmZsb3d2aWV3ZXIgc3ZnIC5mbG93V2lyZXMmIzAzOTspLmVtcHR5KClcbiAgICAgICAgICAgICQoJiMwMzk7LmZsb3d2aWV3ZXIgc3ZnIC5mbG93Tm9kZXMmIzAzOTspLmVtcHR5KClcbiAgICAgICAgfVxuICAgICAgICAvLyBnZXQgdGhlIHRhYnMvc3ViZmxvd3MgZm9yIG91ciBwcm92aWRlZCBmbG93XG4gICAgICAgIGNvbnN0IHRhYnMgPSBwcm9jZXNzRmxvdyhmbG93KVxuICAgICAgICAvLyBzb3J0IHRoZW0gc3VjaCB0aGF0IHRhYnMgcmVuZGVyIGZpcnN0XG4gICAgICAgIHRhYnMuc29ydCgoYSwgYikgPSZndDsge1xuICAgICAgICAgICAgcmV0dXJuIGEudHlwZSAmZ3Q7IGIudHlwZSA/IC0xIDogKGEudHlwZSAmbHQ7IGIudHlwZSkgPyAxIDogMFxuICAgICAgICB9KVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5UYWIgKGlkKSB7XG4gICAgICAgICAgICAvLyBjbGVhciBhbnkgZXhpc3RpbmcgZmxvd1xuICAgICAgICAgICAgY2xlYXJGbG93KClcbiAgICAgICAgICAgIC8vIGRyYXcgdGhlIG5ldyBmbG93IC0gdXNlcyBmdW5jdGlvbiBmcm9tIGBwdWJsaWMvanMvZmxvd3ZpZXdlci5qc2BcbiAgICAgICAgICAgIHJlbmRlckZsb3coaWQsIGZsb3csICQoJiMwMzk7LmZsb3d2aWV3ZXIgc3ZnJiMwMzk7KSwge1xuICAgICAgICAgICAgICAgJnF1b3Q7YXJyb3dzJnF1b3Q7OiBmYWxzZSxcbiAgICAgICAgICAgICAgICZxdW90O2dyaWRsaW5lcyZxdW90OzogZmFsc2UsXG4gICAgICAgICAgICAgICAmcXVvdDt6b29tJnF1b3Q7OiBmYWxzZSxcbiAgICAgICAgICAgICAgICZxdW90O2ltYWdlcyZxdW90OzogdHJ1ZSxcbiAgICAgICAgICAgICAgICZxdW90O2xpbmtsaW5lcyZxdW90OzogZmFsc2UsXG4gICAgICAgICAgICAgICAmcXVvdDtkbGxpbmsmcXVvdDs6IGZhbHNlLFxuICAgICAgICAgICAgICAgJnF1b3Q7bGFiZWxzJnF1b3Q7OiB0cnVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhZGRQYW5ab29tKClcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFkZFRhYiAodGFiLCBpbmRleCkge1xuICAgICAgICAgICAgY29uc3QgY2xhc3NlcyA9ICYjMDM5O2Zsb3d2aWV3ZXItdGFiIGZsb3d2aWV3ZXItJiMwMzk7ICsgdGFiLnR5cGVcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0YWIudHlwZSA9PT0gJiMwMzk7dGFiJiMwMzk7ID8gJiMwMzk7RmxvdyAmIzAzOTsgKyAoaW5kZXggKyAxKSA6IHRhYi5sYWJlbFxuICAgICAgICAgICAgY29uc3QgdGFiRE9NID0gJCgmIzAzOTsuZmxvd3ZpZXdlci10YWJzJiMwMzk7KVxuICAgICAgICAgICAgICAgIC5hcHBlbmQoYCZsdDtkaXYgaWQ9JnF1b3Q7Zmxvd3ZpZXdlci10YWItJHtpbmRleH0mcXVvdDsgY2xhc3M9JnF1b3Q7JHtjbGFzc2VzfSZxdW90OyZndDske25hbWV9Jmx0Oy9kaXYmZ3Q7YClcbiAgICAgICAgICAgICAgICAub24oJiMwMzk7Y2xpY2smIzAzOTssIGAjZmxvd3ZpZXdlci10YWItJHtpbmRleH1gLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBvbiBjbGljayB0byBlYWNoIG5ldyB0YWJcbiAgICAgICAgICAgICAgICAgICAgJCgmIzAzOTsuZmxvd3ZpZXdlci10YWImIzAzOTspLnJlbW92ZUNsYXNzKCYjMDM5O2FjdGl2ZSYjMDM5OylcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygmIzAzOTthY3RpdmUmIzAzOTspXG4gICAgICAgICAgICAgICAgICAgIG9wZW5UYWIodGFiLmlkKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICB0YWJzLmZvckVhY2goKHRhYiwgaW5kZXgpID0mZ3Q7IHtcbiAgICAgICAgICAgIGFkZFRhYih0YWIsIGluZGV4KVxuICAgICAgICB9KVxuXG4gICAgICAgIGNsZWFyRmxvdygpO1xuICAgICAgICByZW5kZXJGbG93KHRhYnNbMF0uaWQsIGZsb3csICQoJiMwMzk7LmZsb3d2aWV3ZXIgc3ZnJiMwMzk7KSwge1xuICAgICAgICAgICAgJnF1b3Q7YXJyb3dzJnF1b3Q7OiBmYWxzZSxcbiAgICAgICAgICAgICZxdW90O2dyaWRsaW5lcyZxdW90OzogZmFsc2UsXG4gICAgICAgICAgICAmcXVvdDt6b29tJnF1b3Q7OiBmYWxzZSxcbiAgICAgICAgICAgICZxdW90O2ltYWdlcyZxdW90OzogdHJ1ZSxcbiAgICAgICAgICAgICZxdW90O2xpbmtsaW5lcyZxdW90OzogdHJ1ZSxcbiAgICAgICAgICAgICZxdW90O2RsbGluayZxdW90OzogZmFsc2UsXG4gICAgICAgICAgICAmcXVvdDtsYWJlbHMmcXVvdDs6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgYWRkUGFuWm9vbSgpO1xuICAgICAgICAkKCYjMDM5OyNmbG93dmlld2VyLXRhYi0wJiMwMzk7KS5hZGRDbGFzcygmIzAzOTthY3RpdmUmIzAzOTspXG4gICAgICAgICQoJiMwMzk7I2NvcHktZmxvdyYjMDM5Oykub24oJiMwMzk7Y2xpY2smIzAzOTssIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoSlNPTi5zdHJpbmdpZnkoZmxvdykpO1xuICAgICAgICB9KVxuICAgIH0pKClcbiZsdDsvc2NyaXB0Jmd0OyZsdDsvYm9keSZndDtcblwiIGFsbG93PVwiY2xpcGJvYXJkLXJlYWQ7IGNsaXBib2FyZC13cml0ZVwiIHN0eWxlPVwiYm9yZGVyOiBub25lOyBtaW4taGVpZ2h0OiA0ODBweDtcIiBkYXRhLWZsb3c9XCJXM3NpYVdRaU9pSTNNak0yWmpSaE1qWXhZMlF4TURjeElpd2lkSGx3WlNJNkluUmhZaUlzSW14aFltVnNJam9pVzFWMGFXeGRJRWRsYm1WeVlYUmxJSE5sYkdZdFpXNWpZWEJ6ZFd4aGRHVmtJR2xtY21GdFpTQm1iM0lnWlcxaVpXUmthVzVuSUdac2IzZHpJaXdpWkdsellXSnNaV1FpT21aaGJITmxMQ0pwYm1adklqb2lPam82SUdGcGJWeHVYRzVVYUdseklIVnpaWE1nZEdobElHQnpjbU5rYjJOZ0lHRjBkSEpwWW5WMFpTQnZiaUJwWm5KaGJXVnpJSFJ2SUdOeVpXRjBaU0JoSUhObGJHWXRaVzVqWVhCemRXeGhkR1ZrSUdsbWNtRnRaU0J6Ym1sd2NHVjBJSFJvWVhRZ2FXNWpiM0p3YjNKaGRHVnpJSFJvWlNCamRYSnlaVzUwSUdac2IzY3VYRzVjYmpvNk9seHVYRzRqSXlNZ1JYaGhiWEJzWlZ4dVhHNGlMQ0psYm5ZaU9sdGRmU3g3SW1sa0lqb2laREE1WVRNeE5qVm1ZekZsTURVeU9TSXNJblI1Y0dVaU9pSnFkVzVqZEdsdmJpSXNJbm9pT2lJM01qTTJaalJoTWpZeFkyUXhNRGN4SWl3aWVDSTZNVEE1TkM0NU1UZ3pPVEUwTmpZeE5EQTNMQ0o1SWpveE1USXVOVGN4TkRNd016STFOVEE0TVRJc0luZHBjbVZ6SWpwYld5SXhNakk1TldJMU9EUXdOak5qT1dOaElsMWRmU3g3SW1sa0lqb2lZVEExWkRreVlXRmtOekkxTkdZME9DSXNJblI1Y0dVaU9pSm1kVzVqZEdsdmJpSXNJbm9pT2lJM01qTTJaalJoTWpZeFkyUXhNRGN4SWl3aWJtRnRaU0k2SW1aMWJtTjBhVzl1SURRaUxDSm1kVzVqSWpvaVhHNXlaWFIxY200Z2JYTm5PeUlzSW05MWRIQjFkSE1pT2pFc0luUnBiV1Z2ZFhRaU9qQXNJbTV2WlhKeUlqb3dMQ0pwYm1sMGFXRnNhWHBsSWpvaUlpd2labWx1WVd4cGVtVWlPaUlpTENKc2FXSnpJanBiWFN3aWVDSTZPREUwTENKNUlqbzBOVGtzSW5kcGNtVnpJanBiV3lKak9XVTFNMkkyTURVMVpqZGhabUppSWl3aVpHWTRZelU1TlRjNE5ERmlNekJtTlNKZFhYMHNleUpwWkNJNkltTTVaVFV6WWpZd05UVm1OMkZtWW1JaUxDSjBlWEJsSWpvaWMzZHBkR05vSWl3aWVpSTZJamN5TXpabU5HRXlOakZqWkRFd056RWlMQ0p1WVcxbElqb2lJaXdpY0hKdmNHVnlkSGtpT2lKd1lYbHNiMkZrSWl3aWNISnZjR1Z5ZEhsVWVYQmxJam9pYlhObklpd2ljblZzWlhNaU9sdDdJblFpT2lKbGNTSXNJbllpT2lJaUxDSjJkQ0k2SW5OMGNpSjlYU3dpWTJobFkydGhiR3dpT2lKMGNuVmxJaXdpY21Wd1lXbHlJanBtWVd4elpTd2liM1YwY0hWMGN5STZNU3dpZUNJNk9UZ3pMQ0o1SWpvMk1UY3NJbmRwY21WeklqcGJXeUl3Tnprd09EQm1NemMyTWpGaU4yRTBJaXdpTVRJeU9UVmlOVGcwTURZell6bGpZU0pkWFgwc2V5SnBaQ0k2SWpBM09UQTRNR1l6TnpZeU1XSTNZVFFpTENKMGVYQmxJam9pWTJoaGJtZGxJaXdpZWlJNklqY3lNelptTkdFeU5qRmpaREV3TnpFaUxDSnVZVzFsSWpvaUlpd2ljblZzWlhNaU9sdDdJblFpT2lKelpYUWlMQ0p3SWpvaWNHRjViRzloWkNJc0luQjBJam9pYlhObklpd2lkRzhpT2lJaUxDSjBiM1FpT2lKemRISWlmVjBzSW1GamRHbHZiaUk2SWlJc0luQnliM0JsY25SNUlqb2lJaXdpWm5KdmJTSTZJaUlzSW5Sdklqb2lJaXdpY21WbklqcG1ZV3h6WlN3aWVDSTZNVEU0TVN3aWVTSTZOamt5TENKM2FYSmxjeUk2VzFzaU1XTmxZamM1T1RSalpqQTJaV1kwTmlKZFhYMHNleUpwWkNJNkltUm1PR00xT1RVM09EUXhZak13WmpVaUxDSjBlWEJsSWpvaWRHVnRjR3hoZEdVaUxDSjZJam9pTnpJek5tWTBZVEkyTVdOa01UQTNNU0lzSW01aGJXVWlPaUlpTENKbWFXVnNaQ0k2SW5CaGVXeHZZV1FpTENKbWFXVnNaRlI1Y0dVaU9pSnRjMmNpTENKbWIzSnRZWFFpT2lKb1lXNWtiR1ZpWVhKeklpd2ljM2x1ZEdGNElqb2liWFZ6ZEdGamFHVWlMQ0owWlcxd2JHRjBaU0k2SWxSb2FYTWdhWE1nZEdobElIQmhlV3h2WVdRNklIdDdjR0Y1Ykc5aFpIMTlJQ0VpTENKdmRYUndkWFFpT2lKemRISWlMQ0o0SWpveE5UTTJMQ0o1SWpvME5EWXNJbmRwY21WeklqcGJXMTFkZlN4N0ltbGtJam9pTVdObFlqYzVPVFJqWmpBMlpXWTBOaUlzSW5SNWNHVWlPaUowY21sbloyVnlJaXdpZWlJNklqY3lNelptTkdFeU5qRmpaREV3TnpFaUxDSnVZVzFsSWpvaUlpd2liM0F4SWpvaU1TSXNJbTl3TWlJNklqQWlMQ0p2Y0RGMGVYQmxJam9pZG1Gc0lpd2liM0F5ZEhsd1pTSTZJblpoYkNJc0ltUjFjbUYwYVc5dUlqb2lNalV3SWl3aVpYaDBaVzVrSWpvaVptRnNjMlVpTENKdmRtVnljbWxrWlVSbGJHRjVJam9pWm1Gc2MyVWlMQ0oxYm1sMGN5STZJbTF6SWl3aWNtVnpaWFFpT2lJaUxDSmllWFJ2Y0dsaklqb2lZV3hzSWl3aWRHOXdhV01pT2lKMGIzQnBZeUlzSW05MWRIQjFkSE1pT2pFc0luZ2lPakV6Tmprc0lua2lPalUzT0N3aWQybHlaWE1pT2x0YkltUm1PR00xT1RVM09EUXhZak13WmpVaVhWMTlMSHNpYVdRaU9pSXpaVGRoWm1Rd1l6bGlaR0l3TW1JM0lpd2lkSGx3WlNJNklrWnNiM2RJZFdKUWRXeHNJaXdpZWlJNklqY3lNelptTkdFeU5qRmpaREV3TnpFaUxDSnViM1JoWWlJNlptRnNjMlVzSW1ac2IzZHBaQ0k2SWpabE5UUmtOakpsTlROaFlqVmlObVFpTENKNElqb3pPRGNzSW5raU9qUTBNaXdpZDJseVpYTWlPbHRiWFYxOUxIc2lhV1FpT2lJeE1qSTVOV0kxT0RRd05qTmpPV05oSWl3aWRIbHdaU0k2SW1oMGJXd2lMQ0o2SWpvaU56SXpObVkwWVRJMk1XTmtNVEEzTVNJc0ltNWhiV1VpT2lJaUxDSndjbTl3WlhKMGVTSTZJbkJoZVd4dllXUWlMQ0p2ZFhSd2NtOXdaWEowZVNJNkluQmhlV3h2WVdRaUxDSjBZV2NpT2lJaUxDSnlaWFFpT2lKb2RHMXNJaXdpWVhNaU9pSnphVzVuYkdVaUxDSjRJam94TURrd0xDSjVJam8xTlN3aWQybHlaWE1pT2x0YklqRmpaV0kzT1RrMFkyWXdObVZtTkRZaUxDSmtNRGxoTXpFMk5XWmpNV1V3TlRJNUlsMWRmU3g3SW1sa0lqb2lZVEE0WkRZMVpEQm1ZVGhsTkRreU9DSXNJblI1Y0dVaU9pSkdiRzkzU0hWaVVIVnphQ0lzSW5vaU9pSTNNak0yWmpSaE1qWXhZMlF4TURjeElpd2lZWEJwVkc5clpXNGlPaUpHVEU5WFNGVkNYMEZRU1Y5VVQwdEZUaUlzSW1Gd2FWUnZhMlZ1Vkhsd1pTSTZJbVZ1ZGlJc0ltNWhiV1VpT2lJaUxDSjRJam96T1Rrc0lua2lPak01TUN3aWQybHlaWE1pT2x0YlhWMTlYUT09XCI+PC9pZnJhbWU+IiwiZW52IjpbXX0seyJpZCI6ImQwOWEzMTY1ZmMxZTA1MjkiLCJ0eXBlIjoianVuY3Rpb24iLCJ6IjoiNzIzNmY0YTI2MWNkMTA3MSIsIngiOjEwOTQuOTE4MzkxNDY2MTQwNywieSI6MTEyLjU3MTQzMDMyNTUwODEyLCJ3aXJlcyI6W1siMTIyOTViNTg0MDYzYzljYSJdXX0seyJpZCI6ImEwNWQ5MmFhZDcyNTRmNDgiLCJ0eXBlIjoiZnVuY3Rpb24iLCJ6IjoiNzIzNmY0YTI2MWNkMTA3MSIsIm5hbWUiOiJmdW5jdGlvbiA0IiwiZnVuYyI6IlxucmV0dXJuIG1zZzsiLCJvdXRwdXRzIjoxLCJ0aW1lb3V0IjowLCJub2VyciI6MCwiaW5pdGlhbGl6ZSI6IiIsImZpbmFsaXplIjoiIiwibGlicyI6W10sIngiOjgxNCwieSI6NDU5LCJ3aXJlcyI6W1siYzllNTNiNjA1NWY3YWZiYiIsImRmOGM1OTU3ODQxYjMwZjUiXV19LHsiaWQiOiJjOWU1M2I2MDU1ZjdhZmJiIiwidHlwZSI6InN3aXRjaCIsInoiOiI3MjM2ZjRhMjYxY2QxMDcxIiwibmFtZSI6IiIsInByb3BlcnR5IjoicGF5bG9hZCIsInByb3BlcnR5VHlwZSI6Im1zZyIsInJ1bGVzIjpbeyJ0IjoiZXEiLCJ2IjoiIiwidnQiOiJzdHIifV0sImNoZWNrYWxsIjoidHJ1ZSIsInJlcGFpciI6ZmFsc2UsIm91dHB1dHMiOjEsIngiOjk4MywieSI6NjE3LCJ3aXJlcyI6W1siMDc5MDgwZjM3NjIxYjdhNCIsIjEyMjk1YjU4NDA2M2M5Y2EiXV19LHsiaWQiOiIwNzkwODBmMzc2MjFiN2E0IiwidHlwZSI6ImNoYW5nZSIsInoiOiI3MjM2ZjRhMjYxY2QxMDcxIiwibmFtZSI6IiIsInJ1bGVzIjpbeyJ0Ijoic2V0IiwicCI6InBheWxvYWQiLCJwdCI6Im1zZyIsInRvIjoiIiwidG90Ijoic3RyIn1dLCJhY3Rpb24iOiIiLCJwcm9wZXJ0eSI6IiIsImZyb20iOiIiLCJ0byI6IiIsInJlZyI6ZmFsc2UsIngiOjExODEsInkiOjY5Miwid2lyZXMiOltbIjFjZWI3OTk0Y2YwNmVmNDYiXV19LHsiaWQiOiJkZjhjNTk1Nzg0MWIzMGY1IiwidHlwZSI6InRlbXBsYXRlIiwieiI6IjcyMzZmNGEyNjFjZDEwNzEiLCJuYW1lIjoiIiwiZmllbGQiOiJwYXlsb2FkIiwiZmllbGRUeXBlIjoibXNnIiwiZm9ybWF0IjoiaGFuZGxlYmFycyIsInN5bnRheCI6Im11c3RhY2hlIiwidGVtcGxhdGUiOiJUaGlzIGlzIHRoZSBwYXlsb2FkOiB7e3BheWxvYWR9fSAhIiwib3V0cHV0Ijoic3RyIiwieCI6MTUzNiwieSI6NDQ2LCJ3aXJlcyI6W1tdXX0seyJpZCI6IjFjZWI3OTk0Y2YwNmVmNDYiLCJ0eXBlIjoidHJpZ2dlciIsInoiOiI3MjM2ZjRhMjYxY2QxMDcxIiwibmFtZSI6IiIsIm9wMSI6IjEiLCJvcDIiOiIwIiwib3AxdHlwZSI6InZhbCIsIm9wMnR5cGUiOiJ2YWwiLCJkdXJhdGlvbiI6IjI1MCIsImV4dGVuZCI6ImZhbHNlIiwib3ZlcnJpZGVEZWxheSI6ImZhbHNlIiwidW5pdHMiOiJtcyIsInJlc2V0IjoiIiwiYnl0b3BpYyI6ImFsbCIsInRvcGljIjoidG9waWMiLCJvdXRwdXRzIjoxLCJ4IjoxMzY5LCJ5Ijo1NzgsIndpcmVzIjpbWyJkZjhjNTk1Nzg0MWIzMGY1Il1dfSx7ImlkIjoiM2U3YWZkMGM5YmRiMDJiNyIsInR5cGUiOiJGbG93SHViUHVsbCIsInoiOiI3MjM2ZjRhMjYxY2QxMDcxIiwibm90YWIiOmZhbHNlLCJmbG93aWQiOiI0MmU5NjRhZDM0ODUxNDg4IiwieCI6Mzg3LCJ5Ijo0NDIsIndpcmVzIjpbW11dfSx7ImlkIjoiMTIyOTViNTg0MDYzYzljYSIsInR5cGUiOiJodG1sIiwieiI6IjcyMzZmNGEyNjFjZDEwNzEiLCJuYW1lIjoiIiwicHJvcGVydHkiOiJwYXlsb2FkIiwib3V0cHJvcGVydHkiOiJwYXlsb2FkIiwidGFnIjoiIiwicmV0IjoiaHRtbCIsImFzIjoic2luZ2xlIiwieCI6MTA5MCwieSI6NTUsIndpcmVzIjpbWyIxY2ViNzk5NGNmMDZlZjQ2IiwiZDA5YTMxNjVmYzFlMDUyOSJdXX0seyJpZCI6ImEwOGQ2NWQwZmE4ZTQ5MjgiLCJ0eXBlIjoiRmxvd0h1YlB1c2giLCJ6IjoiNzIzNmY0YTI2MWNkMTA3MSIsImFwaVRva2VuIjoiRkxPV0hVQl9BUElfVE9LRU4iLCJhcGlUb2tlblR5cGUiOiJlbnYiLCJuYW1lIjoiIiwieCI6Mzk5LCJ5IjozOTAsIndpcmVzIjpbW11dfV0=\"></iframe>","env":[]},{"id":"9862bd73e0604af1","type":"group","z":"7236f4a261cd1071","name":"This group is removed from diagram","style":{"label":true},"nodes":["1022cf699914e2b8","f528bb797ce383a9","27907cdacc4fb8bf","cb4121cd28c1a2a6","e58926309a683a97","63222661b47844e7","6350e110c28cac3d","38eddf11e45666b9","25a6b6b1e833312c","8aa3a81a7923e7d0","e2a63bd14f6739d6"],"x":595,"y":728.5,"w":994,"h":407.5},{"id":"d09a3165fc1e0529","type":"junction","z":"7236f4a261cd1071","x":1094.9183914661407,"y":112.57143032550812,"wires":[["12295b584063c9ca"]]},{"id":"1022cf699914e2b8","type":"ClientCode","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"Obtain Frontend Flow","clientcode":"(function () {\n    var activeWorkspace = RED.workspaces.active();\n    var nodes = RED.nodes.groups(activeWorkspace);\n\n    nodes = nodes.concat(RED.nodes.junctions(activeWorkspace));\n    nodes = nodes.concat(RED.nodes.filterNodes({ z: activeWorkspace }));\n\n    RED.nodes.eachConfig(function (n) {\n        if (n.z === RED.workspaces.active() && n._def.hasUsers === false) {\n            // Grab any config nodes scoped to this flow that don't\n            // require any flow-nodes to use them\n            nodes.push(n);\n        }\n    });\n\n    var parentNode = RED.nodes.workspace(\n        activeWorkspace\n    ) || RED.nodes.subflow(activeWorkspace);\n\n    nodes.unshift(parentNode);\n    \n    var expNodes = RED.nodes.createExportableNodeSet(nodes)\n\n    try {\n        var removeGrpId = RED.nodes.node(node.id || nodeid).g;\n\n        expNodes = expNodes.filter( (n) => { return n.g != removeGrpId && n.id != removeGrpId } )\n    } catch (ex) {}\n\n    node.send({ payload: expNodes })    \n})();\n","format":"javascript","x":816,"y":987,"wires":[["cb4121cd28c1a2a6"]]},{"id":"f528bb797ce383a9","type":"debug","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"iframe share code","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1449,"y":1005.5,"wires":[]},{"id":"27907cdacc4fb8bf","type":"inject","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"generate iframe share","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":741,"y":769.5,"wires":[["e2a63bd14f6739d6"]]},{"id":"cb4121cd28c1a2a6","type":"function","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"create iframe string with flow payload","func":"const escapeHtml = (unsafe) => {\n    return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('\"', '&quot;').replaceAll(\"'\", '&#039;');\n}\n\n/*\nmsg.payload = '<iframe width=\"100%\" height=\"100%\" srcdoc=\"' +\n    msg.original_html.replaceAll('\"','&quot;') +\n    '\" src=\"data:text/html;base64,' +\n    msg.html_base64 +\n    '\" allow=\"clipboard-read; clipboard-write\" style=\"border: none; min-height: 450px;\" data-flow=\"' + Buffer.from(JSON.stringify(msg.payload)).toString('base64') +\n    '\"></iframe>';\n*/\n\nmsg.payload = '<iframe width=\"100%\" height=\"100%\" srcdoc=\"' +\n    escapeHtml(msg.original_html).replaceAll('&', '&amp;') +\n    '\" allow=\"clipboard-read; clipboard-write\" style=\"border: none; min-height: 480px;\" data-flow=\"' + Buffer.from(JSON.stringify(msg.payload)).toString('base64') +\n    '\"></iframe>';\n\nreturn msg","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1013,"y":1061.5,"wires":[["f528bb797ce383a9","6350e110c28cac3d"]]},{"id":"e58926309a683a97","type":"catch","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"","scope":["cb4121cd28c1a2a6"],"uncaught":false,"x":1076,"y":1090,"wires":[["63222661b47844e7"]]},{"id":"63222661b47844e7","type":"debug","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1382,"y":1095,"wires":[]},{"id":"6350e110c28cac3d","type":"ClientCode","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"copy to clipboard","clientcode":"(function(pload) {\n    function fallbackCopyTextToClipboard(text, cb) {\n        var textArea = document.createElement(\"textarea\");\n        textArea.value = text;\n\n        // Avoid scrolling to bottom\n        textArea.style.top = \"0\";\n        textArea.style.left = \"0\";\n        textArea.style.position = \"fixed\";\n\n        document.body.appendChild(textArea);\n        textArea.focus();\n        textArea.select();\n\n        try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful';\n\n            if (successful && cb && typeof cb == \"function\") { cb(); }\n\n            console.log('Fallback: Copying text command was ' + msg);\n        } catch (err) {\n            console.error('Fallback: Oops, unable to copy', err);\n        }\n\n        document.body.removeChild(textArea);\n    }\n\n    function copyTextToClipboard(text, cb) {\n        if (!navigator.clipboard) {\n            fallbackCopyTextToClipboard(text,cb);\n            return;\n        }\n\n        navigator.clipboard.writeText(text).then(\n            function () {\n                if (cb && typeof cb == \"function\") { cb(); }\n                console.log('Async: Copying to clipboard was successful!');\n            }, function (err) {\n                console.error('Async: Could not copy text: ', err);\n            }\n        );\n    }\n\n    function copyToClipboard(msg) {\n        copyTextToClipboard(msg.payload, () => {\n            alert('Copied iframe code to clipboard')\n        });\n    }\n\n    copyToClipboard({\n        payload: pload\n    });\n})(payload);\n\nnode.send({ payload: payload })","format":"javascript","x":1473,"y":917.3570556640625,"wires":[[]]},{"id":"a05d92aad7254f48","type":"function","z":"7236f4a261cd1071","name":"function 4","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":814,"y":459,"wires":[["c9e53b6055f7afbb","df8c5957841b30f5"]]},{"id":"c9e53b6055f7afbb","type":"switch","z":"7236f4a261cd1071","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":983,"y":617,"wires":[["079080f37621b7a4","12295b584063c9ca"]]},{"id":"079080f37621b7a4","type":"change","z":"7236f4a261cd1071","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1181,"y":692,"wires":[["1ceb7994cf06ef46"]]},{"id":"df8c5957841b30f5","type":"template","z":"7236f4a261cd1071","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":1536,"y":446,"wires":[[]]},{"id":"1ceb7994cf06ef46","type":"trigger","z":"7236f4a261cd1071","name":"","op1":"1","op2":"0","op1type":"val","op2type":"val","duration":"250","extend":"false","overrideDelay":"false","units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1369,"y":578,"wires":[["df8c5957841b30f5"]]},{"id":"38eddf11e45666b9","type":"base64","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"","action":"","property":"payload","x":1255,"y":863,"wires":[["25a6b6b1e833312c"]]},{"id":"25a6b6b1e833312c","type":"change","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"","rules":[{"t":"set","p":"html_base64","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1081,"y":924,"wires":[["1022cf699914e2b8"]]},{"id":"8aa3a81a7923e7d0","type":"change","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"","rules":[{"t":"set","p":"original_html","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1118,"y":786,"wires":[["38eddf11e45666b9"]]},{"id":"12295b584063c9ca","type":"html","z":"7236f4a261cd1071","name":"","property":"payload","outproperty":"payload","tag":"","ret":"html","as":"single","x":1090,"y":55,"wires":[["1ceb7994cf06ef46","d09a3165fc1e0529"]]},{"id":"e2a63bd14f6739d6","type":"template","z":"7236f4a261cd1071","g":"9862bd73e0604af1","name":"share.html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t<link rel=\"icon\" type=\"image/x-icon\" href=\"/favicon.ico\"/>\n\t<title>FlowHub - Flow Sharing</title>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.openmindmap.org/embed/flowviewer.css\"/>\n    <script src=\"https://cdn.openmindmap.org/embed/jquery-3.7.0.min.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n    \n    <style>\n        .flowviewer svg {\n            min-height: 450px;\n        }\n    </style>\n</head>\n<body class=\"flowviewer-share\">\n<style>\n.flowviewer {\n    position: relative;\n}\n.flowviewer svg {\n    --red-ui-view-grid-color: #eee;\n    --red-ui-view-border: 1px solid #bbbbbb;\n    --red-ui-node-border: #999;\n    --red-ui-node-background-default: #eee;\n    --red-ui-node-icon-background-color-fill: black;\n    --red-ui-node-icon-background-color-opacity: 0.1;\n    --red-ui-node-label-color: #333;\n    --red-ui-node-port-background: #d9d9d9;\n    --red-ui-link-color: #999;\n    background-color: white;\n    min-height: 450px;\n    border: var(--red-ui-view-border);\n    border-radius: 3px;\n    position: relative;\n}\n\n.flowviewer svg {\n    width: 100%;\n    height: 100%;\n    min-height: 450px;\n    margin: auto;\n    display: block;\n    border-radius: 2px;\n}\n\n.flowviewer svg {\n    cursor: move;\n    cursor: grab;\n}\n\n.flowviewer .dragging {\n    cursor: grabbing;\n}\n\n.flowviewer-tabs {\n    display: flex;\n}\n.flowviewer-tab {\n    padding: 6px 12px;\n    box-sizing: border-box;\n    display: inline-block;\n    border: 1px solid #bbbbbb;\n    border-right: none;\n    background-color: #f0f0f0;\n    max-width: 200px;\n    width: 14%;\n    overflow: hidden;\n    white-space: nowrap;\n    position: relative;\n    margin-top: -1px;\n    transition: 0.2s background-color;\n}\n.flowviewer-tab.active {\n    background-color: white;\n    border-top-color: white;\n}\n.flowviewer-tab:hover {\n    cursor: pointer;\n    background-color: white;\n}\n.flowviewer-tab:last-child {\n    border-right: 1px solid #bbbbbb;\n}\n\n.flowviewer-note {\n    margin-top: 12px;\n    font-size: 0.875rem;\n    font-style: italic;\n}\n\nbody.flowviewer-share {\n    background-color: inherit;\n}\n\n\n.group-text-label {\n    font-family: Helvetica Neue, Arial, Helvetica, sans-serif;\n\tfont-size: 14px;\n}\n\n.node-text-label {\n\tfont-family: Helvetica Neue, Arial, Helvetica, sans-serif;\n\tfont-size: 14px;\n\tdominant-baseline: middle;\n}\n\n.subflow-node-text-label {\n    color: rgb(85, 85, 85);\n    dominant-baseline: middle;\n    font-family: Helvetica Neue, Arial, Helvetica, sans - serif;\n    font-size: 10px;\n    line-height: 20px;\n    pointer-events: none;\n    text-anchor: middle;\n    user-select: none\n}\n\n.subflow-node-text-label-number {\n    color: rgb(85, 85, 85);\n    dominant-baseline: middle;\n    font-family: Helvetica Neue, Arial, Helvetica, sans-serif;\n    font-size: 16px;\n    line-height: 20px;\n    pointer-events: none;\n    text-anchor: middle;\n    user-select: none\n}\n\n.flow-download-link {\n    font-size: 70%;\n}\n\n.flow-copy-to-clipboard-link {\n    font-size: 70%;\n}\n\n.node {\n    fill-opacity: 1;\n    stroke-width: 1px;\n}\n\n.link {\n    stroke: #999;\n    stroke-width: 3;\n    fill: none;\n}\n\n.link-highlight, .node-highlight {\n    stroke: rgb(255, 127, 14);\n}\n.node-highlight {\n    stroke-width: 3px;\n}\n\n.node-disabled {\n\tstroke-dasharray: 8,3;\n\tfill-opacity: 0.5;\n}\n\n.group-highlight {\n    stroke: rgb(255, 127, 14);\n    stroke-width: 4px;\n    fill: rgb(255, 127, 14);\n    fill-opacity: 0.2;\n}\n\n.link-disabled {\n\tstroke-dasharray: 10,8 !important;\n\tstroke-width: 2 !important;\n\tstroke: rgb(204, 204, 204);\n}\n\n.grid-line {\n    shape-rendering: crispedges;\n    stroke: rgb(238, 238, 238);\n    stroke-width: 1px;\n    fill: none;\n}\n.output-deco {\n    stroke-width: 2px;\n    stroke-miterlimit: 4;\n}\n\n.input-deco {\n    stroke-width: 2px;\n    stroke-miterlimit: 4;\n}\n\n.flow-render-error {\n    background-color: rgb(54, 52, 52);\n    color: rgb(196, 59, 59);\n    width: 100%;\n}\n.flowviewer-share-details {\n    padding: 5px;\n    border: 1px solid #aa6767;\n    background: white;\n    border-bottom-right-radius: 3px;\n    border-top-left-radius: 3px;\n    font-size: 0.8em;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n}\n</style>\n\n<div>\n    <div class=\"flowviewer\">\n        <div style=\"position: relative\">\n            <svg>\n                <g class=\"flowGridlines\"></g>\n                <g class=\"containerGroup\">\n                    <g class=\"flowGroups\"></g>\n                    <g class=\"flowWires\"></g>\n                    <g class=\"flowNodes\"></g>\n                </g>\n            </svg>\n            <button id=\"copy-flow\" class=\"copy-button\" style=\"display: none;\">Copy JSON</button>\n        </div>\n        <div style=\"display: none;\" class=\"flowviewer-tabs\"></div>\n    </div>\n</div>\n\n\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js\" integrity=\"sha512-M7nHCiNUOwFt6Us3r8alutZLm9qMt4s9951uo8jqO4UwJ1hziseL6O3ndFyigx6+LREfZqnhHxYjKRJ8ZQ69DQ==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n\n<head>\n    <script type=\"text/javascript\" src=\"https://cdn.openmindmap.org/embed/flowviewer.js\"></script>\n</head>\n<script type=\"text/javascript\">\n    (function () {\n\n        var atobUtf8 = (content) => {\n            function base64ToBytes(base64) {\n              const binString = atob(base64);\n              return Uint8Array.from(binString, (m) => m.codePointAt(0));\n            }\n            return new TextDecoder().decode(base64ToBytes(content));\n        };\n\n        // pull Flow into JS\n        const flow = ( window.frameElement && window.frameElement.getAttribute('data-flow') && JSON.parse(atobUtf8(window.frameElement.getAttribute('data-flow'))) ) || [{\"id\":\"ec554278a5afbd2f\",\"type\":\"comment\",\"z\":\"b8a44ab3f9a85b8b\",\"name\":\"No flow data found, ensure `data-flow` is set on the containing iframe\",\"info\":\"\",\"x\":785,\"y\":294,\"wires\":[]}];\n\n        /**\n         * Parse the flow.json to get the details on the tabs/subflows present\n         */\n        const processFlow = function (flow) {\n            const tabids = []\n            const tabs = []\n            flow.forEach((d) => {\n                if (d.type === 'subflow') {\n                    tabids.push(d.id)\n                    tabs.push({\n                        id: d.id,\n                        label: d.name,\n                        type: 'subslow'\n                    })\n                } else if (d.z) {\n                    if (tabids.indexOf(d.z) === -1) {\n                        tabids.push(d.z)\n                        tabs.push({\n                            id: d.z,\n                            label: d.z,\n                            type: 'tab',\n                        })\n                    }\n                }\n            })\n            return tabs\n        }\n\n        function addPanZoom () {\n            var svgs = d3.selectAll('.flowviewer svg');\n\n            var svg = $(\".flowviewer svg\");\n\n            svg.attr('width','');\n            svg.attr('height','');\n            svg.css('width', $('.flowviewer').width() + \"px\");\n            svg.css('height', $('.flowviewer').height() + \"px\");\n            var bbx = $(\".flowviewer svg .containerGroup\")[0].getBBox();\n            svg.attr('viewBox', bbx.x + \" \" + bbx.y + \" \" + (bbx.width * 1.1) + \" \" + (bbx.height * 1.1) )\n\n            svgs.each(function() {\n                var svg = d3.select(this);\n\n                svg.html('<g>' + svg.html() + '</g>');\n                var inner = svg.select('g');\n                var zoom = d3.zoom()\n                    .scaleExtent([0.3, 100])\n                    .on(\"start\", function () {\n                        svg.classed(\"dragging\", true);\n                    })\n                    .on('zoom', function(event) {\n                        inner.attr('transform', event.transform);\n                    })\n                    .on(\"end\", function () {\n                        svg.classed(\"dragging\", false);\n                    });\n                svg.call(zoom);\n            });\n        }\n\n        const clearFlow = function () {\n            $('.flowviewer svg .flowGridlines').empty()\n            $('.flowviewer svg .flowGroups').empty()\n            $('.flowviewer svg .flowWires').empty()\n            $('.flowviewer svg .flowNodes').empty()\n        }\n        // get the tabs/subflows for our provided flow\n        const tabs = processFlow(flow)\n        // sort them such that tabs render first\n        tabs.sort((a, b) => {\n            return a.type > b.type ? -1 : (a.type < b.type) ? 1 : 0\n        })\n\n        function openTab (id) {\n            // clear any existing flow\n            clearFlow()\n            // draw the new flow - uses function from `public/js/flowviewer.js`\n            renderFlow(id, flow, $('.flowviewer svg'), {\n               \"arrows\": false,\n               \"gridlines\": false,\n               \"zoom\": false,\n               \"images\": true,\n               \"linklines\": false,\n               \"dllink\": false,\n               \"labels\": true,\n            });\n            addPanZoom()\n        }\n\n        function addTab (tab, index) {\n            const classes = 'flowviewer-tab flowviewer-' + tab.type\n            const name = tab.type === 'tab' ? 'Flow ' + (index + 1) : tab.label\n            const tabDOM = $('.flowviewer-tabs')\n                .append(`<div id=\"flowviewer-tab-${index}\" class=\"${classes}\">${name}</div>`)\n                .on('click', `#flowviewer-tab-${index}`, function () {\n                    // add on click to each new tab\n                    $('.flowviewer-tab').removeClass('active')\n                    $(this).addClass('active')\n                    openTab(tab.id)\n                })\n        }\n\n        tabs.forEach((tab, index) => {\n            addTab(tab, index)\n        })\n\n        clearFlow();\n        renderFlow(tabs[0].id, flow, $('.flowviewer svg'), {\n            \"arrows\": false,\n            \"gridlines\": false,\n            \"zoom\": false,\n            \"images\": true,\n            \"linklines\": true,\n            \"dllink\": false,\n            \"labels\": true,\n        });\n        \n        addPanZoom();\n        $('#flowviewer-tab-0').addClass('active')\n        $('#copy-flow').on('click', function() {\n            navigator.clipboard.writeText(JSON.stringify(flow));\n        })\n    })()\n</script></body>\n","output":"str","x":918,"y":831,"wires":[["8aa3a81a7923e7d0"]]}]