[{"id":"119a019d22344192","type":"tab","label":"[Experimental] HN Rss + Frontend code","disabled":false,"info":"::: aim\n\nProviding a ever updating visual representation of Hacker News content.\n\n:::\n\n::: requirements\n\nThis requirements the following Node-RED nodes:\n\n- [introspection](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection), version >= 0.4.2\n\n:::\n\n::: background\n\nThis is misusing the Node-RED client to create nodes that represent RSS feed items. It also wires together related nodes, in this case comments on Hacker News articles.\n\n:::\n\n### Related Flows\n\n- [Result of letting this flow run](https://flowhub.org/f/1b2cdc85fc889cd0)\n\n","env":[]},{"id":"bbf722420c362971","type":"group","z":"119a019d22344192","name":"using dagre","style":{"label":true},"nodes":["d6989b8cdc9cc614","a018760f3420e29d","78f9090fed2fbcfc","0bbc986340d159a1","ebdad0d4403173b3"],"x":925.78564453125,"y":918.0000406901045,"w":596,"h":230.99995930989553},{"id":"8b9a71f205e03c83","type":"group","z":"119a019d22344192","name":"always the same","style":{"label":true},"nodes":["1e7f8b2c254e4d60","821ed929c72480b8","4396339926a3894b","314340aa366d6beb","c3a1fd7da8e38825","6bf7abf7d244f8dc","e5587a8f162ae32a","ebe29205544f1399","22363d408e13a802"],"x":2878.7857666015625,"y":116,"w":387,"h":267},{"id":"8c55c129f2a5ee57","type":"group","z":"119a019d22344192","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["3fd12d3cc91f54bf","2a7a1c4264a275c3","dd65e00f2585f10b"],"x":2184,"y":818.5,"w":453.5,"h":246},{"id":"d6b70422242c4b00","type":"group","z":"119a019d22344192","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["cb8915b3999f4b65","f0ddfaa9d95b07f7","0f89443c327a3540","a6a915b6a7f7f6dc"],"x":2838.7857666015625,"y":1025.5,"w":412,"h":306},{"id":"14b07e82a651e858","type":"junction","z":"119a019d22344192","x":241.27550089359283,"y":546.3350715637207,"wires":[["1827e471f8ae10be","6bdeb72861bdc2ae","eee7edeff8563c8e"]]},{"id":"2bd777ecf6a3b9aa","type":"junction","z":"119a019d22344192","x":322.44607388973236,"y":203,"wires":[["14b07e82a651e858","583aad6bb97cfeae"]]},{"id":"a24b42e10f2bc804","type":"http request","z":"119a019d22344192","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1353.6665840148926,"y":592.6784076690674,"wires":[["18d94b608916caa0"]]},{"id":"18d94b608916caa0","type":"xml","z":"119a019d22344192","name":"","property":"payload","attr":"","chr":"","x":1355.75,"y":487.84509086608887,"wires":[["c11eda51de3f3c1f"]]},{"id":"9e3841e73885b3dd","type":"join","z":"119a019d22344192","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":"false","timeout":"","count":"","reduceRight":false,"x":2462,"y":492.59503173828125,"wires":[["875ef0b0799bb044"]]},{"id":"c11eda51de3f3c1f","type":"function","z":"119a019d22344192","name":"define subflow","func":"msg.tab_id_z = RED.util.generateId();\n\nvar subflowId = RED.util.generateId();\n\nvar getName = () => {\n    var pl = msg.payload;\n    /* \n     * This supports the title being (in that order):\n     *    - payload.rss.channel[0].title[0]\n     *    - payload.feed.title[0]._ \n     *    - payload.feed.title[0]\n     */\n    return ( \n        (pl && pl.rss && pl.rss.channel && pl.rss.channel[0] && pl.rss.channel[0].title && pl.rss.channel[0].title[0]) ||\n        (pl && pl.feed && pl.feed.title && pl.feed.title[0] && (pl.feed.title[0]._ || pl.feed.title[0]) ) ||\n        \"Unk: \" + subflowId\n    )\n};\n\nvar subflowDefined = flow.get(msg.node_colour.substr(1,12));\n\nif (subflowDefined) {\n\n    msg.subflow_defined = true;\n    msg.subflow_type = subflowDefined;\n\n} else {\n\n    msg.subflow_type = {\n        \"id\": subflowId,\n        \"type\": \"subflow\",\n        \"name\": getName(),\n        \"info\": \"Imported at \" + new Date() + \"\\n<hr>\\n\" + msg.url + \"\\n\",\n        \"category\": \"rssfeeds\",\n        \"icon\": msg.icon || \"font-awesome/fa-feed\",\n\n        \"in\": [\n            {\n                \"x\": 201.25,\n                \"y\": 188.75,\n                \"wires\": []\n            }\n        ],\n\n        \"out\": [\n            {\n                \"x\": 496.25,\n                \"y\": 161.25,\n                \"wires\": [\n                    {\n                        \"id\": subflowId,\n                        \"port\": 0\n                    }\n                ]\n            }\n        ],\n\n        \"env\": [\n            {\n                \"name\": \"createdAt\",\n                \"type\": \"str\",\n                \"value\": \"\"\n            },\n            {\n                \"name\": \"updatedAt\",\n                \"type\": \"str\",\n                \"value\": \"\"\n            }\n        ],\n\n        \"meta\": {},\n        \"color\": msg.node_colour,\n    };\n\n    msg.subflow_defined = false;\n    flow.set(msg.node_colour.substr(1, 12), { ...msg.subflow_type })\n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1374.0832061767578,"y":380.1546821594238,"wires":[["2add974310f6f3b1"]]},{"id":"875ef0b0799bb044","type":"function","z":"119a019d22344192","name":"prepend the subflow to the nodes array","func":"if (!msg.subflow_defined) {\n    msg.payload = [\n        msg.subflow_type,\n        ...msg.payload    \n    ];\n}\nmsg.payload = {\n    flowContent: msg.payload,\n    removeduplicates: true,\n    autoimport: true\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2561.25,"y":685.79150390625,"wires":[["5bf2de0885c59307"]]},{"id":"2add974310f6f3b1","type":"switch","z":"119a019d22344192","name":"format type decider","property":"formatType","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1393.75,"y":315.9879150390625,"wires":[["182961ab0bc4acb1"],["1c4538eccf58e703"]]},{"id":"182961ab0bc4acb1","type":"change","z":"119a019d22344192","name":"payload.rss.channel[0].item","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.rss.channel[0].item","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1723,"y":310.4075927734375,"wires":[["9db21ab092193273"]]},{"id":"9db21ab092193273","type":"split","z":"119a019d22344192","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1919.0625,"y":453.52593994140625,"wires":[["52fc4e7061589c27"]]},{"id":"1c4538eccf58e703","type":"change","z":"119a019d22344192","name":"payload.rss.channel[0].item","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.rss.channel[0].item","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1731,"y":363.023681640625,"wires":[["1b5507363bd05954"]]},{"id":"1b5507363bd05954","type":"split","z":"119a019d22344192","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1922.5625,"y":409.0259704589844,"wires":[["d4c4c49541626eb2"]]},{"id":"52fc4e7061589c27","type":"function","z":"119a019d22344192","name":"2. guid[0]._, title, description, pubDate","func":"// some GUIDs are in fact IDs so prepend the URL when generating the ID\nmsg.payload = {\n    \"id\": xxhashjs.h64(msg.url + msg.payload.guid[0]._, 0xbad0feed).toString(16),\n    \"type\": \"subflow:\" + msg.subflow_type.id,\n    \"z\": msg.tab_id_z,\n    \"name\": msg.payload.title[0].trim(),\n    \"info\": msg.payload.description[0].trim(),\n    \"env\": [\n        {\n            \"name\": \"createdAt\",\n            \"value\": msg.payload.pubDate[0],\n            \"type\": \"str\"\n        },\n        {\n            \"name\": \"updatedAt\",\n            \"value\": msg.payload.pubDate[0],\n            \"type\": \"str\"\n        }\n    ],\n    \"createdAt\": msg.payload.pubDate[0],\n    \"updatedAt\": msg.payload.pubDate[0],\n    \"x\": 2000 * Math.random(),\n    \"y\": 2000 * Math.random(),\n    \"wires\": [\n        []\n    ]\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"xxhashjs","module":"xxhashjs"}],"x":2139.5,"y":489.4075927734375,"wires":[["9e3841e73885b3dd"]]},{"id":"d4c4c49541626eb2","type":"function","z":"119a019d22344192","name":"3. guid[0]._, title, link, description & pubDate","func":"// some GUIDs are in fact IDs so prepend the URL when generating the ID\nmsg.payload = {\n    \"id\": xxhashjs.h64(msg.url + msg.payload.guid[0]._, 0xbad0feed).toString(16),\n    \"type\": \"subflow:\" + msg.subflow_type.id,\n    \"z\": msg.tab_id_z,\n    \"name\": msg.payload.title[0].trim(),\n    \"info\": msg.payload.link[0] + \"\\n<hr>\\n\" + msg.payload.description[0].trim(),\n    \"env\": [\n        {\n            \"name\": \"createdAt\",\n            \"value\": msg.payload.pubDate[0],\n            \"type\": \"str\"\n        },\n        {\n            \"name\": \"updatedAt\",\n            \"value\": msg.payload.pubDate[0],\n            \"type\": \"str\"\n        }\n    ],\n    \"createdAt\": msg.payload.pubDate[0],\n    \"updatedAt\": msg.payload.pubDate[0],\n    \"x\": 2000 * Math.random(),\n    \"y\": 2000 * Math.random(),\n    \"wires\": [\n        []\n    ]\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[{"var":"xxhashjs","module":"xxhashjs"}],"x":2183.5,"y":436.023681640625,"wires":[["9e3841e73885b3dd"]]},{"id":"0fc4a6df8134452b","type":"change","z":"119a019d22344192","name":"HN frontpage","rules":[{"t":"set","p":"url","pt":"msg","to":"https://hnrss.org/frontpage","tot":"str"},{"t":"set","p":"node_colour","pt":"msg","to":"#e5b67b","tot":"str"},{"t":"set","p":"formatType","pt":"msg","to":"2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":967,"y":427.488037109375,"wires":[["a24b42e10f2bc804"]]},{"id":"49500a324e280110","type":"change","z":"119a019d22344192","name":"HN newest submissions","rules":[{"t":"set","p":"url","pt":"msg","to":"https://hnrss.org/newest","tot":"str"},{"t":"set","p":"node_colour","pt":"msg","to":"#ebc883","tot":"str"},{"t":"set","p":"formatType","pt":"msg","to":"2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":997,"y":390.738037109375,"wires":[["a24b42e10f2bc804"]]},{"id":"cdf472c4f75f375c","type":"change","z":"119a019d22344192","name":"hacker news new comments","rules":[{"t":"set","p":"url","pt":"msg","to":"https://hnrss.org/newcomments","tot":"str"},{"t":"set","p":"node_colour","pt":"msg","to":"#f0da8c","tot":"str"},{"t":"set","p":"formatType","pt":"msg","to":"3","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1007,"y":353.988037109375,"wires":[["a24b42e10f2bc804"]]},{"id":"1827e471f8ae10be","type":"delay","z":"119a019d22344192","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":459,"y":633.988037109375,"wires":[["cdf472c4f75f375c"]]},{"id":"6bdeb72861bdc2ae","type":"delay","z":"119a019d22344192","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":459,"y":670.738037109375,"wires":[["49500a324e280110"]]},{"id":"eee7edeff8563c8e","type":"delay","z":"119a019d22344192","name":"","pauseType":"delay","timeout":"13","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":459,"y":707.488037109375,"wires":[["0fc4a6df8134452b"]]},{"id":"d18f79a06689f21d","type":"inject","z":"119a019d22344192","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":545,"y":318.15478515625,"wires":[["cdf472c4f75f375c"]]},{"id":"e7fafd515c93d378","type":"inject","z":"119a019d22344192","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":519.4999389648438,"y":353.15478515625,"wires":[["49500a324e280110"]]},{"id":"7f326babdf2cd3b3","type":"inject","z":"119a019d22344192","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":498.50006103515625,"y":394.15478515625,"wires":[["0fc4a6df8134452b"]]},{"id":"8096598130f92348","type":"ClientCode","z":"119a019d22344192","name":"connect nodes for HN ","clientcode":"var namesToId = {}\n\nRED.nodes.eachNode((n) => {\n  if (n._def.category == \"rssfeeds\") {\n    namesToId[n.name] = n.id\n  }\n})\n\nvar allArticles = [];\n\nRED.nodes.eachNode((n) => {\n  if (n._def.category == \"rssfeeds\" && n._def.label() == \"Hacker News: New Comments\") {\n    var title = n.name.match(/^New[ ]+comment[ ]+by.+\\\"(.*)\\\"/)[1];\n    var tgtId = namesToId[title];\n    if (tgtId) {\n      var t = RED.nodes.node(tgtId);\n      RED.nodes.addLink({ source: n, sourcePort: 0, target: t });\n      RED.view.select([t, n]);\n    }\n  }\n})\n\nnode.send({ \n  topic: \"success\",\n})\n","format":"javascript","x":3060.9998321533203,"y":795.9999198913574,"wires":[[]]},{"id":"5bf2de0885c59307","type":"ClientCode","z":"119a019d22344192","name":"TriggerImport","clientcode":"function doIt() {\n  var content = payload.flowContent;\n\n  if (payload.removeduplicates) {\n    content = content.filter((elem) => {\n      return RED.nodes.node(elem.id) == undefined\n    });\n  }\n\n  if (content.length == 0) {\n    RED.notify(\"No new content\", {\n      type: \"ok\",\n      id: \"TriggerImport\",\n      timeout: 2000\n    });\n    return;\n  }\n  RED.clipboard.import();\n\n  setTimeout(() => {\n    $('#red-ui-clipboard-dialog-import-text').val(\n      JSON.stringify(content)\n    ).trigger(\"paste\");\n\n    if (payload.autoimport) {\n      setTimeout(() => {\n        $('#red-ui-clipboard-dialog-ok').trigger('click');\n        node.send({ payload: \"ok\"})\n      }, 435);\n    } else {\n      node.send({ payload: \"ok\" })\n    }\n  }, 300);\n};\n\ndoIt();\n","format":"javascript","x":2884,"y":620,"wires":[["94491cca3fb551c3"]]},{"id":"cb8915b3999f4b65","type":"ClientCode","z":"119a019d22344192","g":"d6b70422242c4b00","name":"delete old comments","clientcode":"RED.view.select(false)\n\n// close any dialog that explains that there are duplicates and therefore\n// only a copy can be imported, hit the cancel button on that one.\n// Five clicks should do the job ...\nfor (var idx = 0; idx < 5; idx++) {\n  $($('.ui-dialog-buttonset').find(\"button\")[0]).trigger('click')\n}\n\nvar allSelectNodes = [];\n\nRED.nodes.eachNode(function (e) {\n  if (e._def && e.env && e.env[1] &&\n    e._def.label() == data.payload.label &&\n    e._def.category == data.payload.category &&\n    (Date.parse(e.env[1].value) <\n      (new Date().getTime() - parseInt(data.payload.old_than_ms)))) {\n    allSelectNodes.push(e)\n  }\n});\n\nRED.view.select({ nodes: allSelectNodes })\nsetTimeout(() => {\n  RED.actions.invoke(\"core:delete-selection\")\n}, 1500);\n","format":"javascript","x":3123.7857666015625,"y":1290.5,"wires":[[]]},{"id":"f0ddfaa9d95b07f7","type":"change","z":"119a019d22344192","g":"d6b70422242c4b00","name":"delete old items - 3 hours","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t   \"category\": \"rssfeeds\",\t   \"old_than_ms\": 1000 * 60 * 180,\t   \"name\": \"Hacker News: New Comments\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":3110.7857666015625,"y":1213.5,"wires":[["cb8915b3999f4b65"]]},{"id":"94491cca3fb551c3","type":"delay","z":"119a019d22344192","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2976.66650390625,"y":708.3333129882812,"wires":[["8096598130f92348"]]},{"id":"d6989b8cdc9cc614","type":"ClientCode","z":"119a019d22344192","g":"bbf722420c362971","name":"using dagre","clientcode":"/* Code take from https://pastebin.com/TJRFD3mg\n   which came from https://discourse.nodered.org/t/read-flows-json-and-position-the-nodes-in-most-efficient-readable-way/78158/12\n*/\nvar allnodes = payload.allnodes;\nvar alledges = payload.alledges;\nvar fixedNodeId = payload.fixedNodeId;\n\nvar g = new dagre.graphlib.Graph();\ng.setGraph({});\ng.setDefaultEdgeLabel(function () { return {}; });\n\nfor (var idx = 0; idx < allnodes.length; idx++) {\n    var n = allnodes[idx];\n    g.setNode(n.id, {\n        ...n,\n    })\n}\n\nfor (var idx = 0; idx < alledges.length; idx++) {\n    var e = alledges[idx];\n    g.setEdge(e.sources[0], e.targets[0])\n}\n\ng.graph().rankdir = \"LR\"\ng.graph().marginx = 2\ng.graph().marginy = 2\ng.graph().ranker = \"longest-path\"\ng.graph().nodesep = 2\ng.graph().ranksep = 2\n\ndagre.layout(g)\n\nvar payload = {\n    fixedNodeId: fixedNodeId,\n    nodes: g.nodes().map(function (v) {\n        return {\n            ...g.node(v)\n        }\n    })\n}\nnode.send( { payload: payload })","format":"javascript","x":1021.78564453125,"y":1071,"wires":[["ebdad0d4403173b3"]]},{"id":"a018760f3420e29d","type":"link call","z":"119a019d22344192","g":"bbf722420c362971","name":"","links":["e5587a8f162ae32a"],"linkType":"static","timeout":"30","x":1246.78564453125,"y":959.0000406901045,"wires":[["78f9090fed2fbcfc"]]},{"id":"78f9090fed2fbcfc","type":"link call","z":"119a019d22344192","g":"bbf722420c362971","name":"","links":["c3a1fd7da8e38825"],"linkType":"static","timeout":"30","x":1186.78564453125,"y":1014.2381591796875,"wires":[["d6989b8cdc9cc614"]]},{"id":"0bbc986340d159a1","type":"link call","z":"119a019d22344192","g":"bbf722420c362971","name":"","links":["22363d408e13a802"],"linkType":"static","timeout":"30","x":1425.78564453125,"y":1108,"wires":[["4dd9b367a68f993f"]]},{"id":"1e7f8b2c254e4d60","type":"link in","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"load elkjs","links":[],"x":2919.7857666015625,"y":289,"wires":[["821ed929c72480b8"]]},{"id":"821ed929c72480b8","type":"ClientCode","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"load elkjs","clientcode":"/* \n    Source:\n    https://stackoverflow.com/questions/14644558/call-javascript-function-after-script-is-loaded\n*/\nfunction loadScript(url, callback) {\n    var script = document.createElement(\"script\")\n    script.type = \"text/javascript\";\n\n    if (script.readyState) {  // only required for IE <9\n        script.onreadystatechange = function () {\n            if (script.readyState === \"loaded\" || script.readyState === \"complete\") {\n                script.onreadystatechange = null;\n                callback();\n            }\n        };\n    } else {  //Others\n        script.onload = function () {\n            callback();\n        };\n    }\n\n    script.src = url;\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\n}\n\nif (typeof ELK == \"undefined\") {\n    loadScript(\"https://cdn.openmindmap.org/thirdparty/elk.bundled.js\", () => {\n        node.send({\n            topic: topic,\n            payload: payload\n        })\n    })\n} else {\n    node.send({\n        topic: topic,\n        payload: payload\n    })\n}\n","format":"javascript","x":3082.7857666015625,"y":289,"wires":[["4396339926a3894b"]]},{"id":"4396339926a3894b","type":"link out","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"link out 2","mode":"return","links":[],"x":3224.7857666015625,"y":289,"wires":[]},{"id":"314340aa366d6beb","type":"ClientCode","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"obtain nodes for selection","clientcode":"function doIt() {\n    var selection = RED.view.selection();\n    \n    if (!selection.nodes || selection.nodes.length !== 1) {\n        RED.notify(\"Select exactly one node\");\n        return;\n    }\n\n    // These values will be used to move everything around our selected node but\n    // not move everything into the top left hand corner as Elkjs would like us\n    // to do.\n    var fixedNodeId = selection.nodes[0].id;\n\n    var ns = RED.nodes.getAllFlowNodes(selection.nodes[0]);\n\n    // Convert nodes to flows.json format since all the wires, i.e. links, are \n    // contained in one simple json format.\n    var allnodes = RED.nodes.createExportableNodeSet(ns).filter((n) => {\n        return n.type != \"tab\" && n.type != 'subflow' && n.type != \"group\"\n    });\n\n    var alledges = [];\n    allnodes.forEach((n) => {\n        for (var widx = 0; widx < n.wires.length; widx++) {\n            for (var xidx = 0; xidx < n.wires[widx].length; xidx++) {\n                alledges.push({\n                    id: n.id + n.wires[widx][xidx],\n                    sources: [n.id],\n                    targets: [n.wires[widx][xidx]]\n                });\n            }\n        }\n    })\n\n    allnodes = allnodes.map((n) => {\n        return {\n            id: n.id,\n            width: document.getElementById(n.id).getBBox().width + 3,\n            height: document.getElementById(n.id).getBBox().height + 3,\n        }\n    });\n\n    node.send({\n        payload: {\n            allnodes: allnodes,\n            alledges: alledges,\n            fixedNodeId: fixedNodeId\n        }\n    })\n\n}\n\ndoIt()\n","format":"javascript","x":3093.7857666015625,"y":342,"wires":[["4396339926a3894b"]]},{"id":"c3a1fd7da8e38825","type":"link in","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"obtain nodes for selection","links":[],"x":2919.7857666015625,"y":342,"wires":[["314340aa366d6beb"]]},{"id":"6bf7abf7d244f8dc","type":"ClientCode","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"load dagre.js","clientcode":"/* \n    Source:\n    https://stackoverflow.com/questions/14644558/call-javascript-function-after-script-is-loaded\n*/\nfunction loadScript(url, callback) {\n    var script = document.createElement(\"script\")\n    script.type = \"text/javascript\";\n\n    if (script.readyState) {  // only required for IE <9\n        script.onreadystatechange = function () {\n            if (script.readyState === \"loaded\" || script.readyState === \"complete\") {\n                script.onreadystatechange = null;\n                callback();\n            }\n        };\n    } else {  //Others\n        script.onload = function () {\n            callback();\n        };\n    }\n\n    script.src = url;\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\n}\n\nif ( typeof dagre == \"undefined\") {\nloadScript(\"https://cdn.openmindmap.org/thirdparty/dagre.min.js\", () => {\n    node.send({\n        topic: topic,\n        payload: payload\n    })\n})\n} else {\n    node.send({\n        topic: topic,\n        payload: payload\n    })\n}","format":"javascript","x":3089.7857666015625,"y":221,"wires":[["4396339926a3894b"]]},{"id":"e5587a8f162ae32a","type":"link in","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"load dagre.js","links":[],"x":2919.7857666015625,"y":221,"wires":[["6bf7abf7d244f8dc"]]},{"id":"ebe29205544f1399","type":"ClientCode","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"move nodes","clientcode":"var children = payload.nodes;\nvar fixedNodeId = payload.fixedNodeId;\n\nvar changedNodes = [];\n\n// Before moving anything we get the offset (x,y) - this is the amount that our\n// fixed Node moved - our fixed node does not move, this means everything is offset\n// by the distance it moved.\nvar offsetX = 0;\nvar offsetY = 0;\n\nchildren.forEach((c) => {\n    if (c.id == fixedNodeId) {\n        var nd = RED.nodes.node(c.id);\n        offsetX = c.x - nd.x;\n        offsetY = c.y - nd.y;\n    }\n});\n\nif (isNaN(offsetY) || isNaN(offsetX)) {\n    console.log(fixedNodeId)\n    console.log(RED.nodes.node(fixedNodeId))\n    console.log(children)\n    node.error(\"Offset is NaN\")\n} else {\n    children.forEach((c) => {\n        var nd = RED.nodes.node(c.id);\n\n        changedNodes.push({\n            n: nd,\n            ox: nd.x,\n            oy: nd.y,\n            moved: nd.moved\n        });\n\n        if (!isNaN(c.x - offsetX) && !isNaN(c.y - offsetY)) {\n            nd.x = c.x - offsetX;\n            nd.y = c.y - offsetY;\n            nd.dirty = true;\n        }\n    });\n\n    RED.history.push({ t: \"move\", nodes: changedNodes, dirty: RED.nodes.dirty() });\n    RED.nodes.dirty(true);\n    RED.view.redraw(true);\n\n    node.send({ type: \"ok\", payload: payload })\n}","format":"javascript","x":3083.7857666015625,"y":157,"wires":[["4396339926a3894b"]]},{"id":"22363d408e13a802","type":"link in","z":"119a019d22344192","g":"8b9a71f205e03c83","name":"move nodes","links":[],"x":2919.7857666015625,"y":157,"wires":[["ebe29205544f1399"]]},{"id":"917aedb619af197c","type":"ClientCode","z":"119a019d22344192","name":"all articles and new submissions","clientcode":"var namesToId = {}\n\nRED.nodes.eachNode((n) => {\n  if (n._def.category == \"rssfeeds\") {\n    namesToId[n.name] = n.id\n  }\n})\n\nvar allArticlesIds = [];\n\nRED.nodes.eachNode((n) => {\n  if (n._def.category == \"rssfeeds\" && (n._def.label() == \"Hacker News: Front Page\" || \n                                        n._def.label() == \"Hacker News: Newest\") ) {\n    allArticlesIds.push(n.id)\n  }\n})\n\nnode.send({ \n  topic: \"success\",\n  payload: allArticlesIds\n})\n","format":"javascript","x":895,"y":620,"wires":[["62499e655b5065ba"]]},{"id":"583aad6bb97cfeae","type":"delay","z":"119a019d22344192","name":"","pauseType":"delay","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":712.5,"y":180.5,"wires":[["917aedb619af197c"]]},{"id":"62499e655b5065ba","type":"ClientCode","z":"119a019d22344192","name":"","clientcode":"if ( payload.length > 0 ) {\n    var artId = payload.pop();\n    var nd = RED.nodes.node(artId);\n    RED.view.select({ nodes: [nd] })\n    node.send({\n        payload: payload,\n        origIds: payload\n    })\n} else {\n    node.send({\n        topic: \"done\"\n    })\n}","format":"javascript","x":1120,"y":677,"wires":[["616346ede7e1d427","9d3f5f5dbf787f63"]]},{"id":"4dd9b367a68f993f","type":"change","z":"119a019d22344192","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"origIds","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1706,"y":730,"wires":[["62499e655b5065ba","41596027d789cbfb"]]},{"id":"41596027d789cbfb","type":"debug","z":"119a019d22344192","name":"debug 29","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"","statusType":"counter","x":1896,"y":813,"wires":[]},{"id":"ebdad0d4403173b3","type":"switch","z":"119a019d22344192","g":"bbf722420c362971","name":"","property":"payload.nodes.length","propertyType":"msg","rules":[{"t":"lte","v":"1","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1223.5,"y":1098,"wires":[["4dd9b367a68f993f"],["0bbc986340d159a1"]]},{"id":"3fd12d3cc91f54bf","type":"ClientCode","z":"119a019d22344192","g":"8c55c129f2a5ee57","name":"using elkjs","clientcode":"var nodes = [];\nRED.nodes.eachNode((n) => {\n    if (n._def.category == \"rssfeeds\") {\n        nodes.push(n)\n    }\n})\n\nvar allnodes = RED.nodes.createExportableNodeSet(nodes).filter((n) => {\n    return n.type != \"tab\" && n.type != 'subflow' && n.type != \"group\";\n});\n\nvar hasWire = [];\n\nfor ( var idx = 0; idx < allnodes.length; idx++ ) {\n    var n = allnodes[idx];\n\n    if ( n.wires[0].length > 0 ) {\n        hasWire.push(n.id);\n        for (var widx = 0; widx < n.wires[0].length; widx++) {\n            hasWire.push(n.wires[0][widx])\n        }\n    }\n}\n\nallnodes = allnodes.filter((n) => {\n    return hasWire.indexOf(n.id) < 0;\n});\n\nhasWire = undefined;\n\nvar alledges = [];\nallnodes.forEach((n) => {\n    for (var widx = 0; widx < n.wires.length; widx++) {\n        for (var xidx = 0; xidx < n.wires[widx].length; xidx++) {\n            alledges.push({\n                id: n.id + n.wires[widx][xidx],\n                sources: [n.id],\n                targets: [n.wires[widx][xidx]]\n            });\n        }\n    }\n})\n\nallnodes = allnodes.map((n) => {\n    return {\n        id: n.id,\n        width: document.getElementById(n.id).getBBox().width + 3,\n        height: document.getElementById(n.id).getBBox().height + 3,\n    }\n});\n\n// see https://github.com/kieler/elkjs#api for more details\nvar graph = {\n    id: \"root\",\n    layoutOptions: {\n        'algorithm': 'org.eclipse.elk.box',\n        'childAreaHeight': 3000,\n        'childAreaWidth': 3000,\n    },\n    children: allnodes,\n    edges: alledges\n};\n\nconst elk = new ELK();\n\nelk.layout(graph)\n    .then((g) => {\n        node.send({\n            payload: {\n                fixedNodeId: allnodes[0].id,\n                nodes: g.children\n            }\n        })\n    })\n    .catch((g) => { node.send({ type: \"error\", payload: g }) });\n\n","format":"javascript","x":2412,"y":931.5,"wires":[["dd65e00f2585f10b"]]},{"id":"2a7a1c4264a275c3","type":"link call","z":"119a019d22344192","g":"8c55c129f2a5ee57","name":"","links":["1e7f8b2c254e4d60"],"linkType":"static","timeout":"30","x":2270,"y":859.5,"wires":[["3fd12d3cc91f54bf"]]},{"id":"dd65e00f2585f10b","type":"link call","z":"119a019d22344192","g":"8c55c129f2a5ee57","name":"","links":["22363d408e13a802"],"linkType":"static","timeout":"30","x":2541.5,"y":1023.5,"wires":[["0f89443c327a3540","4da093cce297cee4"]]},{"id":"616346ede7e1d427","type":"switch","z":"119a019d22344192","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"done","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1757.5,"y":667.5000610351562,"wires":[["104abb70577e7fb6"]]},{"id":"9d3f5f5dbf787f63","type":"switch","z":"119a019d22344192","name":"","property":"topic","propertyType":"msg","rules":[{"t":"neq","v":"done","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1233,"y":760,"wires":[["a018760f3420e29d"]]},{"id":"250e696b77b7da29","type":"inject","z":"119a019d22344192","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":485,"y":1052.5,"wires":[["917aedb619af197c"]]},{"id":"104abb70577e7fb6","type":"delay","z":"119a019d22344192","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2017,"y":686.5,"wires":[["2a7a1c4264a275c3"]]},{"id":"0f89443c327a3540","type":"join","z":"119a019d22344192","g":"d6b70422242c4b00","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"7","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2914.7857666015625,"y":1117.5,"wires":[["f0ddfaa9d95b07f7","a6a915b6a7f7f6dc"]]},{"id":"4da093cce297cee4","type":"debug","z":"119a019d22344192","name":"debug 30","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"","statusType":"counter","x":2850,"y":878,"wires":[]},{"id":"a6a915b6a7f7f6dc","type":"debug","z":"119a019d22344192","g":"d6b70422242c4b00","name":"debug 31","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"","statusType":"counter","x":3144.7857666015625,"y":1066.5,"wires":[]},{"id":"77531a1d680aa434","type":"inject","z":"119a019d22344192","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"135","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"","payloadType":"date","x":130.99996948242188,"y":92,"wires":[["2bd777ecf6a3b9aa"]]}]