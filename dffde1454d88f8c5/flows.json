[{"id":"dffde1454d88f8c5","type":"tab","label":"[sound] in-browser Oscillator and Speech node","disabled":false,"info":"### Description\n\nThis creates a simple in-browser oscillator that makes a very simple tone ladder.\n\nThis is inspired by [pagenodes](https://github.com/monteslu/pagenodes) which does have an explicit oscillator node.\n\nThe speaker node usese the [SpeechSynthesisUtterance](https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance) API and the oscillator node uses the [OscillatorNode](https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode) API.\n\n::: warning\n\nThis flow, once started, can only be stopped by restarting the flows.\n\n:::\n\n### Requirements\n\n- [ClientCode node from introspection package](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection)","env":[]},{"id":"ed1c4474e64ca356","type":"junction","z":"dffde1454d88f8c5","x":1204,"y":273,"wires":[["4d9b33ed97cf7953"]]},{"id":"4d9b33ed97cf7953","type":"ClientCode","z":"dffde1454d88f8c5","name":"Oscillator","clientcode":"window.oscillators = window.oscillators || {};\n\nvar context = new AudioContext();\nvar frequency = parseInt(msg.frequency, 10) || node.frequency || 440;\nvar duration = parseInt(msg.duration, 10);\nif (duration != 0 && !duration) {\n    duration = node.duration || 500;\n}\n\n\nif (duration == 0) {\n    if (window.oscillators[frequency]) {\n        window.oscillators[frequency].oscillator.stop(0);\n        clearTimeout(window.oscillators[frequency].timeout);\n        // console.log('cleared osc', node.oscillators[frequency]);\n        delete window.oscillators[frequency];\n    }\n    //return;\n} else {\n\n    var oscillator = context.createOscillator();\n    oscillator.frequency.value = frequency;\n\n    if (Array.isArray(msg.realTable)) {\n        var real = new Float32Array(msg.realTable);\n        var imag;\n        if (msg.imagTable && Array.isArray(msg.imagTable)) {\n            imag = new Float32Array(msg.imagTable);\n        } else {\n            imag = new Float32Array(real.length);\n        }\n        var pWave = context.createPeriodicWave(real, imag);\n        oscillator.setPeriodicWave(pWave);\n    } else {\n        oscillator.type = msg.shape || node.shape || 'sine';\n    }\n\n    oscillator.connect(context.destination);\n    oscillator.start(0);\n\n    var timeout = setTimeout(function () {\n        if (window.oscillators[frequency]) {\n            window.oscillators[frequency].oscillator.stop(0);\n            delete window.oscillators[frequency];\n        }\n    }, duration);\n\n    window.oscillators[frequency] = { timeout: timeout, oscillator: oscillator };\n}","format":"javascript","x":1680,"y":471,"wires":[[]]},{"id":"a38067fc9439e2a9","type":"inject","z":"dffde1454d88f8c5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":297,"y":38,"wires":[["ae97499d5da82046"]]},{"id":"ae97499d5da82046","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"450","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":167,"wires":[["4444ed27f52fcc08","ed1c4474e64ca356"]]},{"id":"486b779d5909d762","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"440","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":942,"y":252,"wires":[["bbbc4edba3f85591","ed1c4474e64ca356"]]},{"id":"4444ed27f52fcc08","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":548,"y":374,"wires":[["486b779d5909d762"]]},{"id":"c27ff140e2475e56","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"430","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":971,"y":349,"wires":[["aafb8d7bd6694964","ed1c4474e64ca356"]]},{"id":"bbbc4edba3f85591","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":606,"y":424,"wires":[["c27ff140e2475e56"]]},{"id":"3e47f92fc845a52e","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"420","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":972,"y":430,"wires":[["4a225645a9803a1e","ed1c4474e64ca356"]]},{"id":"aafb8d7bd6694964","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":666,"y":483,"wires":[["3e47f92fc845a52e"]]},{"id":"6b5dc1823dccc66d","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"410","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":966,"y":501,"wires":[["4b364988de72d54b","ed1c4474e64ca356"]]},{"id":"4a225645a9803a1e","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":724,"y":533,"wires":[["6b5dc1823dccc66d"]]},{"id":"4b364988de72d54b","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":783,"y":584,"wires":[["ae97499d5da82046"]]},{"id":"6c22c0c824c1cc51","type":"ClientCode","z":"dffde1454d88f8c5","name":"Speaker","clientcode":"const synth = window.speechSynthesis;\n\nlet voices = synth.getVoices();\n\nconst utterThis = new SpeechSynthesisUtterance(msg.payload || \"hello world\");\n\nutterThis.voice = voices[0];\n\nsynth.speak(utterThis);\n\n","format":"javascript","x":1458,"y":739,"wires":[[]]},{"id":"27e5e6370596cfdd","type":"inject","z":"dffde1454d88f8c5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"hello world","payloadType":"str","x":943,"y":740,"wires":[["6c22c0c824c1cc51"]]},{"id":"066fe201d2944965","type":"inject","z":"dffde1454d88f8c5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"good bye cruel world","payloadType":"str","x":1036,"y":870,"wires":[["6c22c0c824c1cc51"]]},{"id":"07859189574901fc","type":"inject","z":"dffde1454d88f8c5","name":"Node red is not a dashboard","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"Node red is not a dashboard","payloadType":"str","x":1177,"y":973,"wires":[["6c22c0c824c1cc51"]]}]