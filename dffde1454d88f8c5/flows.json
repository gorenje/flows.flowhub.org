[{"id":"dffde1454d88f8c5","type":"tab","label":"[sound] in-browser Oscillator and Speech node","disabled":false,"info":"### Description\n\nThis creates a simple in-browser oscillator that makes a very simple tone ladder.\n\nThis is inspired by [pagenodes](https://github.com/monteslu/pagenodes) which does have an explicit oscillator node.\n\nThe speaker node usese the [SpeechSynthesisUtterance](https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance) API and the oscillator node uses the [OscillatorNode](https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode) API.\n\n::: warning\n\nThis flow, once started, can only be stopped by restarting the flows.\n\n:::\n\n### Requirements\n\n- [ClientCode node from introspection package](https://flows.nodered.org/node/@gregoriusrippenstein/node-red-contrib-introspection)","env":[]},{"id":"4d9b33ed97cf7953","type":"ClientCode","z":"dffde1454d88f8c5","name":"Oscillator","clientcode":"node.oscillators = {};\n\nvar context = new AudioContext();\nvar frequency = parseInt(msg.frequency, 10) || node.frequency || 440;\nvar duration = parseInt(msg.duration, 10);\nif (duration != 0 && !duration) {\n    duration = node.duration || 500;\n}\n\n\nif (duration == 0) {\n    if (node.oscillators[frequency]) {\n        node.oscillators[frequency].oscillator.stop(0);\n        clearTimeout(node.oscillators[frequency].timeout);\n        // console.log('cleared osc', node.oscillators[frequency]);\n        delete node.oscillators[frequency];\n    }\n    //return;\n}\n\nvar oscillator = context.createOscillator();\noscillator.frequency.value = frequency;\n\nif (Array.isArray(msg.realTable)) {\n    var real = new Float32Array(msg.realTable);\n    var imag;\n    if (msg.imagTable && Array.isArray(msg.imagTable)) {\n        imag = new Float32Array(msg.imagTable);\n    } else {\n        imag = new Float32Array(real.length);\n    }\n    var pWave = context.createPeriodicWave(real, imag);\n    oscillator.setPeriodicWave(pWave);\n} else {\n    oscillator.type = msg.shape || node.shape || 'sine';\n}\n\noscillator.connect(context.destination);\noscillator.start(0);\n\nvar timeout = setTimeout(function () {\n    if (node.oscillators[frequency]) {\n        node.oscillators[frequency].oscillator.stop(0);\n        delete node.oscillators[frequency];\n    }\n}, duration);\n\nnode.oscillators[frequency] = { timeout: timeout, oscillator: oscillator };","format":"javascript","x":1517,"y":319,"wires":[[]]},{"id":"a38067fc9439e2a9","type":"inject","z":"dffde1454d88f8c5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":324,"y":64,"wires":[["ae97499d5da82046"]]},{"id":"ae97499d5da82046","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"450","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":821,"y":153,"wires":[["4d9b33ed97cf7953","4444ed27f52fcc08"]]},{"id":"486b779d5909d762","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"440","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":946,"y":276,"wires":[["4d9b33ed97cf7953","bbbc4edba3f85591"]]},{"id":"4444ed27f52fcc08","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":492,"y":301,"wires":[["486b779d5909d762"]]},{"id":"c27ff140e2475e56","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"430","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":381,"wires":[["aafb8d7bd6694964","4d9b33ed97cf7953"]]},{"id":"bbbc4edba3f85591","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":506,"y":406,"wires":[["c27ff140e2475e56"]]},{"id":"3e47f92fc845a52e","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"420","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":961,"y":465,"wires":[["4a225645a9803a1e","4d9b33ed97cf7953"]]},{"id":"aafb8d7bd6694964","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":507,"y":490,"wires":[["3e47f92fc845a52e"]]},{"id":"6b5dc1823dccc66d","type":"change","z":"dffde1454d88f8c5","name":"","rules":[{"t":"set","p":"shape","pt":"msg","to":"triangle","tot":"str"},{"t":"set","p":"duration","pt":"msg","to":"1100","tot":"str"},{"t":"set","p":"frequency","pt":"msg","to":"410","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":981,"y":543,"wires":[["4d9b33ed97cf7953","4b364988de72d54b"]]},{"id":"4a225645a9803a1e","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":527,"y":568,"wires":[["6b5dc1823dccc66d"]]},{"id":"4b364988de72d54b","type":"delay","z":"dffde1454d88f8c5","name":"","pauseType":"delay","timeout":"900","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":540,"y":645,"wires":[["ae97499d5da82046"]]},{"id":"6c22c0c824c1cc51","type":"ClientCode","z":"dffde1454d88f8c5","name":"Speaker","clientcode":"const synth = window.speechSynthesis;\n\nlet voices = synth.getVoices();\n\nconst utterThis = new SpeechSynthesisUtterance(msg.payload || \"hello world\");\n\nutterThis.voice = voices[0];\n\nsynth.speak(utterThis);\n\n","format":"javascript","x":1369,"y":697,"wires":[[]]},{"id":"27e5e6370596cfdd","type":"inject","z":"dffde1454d88f8c5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"hello world","payloadType":"str","x":845,"y":796,"wires":[["6c22c0c824c1cc51"]]},{"id":"066fe201d2944965","type":"inject","z":"dffde1454d88f8c5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"good bye cruel world","payloadType":"str","x":972,"y":926,"wires":[["6c22c0c824c1cc51"]]},{"id":"07859189574901fc","type":"inject","z":"dffde1454d88f8c5","name":"Node red is not a dashboard","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"Node red is not a dashboard","payloadType":"str","x":1188,"y":1045,"wires":[["6c22c0c824c1cc51"]]}]