[{"id":"0e07ddb58be5f031","type":"tab","label":"[Refactor] Visualising Clarity","disabled":false,"info":"::: aim\n\nThe aim is to demonstrate a form of visual refactoring. Refactoring aids in the clarification of complicated code, it makes code simpler and more understandable.\n\nRefactoring is applies to a visual form of coding and this flow demonstrates that.\n\n:::\n\n### Background\n\nRefactoring code to make it simpler is a big part of being a developer, and this is no different when coding visually. [This change](https://backup.openmindmap.org/?flid=3586922cb708a29c&v2=c58ea88db10993c13b0c21c18f01687e3360efa3&v1=515b0b59e72b99f0bd435f66e16566eb06100622) shows the start and end point of that refactoring that I did. What it does not show are the steps I went through.\n\nThis flow shows those steps, I will try to explain the whys, whats and whens of that refactoring.\n\n### Code\n\nThe code itself is a loop which iterates through a list commits made in a GitHub repository. Normally loops should not be done in this way, that is by having inputs connected to outputs that have their outputs connected to inputs! The code retrieves the details of the commit: author and commit message. The loop exits when the list of commits is empty, as defined in the <a class=\"ahl-node-only\" data-ids=\"eb141daddbe16a63\">is loop done?</a> node. The node then passes out an array containing all commits and their details.\n\nIn writing this up, I realised that the code could be done in parallel, retrieving all the commit details in concurrently. That is the final version shown here. In comparison to the original code, the parallel code is visually simpler to understand however it hides the complexity of parallel processing: create the message, obtain the data, wait until all the data has arrived, synchronisation and all the other complexity that come with concurrent programming.\n\n### Explanation\n\n\nTo begin with, I had <a class=\"ahl-group-only\" data-ids=\"44fd843917f5b1fd\">this group</a> which represented the functionality required and it works. There is nothing wrong with the code, it works and works well but it seems a little like spaghetti code - *literally*! What I don't like is the data lines crossing each other. That is confusing and makes me take too long to understand what is happening, that's the first sign of refactoring.\n\nNode-RED provides a nice little feature in the context menu: insert link nodes:\n\n![img](https://cdn.openmindmap.org/content/1692183291666_Screen_Shot_2023-08-16_at_12.42.12.png)\n\nHighlight the link and insert link nodes. This is what I did with <a class='ahl-link-node' data-ids=\"63bf4ed53fac87b0,eb141daddbe16a63\">this link</a> and <a class='ahl-link-node' data-ids=\"2e84fdf7687e96db,63bf4ed53fac87b0\">this link</a>. That brought me to <a class=\"ahl-group-only\" data-ids=\"226a97c957680f7b\">this group</a> which does look better. However what I didn't like about that group was that the <a class=\"ahl-link-node\" data-ids=\"49f691141a114596,36b43954495e87a4\">link to the exit node</a> crossed the second link out of the *is loop done?* node.\n\nThere had to be a better solution.\n\n\n\n![img](https://cdn.openmindmap.org/content/1692183278260_Screen_Shot_2023-08-16_at_12.52.39.png)\n","env":[]},{"id":"44fd843917f5b1fd","type":"group","z":"0e07ddb58be5f031","name":"retrieve specific commit details","style":{"label":true},"nodes":["48e7f8ab8bf67d6a","2e84fdf7687e96db","63bf4ed53fac87b0","eb141daddbe16a63"],"x":271,"y":196,"w":466,"h":489},{"id":"8a5580ab13df56e6","type":"group","z":"0e07ddb58be5f031","name":"retrieve specific commit","style":{"label":true},"nodes":["2b42d79862869573","908b454275656ccd","a56202f9582cdbe9","20e6a497f7ac7d9d","d8e2363b051259d2"],"x":208.97015237808228,"y":1486.7709317207336,"w":500.32584297657013,"h":300.9998869895935},{"id":"226a97c957680f7b","type":"group","z":"0e07ddb58be5f031","name":"retrieve specific commit details","style":{"label":true},"nodes":["9bb4dea559fa1477","ee0a8cae8150591a","d0916c506e178b81","49f691141a114596","4467bc6464a2743d","b4d82c983286fe15","bb7089242a04094e","520b1b5c859bcbf4"],"x":1021,"y":272,"w":624,"h":340},{"id":"dda47cf6fa5056ef","type":"group","z":"0e07ddb58be5f031","g":"8cba9d4a60edf737","name":"retrieve specific commit details","style":{"label":true},"nodes":["855ec9d6064faef0","d502d8642cdc5d80","ee05db7ee675c7c7","a0da685b06d5636c"],"x":412,"y":829,"w":432,"h":489},{"id":"9d28ca8a8dceb9a1","type":"group","z":"0e07ddb58be5f031","g":"8cba9d4a60edf737","name":"retrieve specific commit details","style":{"label":true},"nodes":["1b8f6fb804c2a146","50289f2b4e9cdc83","6be88d10e227cb89","c06c24b244849166","d6251135a28cbd6f","9cde6c57783b93d4"],"x":1044,"y":825,"w":403,"h":513},{"id":"6737273baae3341f","type":"group","z":"0e07ddb58be5f031","name":"retrieve all details for specific commits","style":{"label":true},"nodes":["a5e5a535cd62d611","28b17aadf4fad367","dc8cfd520906621c","2b04bd04e951108a","1f1cb522b2026602"],"x":1091,"y":1478,"w":300,"h":317},{"id":"8cba9d4a60edf737","type":"group","z":"0e07ddb58be5f031","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["535fb7132732849d","a556e89b454b75cf","6f0365527aa3d17d","dda47cf6fa5056ef","9d28ca8a8dceb9a1","90d9ae5cc588c58c"],"x":209,"y":799,"w":1441,"h":565},{"id":"d8e2363b051259d2","type":"junction","z":"0e07ddb58be5f031","g":"8a5580ab13df56e6","x":234.97015237808228,"y":1755.0216538906097,"wires":[["908b454275656ccd"]]},{"id":"48e7f8ab8bf67d6a","type":"function","z":"0e07ddb58be5f031","g":"44fd843917f5b1fd","name":"handle the query 'c' - commit list","func":"msg.shasToObtain = msg.req.query.c.split(',');\n\nmsg.payload = msg.shasToObtain.pop();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":437,"y":237,"wires":[["2e84fdf7687e96db"]]},{"id":"2e84fdf7687e96db","type":"link call","z":"0e07ddb58be5f031","g":"44fd843917f5b1fd","name":"[github] get commits for sha","links":[],"linkType":"static","timeout":"30","x":576,"y":498,"wires":[["63bf4ed53fac87b0"]]},{"id":"63bf4ed53fac87b0","type":"function","z":"0e07ddb58be5f031","g":"44fd843917f5b1fd","name":"push commit onto stack and set next commit sha","func":"msg.commits.push({...msg.payload})\n\nmsg.payload = msg.shasToObtain.pop()\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":521,"y":320,"wires":[["eb141daddbe16a63"]]},{"id":"eb141daddbe16a63","type":"switch","z":"0e07ddb58be5f031","g":"44fd843917f5b1fd","name":"is loop done?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":526,"y":644,"wires":[["161f37218fb1496d"],["2e84fdf7687e96db"]]},{"id":"2b42d79862869573","type":"function","z":"0e07ddb58be5f031","g":"8a5580ab13df56e6","name":"handle the query 'c' - commit list","func":"msg.shasToObtain = msg.req.query.c.split(',');\n\nmsg.payload = msg.shasToObtain.pop();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480.2959953546524,"y":1527.7709317207336,"wires":[["908b454275656ccd"]]},{"id":"908b454275656ccd","type":"link call","z":"0e07ddb58be5f031","g":"8a5580ab13df56e6","name":"[github] get commits for sha","links":[],"linkType":"static","timeout":"30","x":563.2959953546524,"y":1594.7709317207336,"wires":[["a56202f9582cdbe9"]]},{"id":"a56202f9582cdbe9","type":"function","z":"0e07ddb58be5f031","g":"8a5580ab13df56e6","name":"push commit onto stack \\n and set next commit sha","func":"msg.commits.push({...msg.payload})\n\nmsg.payload = msg.shasToObtain.pop()\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":542.2958984375,"y":1660.77099609375,"wires":[["20e6a497f7ac7d9d"]]},{"id":"20e6a497f7ac7d9d","type":"switch","z":"0e07ddb58be5f031","g":"8a5580ab13df56e6","name":"is loop done?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":509.2959427833557,"y":1746.7708187103271,"wires":[["a918519ff4b614e2"],["d8e2363b051259d2"]]},{"id":"9bb4dea559fa1477","type":"function","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"handle the query 'c' - commit list","func":"msg.shasToObtain = msg.req.query.c.split(',');\n\nmsg.payload = msg.shasToObtain.pop();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1187,"y":313,"wires":[["ee0a8cae8150591a"]]},{"id":"ee0a8cae8150591a","type":"link call","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"[github] get commits for sha","links":[],"linkType":"static","timeout":"30","x":1499,"y":486,"wires":[["b4d82c983286fe15"]]},{"id":"d0916c506e178b81","type":"function","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"push commit onto stack \\n and set next commit sha","func":"msg.commits.push({...msg.payload})\n\nmsg.payload = msg.shasToObtain.pop()\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1187,"y":451,"wires":[["4467bc6464a2743d"]]},{"id":"49f691141a114596","type":"switch","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"is loop done?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1251,"y":571,"wires":[["36b43954495e87a4"],["ee0a8cae8150591a"]]},{"id":"4467bc6464a2743d","type":"link out","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"link out 110","mode":"link","links":["520b1b5c859bcbf4"],"x":1279,"y":373,"wires":[]},{"id":"520b1b5c859bcbf4","type":"link in","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"link in 4","links":["4467bc6464a2743d"],"x":1077,"y":557,"wires":[["49f691141a114596"]]},{"id":"b4d82c983286fe15","type":"link out","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"link out 111","mode":"link","links":["bb7089242a04094e"],"x":1474,"y":422,"wires":[]},{"id":"bb7089242a04094e","type":"link in","z":"0e07ddb58be5f031","g":"226a97c957680f7b","name":"link in 5","links":["b4d82c983286fe15"],"x":1120,"y":371,"wires":[["d0916c506e178b81"]]},{"id":"855ec9d6064faef0","type":"function","z":"0e07ddb58be5f031","g":"dda47cf6fa5056ef","name":"handle the query 'c' - commit list","func":"msg.shasToObtain = msg.req.query.c.split(',');\n\nmsg.payload = msg.shasToObtain.pop();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":669,"y":870,"wires":[["d502d8642cdc5d80"]]},{"id":"d502d8642cdc5d80","type":"link call","z":"0e07ddb58be5f031","g":"dda47cf6fa5056ef","name":"[github] get commits for sha","links":[],"linkType":"static","timeout":"30","x":657,"y":995,"wires":[["ee05db7ee675c7c7"]]},{"id":"ee05db7ee675c7c7","type":"function","z":"0e07ddb58be5f031","g":"dda47cf6fa5056ef","name":"push commit onto stack and set next commit sha","func":"msg.commits.push({...msg.payload})\n\nmsg.payload = msg.shasToObtain.pop()\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":628,"y":1172,"wires":[["a0da685b06d5636c"]]},{"id":"a0da685b06d5636c","type":"switch","z":"0e07ddb58be5f031","g":"dda47cf6fa5056ef","name":"is loop done?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":675,"y":1277,"wires":[["535fb7132732849d"],["d502d8642cdc5d80"]]},{"id":"1b8f6fb804c2a146","type":"function","z":"0e07ddb58be5f031","g":"9d28ca8a8dceb9a1","name":"handle the query 'c' - commit list","func":"msg.shasToObtain = msg.req.query.c.split(',');\n\nmsg.payload = msg.shasToObtain.pop();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1281,"y":866,"wires":[["50289f2b4e9cdc83"]]},{"id":"50289f2b4e9cdc83","type":"link call","z":"0e07ddb58be5f031","g":"9d28ca8a8dceb9a1","name":"[github] get commits for sha","links":[],"linkType":"static","timeout":"30","x":1269,"y":991,"wires":[["6be88d10e227cb89"]]},{"id":"6be88d10e227cb89","type":"function","z":"0e07ddb58be5f031","g":"9d28ca8a8dceb9a1","name":"push commit onto stack \\n and set next commit sha","func":"msg.commits.push({...msg.payload})\n\nmsg.payload = msg.shasToObtain.pop()\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1264,"y":1121,"wires":[["c06c24b244849166"]]},{"id":"c06c24b244849166","type":"switch","z":"0e07ddb58be5f031","g":"9d28ca8a8dceb9a1","name":"is loop done?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1216,"y":1270,"wires":[["a556e89b454b75cf"],["9cde6c57783b93d4"]]},{"id":"9cde6c57783b93d4","type":"link out","z":"0e07ddb58be5f031","g":"9d28ca8a8dceb9a1","name":"link out 112","mode":"link","links":["d6251135a28cbd6f"],"x":1376,"y":1297,"wires":[]},{"id":"d6251135a28cbd6f","type":"link in","z":"0e07ddb58be5f031","g":"9d28ca8a8dceb9a1","name":"link in 6","links":["9cde6c57783b93d4"],"x":1085,"y":1009,"wires":[["50289f2b4e9cdc83"]]},{"id":"7f407fb6f8e09e43","type":"inject","z":"0e07ddb58be5f031","name":"ENTRY","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":179,"y":237,"wires":[["48e7f8ab8bf67d6a"]]},{"id":"161f37218fb1496d","type":"debug","z":"0e07ddb58be5f031","name":"EXIT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":816,"y":639,"wires":[]},{"id":"36b43954495e87a4","type":"debug","z":"0e07ddb58be5f031","name":"EXIT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1727,"y":565,"wires":[]},{"id":"88262b366cc6b892","type":"inject","z":"0e07ddb58be5f031","name":"ENTRY","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":931,"y":313,"wires":[["9bb4dea559fa1477"]]},{"id":"80d99e34cbbbc9cb","type":"inject","z":"0e07ddb58be5f031","name":"ENTRY","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":129,"y":1528.0000305175781,"wires":[["2b42d79862869573"]]},{"id":"a918519ff4b614e2","type":"debug","z":"0e07ddb58be5f031","name":"EXIT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":811.0000610351562,"y":1740,"wires":[]},{"id":"535fb7132732849d","type":"debug","z":"0e07ddb58be5f031","g":"8cba9d4a60edf737","name":"EXIT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":951,"y":1271,"wires":[]},{"id":"90d9ae5cc588c58c","type":"inject","z":"0e07ddb58be5f031","g":"8cba9d4a60edf737","name":"ENTRY","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":305,"y":868,"wires":[["855ec9d6064faef0"]]},{"id":"a556e89b454b75cf","type":"debug","z":"0e07ddb58be5f031","g":"8cba9d4a60edf737","name":"EXIT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1554,"y":1272,"wires":[]},{"id":"6f0365527aa3d17d","type":"inject","z":"0e07ddb58be5f031","g":"8cba9d4a60edf737","name":"ENTRY","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":950,"y":868,"wires":[["1b8f6fb804c2a146"]]},{"id":"a5e5a535cd62d611","type":"change","z":"0e07ddb58be5f031","g":"6737273baae3341f","name":"split 'c' parameter","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.req.query.c, ',')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1212,"y":1519,"wires":[["28b17aadf4fad367"]]},{"id":"28b17aadf4fad367","type":"split","z":"0e07ddb58be5f031","g":"6737273baae3341f","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1232,"y":1585,"wires":[["2b04bd04e951108a"]]},{"id":"dc8cfd520906621c","type":"join","z":"0e07ddb58be5f031","g":"6737273baae3341f","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1254,"y":1754,"wires":[["e34a7a17b0d9c2e7"]]},{"id":"2b04bd04e951108a","type":"link call","z":"0e07ddb58be5f031","g":"6737273baae3341f","name":"[github] get commits for sha","links":["dbdea53966e72031"],"linkType":"static","timeout":"30","x":1237,"y":1661,"wires":[["dc8cfd520906621c"]]},{"id":"1f1cb522b2026602","type":"catch","z":"0e07ddb58be5f031","g":"6737273baae3341f","name":"","scope":["2b04bd04e951108a"],"uncaught":false,"x":1315,"y":1637,"wires":[["dc8cfd520906621c"]]},{"id":"545f0610813b53aa","type":"inject","z":"0e07ddb58be5f031","name":"ENTRY","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":957,"y":1519,"wires":[["a5e5a535cd62d611"]]},{"id":"e34a7a17b0d9c2e7","type":"debug","z":"0e07ddb58be5f031","name":"EXIT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1615,"y":1753,"wires":[]}]